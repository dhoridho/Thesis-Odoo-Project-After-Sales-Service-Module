<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="service_request_template" name="Service Request Form">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h1>Service Request</h1>
                <form id="service-request-form" action="/service/request/submit" method="post" enctype="multipart/form-data">
                    <!-- CSRF Token -->
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

                    <!-- Customer Selection -->
                    <t t-if="logged_in_customer">
                        <div class="form-group">
                            <label>Customer</label>
                            <input type="text" class="form-control" t-att-value="logged_in_customer.name" readonly="readonly" />
                            <input type="hidden" name="customer_id" t-att-value="logged_in_customer.id" />
                        </div>
                    </t>
                    <t t-else="">
                        <div class="form-group">
                            <label for="customer_id">Customer</label>
                            <select name="customer_id" id="customer_id" class="form-control" required="required">
                                <option t-att-value="''" t-att-disabled="True" t-att-selected="True">Select Customer</option>
                                <t t-if="request.env['res.partner'].sudo().search([('customer_rank', '>', 0)])">
                                    <t t-foreach="request.env['res.partner'].sudo().search([('customer_rank', '>', 0)])" t-as="customer">
                                        <option t-att-value="customer.id">
                                            <t t-esc="customer.name" />
                                        </option>
                                    </t>
                                </t>
                                <t t-else="">
                                    <option value=""  t-att-disabled="True">No Customers Available</option>
                                </t>
                            </select>
                        </div>
                    </t>

                    <!-- Product Dropdown -->
                    <div class="form-group">
                        <label for="product_id">Product</label>
                        <select id="product_id" name="product_id" class="form-control" required="required">
                            <option value=""  t-att-disabled="True" t-att-selected="True">Select Product</option>
                            <t t-if="products and len(products) > 0">
                                <t t-foreach="products" t-as="product">
                                    <option t-att-value="product['id']">
                                        <t t-esc="product['name']" />
                                    </option>
                                </t>
                            </t>
                            <t t-else="">
                                <option value=""  t-att-disabled="True">No Products Available</option>
                            </t>
                        </select>
                    </div>

                    <!-- Request Date -->
                    <div class="form-group">
                        <label for="request_date">Request Date</label>
                        <input type="date" id="request_date" name="request_date" class="form-control" t-att-value="current_date" required="required" />
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea id="description" name="description" class="form-control" placeholder="Describe the issue" required="required"></textarea>
                    </div>

                    <!-- Attachments -->
                    <div class="form-group">
                        <label for="attachments">Upload Attachments</label>
                        <input type="file" id="attachments" name="attachments" class="form-control" multiple="multiple" />
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
            </div>
        </t>
    </template>

    <template id="service_request_success_template" name="Service Request Success">
        <t t-call="website.layout">
            <div class="container mt-5">
                <h1>Success</h1>
                <p>Your service request has been submitted successfully!</p>
                <t t-if="request_number">
                    <p>Request Number: <strong><t t-esc="request_number" /></strong></p>
                </t>
                <a href="/" class="btn btn-primary">Back to Home</a>
            </div>
        </t>
    </template>

    <record id="menu_service_request_form" model="website.menu">
        <field name="name">Service Request</field>
        <field name="url">/service/request</field>
        <field name="parent_id" ref="website.main_menu" />
        <field name="sequence" eval="20" />
    </record>
</odoo>
