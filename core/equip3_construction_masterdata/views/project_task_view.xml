<?xml version="1.0"?>
<odoo>
    <data>
        
        <record id="view_task_tree_project" model="ir.ui.view">
            <field name="name">project.task.tree.project</field>
            <field name="model">project.task</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Job Orders" multi_edit="1" sample="1">
                    <field name="message_needaction" invisible="1" readonly="1"/>
                    <field name="is_closed" invisible="1" />
                    <field name="sequence" invisible="1" readonly="1"/>
                    <field name="name"/>
                    <field name="project_id" optional="show" readonly="1"/>
                    <field name="partner_id" optional="hide"/>
                    <field name="parent_id" groups="project.group_subtask_project" invisible="1"/>
                    <field name="user_id" optional="show" widget="many2one_avatar_user"/>
                    <field name="company_id" groups="base.group_multi_company" optional="show"/>
                    <field name="allow_subtasks" invisible="1"/>
                    <field name="planned_hours" widget="timesheet_uom_no_toggle" sum="Initially Planned Hours" optional="hide"/>
                    <field name="effective_hours" widget="timesheet_uom" sum="Effective Hours" optional="show"/>
                    <field name="remaining_hours" widget="timesheet_uom" sum="Remaining Hours" optional="hide" decoration-danger="progress &gt;= 100" decoration-warning="progress &gt;= 80 and progress &lt; 100"/>
                    <field name="subtask_effective_hours" widget="timesheet_uom" attrs="{'invisible' : [('allow_subtasks', '=', False)]}" optional="hide"/>
                    <field name="total_hours_spent" widget="timesheet_uom" attrs="{'invisible' : [('allow_subtasks', '=', False)]}" optional="hide"/>
                    <field name="progress" widget="progressbar" optional="show" groups="hr_timesheet.group_hr_timesheet_user"/>
                    <field name="activity_ids" widget="list_activity" optional="show"/>
                    <field name="date_deadline" optional="hide" widget="remaining_days" attrs="{'invisible': [('is_closed', '=', True)]}"/>
                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="show"/>
                    <field name="kanban_state" widget="state_selection" optional="hide" readonly="1"/>
                    <field name="stage_id" invisible="context.get('set_visible',False)" readonly="1"/>
                </tree>
            </field>
        </record>

        <record id="view_task_ks_gantt_project" model="ir.ui.view">
            <field name="name">project.task.ks.gantt.project</field>
            <field name="model">project.task</field>
            <field name="arch" type="xml">
                <ks_gantt
                        create="false"
                        ks_context='{
                          "form_view_ref" : "equip3_construction_operation.add_fields_project_task_form"
                        }'
                        ks_task_start_date="planned_start_date"
                        ks_task_end_date="planned_end_date"
                        ks_task_id="id"
                        ks_task_name="name"
                        ks_task_stage_id="state"
                        ks_gantt_config='{
                            "ks_hide_graph_overlay": "True",
                            "ks_hide_deadline": "True",
                            "ks_hide_task_reorder": "True",
                            "ks_hide_resource_panel": "True",
                            "ks_hide_days_off": "True",
                            "ks_hide_grid_owner": "True",
                            "ks_hide_sub_task_icon": "True"
                        }'
                        ks_task_link_info='{
                            "ks_link_source": "ks_source_wo_id",
                            "ks_link_target": "ks_target_wo_id"
                        }'
                        ks_task_progress="progress_task"
                        ks_task_color="gantt_chart_color"
                        
                        ks_export_field='[
                                        "project_id",
                                        "planned_start_date",
                                        "planned_end_date",
                                        "planned_hours",
                                        "state",
                                        "name",
                                        ]'
                >
                <!-- ks_task_link="ks_task_link_json" -->
                </ks_gantt>
            </field>
        </record>

        <record id="task_type_edit_inherit" model="ir.ui.view">
            <field name="name">project.task.type.form</field>
            <field name="model">project.task.type</field>
            <field name="inherit_id" ref="project.task_type_edit"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='project_ids']" position="after">
                    <field name="company_id" invisible="1" />
                    <field name="department_type" invisible="1" />
                </xpath>
            </field>
        </record>

        <record id="project.open_task_type_form" model="ir.actions.act_window">
            <field name="name">Stages</field>
            <field name="res_model">project.task.type</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_id" ref="project.task_type_tree"/>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Create a new stage in the task pipeline
              </p><p>
                Define the steps that will be used in the project from the
                creation of the task, up to the closing of the task or issue.
                You will use these stages in order to track the progress in
                solving a task or an issue.
              </p>
            </field>
        </record>

        <record id="view_task_tree_project_action_view_order_tree" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="equip3_construction_masterdata.view_task_tree_project"/>
            <field name="act_window_id" ref="project.act_project_project_2_project_task_all"/>
        </record>

        <menuitem id="menu_stages"
                  name = "Stages"
                  parent = "abs_construction_management.menu_configuration"
                  action = "project.open_task_type_form"
                  sequence="2" />
                  <!-- groups="base.group_no_one" -->

        <record model='ir.ui.menu' id='menu_stages'>
            <field name="groups_id" eval="[(6, 0, [ref('equip3_construction_accessright_setting.group_construction_engineer')])]"/>
        </record>

    </data>
</odoo>