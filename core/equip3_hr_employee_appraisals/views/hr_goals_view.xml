<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="hr_goals_tree_view" model="ir.ui.view">
            <field name="name">hr.goals.tree</field>
            <field name="model">hr.goals</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="name"/>
                    <field name="goal_types_id"/>
                    <field name="applicable_to"/>
                    <field name="description"/>
                    <field name="achievement_score"/>
                </tree>
            </field>
        </record>

        <record id="hr_goals_form_view" model="ir.ui.view">
            <field name="name">hr.goals.form</field>
            <field name="model">hr.goals</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_submit" states="draft" type="object" string="Submit"/>
                        <field name="state" widget="statusbar" />
                    </header>
                    <sheet>
                        <div name="button_box" class="oe_button_box">
                            <button name="action_goals_child" type="object" class="oe_stat_button" icon="fa-pencil-square-o" attrs="{'invisible':[('is_childs','=',True)]}">
                                <span>Goals Child</span>
                            </button>
                        </div>
                        <group>
                            <group>
                                <field name="is_childs" invisible="1"/>
                                <field name="name" attrs="{'readonly':[('state','=','submitted')]}"/>
                                <field name="allowed_goals_parent_ids" widget="many2many_tags" invisible="1"/>
                                <field name="goals_parent_id" options="{'no_create': True, 'no_open': True}" attrs="{'readonly':[('state','=','submitted')]}"/>
                                <field name="key_result_area_parent_id" options="{'no_create': True, 'no_open': True}" domain="[('goal_title_id','=', goals_parent_id)]" attrs="{'readonly':[('state','=','submitted')],'invisible':[('goals_parent_id','=',False)],'required':[('goals_parent_id','!=',False)]}"/>
                                <field name="weightage" attrs="{'readonly':[('state','=','submitted')]}"/>
                                <field name="goal_types_domain_ids" widget="many2many_tags" invisible="1"/>
                                <field name="goal_types_id" options="{'no_create': True}" domain="[('id','in',goal_types_domain_ids)]" required="1" readonly="1" force_save="1"/>
                                <field name="goal_types_name" invisible="1"/>
                                <field name="is_self_service" invisible="1"/>
                                <field name="goal_types_readonly" invisible="1"/>
                                <field name="applicable_to" attrs="{'readonly':['|','|',('is_self_service','=',True),('state','=','submitted'),('goal_types_readonly','=',True)]}" force_save="1" required="1"/>
                                <field name="company_id" options="{'no_create': True, 'no_open': True}" attrs="{'invisible':[('applicable_to','!=','by_company')],'required':[('applicable_to','=','by_company')],'readonly':[('state','=','submitted')]}"/>
                                <field name="division_ids" widget="many2many_tags" options="{'no_create': True}" attrs="{'invisible':[('applicable_to','!=','by_division')],'required':[('applicable_to','=','by_division')],'readonly':[('state','=','submitted')]}"/>
                                <field name="job_position_ids" widget="many2many_tags" options="{'no_create': True}" attrs="{'invisible':[('applicable_to','!=','by_job_position')],'required':[('applicable_to','=','by_job_position')],'readonly':[('state','=','submitted')]}"/>
                                <field name="teams_ids" widget="many2many_tags" options="{'no_create': True}" attrs="{'invisible':[('applicable_to','!=','by_team')],'required':[('applicable_to','=','by_team')],'readonly':[('state','=','submitted')]}"/>
                                <field name="employee_ids" widget="many2many_tags" options="{'no_create': True}" attrs="{'invisible':[('applicable_to','!=','by_employee')],'required':[('applicable_to','=','by_employee')],'readonly':['|','|',('is_self_service','=',True),('state','=','submitted'),('goal_types_readonly','=',True)]}" force_save="1"/>
                                <field name="description" attrs="{'readonly':[('state','=','submitted')]}"/>
                            </group>
                            <group>
                                <field name="evaluation_period_id" options="{'no_create': True, 'no_open': True}" required="1" attrs="{'readonly':['|',('state','=','submitted'),('goals_parent_id','!=',False)]}" force_save="1"/>
                                <field name="formula" attrs="{'readonly':['|',('state','=','submitted'),('goals_parent_id','!=',False)]}" force_save="1"/>
                                <field name="achievement_score" attrs="{'readonly':['|',('formula','in',['average','sum','max','min','median']),('state','=','submitted')]}" force_save="1"/>
                                <field name="achievement_score_shadow" invisible="1"/>
                                <field name="create_uid"  string = "Created by"/>
                                <field name="create_date" string = "Created on"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="key_result_area" string="Key Result Area">
                                <field name="key_result_area_ids" nolabel="1">
                                    <form>
                                        <sheet>
                                            <group>
                                                <field name="name" required="1"/>
                                                <field name="key_result_type" required="1"/>
                                                <field name="key_result_area_id" options="{'no_create': True}" attrs="{'invisible':[('key_result_type','!=','kpi_based')]}"/>
                                                <field name="milestone_template_id" attrs="{'invisible':[('key_result_type','!=','milestone')],'required':[('key_result_type','=','milestone')]}"/>
                                                <label for="start_date" string="Period" attrs="{'invisible':[('key_result_type','=','milestone')]}"/>
                                                <div attrs="{'invisible':[('key_result_type','=','milestone')]}">
                                                    <field name="start_date" class="oe_inline" required="1"/> - <field name="end_date" class="oe_inline" required="1"/>
                                                </div>
                                                <field name="key_result_milestone_ids" nolabel="1" attrs="{'invisible':[('key_result_type','!=','milestone')]}">
                                                    <tree editable="bottom" create="0" delete="0">
                                                        <field name="sequence" widget="handle"/>
                                                        <field name="name" readonly="1" force_save="1"/>
                                                        <field name="start_date"/>
                                                        <field name="end_date"/>
                                                        <field name="weightage" invisible="1"/>
                                                    </tree>
                                                </field>
                                                <field name="key_result_target" string="Target" required="1"  attrs="{'readonly':[('key_result_type','=','milestone')]}" force_save="1"/>
                                                <field name="actual"/>
                                                <field name="achievement"/>
                                                <field name="check_in_requency" widget="radio" options="{'horizontal': true}"/>
                                                <field name="weekly" attrs="{'invisible':[('check_in_requency','!=','weekly')]}"/>
                                                <field name="monthly" attrs="{'invisible':[('check_in_requency','!=','monthly')]}"/>
                                                <field name="date" attrs="{'invisible':['|',('monthly','!=','specific_days'),('check_in_requency','!=','monthly')],'required':[('monthly','=','specific_days')]}"/>
                                                <field name="priority"/>
                                                <field name="state"/>
                                                <field name="add_member_ids" widget="many2many_tags" options="{'no_create': True}" invisible="1"/>
                                            </group>
                                        </sheet>
                                    </form>
                                    <tree>
                                        <field name="name"/>
                                        <field name="key_result_type"/>
                                        <field name="add_member_ids" widget="many2many_tags" options="{'no_create': True}" string="Member" invisible="1"/>
                                        <field name="key_result_target" string="Target"/>
                                        <field name="actual"/>
                                        <field name="achievement"/>
                                        <field name="priority"/>
                                        <field name="state"/>
                                        <field name="created_by" attrs="{'column_invisible': [('parent.goal_types_name','=','Employee Goals')]}"/>
                                        <field name="is_childs" invisible="1"/>
                                        <button name="button_checkin" type="object" string="Checkin" class="btn-success" attrs="{'invisible':[('is_childs','=',False)]}"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="hr_goals_search" model="ir.ui.view">
            <field name="name">hr.goals.search</field>
            <field name="model">hr.goals</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="goal_types_id"/>
                    <field name="applicable_to"/>
                </search>
            </field>
        </record>

        <record id="hr_company_goals_act_window" model="ir.actions.act_window">
            <field name="name">Company Goals</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.goals</field>
            <field name="view_mode">tree,form</field>
            <field name="context" eval="{'default_goal_types_id':ref('equip3_hr_employee_appraisals.hr_goal_types_company')}"/>
            <field name="domain">['|','&amp;',('assign_user_ids','in',[uid]),('goal_types_id.name','=','Company Goals'),'&amp;',('create_uid','=',uid),('goal_types_id.name','=','Company Goals')]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    There is no data. Click here to add new Goals.
                </p>
            </field>
        </record>

        <record id="hr_division_goals_act_window" model="ir.actions.act_window">
            <field name="name">Division Goals</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.goals</field>
            <field name="view_mode">tree,form</field>
            <field name="context" eval="{'default_goal_types_id':ref('equip3_hr_employee_appraisals.hr_goal_types_division')}"/>
            <field name="domain">['|','&amp;',('assign_user_ids','in',[uid]),('goal_types_id.name','=','Division Goals'),'&amp;',('create_uid','=',uid),('goal_types_id.name','=','Division Goals')]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    There is no data. Click here to add new Goals.
                </p>
            </field>
        </record>

        <record id="hr_team_goals_act_window" model="ir.actions.act_window">
            <field name="name">Team Goals</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.goals</field>
            <field name="view_mode">tree,form</field>
            <field name="context" eval="{'default_goal_types_id':ref('equip3_hr_employee_appraisals.hr_goal_types_my_team')}"/>
            <field name="domain">['|','&amp;',('assign_user_ids','in',[uid]),('goal_types_id.name','=','Team Goals'),'&amp;',('create_uid','=',uid),('goal_types_id.name','=','Team Goals')]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    There is no data. Click here to add new Goals.
                </p>
            </field>
        </record>

        <record id="hr_goals_act_window" model="ir.actions.act_window">
            <field name="name">My Goals/Objective</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.goals</field>
            <field name="view_mode">tree,form</field>
            <field name="context" eval="{'default_goal_types_id':ref('equip3_hr_employee_appraisals.hr_goal_types_employee')}"/>
            <field name="domain">['|','&amp;',('assign_user_ids','in',[uid]),('goal_types_id.name','=','Employee Goals'),'&amp;',('create_uid','=',uid),('goal_types_id.name','=','Employee Goals')]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    There is no data. Click here to add new Goals.
                </p>
            </field>
        </record>

        <menuitem name="OKR" id="menu_okr_root"
                parent="employee_performance.menu_template" sequence="3"/>

        <menuitem name="My Goals" id="hr_goals_menu"
                  parent="menu_okr_root"
                  action="hr_goals_act_window"
                  sequence="10"/>
        <menuitem name="Company Goals" id="hr_company_goals_menu"
                  parent="menu_okr_root"
                  action="hr_company_goals_act_window"
                  sequence="20"/>
        <menuitem name="Division Goals" id="hr_division_goals_menu"
                  parent="menu_okr_root"
                  action="hr_division_goals_act_window"
                  sequence="30"/>
        <menuitem name="Team Goals" id="hr_team_goals_menu"
                  parent="menu_okr_root"
                  action="hr_team_goals_act_window"
                  sequence="40"/>

        <record id="hr_goals_child_tree_view" model="ir.ui.view">
            <field name="name">hr.goals.child.tree</field>
            <field name="model">hr.goals.child</field>
            <field name="arch" type="xml">
                <tree create="0" editable="top">
                    <field name="goal_types_id" readonly="1" options="{'no_open': True}"/>
                    <field name="goal_title" readonly="1"/>
                    <field name="create_by" readonly="1" options="{'no_open': True}"/>
                    <field name="achievement_score" readonly="1"/>
                    <field name="weightage" readonly="1"/>
                    <field name="score" readonly="1"/>
                </tree>
            </field>
        </record>

        <record id="hr_goals_child_filter" model="ir.ui.view">
            <field name="name">hr.goals.child.filter</field>
            <field name="model">hr.goals.child</field>
            <field name="arch" type="xml">
                <search string="Search Goal Child">
                    <field name="key_result_area_id" string="Key Result Area" invisible="1"/>
                    <group expand="0" string="Group By">
                        <filter name="group_key_result_area" string="Key Result Area" context="{'group_by':'key_result_area_id'}"/>
                    </group>
                </search>
            </field>
        </record>
    </data>
</odoo>