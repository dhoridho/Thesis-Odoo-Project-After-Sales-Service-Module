<?xml version="1.0"?>
<odoo>

    <!-- stock.picking inherit tree view -->
    <record id="stock_picking_tree_view_inherit" model="ir.ui.view">
        <field name="name">stock.picking.inherit.view.tree</field>
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="sh_inventory_mrp_qc.stock_picking_tree_view_inherit"/>
        <field name="arch" type="xml">
            <!-- <xpath expr="//field[@name='need_qc']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='qc_fail']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='qc_pass']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath> -->
            <xpath expr="//field[@name='need_qc']" position="replace">
            </xpath>
            <xpath expr="//field[@name='qc_fail']" position="replace">
            </xpath>
            <xpath expr="//field[@name='qc_pass']" position="replace">
            </xpath>

            <!-- remove/hide qc field in tree -->
            <!-- <xpath expr="//field[@name='qc_pass']" position="after">
                <field name="need_qc_and_under_progress" string="Need QC"/>
                <field name="is_qc_fail" string="QC Fail"/>
                <field name="is_qc_pass" string="QC Pass"/>
                <field name="is_pending_qc" invisible="1"/>
                <field name="is_under_progress" invisible="1" string="Under Progress QC"/>
                <field name="qc_status" invisible="1"/>
            </xpath> -->
        </field>
    </record>

    <record id="view_form_stock_picking_internal_warehouse" model="ir.ui.view">
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="equip3_inventory_operation.view_form_stock_picking_internal_warehouse"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='operation_details']/field[@name='picking_type_id']" position="after">
                <field name="need_qc" invisible="1" /><field name="qc_fail" invisible="1" /> <field name="qc_pass" invisible="1" /><field name="is_mandatory" invisible="1" />
                <field name="full_pass" invisible="1" />
            </xpath>
            <xpath expr="//field[@name='owner_id']" position="after">
                <field name="is_all_qc_with_remaining_qty" invisible="1"/>
                <field name="is_all_checked" invisible="1"/>
                <field name="is_status_fail_or_pass" invisible="1"/>
                <field name="is_only_read_qc" invisible="1"/>
                <field name="filter_qc" invisible="1"/>
                <field name="is_pending_qc" invisible="1"/>
                <field name="is_under_progress" invisible="1"/>
                <field name="is_qc_fail" invisible="1"/>
                <field name="is_qc_pass" invisible="1"/>
                <field name="qc_status" invisible="1"/>
            </xpath>
            <xpath expr="//sheet/div[@name='button_box']" position="after">
                <div name="control_info">
                    <div class="alert alert-info text-center o_form_header" attrs="{'invisible': ['|','|','|',('full_pass','=',True),('need_qc', '=', False),('qc_fail','=',True),('qc_pass','=',True)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Still Pending.</strong>
                        </div>
                    </div>
                    <div class="alert alert-info text-center o_form_header" style="background: #efd9d9; color: maroon; border: 1px solid #e9b4b4;" attrs="{'invisible': [('qc_fail','=',False)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Failed.</strong>
                        </div>
                    </div>
                    <div class="alert alert-info text-center o_form_header" style="background: #dceddd; color: green; border: 1px solid #b4efb9;" attrs="{'invisible': ['|',('need_qc', '=', False),('full_pass','=',False)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Successfully Passed</strong>
                        </div>
                    </div>
                </div>
            </xpath>
            <xpath expr="//field[@name='move_ids_without_package']/tree/field[@name='product_uom_qty']" position="after">
                <field name='remaining_checked_qty' invisible="1"/>
                <field name="recheck_max_number" invisible="1"/>
            </xpath>
            <xpath expr="/form/header/button[@name='action_assign']" position="after">
                <button name="quality_point" type="object" string="Quality Checks" class="oe_highlight" attrs="{'invisible':['|', '|', ('need_qc', '=', False), ('state', '!=', 'assigned'), ('is_all_qc_with_remaining_qty', '=', False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user" />
                <button name="action_quality_alert" type="object" string="Quality Alerts" class="oe_highlight" attrs="{'invisible':['|', '|', ('need_qc', '=', False), ('state', '!=', 'assigned'), ('is_all_qc_with_remaining_qty', '=', False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user" />
            </xpath>
            <xpath expr="//div[@name='button_box']//button[@name='action_see_move_scrap']" position="before">
                <button name="open_quality_check" class="oe_stat_button" icon="fa-check" type="object" attrs="{'invisible':[('need_qc', '=', False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user">
                    <field name="qc_count" widget="statinfo" string="Quality Checks" />
                </button>

                <button name="open_quality_alert" class="oe_stat_button" icon="fa-warning" type="object" attrs="{'invisible':[('need_qc', '=', False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user">
                    <field name="qc_alert_count" widget="statinfo" string="Quality Alerts" />
                </button>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field/tree/field[@name='quantity_done']" position="before">
                <field name="sh_quality_point" invisible="1" />
                <field name="sh_quality_point_id" invisible="1" />
                <field name="number_of_test" invisible="1" />
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field/tree/field[@name='product_uom']" position="after">
                <field name="sh_last_qc_date" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'column_invisible':[('parent.need_qc', '=', False)]}" />
                <field name="sh_last_qc_state" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'column_invisible':[('parent.need_qc', '=', False)]}" />
                <button
                    name="quality_point_line"
                    type="object"
                    string=""
                    class="oe_stat_button"
                    icon="fa-check-square"
                    attrs="{'invisible':['|',('sh_quality_point','=',False),('number_of_test','&lt;=',0)]}"
                    groups="sh_inventory_mrp_qc.sh_quality_control_user"
                />
                <button name="quality_alert" type="object" string="" class="oe_stat_button" icon="fa-warning" attrs="{'invisible':[('sh_quality_point','=',False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user" />
            </xpath>
            <xpath expr="//notebook//page[4]" position="after">
                <page string="Quality Checks" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'invisible':[('need_qc', '=', False)]}">
                    <field name="sh_quality_check_ids" context="{'form_view_ref':'equip3_inventory_qc.quality_check_line_form_view'}">
                        <tree editable="bottom">
                            <field name="product_id"/>
                            <field name="sh_picking"/>
                            <field name="sh_date"/>
                            <field name="control_point_id"/>
                            <field name="checked_qty" readonly="1"/>
                            <field name="remaining_qty" readonly="1"/>
                            <field name="state" decoration-success="state == 'pass'" decoration-danger="state in ('fail','repair','scrap','transfer')"/>
                            <field name="type_of_qc"/>
                            <field name="is_recheck" invisible="1"/>
                            <button name="recheck" type="object" string="Recheck" class="oe_highlight" attrs="{'invisible':['|','|',('state', '!=', 'fail'),('is_recheck','!=',True),('parent.is_only_read_qc', '=', True)]}" context="{'from_recheck_line': True}"/>
                        </tree>
                    </field>
                    <group>
                        <group>
                            <lable for="attachment_ids" />
                            <field name="attachment_ids" widget="many2many_binary" />
                        </group>
                    </group>
                </page>
                <page string="Quality Alerts" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'invisible':[('need_qc', '=', False)]}">
                    <field name="sh_quality_alert_ids" />
                </page>
            </xpath>
            <xpath expr="//button[@name='button_validate'][1]" position="replace">
                <button
                    name="button_validate"
                    attrs="{'invisible': ['|','|', '|', ('state', 'in', ('waiting','confirmed')), ('show_validate', '=', False),'&amp;',('full_pass','=',False),('is_mandatory','=',True), ('is_all_qc_with_remaining_qty', '=', True)]}"
                    string="Validate"
                    type="object"
                    class="oe_highlight"
                    groups="stock.group_stock_user"
                />
            </xpath>
            <xpath expr="//button[@name='button_validate'][2]" position="replace">
                <button
                    name="button_validate"
                    attrs="{'invisible': ['|','|', '|', ('state', 'not in', ('waiting', 'confirmed')), ('show_validate', '=', False),'&amp;',('full_pass','=',False),('is_mandatory','=',True), ('is_all_qc_with_remaining_qty', '=', True)]}"
                    string="Validate"
                    type="object"
                    groups="stock.group_stock_user"
                    class="o_btn_validate"
                />
            </xpath>
        </field>
    </record>


    <!-- newwwww -->
    <record id="view_picking_form" model="ir.ui.view">
        <field name="model">stock.picking</field>
        <field name="inherit_id" ref="stock.view_picking_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='owner_id']" position="after">
                <field name="is_all_qc_with_remaining_qty" invisible="1"/>
                <field name="is_all_checked" invisible="1"/>
                <field name="is_status_fail_or_pass" invisible="1"/>
                <field name="is_only_read_qc" invisible="1"/>
                <field name="filter_qc" invisible="1"/>
                <field name="is_pending_qc" invisible="1"/>
                <field name="is_under_progress" invisible="1"/>
                <field name="is_qc_fail" invisible="1"/>
                <field name="is_qc_pass" invisible="1"/>
                <field name="qc_status" invisible="1"/>
                <field name="picking_grade_id" invisible="1" force_save="1" readonly="1"/>
                <field name="is_quality_point_grade" invisible="1"/>
            </xpath>

            <xpath expr="/form/header/button[@name='action_assign']" position="after">
                <button name="quality_point" type="object" string="Quality Checks" class="oe_highlight" groups="sh_inventory_mrp_qc.sh_quality_control_user"
                    attrs="{'invisible':['|', '|', '|',('need_qc', '=', False), ('state', '!=', 'assigned'), ('is_all_qc_with_remaining_qty', '=', False), ('is_only_read_qc', '=', True)]}"/>
                <button name="action_quality_alert" type="object" string="Quality Alerts" class="oe_highlight" groups="sh_inventory_mrp_qc.sh_quality_control_user"
                    attrs="{'invisible':['|', '|', ('need_qc', '=', False), ('state', '!=', 'assigned'), ('is_all_qc_with_remaining_qty', '=', False)]}"/>
            </xpath>
            <xpath expr="//div[@name='button_box']//button[@name='action_see_move_scrap']" position="before">
                <button name="open_quality_check" class="oe_stat_button" icon="fa-check" type="object" attrs="{'invisible':[('need_qc', '=', False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user">
                    <field name="qc_count" widget="statinfo" string="Quality Checks" />
                </button>

                <button name="open_quality_alert" class="oe_stat_button" icon="fa-warning" type="object" attrs="{'invisible':[('need_qc', '=', False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user">
                    <field name="qc_alert_count" widget="statinfo" string="Quality Alerts" />
                </button>

                <button name="action_view_product_grade" string="Product Grading" class="oe_stat_button" icon="fa-random" type="object" attrs="{'invisible':['|','|',('state','!=','done'),('need_qc', '=', False),('is_quality_point_grade','=',False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user">
                </button>
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field/tree/field[@name='quantity_done']" position="before">
                <field name="sh_quality_point_id" invisible="1" />
            </xpath>
            <xpath expr="/form/sheet/notebook/page/field/tree/field[@name='product_uom']" position="after">
                <field name="sh_quality_point" invisible="1" />
                <field name="number_of_test" invisible="1" />
                <field name="remaining_checked_qty" invisible="1"/>
                <field name="recheck_max_number" invisible="1"/>
                <field name="sh_last_qc_date" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'column_invisible':[('parent.need_qc', '=', False)]}" />
                <field name="sh_last_qc_state" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'column_invisible':[('parent.need_qc', '=', False)]}" />
                <button
                    name="quality_point_line"
                    type="object"
                    string=""
                    class="oe_stat_button"
                    icon="fa-check-square"
                    attrs="{'invisible':['|',('sh_quality_point','=',False),('number_of_test','&lt;=',0)]}"
                    groups="sh_inventory_mrp_qc.sh_quality_control_user"
                />
                <button name="quality_alert" type="object" string="" class="oe_stat_button" icon="fa-warning" attrs="{'invisible':[('sh_quality_point','=',False)]}" groups="sh_inventory_mrp_qc.sh_quality_control_user" />
            </xpath>
            <xpath expr="//notebook//page[4]" position="after">
                <page string="Quality Checks" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'invisible':[('need_qc', '=', False)]}">
                    <field name="sh_quality_check_ids" context="{'form_view_ref':'equip3_inventory_qc.quality_check_line_form_view'}">
                        <tree editable="bottom">
                            <field name="product_id"/>
                            <field name="sh_picking"/>
                            <field name="sh_date"/>
                            <field name="control_point_id"/>
                            <field name="checked_qty" readonly="1"/>
                            <field name="remaining_qty" readonly="1"/>
                            <field name="state" decoration-success="state == 'pass'" decoration-danger="state in ('fail','repair','scrap','transfer')"/>
                            <field name="type_of_qc"/>
                            <field name="is_recheck" invisible="1"/>
                            <button name="recheck" type="object" string="Recheck" class="oe_highlight" attrs="{'invisible':['|','|',('state', '!=', 'fail'),('is_recheck','!=',True),('parent.is_only_read_qc', '=', True)]}" context="{'from_recheck_line': True}"/>
                            <field name="is_quality_point_grade" invisible="1"/>
                            <button name="action_grade" type="object" string="Grade" class="oe_highlight" context="{'need_grade': True}" attrs="{'invisible':['|','|',('state', '!=', 'pass'), ('product_grade_id', '!=', False),('is_quality_point_grade','=', False)]}"/>
                            <field name="product_grade_id" force_save="1" readonly="1"/>
                        </tree>
                    </field>
                    <group>
                        <group>
                            <lable for="attachment_ids" />
                            <field name="attachment_ids" widget="many2many_binary" />
                        </group>
                    </group>
                </page>
                <page string="Quality Alerts" groups="sh_inventory_mrp_qc.sh_quality_control_user" attrs="{'invisible':[('need_qc', '=', False)]}">
                    <field name="sh_quality_alert_ids" />
                </page>
            </xpath>
            <field name="picking_type_id" position="after">
                <field name="need_qc" invisible="1" /><field name="qc_fail" invisible="1" /> <field name="qc_pass" invisible="1" /><field name="is_mandatory" invisible="1" />
                <field name="full_pass" invisible="1" />
            </field>
            <xpath expr="//sheet/div[@name='button_box']" position="after">
                <div name="control_info">
                    <field name="picking_grade_id" invisible="1"/>
                    <div class="alert alert-info text-center o_form_header" attrs="{'invisible': ['|',('is_pending_qc','!=',True), ('picking_grade_id','!=', False)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Still Pending.</strong>
                        </div>
                    </div>
                    <div class="alert alert-info text-center o_form_header" style="background: #FEFFD4; color: #999C00; border: 1px solid #D5D683;" attrs="{'invisible': [('is_under_progress','!=',True)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Under Progress.</strong>
                        </div>
                    </div>
                    <div class="alert alert-info text-center o_form_header" style="background: #efd9d9; color: maroon; border: 1px solid #e9b4b4;" attrs="{'invisible': [('is_qc_fail','!=', True)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Failed.</strong>
                        </div>
                    </div>
                    <div class="alert alert-info text-center o_form_header" style="background: #f3ea7d; color: #86611d; border: 1px solid #f3ea7d;" invisible="1" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Completed With Some Products Partially Passed.</strong>
                        </div>
                    </div>
                    <div class="alert alert-info text-center o_form_header" style="background: #dceddd; color: green; border: 1px solid #b4efb9;" attrs="{'invisible': [('is_qc_pass','!=', True)]}" role="alert">
                        <div>
                            <strong>Product(s) Quality Control Successfully Passed</strong>
                        </div>
                    </div>
                </div>
            </xpath>
            <xpath expr="//button[@name='button_validate'][1]" position="replace">
                <button
                    name="button_validate"
                    attrs="{'invisible': ['|','|', '|', ('state', 'in', ('waiting','confirmed')), ('show_validate', '=', False),'&amp;',('is_under_progress','=',True),('is_mandatory','=',True), ('is_all_qc_with_remaining_qty', '=', True)]}"
                    string="Validate"
                    type="object"
                    class="oe_highlight"
                    groups="stock.group_stock_user"
                />
            </xpath>
            <xpath expr="//button[@name='button_validate'][2]" position="replace">
                <button
                    name="button_validate"
                    attrs="{'invisible': ['|','|', '|', ('state', 'not in', ('waiting','confirmed')), ('show_validate', '=', False),'&amp;',('is_under_progress','=',True),('is_mandatory','=',True), ('is_all_qc_with_remaining_qty', '=', True)]}"
                    string="Validate"
                    type="object"
                    groups="stock.group_stock_user"
                    class="o_btn_validate"
                />
            </xpath>
        </field>
    </record>


</odoo>
