<?xml version="1.0" encoding="utf-8"?>

<odoo>
        <record id="limit_request_comp_rule" model="ir.rule">
            <field name="name">Customer Limit Request multi-company</field>
            <field name="model_id" ref="model_limit_request"/>
            <field name="domain_force">[('company_id', 'in', company_ids)]</field>
            <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="view_credit_limit_request_form" model="ir.ui.view">
            <field name="name">Credit Limit Request</field>
            <field name="model">limit.request</field>
            <field name="arch" type="xml">
                <form string="Limit Request">
                    <header>
                        <button name="request_approve" type="object" string="Approve" class="btn-primary" attrs="{'invisible': ['|', '|',('id','=',False),('state', '!=', 'draft'), ('limit_approval_matrix', '!=', False)]}"/>
                        <button name="request_approval" type="object" string="Request for Approval" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', '!=', 'draft'), ('limit_approval_matrix', '=', False), ('is_approve_button', '=', False)]}"/>
                        <button name="action_approve_approval" string="Approve" type="object" class="oe_highlight oe_read_only" attrs="{'invisible': ['|', '|', ('approval2', '!=', True), ('state', '!=', 'waiting_approval'), ('is_approve_button', '=', False)]}"/>
                        <button name="action_reject_approval" string="Reject" type="object" attrs="{'invisible': ['|', '|', ('approval2', '!=', True), ('state', '!=', 'waiting_approval'), ('is_approve_button', '=', False)]}"/>
                        <field name="approval2" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="state1" widget="statusbar" align="right"  statusbar_visible="draft,waiting_approval,confirmed" attrs="{'invisible':[('state', '=', 'rejected')]}"/>
                        <field name="state2" widget="statusbar" align="right"  statusbar_visible="draft,waiting_approval,rejected" attrs="{'invisible':[('state', '!=', 'rejected')]}"/>
                    </header>
                    <sheet>
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                        <group >
                            <group>
                                <field name="is_approve_button" invisible="1"/>
                                <field name="is_external_link" invisible="1"/>
                                <field name="partner_id" required="1"  attrs="{'readonly': [('state', 'in', ('confirmed','rejected'))]}" domain="[('customer_rank','>', 0)]" options="{'no_create': True}" context="{'default_is_external_link': True}"/>
                                <field name="is_credit_limit_brand" invisible="1"/>
                                <field name="brand_ids" invisible="1"/>
                                <field name="limit_type" invisible="1"/>
                                <field name="limit_type_old" string="Limit Type" required="1"  attrs="{'readonly': [('state', 'in', ('confirmed','rejected'))], 'invisible': [('is_credit_limit_brand','=', True)]}"/>
                                <field name="limit_type_new" string="Limit Type" required="1"  attrs="{'readonly': [('state', 'in', ('confirmed','rejected'))], 'invisible': [('is_credit_limit_brand','!=', True)]}"/>
                                <field name="credit_amount" attrs="{'invisible': [('limit_type','!=', 'credit_limit')], 'required': [('limit_type', '=', 'credit_limit')], 'readonly': [('state', 'in', ('confirmed','rejected'))]}"/>
                                <field name="last_credit_limit" attrs="{'invisible': [('limit_type','!=', 'credit_limit')], 'readonly': [('state', '=', 'confirmed')]}" readonly="1" force_save="1"/>
                                <field name='new_max_invoice'  attrs="{'invisible' : [('limit_type','!=', 'max_invoice_overdue_days')], 'required': [('limit_type', '=', 'max_invoice_overdue_days')], 'readonly': [('state', '=', 'confirmed')]}"/>
                                <field name="last_max_invoice" attrs="{'invisible' : [('limit_type','!=', 'max_invoice_overdue_days')], 'readonly': [('state', '=', 'confirmed')]}" readonly="1" force_save="1"/>
                                <field name="open_inv_no" attrs="{'invisible': [('limit_type', '!=', 'open_invoice_limit')], 'required': [('limit_type', '=', 'open_invoice_limit')], 'readonly': [('state', '=', 'confirmed')]}" />
                                <field name="last_open_inv_no" attrs="{'invisible' : [('limit_type', '!=', 'open_invoice_limit')], 'readonly': [('state', '=', 'confirmed')]}" readonly="1" force_save="1"/>
                                <field name="description" attrs="{'readonly': [('state', 'in', ('confirmed','rejected'))]}"/>

                            </group>
                            <group>
                                <field name="create_date" string="Creation Date"/>
                                <field name="create_uid" string="Created By"/>
                                <field name="company_id" readonly="1"/>
                                <field name="branch_id" attrs="{'readonly': [('state', 'in', ('confirmed','rejected'))]}"/>
                                <field name="limit_approval_matrix" readonly="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Brand" attrs="{'invisible': ['|',('is_credit_limit_brand','=',False),('limit_type_new','!=','credit_limit_brand')]}">
                                <group id="product_brand_ids">
                                    <field name="product_brand_ids" nolabel="1" context="{'product_brand_ids': product_brand_ids}" attrs="{'invisible': ['|',('is_credit_limit_brand','=',False),('limit_type_new','!=','credit_limit_brand')]}">
                                        <tree editable="bottom">
                                            <field name="sequence" width="5%" string="No."/>
                                            <field name="brand_ids" invisible="1" widget="many2many_tags"/>
                                            <field name="brand_id" required="1" width="35%" domain="[('id', 'not in', brand_ids)]" options="{'no_create': True}"/>
                                            <field name="new_credit_limit_amount" readonly="0" force_save="1" width="30%"/>
                                            <field name="last_credit_limit_amount" readonly="1" force_save="1" width="30%"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                            <page string="Approval Matrix Line" attrs="{'invisible':[('limit_approval_matrix', '=', False)]}">
                                <field name="approval_ids" nolabel="True">
                                    <tree create="false" edit="false" delete="false">
                                        <field name="sequence" invisible="1"/>
                                        <field name="sequence2" force_save="1" readonly="1" class="approver_matrix_sequence"/>
                                        <field name="user_ids" widget="many2many_tags"/>
                                        <field name="minimum_approver"/>
                                        <field name="status"/>
                                        <field name="time"/>
                                        <field name="feedback" string="Rejected Reason"/>
                                        <field name="approved" invisible="1"/>
                                        <field name="approval" invisible="1"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>
        

        <record id="view_credit_limit_request_tree" model="ir.ui.view">
            <field name="name">credit.limit.request.tree</field>
            <field name="model">limit.request</field>
            <field name="arch" type="xml">
                <tree string="Limit Request">
                    <field name="name"/>
                    <field name="create_uid" string="Created By"/>
                    <field name="create_date" />
                    <field name="partner_id" />
                    <field name="limit_type" string="Limit Type"/>
                    <field name="new_amount" string="New Amount"/>
                    <field name="last_amount" string="Last Amount"/>
                    <field name="state"
                        decoration-primary="state=='draft'"
                        decoration-warning="state=='waiting_approval'"
                        decoration-success="state=='confirmed'"
                        decoration-danger="state=='rejected'"
                        widget="badge"
                     />
                    <field name="branch_id"/>
                    <field name="company_id"/>
                </tree>
            </field>
        </record>

        <record id="action_credit_limit_request" model="ir.actions.act_window">
            <field name="name">Limit Request</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">limit.request</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem id="menu_limit_request"
                  action="action_credit_limit_request"
                  parent="sale.sale_order_menu"
                  sequence="2"/>

        <record model="ir.ui.view" id="cancel_credit_limit_memory_form">
            <field name="name">cancel.credit.limit.form</field>
            <field name="model">cancel.credit.limit</field>
            <field name="arch" type="xml">
                <form>
                    <label for="reason" string="Reason:"/><p/>
                    <field name="reason" style="font-size: 12px"/>
                    <footer>
                        <button string="Proceed" type="object" name="action_cancel_limit" class="oe_highlight"/>
                        <button string="Cancel" class="oe_link" special="cancel"/>
                    </footer>
                </form>
            </field>
        </record>
</odoo>