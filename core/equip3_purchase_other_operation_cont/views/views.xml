<odoo>
  <data>
    <record id="direct_purchase_form_view" model="ir.ui.view">
      <field name="name">direct.purchase.form.view</field>
      <field name="model">purchase.order</field>
      <field name="inherit_id" ref="equip3_purchase_operation.purchase_order_view_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='state']" position="after">
          <field name="state_direct_on" widget="statusbar" statusbar_visible="draft,sent,waiting_for_approve,rfq_approved,purchase" attrs="{'invisible': ['|', '|', ('is_approval_matrix_direct', '=', False), ('direct_approval_matrix_id','=',False), ('dp','=',False)]}"/>
          <field name="state_direct_off" widget="statusbar" statusbar_visible="draft,sent,purchase" attrs="{'invisible': ['|', ('dp','=',False), ('direct_approval_matrix_id', '!=', False)]}"/>
        </xpath>
        <xpath expr="//field[@name='state1']" position="attributes">
          <attribute name="attrs">{'invisible' : ['|', '|', ('dp', '=', True),('is_hold_purchase_order', '=', False), '&amp;', ('is_approval_matrix', '=', True), ('approval_matrix_id', '!=', False)]}</attribute>
        </xpath>
        <xpath expr="//field[@name='po_state']" position="attributes">
          <attribute name="attrs">{'invisible' : ['|', '|', ('dp', '=', True), ('is_approval_matrix', '=', False), ('approval_matrix_id', '=', False)]}</attribute>
        </xpath>
<!--        <button name="action_view_picking" position="attributes">-->
<!--          <attribute name="attrs">{'invisible': ['|', '|' , '|' ,('is_shipped', '=', True), ('state','not in', ('purchase','done')), ('picking_count', '=', 0), ('dp', '=', True)]}</attribute>-->
<!--        </button>-->
        <button name="button_confirm" position="after">
          <button string="Approve" name="action_approve_direct" type="object" class="oe_highlight" attrs="{'invisible' : ['|', ('state', '!=', 'waiting_for_approve'), ('is_approve_button_direct', '=', False)]}"/>
          <button string="Reject" name="action_reject" type="object" class="decoration-secondary" attrs="{'invisible' : ['|', ('state', '!=', 'waiting_for_approve'), ('is_approve_button_direct', '=', False)]}"/>
        </button>
        <xpath expr="//button[@name='button_confirm'][3]" position="attributes">
          <attribute name="states"></attribute>
          <attribute name="attrs">{'invisible' : ['|', '|', ('state', 'not in', ('draft','rfq_approved')),
            '&amp;',
            ('is_approval_matrix', '=', True), ('approval_matrix_id', '!=', False),
            '&amp;', '&amp;', '&amp;',
            ('direct_approval_matrix_id','!=',False),
            ('is_approval_matrix_direct', '=', True),
            ('state', 'not in', ('rfq_approved')),
            ('dp', '=', True)]}</attribute>
        </xpath>
        <xpath expr="//label[@for='name2']/.." position="attributes">
            <attribute name="attrs">{'invisible': ['|', ('state', '!=', 'purchase'), ('dp', '=', True)]}</attribute>
        </xpath>
        <xpath expr="//button[@name='button_confirm'][3]" position="before">
          <button name="action_request_direct" string="Request for Approval" type="object" class="oe_highlight" attrs="{'invisible':['|', '|', '|', ('state', 'not in', ('draft', 'sent')),('direct_approval_matrix_id','=',False),('is_approval_matrix_direct','=',False),('dp', '!=',True)]}"/>
        </xpath>
        <xpath expr="//field[@name='approval_matrix_id']" position="before">
          <field name="is_approve_button_direct" invisible="1"/>
          <field name="is_approval_matrix_direct" invisible="1"/>
        </xpath>
        <xpath expr="//field[@name='approval_matrix_id']" position="attributes">
          <attribute name="attrs">{'invisible': ['|', ('dp','=',True), ('approval_matrix_id', '=', False)]}</attribute>
        </xpath>
        <xpath expr="//field[@name='date_order']" position="before">
          <field name="journal_id" attrs="{'invisible': [('dp','!=',True)],'required': [('dp','=',True)], 'readonly': [('state', 'in', ['waiting_for_approve', 'rfq_approved', 'purchase'])]}"/>
          <field name="dp" invisible="1"/>
        </xpath>
        <field name="is_hold_purchase_order" position="after">
          <field name="dp" invisible="1"/>
        </field>
        <xpath expr="//header/field[@name='state']" position="attributes">
           <attribute name="attrs">{'invisible' : ['|', '|', ('is_hold_purchase_order', '=', True), '&amp;', ('is_approval_matrix', '=', True), ('approval_matrix_id', '!=', False), ('dp', '=', True)]}</attribute>
        </xpath>
        <xpath expr="//sheet/notebook/page[@name='products']/field[@name='order_line']/tree" position="inside">
          <field name="dp_line" invisible="1"/>
        </xpath>
        <xpath expr="//notebook//page[@name='approved_matrix_ids']" position="attributes">
          <attribute name="attrs">{'invisible': ['|', ('dp','=',True), ('approval_matrix_id', '=', False)]}</attribute>
        </xpath>
        <xpath expr="//notebook//page[@name='approved_matrix_ids']" position="after">
          <page name="approved_matrix_direct_ids" string="Approval Matrix Line" attrs="{'invisible': ['|', '|', ('dp','!=',True), ('is_approval_matrix_direct','!=', True), ('direct_approval_matrix_id', '=', False)]}">
            <label for="direct_approval_matrix_id" string="Approval Matrix"/>
            <field name="direct_approval_matrix_id"/>
            <field name="approved_matrix_direct_ids" context="{'approved_matrix_direct_ids': approved_matrix_direct_ids}">
              <tree editable="bottom">
                <field name="sequence" />
                <field name="user_ids" widget="many2many_tags"/>
                <field name="minimum_approver" />
                <field name="state_char" />
                <field name="time_stamp"/>
                <field name="feedback" />
              </tree>
            </field>
          </page>
        </xpath>
      </field>
    </record>

    <record id="purchase_order_view_form_inherit" model="ir.ui.view">
      <field name="name">view.form.purchase.order</field>
      <field name="model">purchase.order</field>
      <field name="inherit_id" ref="purchase_stock.purchase_order_view_form_inherit"/>
      <field name="arch" type="xml">
        <button name="action_view_picking" position="attributes">
          <attribute name="attrs">{'invisible': ['|', '|' , '|' ,('is_shipped', '=', True), ('state','not in', ('purchase','done')), ('picking_count', '=', 0), ('dp', '=', True)]}</attribute>
        </button>
      </field>
    </record>

    <record id="equip3_purchase_operation.product_requests_for_quotation_services" model="ir.actions.act_window">
      <field name="domain">[('state', 'in', ['draft', 'sent', 'cancel', 'waiting_for_approve', 'reject']),('po', '=', False), ('is_services_orders', '=', True), ('dp', '=', False),('agreement_id','=',False)]</field>
    </record>

    <record id="equip3_purchase_operation.product_purchase_orders_services" model="ir.actions.act_window">
      <field name="domain">[('state','in',['purchase', 'done', 'cancel', 'reject']),('po', '=', True), ('is_goods_orders', '=', False), ('dp', '=', False)]</field>
    </record>

    <record id="action_direct_purchase" model="ir.actions.act_window">
      <field name="name">Direct Purchase</field>
      <field name="type">ir.actions.act_window</field>
      <field name="res_model">purchase.order</field>
      <field name="view_mode">tree,kanban,form,pivot,graph,calendar,activity</field>
      <field name="view_id" ref="purchase.purchase_order_view_tree"/>
      <field name="view_ids" eval="[(5, 0, 0),
			(0, 0, {'view_mode': 'tree', 'view_id': ref('purchase.purchase_order_view_tree')}),
			(0, 0, {'view_mode': 'form', 'view_id': ref('equip3_purchase_other_operation_cont.direct_purchase_form_view')}),
			(0, 0, {'view_mode': 'kanban', 'view_id': ref('purchase.view_purchase_order_kanban')}),
			(0, 0, {'view_mode': 'calendar', 'view_id': ref('purchase.purchase_order_calendar')}),
			(0, 0, {'view_mode': 'pivot', 'view_id': ref('purchase.purchase_order_pivot')}),
			(0, 0, {'view_mode': 'graph', 'view_id': ref('purchase.purchase_order_graph')})]"/>
      <field name="context">{'default_dp': True, 'default_is_goods_orders' : True, 'goods_order': 1}</field>
      <field name="domain">[('dp','=',True), ('is_goods_orders', '=', True)]</field>
      <field name="search_view_id" ref="purchase.purchase_order_view_search"/>
      <field name="help" type="html">
        <p class="o_view_nocontent_smiling_face">
          No Direct Purchase found. Let's create one!
        </p><p>
      </p>
      </field>
    </record>
    <menuitem
            id="direct_purchase_menu"
            sequence="12"
            parent="purchase.menu_procurement_management"
            action="action_direct_purchase"/>

    <menuitem
            id="direct_purchase_menu_orders"
            sequence="12"
            parent="equip3_purchase_operation.menu_orders"
            action="action_direct_purchase"/>

    <record id="equip3_purchase_operation.purchase_rfq_orders" model="ir.actions.act_window">
      <field name="domain">[('name', 'ilike', 'RFQ'), ('dp', '=', False)]</field>
    </record>

    <record id="equip3_purchase_operation.purchase_form_action_orders" model="ir.actions.act_window">
      <field name="domain">[('state','in',('purchase', 'done','cancel', 'closed')), ('dp', '=', False)]</field>
    </record>

    <record id="equip3_purchase_operation.product_purchase_orders_line" model="ir.actions.act_window">
      <field name="domain">[('state', '=', 'purchase'), ('dp_line', '=', False)]</field>
    </record>

    <record id="equip3_purchase_operation.purchase_order_onhold_orders" model="ir.actions.act_window">
      <field name="domain">[('state','=', 'on_hold'), ('dp', '=', False)]</field>
    </record>

    <record id="equip3_purchase_operation.product_requests_for_quotation_services" model="ir.actions.act_window">
      <field name="domain">[('dp', '=', False), ('state', 'in', ['draft', 'sent', 'cancel', 'waiting_for_approve', 'reject', 'rfq_approved', 'blanket_ordered']),('po', '=', False), ('is_services_orders', '=', True),('agreement_id','=',False)]</field>
    </record>

    <record id="equip3_purchase_operation.product_purchase_orders_services" model="ir.actions.act_window">
      <field name="domain">[('dp', '=', False), ('state','in',['purchase', 'done', 'cancel', 'reject']),('po', '=', True), ('is_services_orders', '=', True)]</field>
    </record>

    <record id="equip3_purchase_operation.services_purchase_order_onhold_services" model="ir.actions.act_window">
      <field name="domain">[('dp', '=', False), ('state','=', 'on_hold'), ('is_goods_orders', '=', False)]</field>
    </record>

    <record id="equip3_purchase_operation.product_purchase_order_line_services" model="ir.actions.act_window">
      <field name="domain">[('dp_line', '=', False), ('is_services_orders', '=', True), ('state', '=', 'purchase')]</field>
    </record>

  </data>
</odoo>