<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <record id="action_report_cost_details_document" model="ir.actions.client">
        <field name="name">Cost Details</field>
        <field name="tag">cost_details_report</field>
        <field name="context" eval="{'model': 'report.equip3_inventory_other_operations.report_cost'}" />
    </record>
    
    <record id="inventory_other_op_repair_order_view_form" model="ir.ui.view">
        <field name="name">inventory.other.op.repair.order.view.form</field>
        <field name="model">repair.order</field>
        <field name="inherit_id" ref="repair.view_repair_order_form"/>
        <field name="arch" type="xml">
            <button name="action_created_invoice" position="after">
                <button name="action_accounting_entries" type="object" string="Accounting Entries" class="oe_stat_button" icon="fa-bars" attrs= "{'invisible' : [('state', '!=', 'done')]}"/>
                <button name="%(action_report_cost_details_document)d" type="action"
                                class="oe_stat_button" icon="fa-bars" string="Cost Details" attrs = "{'invisible' : [('state', '!=', 'done')]}"/>
                <button name="action_valuation" type="object" string="Valuation" class="oe_stat_button" icon="fa-dollar fa-3x" attrs = "{'invisible' : [('state', '!=', 'done')]}"/>
            </button>
            <xpath expr="//notebook/page[1]" position="after">
                <page string="Repaired Products">
                    <field name="repair_order_ids">
                        <tree>
                            <field name="product_id" string="Product Name" readonly="1" force_save="1"/>
                            <field name="available_qty" string="Available Quantity"/>
                            <field name="product_qty" string="Demand Quantity" readonly="1" force_save="1"/>
                            <field name="product_uom" string="Unit of Measure" readonly="1" force_save="1"/>
                        </tree>
                    </field>
                </page>
            </xpath>
            <xpath expr="//field[@name='tag_ids']" position="after">
                <field name="start_date" attrs="{'invisible' : [('start_date', '=', False )]}" />
                <field name="end_date" attrs="{'invisible' : [('end_date', '=', False )]}" />
            </xpath>
            <xpath expr="//header/button[1]" position="after">
                <button name="action_item_available" states="availability" type="object" string="Item available" class="oe_highlight"/>
                <button name="action_cancel_repair" states="availability" type="object" string="Cancel Repair"/>
            </xpath>
            <xpath expr="//header/button[@name='action_repair_cancel'][2]" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('state','in', ['cancel', 'availability','done']), ('invoice_state', '=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <field name="delivery_order_id" invisible="1"/>
                <button name="action_create_delivery_order" type="object" class="oe_stat_button" icon="fa-truck" attrs="{'invisible': ['|', ('state', '=', 'availability'), ('delivery_order_id', '=', False)]}">
                    Delivery
                </button>
            </xpath>
            <xpath expr="//field[@name='product_qty']" position="attributes">
                <attribute name="attrs">{'readonly': [('state','not in', ['draft', 'availability'])]}</attribute>
            </xpath>
            <xpath expr="//button[@name='print_repair_order']" position="replace">
                <button name="print_repair_order"  string="Print" type="object" attrs = "{'invisible' : [('state', '!=', 'done')]}"/>
            </xpath>
            <xpath expr="//button[@name='action_send_mail']" position="attributes">
                <attribute name="string">Send</attribute>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="after">
                <field name="source_doc" string="Source"/>
                <field name="repair_type" invisible="1"/>
                <field name="check_parts_availability" invisible="1"/>
                <field name="check_availability" invisible="1"/>
                <field name="hide_button" invisible="1"/>
                <field name="warehouse_id" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='lot_id']" position="attributes">
                <attribute name="context">{}</attribute>
            </xpath>
            <xpath expr="//page[@name='parts']/field[@name='operations']/tree/field[@name='lot_id']" position="attributes">
                <attribute name="context">{}</attribute>
            </xpath>
            <xpath expr="//button[@name='action_validate']" position="before">
                <button name="action_check_availability"  type="object" string="Check Availability" class="oe_highlight" attrs = "{'invisible' : ['|',('state', '!=', 'draft' ), ('hide_button', '=', False)]}"/>
            </xpath>
            <xpath expr="//button[@name='action_validate']" position="attributes">
                <attribute name="attrs">{'invisible' : ['|', ('hide_button', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='operations']" position="before">
                <button name="action_submit_material_request"  type="object" string="Submit Material Request" class="oe_highlight" attrs = "{'invisible' : ['|', ('check_parts_availability', '=', False), ('state','not in',['availability','draft','confirmed'])]}"/>
            </xpath>
            <xpath expr="//page[@name='parts']/field[@name='operations']/tree/field[@name='location_dest_id']" position="after">
                <field name="check_stock" invisible="1"/>
<!--                <field name="ro_location_id"/>-->
                <field name="warehouse_id" invisible="1"/>
                <field name="filter_lot_ids" widget="many2many_tags" invisible="1"/>
<!--                <field name="filter_location_ids" widget="many2many_tags"/>-->
            </xpath>
            <xpath expr="//page[@name='parts']/field[@name='operations']/tree/field[@name='location_id']" position="attributes">
                <attribute name="domain">['|', '|', ('warehouse_id', '=', warehouse_id), ('usage', 'in', ['inventory','production']), ('name', '=', 'Transit')]</attribute>
            </xpath>
            <xpath expr="//page[@name='parts']/field[@name='operations']/tree/field[@name='location_dest_id']" position="attributes">
                <attribute name="domain">['|', '|', ('warehouse_id', '=', warehouse_id), ('usage', 'in', ['inventory','production']), ('name', '=', 'Transit')]</attribute>
            </xpath>
            <xpath expr="//page[@name='parts']/field[@name='operations']/tree/field[@name='lot_id']" position="attributes">
                <attribute name="domain">[('id', 'in', filter_lot_ids)]</attribute>
            </xpath>

        </field>
    </record>

    <record id="repair.action_repair_order_tree" model="ir.actions.act_window">
    <field name="name">Customer Repair</field>
    <field name="domain">[('repair_type', '=', 'customer_repair')]</field>
    <field name="context">{'default_repair_type': 'customer_repair'}</field>
    </record>

    <record model="ir.ui.view" id="check_ro_availability_wizard_form_view">
        <field name="name">ro.check_availability</field>
        <field name="model">ro.check_availability</field>
        <field name="arch" type="xml">
            <form create="false" edit="false">
                    <field name="message_id" readonly="1"/>
                    <field name="repair_order_id" invisible="1"/>
                     <footer>
                        <button name="action_validate" string="Ok" type="object" class="btn-primary"/>
<!--                        <button string="Cancel" class="btn-secondary" special="cancel"/>-->
                    </footer>
            </form>
        </field>
    </record>

    <menuitem id="repair.menu_repair_order"
              groups="stock.group_stock_user"
              name="Repairs"
              sequence="36"
              web_icon="repair,static/description/icon.png"/>

    <menuitem id="repair_order_menu" 
              name="Customer Repair"
              action="repair.action_repair_order_tree"
              parent="repair.menu_repair_order"
              groups="stock.group_stock_user"
              sequence="1"/>

</odoo>