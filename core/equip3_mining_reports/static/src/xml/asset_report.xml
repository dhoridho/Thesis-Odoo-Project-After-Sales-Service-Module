<templates>
    <t t-name="AssetReportTemplate">
        <div class="o_view_asset_report">
            <div class="o_mining_asset_report_header"></div>
            <div class="o_mining_asset_report_content"></div>
        </div>
    </t>
    
    <t t-name="AssetReportHeader">
        <div class="o_mining_report_title">
            <h1>Asset Production Report</h1>
        </div>

        <div class="o_mining_control_panel">
            <div class="o_panel_left">
                <div class="o_report_buttons">
                    <button type="button" class="o_print_pdf btn btn-primary mr-2">Print (PDF)</button>
                    <button type="button" class="o_print_xlsx btn btn-primary" id="xlsx">Export (XLSX)</button>
                </div>
            </div>
            <div class="o_panel_right">
                <div class="o_report_filter">
                    <div class="o_filter mr-2">
                        <div class="dropleft o_filter_pit">
                            <t t-set="filter_pit" t-value="filters['filter_pit']"/>
                            <a class="btn btn-secondary dropdown-toggle o_filter_pit_btn" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" t-att-data-filter-pit="filter_pit['active'][0]">
                                <t t-esc="filter_pit['active'][1]"/>
                            </a>
                            <ul class="dropdown-menu o_filter_pit_dropdown" aria-labelledby=".o_filter_pit_btn">
                                <t t-foreach="filter_pit['selection']" t-as="selection">
                                    <li><a class="dropdown-item o_filter_pit_item" href="#" t-att-data-filter-pit="selection[0]">
                                        <t t-esc="selection[1]"/>
                                    </a></li>
                                </t>
                            </ul>
                        </div>
                    </div>
                    <div class="o_apply">
                        <button type="button" class="o_apply_filter btn btn-primary">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <t t-name="AssetReportTable">
        <t t-set="field_names" t-value="['input_ids', 'output_ids', 'fuel_ids']"/>
        <table class="table o_table_asset_report">
            <t t-foreach="data['children']" t-as="asset">
                <thead>
                    <tr>
                        <th class="o_title"><t t-esc="asset['name']"/></th>
                        <th class="o_title">Product/Input</th>
                        <th class="o_title">Input</th>
                        <th class="o_title">UoM</th>
                        <th class="o_title">Product/Output</th>
                        <th class="o_title">Output</th>
                        <th class="o_title">UoM</th>
                        <th class="o_title">Duration</th>
                        <th class="o_title">Fuel Type</th>
                        <th class="o_title">Fuel Usage</th>
                        <th class="o_title">UoM</th>
                    </tr>
                </thead>

                <t t-foreach="asset['children']" t-as="operation">
                    <tbody class="o_row" data-toggle="collapse" t-attf-data-target=".row_{{asset['id']}}_{{operation['id']}}" aria-expanded="false">
                        <tr>
                            <td>
                                <span class="fa fa-caret-right" role="img" aria-label="Unfolded" title="Unfolded"></span>
                                <t t-esc="operation['name']"/>
                            </td>
                            <t t-foreach="field_names" t-as="key">
                                <t t-if="key == 'fuel_ids'">
                                    <td class="o_value"><t t-esc="formatFloat(operation['duration'])"/></td>
                                </t>
                                <t t-set="add_separator" t-value="0"/>
                                <t t-set="total_value" t-value="0.0"/>

                                <td class="o_nowrap">
                                    <t t-foreach="operation[key]" t-as="line">
                                        <t t-set="product_name" t-value="line['name']"/>

                                        <t t-if="add_separator">
                                            <span t-esc="', '"/>
                                        </t>
                                        <t t-esc="product_name"/>

                                        <t t-if="product_name">
                                            <t t-set="add_separator" t-value="1"/>
                                        </t>
                                        <t t-else="">
                                            <t t-set="add_separator" t-value="0"/>
                                        </t>
                                        
                                        <t t-set="total_value" t-value="total_value + line['qty']"/>
                                    </t>
                                </td>
                                <td class="o_value"><t t-esc="formatFloat(total_value)"/></td>
                                <td class="o_nowrap">
                                    <t t-foreach="operation[key]" t-as="line">
                                        <t t-esc="line['uom']"/>
                                    </t>
                                </td>
                            </t>
                        </tr>
                    </tbody>
                    <tbody t-attf-class="collapse row_{{asset['id']}}_{{operation['id']}}">
                        <t t-foreach="operation['children']" t-as="record">
                            <t t-foreach="record['children']" t-as="fuel">
                                <tr>
                                    <td class="o_act">
                                        <a class="o_record_dropdown dropdown-toggle" data-toggle="dropdown" href="#" aria-haspopup="true" aria-expanded="false">
                                            <span t-esc="fuel['name']"/>
                                        </a>
                                        <ul class="dropdown-menu" aria-labelledby=".o_record_dropdown">
                                            <li>
                                                <a class="dropdown-item o_view_record" href="#" 
                                                t-att-data-desc="fuel['description']" 
                                                t-att-data-model="fuel['model']" 
                                                t-att-data-res_id="fuel['id']">View Record</a>
                                            </li>
                                        </ul>
                                    </td>
                                    <t t-foreach="field_names" t-as="key">
                                        <t t-if="key == 'fuel_ids'">
                                            <td class="o_value"><t t-esc="formatFloat(fuel['duration'])"/></td>
                                        </t>
                                        <t t-set="add_separator" t-value="0"/>
                                        <t t-set="total_value" t-value="0.0"/>

                                        <td class="o_nowrap">
                                            <t t-foreach="fuel[key]" t-as="line">
                                                <t t-set="product_name" t-value="line['name']"/>

                                                <t t-if="add_separator">
                                                    <t t-esc="', '"/>
                                                </t>
                                                <a class="o_record_dropdown dropdown-toggle o_dropdown_inline" data-toggle="dropdown" href="#" aria-haspopup="true" aria-expanded="false">
                                                    <t t-esc="product_name"/>
                                                </a>
                                                <ul class="dropdown-menu" aria-labelledby=".o_record_dropdown">
                                                    <li>
                                                        <a class="dropdown-item o_view_record" href="#" 
                                                        t-att-data-desc="line['description']" 
                                                        t-att-data-model="line['model']" 
                                                        t-att-data-res_id="line['id']">View Record</a>
                                                    </li>
                                                </ul>

                                                <t t-if="product_name">
                                                    <t t-set="add_separator" t-value="1"/>
                                                </t>
                                                <t t-else="">
                                                    <t t-set="add_separator" t-value="0"/>
                                                </t>
                                                
                                                <t t-set="total_value" t-value="total_value + line['qty']"/>
                                            </t>
                                        </td>
                                        <td class="o_value"><t t-esc="formatFloat(total_value)"/></td>
                                        <td class="o_nowrap">
                                            <t t-foreach="operation[key]" t-as="line">
                                                <t t-esc="line['uom']"/>
                                            </t>
                                        </td>
                                    </t>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </t>
            </t>
        </table>
    </t>

    <t t-name="AssetNoContentHelper">
        <div class="o_view_nocontent">
            <div class="o_nocontent_help">
                <p class="o_view_nocontent_smiling_face">
                    No assets data for corresponding facilities area yet. Try changing the pits or create a new actualization record.
                </p>
                <p>
                    Some description/helper about asset production report.
                </p>
            </div>
        </div>
    </t>

</templates>