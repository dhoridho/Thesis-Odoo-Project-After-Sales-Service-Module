<templates>
    <t t-name="StrippingRatioReportTemplate">
        <div class="o_view_stripping_ratio_report">
            <div class="o_mining_stripping_report_header"></div>
            <div class="o_mining_stripping_report_content"></div>
        </div>
    </t>
    
    <t t-name="StrippingRatioReportHeader">
        <div class="o_mining_report_title">
            <h1>Stripping Ratio Report</h1>
        </div>

        <div class="o_mining_stripping_control_panel">
            <div class="o_panel_top">
                <table class="o_table_panel">
                    <tbody>
                        <tr>
                            <td class="o_td_label">Year</td>
                            <td class="o_year_filter_widget"/>
                        </tr>
                        <tr>
                            <td class="o_td_label">Period</td>
                            <td class="o_period_filter_widget">
                                <t t-set="filter_period" t-value="filters['filter_period']"/>
                                <t t-foreach="filter_period['selection']" t-as="selection">
                                    <t t-if="selection[0] == filter_period['active'][0]">
                                        <input type="radio" t-attf-id="period_{{ selection[0] }}" name="filter-period" t-attf-value="{{ selection[0] }}" checked="checked"/>
                                    </t>
                                    <t t-else="">
                                        <input type="radio" t-attf-id="period_{{ selection[0] }}" name="filter-period" t-attf-value="{{ selection[0] }}"/>
                                    </t>
                                    <label t-attf-for="period_{{ selection[0] }}"><span t-esc="selection[1]"/></label>
                                    <br/>
                                </t>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="o_panel_bottom">
                <div class="o_panel_left">
                    <div class="o_report_buttons">
                        <button type="button" class="o_print_pdf btn btn-primary mr-2">Print (PDF)</button>
                        <button type="button" class="o_print_xlsx btn btn-primary" id="xlsx">Export (XLSX)</button>
                    </div>
                </div>
                <div class="o_panel_right">
                    <div class="o_report_filter">
                        <div class="o_filter mr-2">
                            <div class="dropleft o_filter_site">
                                <t t-set="filter_site" t-value="filters['filter_site']"/>
                                <a class="btn btn-secondary dropdown-toggle o_filter_site_btn" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" t-att-data-filter-site="filter_site['active'][0]">
                                    <t t-esc="filter_site['active'][1]"/>
                                </a>
                                <ul class="dropdown-menu o_filter_site_dropdown" aria-labelledby=".o_filter_site_btn">
                                    <t t-foreach="filter_site['selection']" t-as="selection">
                                        <li><a class="dropdown-item o_filter_site_item" href="#" t-att-data-filter-site="selection[0]">
                                            <t t-esc="selection[1]"/>
                                        </a></li>
                                    </t>
                                </ul>
                            </div>
                        </div>
                        <div class="o_apply">
                            <button type="button" class="o_apply_filter btn btn-primary">Apply</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <t t-name="StrippingRatioReportTable">
        <t t-set="period" t-value="filters['filter_period']['active'][0]"/>
        <t t-foreach="data" t-as="strip">
            <div class="o_stripping_info">
                <span class="o_waste_label">Waste:</span> <span class="o_waste_product" t-esc="strip['waste']['products']"/>
                <span class="o_ore_label">Ore:</span> <span class="o_ore_product" t-esc="strip['ore']['products']"/>
            </div>

            <table class="table o_table_stripping_report">
                <thead>
                    <tr>
                        <th rowspan="2" class="o_freeze">Operation</th>
                        <t t-if="period == 'quarterly'">
                            <th class="o_separator" colspan="4">Q1</th>
                            <th class="o_separator" colspan="4">Q2</th>
                            <th class="o_separator" colspan="4">Q3</th>
                            <th class="o_separator" colspan="4">Q4</th>
                        </t>
                        <t t-else="">
                            <th class="o_separator" colspan="7">H1</th>
                            <th class="o_separator" colspan="7">H2</th>
                        </t>
                    </tr>
                    <tr>
                        <th class="o_separator">January</th>
                        <th>February</th>
                        <th>March</th>

                        <t t-if="period == 'quarterly'">
                            <th class="o_total">Total</th>
                            <th class="o_separator">April</th>
                        </t>
                        <t t-else="">
                            <th>April</th>
                        </t>
                        
                        <th>May</th>
                        <th>June</th>
                        <th class="o_total">Total</th>
                        <th class="o_separator">July</th>
                        <th>August</th>
                        <th>September</th>

                        <t t-if="period == 'quarterly'">
                            <th class="o_total">Total</th>
                            <th class="o_separator">October</th>
                        </t>
                        <t t-else="">
                            <th>October</th>
                        </t>
                        
                        <th>November</th>
                        <th>December</th>
                        <th class="o_total">Total</th>
                    </tr>
                </thead>

                <tbody>
                    <t t-foreach="['waste', 'ore', 'total']" t-as="key">
                        <t t-if="key == 'total'">
                            <t t-set="tr_class" t-value="'o_total'"/>
                        </t>
                        <t t-else="">
                            <t t-set="tr_class" t-value="''"/>
                        </t>
                        <tr t-attf-class="{{ tr_class }}">
                            <td class="o_freeze"><t t-esc="strip[key]['operation']"/></td>
                            
                            <t t-set="counter" t-value="1"/>
                            <t t-set="total" t-value="0"/>
                            <t t-foreach="strip[key]['months']" t-as="month">
                                <t t-set="td_class" t-value="'o_value'"/>
                                <t t-if="counter == 1 or counter == 7 or (period == 'quarterly' and (counter == 4 or counter == 10))">
                                    <t t-set="td_class" t-value="td_class + ' o_separator'"/>
                                </t>

                                <td t-attf-class="{{ td_class }}"><t t-esc="formatFloat(month_value['qty'], false, {'digits': [false, digits]})"/> <t t-esc="month_value['uom']"/></td>
                                
                                <t t-set="total" t-value="total + month_value['qty']"/>
                                <t t-if="counter == 6 or counter == 12 or (period == 'quarterly' and (counter == 3 or counter == 9))">
                                    <td class="o_total"><t t-esc="formatFloat(total, false, {'digits': [false, digits]})"/> <t t-esc="month_value['uom']"/></td>
                                    <t t-set="total" t-value="0"/>
                                </t>
    
                                <t t-set="counter" t-value="counter + 1"/>
                            </t>
                        </tr>
                    </t>
                </tbody>
            </table>
        </t>
    </t>

    <t t-name="StrippingRatioNoContentHelper">
        <div class="o_view_nocontent">
            <div class="o_nocontent_help">
                <p class="o_view_nocontent_smiling_face">
                    No stripping ratio data for corresponding filters yet. Try changing the filters or create a new actualization record.
                </p>
                <p>
                    Some description/helper about stripping ratio report.
                </p>
            </div>
        </div>
    </t>

</templates>