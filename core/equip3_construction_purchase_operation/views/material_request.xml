<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Add Field Type of MR -->
    <record id="type_of_product_form_view_inherited" model="ir.ui.view">
        <field name="name">type.of.product.form.view.inherited</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='requested_by']" position="after">
                <field name="project" options="{'no_create': True, 'no_quick_create':True,'no_create_edit':True}"/>
            </xpath>
            <xpath expr="//field[@name='project']" position="after">
                <field name="budgeting_method" widget="radio" readonly="1" attrs="{'invisible': [('project', '=', False)]}"/>
                <field name="budgeting_period" invisible="1" force_save="1" attrs="{'invisible': [('project', '=', False)]}"/>
                <field name="job_cost_sheet" domain="[('project_id', '=', parent.project)]" readonly="1" force_save="1" attrs="{'invisible': [('project', '=', False)]}"/>
                <field name="project_budget" force_save="1" attrs="{'invisible': ['|', '|', ('project', '=', False), ('budgeting_period', '=', 'project'), ('is_multiple_budget', '=', True)], 'required': [('project', '!=', False), ('budgeting_period', '!=', 'project'), ('is_multiple_budget', '!=', True)]}"/>
                <field name="is_multiple_budget_procurement" invisible='1'/>
                <label for="is_multiple_budget" attrs="{'invisible': ['|', '|', ('project', '=', False), ('is_multiple_budget_procurement', '=', False), ('budgeting_period', '=', 'project')]}"/>
                <div name="multiple_budget_div" class="d-flex" attrs="{'invisible': ['|', '|', ('project', '=', False), ('is_multiple_budget_procurement', '=', False), ('budgeting_period', '=', 'project')]}">
                    <field name="is_multiple_budget" nolabel="1"/>
                    <field name="multiple_budget_ids" widget="many2many_tags"
                    attrs="{'required': [('is_multiple_budget', '!=', False)]}" nolabel="1"/>
                </div>
               <field name="project_scope_computed" widget="many2many_tags" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='branch_id']" position="after">
                <field name="type_of_mr" attrs="{'invisible': [('project', '=', False)]}" />
            </xpath>
             <xpath expr="//form/header/button[@name='create_purchase_request']" position="attributes">
                <attribute name="attrs">{'invisible':['|', ('type_of_mr','=','equipment'), ('status', '!=', 'confirm')]}</attribute>
            </xpath>
            <xpath expr="//button[@name='create_purchase_request']" position="after">
                <button 
                    name="create_asset_purchase_request" 
                    string="Create Asset Purchase Request" 
                    type="object"
                    invisible="1"
                    class="btn btn-primary"/>
            </xpath>
             <xpath expr="//field[@name='type_of_mr']" position="after">
                <field name="request_to_departement" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" invisible="1"/>
            </xpath>
             <xpath expr="//field[@name='progress_quantity']" position="attributes">
                <attribute name="string">In Progress Quantity</attribute>
            </xpath>
            <xpath expr="//field[@name='product_line']" position="attributes">
                <attribute name="class">o_mr_product_line</attribute>
            </xpath>
            <xpath expr="//field[@name='product']" position="before">
                <field name="project" invisible="1"/>
                <field name="cs_equipment_id" optional="hide" invisible='1'/>
                <field name="bd_equipment_id" optional="hide" invisible='1'/>
                
                <field name="cs_material_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', ('parent.project','=',False), ('parent.type_of_mr','!=','material')]}"/>
                <field name="cs_labour_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', ('parent.project','=',False), ('parent.type_of_mr','!=','labour')]}"/>
                <field name="cs_overhead_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', ('parent.project','=',False), ('parent.type_of_mr','!=','overhead')]}"/>
                
                <field name="cs_material_gop_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget'), ('parent.type_of_mr','!=','material')]}"/>
                <field name="cs_labour_gop_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget'), ('parent.type_of_mr','!=','labour')]}"/>
                <field name="cs_overhead_gop_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget'), ('parent.type_of_mr','!=','overhead')]}"/>
                
                <field name="bd_material_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', ('parent.project','=',False), ('parent.project_budget','=', False), ('parent.is_multiple_budget','=',True), ('parent.type_of_mr','!=','material')]}"/>
                <field name="bd_labour_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', ('parent.project','=',False), ('parent.project_budget','=',False), ('parent.is_multiple_budget','=',True), ('parent.type_of_mr','!=','labour')]}"/>
                <field name="bd_overhead_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', ('parent.project','=',False), ('parent.project_budget','=',False), ('parent.is_multiple_budget','=',True), ('parent.type_of_mr','!=','overhead')]}"/>
                
                <field name="bd_material_ids" widget="many2many_tags" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', ('parent.project','=',False), ('parent.multiple_budget_ids','=', False), ('parent.is_multiple_budget','=',False), ('parent.type_of_mr','!=','material')]}"/>
                <field name="bd_labour_ids" widget="many2many_tags" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', ('parent.project','=',False), ('parent.multiple_budget_ids','=',False), ('parent.is_multiple_budget','=',False), ('parent.type_of_mr','!=','labour')]}"/>
                <field name="bd_overhead_ids" widget="many2many_tags" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', ('parent.project','=',False), ('parent.multiple_budget_ids','=',False), ('parent.is_multiple_budget','=',False), ('parent.type_of_mr','!=','overhead')]}"/>
                
                <field name="bd_material_gop_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget',), ('parent.project_budget','=', False), ('parent.is_multiple_budget','=',True), ('parent.type_of_mr','!=','material')]}"/>
                <field name="bd_labour_gop_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget',), ('parent.project_budget','=',False), ('parent.is_multiple_budget','=',True), ('parent.type_of_mr','!=','labour')]}"/>
                <field name="bd_overhead_gop_id" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget',), ('parent.project_budget','=',False), ('parent.is_multiple_budget','=',True), ('parent.type_of_mr','!=','overhead')]}"/>
                
                <field name="bd_material_gop_ids" widget="many2many_tags" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget',), ('parent.multiple_budget_ids','=', False), ('parent.is_multiple_budget','=',False), ('parent.type_of_mr','!=','material')]}"/>
                <field name="bd_labour_gop_ids" widget="many2many_tags" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget',), ('parent.multiple_budget_ids','=',False), ('parent.is_multiple_budget','=',False), ('parent.type_of_mr','!=','labour')]}"/>
                <field name="bd_overhead_gop_ids" widget="many2many_tags" optional="hide" readonly='1' force_save="1" attrs="{'column_invisible': ['|', '|', '|', '|', ('parent.project','=',False), ('parent.budgeting_method','!=','gop_budget',), ('parent.multiple_budget_ids','=',False), ('parent.is_multiple_budget','=',False), ('parent.type_of_mr','!=','overhead')]}"/>
                
                <field name="project_scope_computed" invisible="1"/>
                <field name="project_scope" domain="[('id','in',parent.project_scope_computed)]" attrs="{'column_invisible': [('parent.project','=',False)], 'required': [('parent.project', '!=', False), ('parent.type_of_mr', '!=', 'labour')]}"
                       options="{'no_create':True, 'no_quick_create':True, 'no_create_edit':True}"/>
                <field name="project_section_computed" widget="many2many_tags" invisible="1"/>
                <field name="section" domain="[('id','in',project_section_computed)]" attrs="{'column_invisible': [('parent.project','=',False)], 'required': [('parent.project', '!=', False), ('parent.type_of_mr', '!=', 'labour')], 'readonly': [('project_scope', '=', False)]}"
                       options="{'no_create':True, 'no_quick_create':True, 'no_create_edit':True}"/>
                <field name="variable" attrs="{'column_invisible': [('parent.project','=',False)], 'readonly': [('section', '=', False)]}" invisible='1'
                       options="{'no_create':True, 'no_quick_create':True, 'no_create_edit':True}"/>
                <field name="group_of_product" attrs="{'column_invisible': [('parent.project','=',False)], 'required': [('parent.project', '!=', False)], 'readonly': [('section', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='quantity']" position="after">
                <field name="budget_quantity" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.project','=',False)]}"/>
            </xpath>
            
            <xpath expr="//field[@name='request_date']" position="before">
                <field name="status_2"/>
            </xpath>
            <xpath expr="//field[@name='product_line']/tree/field[@name='product']" position="attributes">
                <attribute name="attrs">{'readonly': [('group_of_product', '=', False), ('parent.project', '!=', False)]}</attribute>
                <!-- <attribute name="domain">[('group_of_product','=', group_of_product)]</attribute> -->
            </xpath>
            <xpath expr="//field[@name='product_line']/tree/field[@name='status']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='action_show_stock']" position="after">
                <button name="action_cancel_line" type="object" attrs="{'invisible': [('status_2', '!=', 'confirm')]}" string="Cancel" class="btn btn-primary"/>
            </xpath>
        </field>
    </record>

    <!-- Add Button Create Purchase Agreement -->
    <!-- <record id="create_agreement_form_view_inherited" model="ir.ui.view">
        <field name="name">create.agreement.form.view.inherited</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//form/header/button[@name='create_purchase_request']" position="attributes">
                <attribute name="attrs">{'invisible':['|', ('type_of_mr','=','equipment'), ('status', '!=', 'confirm')]}</attribute>
            </xpath>
            <xpath expr="//button[@name='create_purchase_request']" position="after">
                <button 
                    name="create_asset_purchase_request" 
                    string="Create Asset Purchase Request" 
                    type="object"
                    invisible="1"
                    class="btn btn-primary"/>
            </xpath>
            <xpath expr="//form/header/button[@name='create_purchase_request']" position="after">
                <button name="%(equip3_construction_purchase_operation.agreement_generate_action)d" type="action"
                    string="Create Purchase Tender" attrs="{'invisible': [('status', '!=', 'confirm')]}"
                    class="btn btn-primary"/>
            </xpath>
            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                <button attrs="{'invisible': [('status', '!=', 'confirm')], 'invisible': [('agreement_count', '=', 0)]}" class="oe_stat_button" 
                icon="fa-tasks" name="%(sh_po_tender_management.sh_purchase_agreement_action)d" type="action">
                    <field name="agreement_count" string="Purchase Tender" widget="statinfo"/>
                </button>
            </xpath>
        </field>
    </record> -->

    <!-- material.request inherit tree view -->
    <record id="material_request_view_id" model="ir.ui.view">
        <field name="name">material.request.inherit.view.tree</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_tree_view"/>
        <field name="arch" type="xml">
            <!-- <search string="Search Material Request">
                <group name="group_by" string="Group By">
                    <filter name="project" string="Project" context="{'group_by' : 'project'}" />
                </group>
            </search> -->
            <xpath expr="//tree[1]" position='attributes'>
                <attribute name="class">o_mr_line</attribute>
            </xpath>   
            <xpath expr="//tree[1]" position='attributes'>
                <attribute name="class">o_mr_line</attribute>
            </xpath>
            
        </field>
    </record>


    <record id="view_material_request_filter" model="ir.ui.view">
        <field name="name">material.request.filter.projectid</field>
        <field name="model">material.request</field>
        <field name="arch" type="xml">
            <search string="Search Material Request">
               <group name="group_by" string="Group By">
                   <filter name="project" string="Project" context="{'group_by' : 'project'}" />
                </group>
           </search>
        </field>
    </record>

    <!-- Add Field Request to Departement -->
    <!-- <record id="request_to_departement_form_view_inherited" model="ir.ui.view">
        <field name="name">request.to.departement.form.view.inherited</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_form_view"/>
        <field name="arch" type="xml">
        <xpath expr="//field[@name='type_of_mr']" position="after">
            <field name="request_to_departement" options="{'no_quick_create':True,'no_create_edit':True,'no_open': True,}" invisible="1"/>
        </xpath>
        </field>
    </record> -->

    <!-- Add Field Project & Job Cost Sheet-->
    <!-- <record id="project_form_view_inherited" model="ir.ui.view">
        <field name="name">project.form.view.inherited</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_form_view"/>
        <field name="arch" type="xml">
        <xpath expr="//field[@name='requested_by']" position="after">
            <field name="project"/>
        </xpath>
        <xpath expr="//field[@name='project']" position="after">
            <field name="budgeting_method" widget="radio" readonly="1" attrs="{'invisible': [('project', '=', False)]}"/>
            <field name="budgeting_period" invisible="1" force_save="1"/>
            <field name="job_cost_sheet" domain="[('project_id', '=', parent.project)]" attrs="{'invisible': [('project', '=', False)]}" readonly="1" force_save="1"/>
            <field name="project_budget" force_save="1" attrs="{'invisible': ['|',('is_multiple_budget', '=', True),('budgeting_period', '=', 'project'), ('project', '=', False)], 'required': [('budgeting_period', '!=', 'project'), ('is_multiple_budget', '!=', True)]}"/>
            <label for="is_multiple_budget" attrs="{'invisible': [('budgeting_period', '=', 'project'), ('project', '=', False)]}"/>
            <div name="multiple_budget_div" class="d-flex">
                <field name="is_multiple_budget" nolabel="1" attrs="{'invisible': [('budgeting_period', '=', 'project'), ('project', '=', False)]}"/>
                <field name="multiple_budget_ids" widget="many2many_tags"
                attrs="{'invisible': ['|',('is_multiple_budget', '=', False),('budgeting_period', '=', 'project')], 'required': [('is_multiple_budget', '!=', False)]}" nolabel="1"/>
            </div>
        </xpath>
        </field>
    </record> -->

    <!-- Change String on Field progress_quantity to Remaining Quantity -->
    <!-- <record id="remaining_quantity_form_view_inherited" model="ir.ui.view">
        <field name="name">remaining.quantity.form.view.inherited</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_form_view"/>
        <field name="arch" type="xml">
        <xpath expr="//field[@name='progress_quantity']" position="attributes">
            <attribute name="string">Remaining Quantity</attribute>
        </xpath>
        </field>
    </record> -->

    <!-- Add Field on Material Request Line -->
    <!-- <record id="add_field_material_request_line" model="ir.ui.view">
        <field name="name">add.field.material.request.line</field>
        <field name="model">material.request</field>
        <field name="inherit_id" ref="equip3_inventory_operation.material_request_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='product_line']" position="attributes">
                <attribute name="class">o_mr_product_line</attribute>
            </xpath>
            <xpath expr="//field[@name='product']" position="before">
                <field name="cs_material_id" optional="hide" force_save="1"/>
                <field name="cs_labour_id" optional="hide" force_save="1"/>
                <field name="cs_overhead_id" optional="hide" force_save="1"/>
                <field name="cs_equipment_id" optional="hide" force_save="1"/>
                <field name="bd_material_id" optional="hide" force_save="1"/>
                <field name="bd_labour_id" optional="hide" force_save="1"/>
                <field name="bd_overhead_id" optional="hide" force_save="1"/>
                <field name="bd_equipment_id" optional="hide" force_save="1"/>
                <field name="project_scope_computed" invisible="1"/>
                <field name="project_scope" domain="[('project_id', '=', parent.project)]" attrs="{'required': [('parent.project', '!=', False), ('parent.type_of_mr', '!=', 'labour')], 'column_invisible': [('parent.project', '=', False)]}"/>
                <field name="section" domain="[('project_scope','=', project_scope), ('project_id','=', parent.project)]" attrs="{'required': [('parent.project', '!=', False), ('parent.type_of_mr', '!=', 'labour')], 'readonly': [('project_scope', '=', False)], 'column_invisible': [('parent.project', '=', False)]}"/>
                <field name="variable" attrs="{'readonly': [('section', '=', False)], 'column_invisible': [('parent.project', '=', False)]}"/>
                <field name="group_of_product" attrs="{'required': [('parent.project', '!=', False)], 'readonly': [('section', '=', False)], 'column_invisible': [('parent.project', '=', False)]}"/>
            </xpath>
            <xpath expr="//field[@name='quantity']" position="after">
                <field name="budget_quantity" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.budgeting_method', '!=', 'product_budget')]}"/>
            </xpath>
            
            <xpath expr="//field[@name='request_date']" position="before">
                <field name="status_2"/>
            </xpath>
            <xpath expr="//field[@name='product_line']/tree/field[@name='product']" position="attributes">
                <attribute name="attrs">{'readonly': [('group_of_product', '=', False)]}</attribute>
                <attribute name="domain">[('group_of_product','=', group_of_product)]</attribute>
            </xpath>
            <xpath expr="//field[@name='product_line']/tree/field[@name='status']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//button[@name='action_show_stock']" position="after">
                <button name="action_cancel_line" type="object" attrs="{'invisible': [('status_2', '!=', 'confirm')]}" string="Cancel" class="btn btn-primary"/>
            </xpath>
        </field>
    </record> -->

    <!-- Add Sub Menu Material Request -->
    <record model="ir.actions.act_window" id="purchase_orders_material_request_action">
        <field name="name">Material Requests</field>
        <field name="res_model">material.request</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="material_request_view_id"/>
        <field name="context">{'search_default_project': 1,
                               'goods_order': 1}</field>
        <field name="target">main</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Material Request found. Let's create one!
            </p>
        </field>
    </record>

    <record model="ir.actions.act_window" id="purchase_orders_material_request_line_action">
        <field name="name">Material Requests Line</field>
        <field name="res_model">material.request.line</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_view_nocontent_create">
            </p>
        </field>
    </record>

    <menuitem id="goods_material_request"
              name="Material Requests"
              parent="purchase.menu_procurement_management"
              sequence="0"/>

    <menuitem id="material_request_menu" 
        name="Material Requests" 
        parent="goods_material_request" 
        sequence ="1"
        action="purchase_orders_material_request_action"
        groups="base.group_user"/>  

    <menuitem id="material_request_line_menu" 
        name="Material Requests Line" 
        parent="goods_material_request" 
        action="purchase_orders_material_request_line_action" 
        sequence="2"/>  
</odoo>