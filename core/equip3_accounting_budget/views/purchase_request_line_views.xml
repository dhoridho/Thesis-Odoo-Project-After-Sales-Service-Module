<odoo>
    <!-- <record id="purchase_request_view_form_inherit" model="ir.ui.view">
        <field name="name">purchase.request.view.form.inherit</field>
        <field name="model">purchase.request</field>
        <field name="inherit_id" ref="equip3_purchase_operation.purchase_request_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='purchase_req_budget']" position="after">
                <field name="realized_amount"/>
            </xpath>
            <xpath expr="//button[@name='action_confirm_purchase_request']" position="attributes">
                <attribute name="name">action_confirm_purchase_request_wizard</attribute>
            </xpath>
        </field>
    </record> -->

    <record id="view_purchase_request_form_inherit_accounting_budget" model="ir.ui.view">
        <field name="name">purchase.request.form.inherit.accounting.budget</field>
        <field name="model">purchase.request</field>
        <field name="inherit_id" ref="purchase_request.view_purchase_request_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="is_allow_purchase_budget" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='avail_amount_budget']" position="after">
                <field name="is_use_purchase_budget" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='avail_amount_budget']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='reserve_amount_budget']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='remaining_amount_budget']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='purchase_req_budget_2']" position="attributes">
                <attribute name="attrs">{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}</attribute>
            </xpath>
        </field>
    </record>    
    
    <record id="purchase_request_warning_form" model="ir.ui.view">
        <field name="name">purchase.request.warning.form</field>
        <field name="model">purchase.request.warning</field>
        <field name="arch" type="xml">
        <form string="Purchase Request Waning">
            <group>
                <p>The product you inserted is bigger than your budget. Do you want to proceed?</p>
                <inline/>
                <field name="warning_line_ids" nolabel="1" readonly="1">
                    <tree>
                        <field name="product_id"/>
                        <field name="purchase_req_budget"/>
                        <field name="available_budget"/>
                        <field name="reserved_budget"/>
                        <field name="remaining_amount"/>
                        <field name="realized_amount" string="Expected Realized Budget" sum="Total Realized Budget"/>
                    </tree>
                </field>
                    
            </group>
	    <footer>
	        <button string='Continue' name='confirm_purchase_request' type='object' class='btn-primary'/>
                <button string='Cancel' class='btn-default' special="cancel"/>
	    </footer>
        </form>
        </field>
    </record>
    
    <record id="action_purchase_request_warning" model="ir.actions.act_window">
        <field name="name">Warning</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.request.warning</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="view_id" ref="purchase_request_warning_form" />
    </record>
    
    <record id="purchase_order_equip3_accounting_budget_form_inherit" model="ir.ui.view">
        <field name="name">purchase.order.equip3.accounting.budget.form.inherit</field>
        <field name="model">purchase.order</field>
        <field name="inherit_id" ref="purchase.purchase_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//tree[1]/field[@name='taxes_id']" position="before">
                <field name="is_use_purchase_budget" invisible="1"/>
                <field name="purchase_req_budget" widget="monetary" attrs="{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}"/>
                <field name="remaining_budget" widget="monetary" attrs="{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}"/>
                <field name="realized_amount" widget="monetary" attrs="{'column_invisible': [('parent.is_allow_purchase_budget','=',False)], 'invisible': [('is_use_purchase_budget','=',False)]}"/>
            </xpath>
            <!-- <xpath expr="//button[@id='draft_confirm']" position="attributes">
                <attribute name="name">action_confirm_purchase_order</attribute>
            </xpath>
            <xpath expr="//button[@id='bid_confirm']" position="attributes">
                <attribute name="name">action_confirm_purchase_order</attribute>
            </xpath> -->
            <xpath expr="//header" position="after">
                <header>
                    <field name="overbudget_po_state" widget="statusbar" statusbar_visible="overbudget_po,overbudget_approved" attrs="{'invisible': [('overbudget_po_state','=',False)]}"/>
                </header>
            </xpath>
            <xpath expr="//header" position="inside">
                <button name="button_confirm_overbudget_po" attrs="{'invisible': ['|', ('state','!=','over_budget_approval'), ('is_overbudget_approve_button','=',False)]}" class="oe_highlight" string="Approve Overbudget" type="object"/>
                <button name="button_reject_overbudget_po" attrs="{'invisible': ['|', ('state','!=','over_budget_approval'), ('is_overbudget_approve_button','=',False)]}" class="oe_highlight" string="Reject" type="object"/>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="approval_overbudget_matrix_id" invisible="1"/>
                <field name="approval_overbudget_matrix_line_id" invisible="1"/>
                <field name="is_overbudget_approve_button" invisible="1"/>
                <field name="approval_overbudget_user_ids" invisible="1"/>
                <field name="is_allow_purchase_budget" invisible="1"/>
            </xpath>
            <page name="purchase_delivery_invoice" position="after">
                <page name="approved_overbudget_matrix_ids" string="Approval Overbudget Matrix Line" attrs="{'invisible': [('overbudget_po_state', '=', False)]}">
                    <field name="approved_overbudget_matrix_ids" context="{'approved_overbudget_matrix_ids': approved_overbudget_matrix_ids}" force_save="1">
                        <tree create="0" edit="0" delete="0">
                            <field name="sequence" />
                            <field name="user_ids" widget="many2many_tags"/>
                            <field name="minimum_approver" />
                            <field name="approver_state" readonly="1" force_save="1"/>
                            <field name="state_char" />
                            <field name="time_stamp" invisible="1"/>
                            <field name="feedback" />
                        </tree>
                    </field>
                </page>
            </page>
        </field>
    </record>

    <record id="purchase_request_view_form_inherit" model="ir.ui.view">
        <field name="name">purchase.request.view.form.inherit</field>
        <field name="model">purchase.request</field>
        <field name="inherit_id" ref="equip3_purchase_operation.purchase_request_view_form"/>
        <field name="arch" type="xml">
           <!--  <xpath expr="//field[@name='pr_state']" position="attributes">
                <attribute name="statusbar_visible">draft,over_budget_approval,to_approve,approved,purchase_request</attribute>
            </xpath> -->
            <xpath expr="//header" position="after">
                <header>
                    <field name="overbudget_pr_state" widget="statusbar" statusbar_visible="overbudget_pr,overbudget_approved" attrs="{'invisible': [('overbudget_pr_state','=',False)]}"/>
                </header>
            </xpath>
            <xpath expr="//header" position="inside">
                <button name="button_confirm_overbudget_pr" attrs="{'invisible': ['|', ('state','!=','over_budget_approval'), ('is_overbudget_approve_button','=',False)]}" class="oe_highlight" string="Approve Overbudget" type="object"/>
                <button name="button_reject_overbudget_pr" attrs="{'invisible': ['|', ('state','!=','over_budget_approval'), ('is_overbudget_approve_button','=',False)]}" class="oe_highlight" string="Reject" type="object"/>

            </xpath>
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="approval_overbudget_matrix_id" invisible="1"/>
                <field name="approval_overbudget_matrix_line_id" invisible="1"/>
                <field name="is_overbudget_approve_button" invisible="1"/>
                <field name="approval_overbudget_user_ids" invisible="1"/>
            </xpath>
            <page name="approved_matrix_ids" position="after">
                <page name="approved_overbudget_matrix_ids" string="Approval Overbudget Matrix Line" attrs="{'invisible': [('overbudget_pr_state', '=', False)]}">
                    <field name="approved_overbudget_matrix_ids" context="{'approved_overbudget_matrix_ids': approved_overbudget_matrix_ids}" force_save="1">
                        <tree create="0" edit="0" delete="0">
                            <field name="sequence" />
                            <field name="user_ids" widget="many2many_tags"/>
                            <field name="minimum_approver" />
                            <field name="approver_state" readonly="1" force_save="1"/>
                            <field name="state_char" />
                            <field name="time_stamp" invisible="1"/>
                            <field name="feedback" />
                        </tree>
                    </field>
                </page>
            </page>
        </field>
    </record>

    <!-- Overbudget Order -->

    <record model="ir.ui.view" id="view_overbudget_po_request_tree">
        <field name="name">view.overbudget.po.request.tree</field>
        <field name="model">purchase.order</field>
        <field name="arch" type="xml">
            <tree string="Overbudget PO Request" create="0">
                <field name="name" />
                <!-- <field name="partner_id" /> -->
                <field name="date_planned"/>
                <field name="user_id"/>
                <field name="origin"/>
                <field name="amount_total"/>
                <field name="overbudget_po_state" widget="badge" decoration-warning="overbudget_po_state == 'overbudget_po'" decoration-success="overbudget_po_state == 'overbudget_approved'" string="Status"/>
                <field name="approval_overbudget_user_ids" invisible="1"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_overbudget_po_request">
        <field name="name">Overbudget PO Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.order</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
        {
            "search_default_requested_by": uid,
            'default_is_goods_orders': True,
            'default_is_single_delivery_destination':True,
            'tree_view_ref': 'equip3_accounting_budget.view_overbudget_po_request_tree',
            'create': 0,
        }
        </field>
        <field name="domain">[('overbudget_po_state','!=',False),('approval_overbudget_user_ids','in',uid)]</field>
        <field name="search_view_id" ref="purchase.purchase_order_view_search"/>
    </record>

    <menuitem
        id="menu_overbudget_po_request"
        name="Overbudget PO Request"
        parent="equip3_purchase_operation.main_menu_goods_purchase_order"
        action="action_overbudget_po_request"/>

    <record model="ir.ui.view" id="view_overbudget_pr_request_tree">
        <field name="name">view.overbudget.pr.request.tree</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <tree string="Overbudget PR Request" create="false">
                <field name="name" />
                <field name="date_start"/>
                <field name="requested_by"/>
                <field name="origin"/>
                <field name="overbudget_pr_state" widget="badge" decoration-warning="overbudget_pr_state == 'overbudget_pr'" decoration-success="overbudget_pr_state == 'overbudget_approved'" string="Status"/>
                <field name="expiry_date"/>
                <field name="pr_request_date"/>
                <field name="branch_id"/>
                <field name="approval_overbudget_user_ids" invisible="1"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_overbudget_pr_request">
        <field name="name">Overbudget PR Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.request</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
        {
            "search_default_requested_by": uid,
            'default_is_goods_orders': True,
            'default_is_single_request_date':True,
            'default_is_single_delivery_destination':True,
            'tree_view_ref': 'equip3_accounting_budget.view_overbudget_pr_request_tree',
            'create': 0,
        }
        </field>
        <field name="domain">[('overbudget_pr_state','!=',False),('approval_overbudget_user_ids','in',uid)]</field>
        <field name="search_view_id" ref="purchase_request.view_purchase_request_search"/>
    </record>

    <menuitem
        id="menu_overbudget_pr_request"
        name="Overbudget PR Request"
        parent="equip3_purchase_operation.main_menu_orders_purchase_request"
        action="action_overbudget_pr_request"/>

    <!-- Overbudget Service Order -->

    <record model="ir.ui.view" id="view_overbudget_pr_request_service_tree">
        <field name="name">view.overbudget.pr.request.service.tree</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <tree string="Overbudget PR Request" create="false">
                <field name="name" />
                <field name="date_start"/>
                <field name="requested_by"/>
                <field name="origin"/>
                <field name="overbudget_pr_state" widget="badge" decoration-warning="overbudget_pr_state == 'overbudget_pr'" decoration-success="overbudget_pr_state == 'overbudget_approved'" string="Status"/>
                <field name="expiry_date"/>
                <field name="pr_request_date"/>
                <field name="branch_id"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_overbudget_pr_request_service">
        <field name="name">Overbudget PR Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.request</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
        {
            "search_default_requested_by": uid,
            'default_is_goods_orders': True,
            'default_is_single_request_date':True,
            'default_is_single_delivery_destination':True,
            'tree_view_ref': 'equip3_accounting_budget.view_overbudget_pr_request_service_tree'
        }
        </field>
        <field name="domain">[('overbudget_pr_state','!=',False)]</field>
        <field name="search_view_id" ref="purchase_request.view_purchase_request_search"/>
    </record>

    <menuitem
        id="menu_overbudget_pr_request_service"
        name="Overbudget PR Request"
        parent="equip3_purchase_operation.main_menu_services_purchase_request"
        action="action_overbudget_pr_request_service"/>

    <!-- Overbudget Goods Order -->

    <record model="ir.ui.view" id="view_overbudget_pr_request_goods_tree">
        <field name="name">view.overbudget.pr.request.goods.tree</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <tree string="Overbudget PR Request" create="false">
                <field name="name" />
                <field name="date_start"/>
                <field name="requested_by"/>
                <field name="origin"/>
                <field name="overbudget_pr_state" widget="badge" decoration-warning="overbudget_pr_state == 'overbudget_pr'" decoration-success="overbudget_pr_state == 'overbudget_approved'" string="Status"/>
                <field name="expiry_date"/>
                <field name="pr_request_date"/>
                <field name="branch_id"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_overbudget_pr_request_goods">
        <field name="name">Overbudget PR Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.request</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
        {
            "search_default_requested_by": uid,
            'default_is_goods_orders': True,
            'default_is_single_request_date':True,
            'default_is_single_delivery_destination':True,
            'tree_view_ref': 'equip3_accounting_budget.view_overbudget_pr_request_goods_tree'
        }
        </field>
        <field name="domain">[('overbudget_pr_state','!=',False)]</field>
        <field name="search_view_id" ref="purchase_request.view_purchase_request_search"/>
    </record>

    <menuitem
        id="menu_overbudget_pr_request_goods"
        name="Overbudget PR Request"
        parent="equip3_purchase_operation.main_menu_goods_purchase_request"
        action="action_overbudget_pr_request_goods"/>


    <!-- Overbudget Asset Order -->

    <record model="ir.ui.view" id="view_overbudget_pr_request_assets_tree">
        <field name="name">view.overbudget.pr.request.assets.tree</field>
        <field name="model">purchase.request</field>
        <field name="arch" type="xml">
            <tree string="Overbudget PR Request" create="false">
                <field name="name" />
                <field name="date_start"/>
                <field name="requested_by"/>
                <field name="origin"/>
                <field name="overbudget_pr_state" widget="badge" decoration-warning="overbudget_pr_state == 'overbudget_pr'" decoration-success="overbudget_pr_state == 'overbudget_approved'" string="Status"/>
                <field name="expiry_date"/>
                <field name="pr_request_date"/>
                <field name="branch_id"/>
            </tree>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_overbudget_pr_request_assets">
        <field name="name">Overbudget PR Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">purchase.request</field>
        <field name="view_mode">tree,form</field>
        <field name="context">
        {
            "search_default_requested_by": uid,
            'default_is_goods_orders': True,
            'default_is_single_request_date':True,
            'default_is_single_delivery_destination':True,
            'tree_view_ref': 'equip3_accounting_budget.view_overbudget_pr_request_assets_tree'
        }
        </field>
        <field name="domain">[('overbudget_pr_state','!=',False)]</field>
        <field name="search_view_id" ref="purchase_request.view_purchase_request_search"/>
    </record>

    <menuitem
        id="menu_overbudget_pr_request_assets"
        name="Overbudget PR Request"
        parent="equip3_purchase_asset.main_menu_assets_purchase_request"
        action="action_overbudget_pr_request_assets"/>
 
</odoo>

