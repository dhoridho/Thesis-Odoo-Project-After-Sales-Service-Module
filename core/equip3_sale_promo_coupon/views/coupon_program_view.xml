<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="coupon_program_action_promo_program_sales" model="ir.actions.act_window">
        <field name="name">Promotion Programs</field>
        <field name="res_model">coupon.program</field>
        <field name="view_mode">tree,kanban,form</field>
        <field name="view_ids" eval="[
            (5, 0, 0),
            (0, 0, {'view_mode': 'tree'}),
            (0, 0, {'view_mode': 'form', 'view_id': ref('coupon.coupon_program_view_promo_program_form')})]"/>
        <field name="search_view_id" ref="coupon.coupon_program_view_promo_program_search"/>
        <field name="domain">[('program_type', '=', 'promotion_program'), ('is_sale_promotion', '=', True)]</field>
        <field name="context">{
            'default_program_type': 'promotion_program',
            'default_promo_code_usage': 'no_code_needed',
            'default_validity_duration': 0,
            'search_default_opened': 1,
            'default_is_sale_promotion': True,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new promotion program
            </p><p>
            Build up promotion programs to attract more customers with discounts, free products, free delivery, etc.
            You can share promotion codes or grant the promotions automatically if some conditions are met.
        </p>
        </field>
    </record>

    <record id="sale_coupon_program_view_promo_program_form" model="ir.ui.view">
        <field name="name">promo.program.form</field>
        <field name="model">coupon.program</field>
        <field name="inherit_id" ref="coupon.coupon_program_view_promo_program_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form" position="inside">
                <field name="is_sale_promotion" invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='rule_partners_domain']" position="before">
                <field name="customers_selection" widget="radio"/>
                <field name="customer_category_ids" widget="many2many_tags" attrs="{'invisible': [('customers_selection', '!=', 'customer_category')]}"/>
                <field name="selected_customers_ids" widget="many2many_tags" attrs="{'invisible': [('customers_selection', '!=', 'selected_customers')]}"/>
            </xpath>

            <xpath expr="//field[@name='rule_products_domain']" position="before">
                <field name="products_selection" widget="radio"/>
                <field name="product_category_ids" widget="many2many_tags" attrs="{'invisible': [('products_selection', '!=', 'product_category')]}"/>
                <field name="selected_products_ids" widget="many2many_tags" attrs="{'invisible': [('products_selection', '!=', 'selected_products')]}"/>
            </xpath>

            <xpath expr="//field[@name='rule_partners_domain']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[@for='rule_min_quantity']" position="attributes">
                <attribute name="string">Minimum Quantity</attribute>
            </xpath>

            <xpath expr="//field[@name='rule_products_domain']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            
            <xpath expr="//field[@name='company_id']" position="attributes">
                <attribute name="readonly">1</attribute>
                <attribute name="force_save">1</attribute>
            </xpath>

            <field name="rule_date_to" position="after">
                <field name="promotion_type"/>
            </field>

            <xpath expr="//sheet/group[2]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//sheet/group[2]" position="after">
                <group string="Rewards" name="rewards_new">
                    <field name="sequence" invisible="1"/>
                    <group name="group_reward_1">
                        <field name="promo_applicability" widget="radio"/>
                    </group>
                    <group name="group_reward_2" modifiers="{}">
                        <field name="reward_type" string="Reward" widget="radio"/>
                        <field name="discount_line_product_id" readonly="0" domain="[('type', '=', 'service')]" attrs="{'invisible': [('reward_type', '=', 'product')]}"/>
                        <field name="reward_product_id" attrs="{'invisible': [('reward_type', 'in', ('discount', 'free_shipping'))], 'required': [('reward_type', '=', 'product')]}" placeholder="Select reward product"/>
                        <label string="Quantity" for="reward_product_quantity" attrs="{'invisible': ['|', ('reward_type', 'in', ('discount', 'free_shipping')), ('reward_product_id', '=',False)]}"/>
                        <div attrs="{'invisible': ['|', ('reward_type', 'in', ('discount', 'free_shipping')),('reward_product_id', '=',False)]}">
                            <field name="reward_product_quantity" class="oe_inline"/>
                            <field name="reward_product_uom_id" class="oe_inline"/>
                        </div>
                    </group>
                    <group name="group_reward_3">
                        <label string="Apply Discount" for="discount_type" attrs="{'invisible': [('reward_type', 'in', ('product', 'free_shipping'))]}"/>
                        <div attrs="{'invisible': [('reward_type', 'in', ('product', 'free_shipping'))]}">
                            <field name="discount_type" class="oe_inline" attrs="{'required': [('reward_type','=','discount')]}"/>
                            <field name="discount_percentage" attrs="{'invisible': [('discount_type', '!=', 'percentage')],'required': [('discount_type', '=', 'percentage')]}" class="oe_inline"/>
                            <span attrs="{'invisible': [('discount_type', '!=', 'percentage')],'required': [('discount_type', '=', 'percentage')]}" class="oe_inline">%</span>
                        </div>
                        <label string="Fixed Amount" for="discount_fixed_amount" attrs="{'invisible': ['|',('discount_type', '!=', 'fixed_amount'), ('reward_type', '!=', 'discount')]}" />
                        <div attrs="{'invisible': ['|',('discount_type', '!=', 'fixed_amount'), ('reward_type', '!=', 'discount')]}">
                            <field name="discount_fixed_amount" class="oe_inline" attrs="{'required':[('discount_type', '=', 'fixed_amount')]}" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </div>
                        <field name="discount_apply_on" attrs="{'invisible':
                        ['|', ('reward_type', 'in', ('product', 'free_shipping')), ('discount_type', '!=', 'percentage')]}" widget="radio"/>
                        <field name="discount_specific_product_ids" widget='many2many_tags' attrs="{'invisible': ['|', '|', ('discount_apply_on', '!=', 'specific_products'),('discount_type', '!=', 'percentage'), ('reward_type', 'in', ('product', 'free_shipping'))], 'required': [('reward_type', '=', 'discount'),('discount_apply_on', '=', 'specific_products'),('discount_type', '=', 'percentage')]}" placeholder="Select products"/>
                        <label for="discount_max_amount" string="Max Discount Amount" attrs="{'invisible': ['|', ('reward_type', 'in', ('product', 'free_shipping')), ('discount_type', '!=', 'percentage')]}"/>
                        <div attrs="{'invisible': ['|', ('reward_type', 'in', ('product', 'free_shipping')), ('discount_type', '!=', 'percentage')]}">
                            <field name="discount_max_amount" class="oe_inline" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <span class="oe_grey">if 0, no limit</span>
                        </div>
                    </group>
                </group>
            </xpath>
            
        </field>
    </record>

    <menuitem
        id="menu_promotion_program"
        action="coupon_program_action_promo_program_sales"
        parent="sale.product_menu_catalog"
        name="Promotion Programs"
        groups="sales_team.group_sale_manager"
        sequence="5"
    />

    <record id="sale_coupon.menu_promotion_type_config" model="ir.ui.menu">
        <field name="active" eval="False"/>
    </record>

</odoo>