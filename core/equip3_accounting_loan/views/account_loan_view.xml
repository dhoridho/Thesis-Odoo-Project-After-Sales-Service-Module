<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="account_loan_line_inherit_tree" model="ir.ui.view">
        <field name="name">account.loan.line.inherit.tree</field>
        <field name="model">account.loan.line</field>
        <field name="inherit_id" ref="account_loan.account_loan_line_tree"/>
        <field name="arch" type="xml">
            <!-- <xpath expr="//field[@name='payment_amount']" position="attributes">
                <attribute name="string">Lease Payment Amount</attribute>
            </xpath>
            <xpath expr="//field[@name='payment_amount']" position="after">
                <field name="pv_of_lease_recal" sum="pv_of_lease_recal"/>
                <field name="pending_principal_amount" string='Lease Liabilities Beginning Balance'/>
            </xpath> -->

            <xpath expr="//field[@name='interests_amount']" position="after">
                <field name="lease_liabilities_ending" string='Lease Liabilities Ending Balance'/>
                <field name="rou_beginning" invisible='1'/>
                <field name="depreciation" sum="depreciation" invisible='1'/>
                <field name="rou_ending" invisible='1'/>
            </xpath>
        </field>
    </record>

    <record id="account_loan_inherit_form" model="ir.ui.view">
        <field name="name">account.loan.inherit.form</field>
        <field name="model">account.loan</field>
        <field name="inherit_id" ref="account_loan.account_loan_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='loan_amount']" position="after">
                <field name="total_lease_recal" string='PV of lease liability' attrs="{'invisible': [('loan_type','!=','pvip')]}"/>
                <field name="implicit_interest_exp" string='Implicit Interest Expense' attrs="{'invisible': [('loan_type','!=','pvip')]}"/>
            </xpath>

            <xpath expr="//page[@id='items']" position="replace">
                <page string="Items" id="items" attrs="{'invisible': [('loan_type','=','pvip')]}">
                    <field name="line_ids">
                        <tree string="Items">
                            <field name="sequence"/>
                            <field name="date"/>
                            <field name="rate"/>
                            <field name="pending_principal_amount"/>
                            <field name="payment_amount" sum="payment_amount" />
                            <field name="principal_amount" />
                            <field name="interests_amount" sum="interests_amount" />
                            <field name="long_term_pending_principal_amount"/>
                            <field name="long_term_principal_amount"/>
                            <field name="loan_state" invisible="1" />
                            <field name="is_leasing" invisible="1" />
                            <field name="has_invoices" invisible="1" />
                            <field name="has_moves" invisible="1" />
                            <field name="currency_id" invisible="1" />
                            <button
                                name="view_account_values"
                                string="Values"
                                type="object"
                                icon="fa-eye"
                                attrs="{'invisible': [('has_moves', '=', False),  ('has_invoices', '=', False)]}"
                            />
                            <button
                                name="view_process_values"
                                string="Process"
                                type="object"
                                icon="fa-cogs"
                                attrs="{'invisible': ['|', '|', ('has_moves', '=', True),  ('has_invoices', '=', True), ('loan_state', '!=', 'posted')]}"
                            />
                        </tree>
                    </field>
                </page>

                <page string="Items" id="items_pvif" attrs="{'invisible': [('loan_type','!=','pvip')]}">
                    <field name="line_ids_pvif">
                        <tree string="Items">
                            <field name="sequence"/>
                            <field name="date"/>
                            <field name="rate"/>
                            <field name="payment_amount" string="Lease Payment Amount" sum="payment_amount" />
                            <field name="pv_of_lease_recal" sum="pv_of_lease_recal"/>
                            <field name="pending_principal_amount" string='Lease Liabilities Beginning Balance'/>
                            <field name="principal_amount" />
                            <field name="interests_amount" sum="interests_amount" />
                            <field name="lease_liabilities_ending" string='Lease Liabilities Ending Balance'/>
                            <field name="loan_state" invisible="1" />
                            <field name="is_leasing" invisible="1" />
                            <field name="has_invoices" invisible="1" />
                            <field name="has_moves" invisible="1" />
                            <field name="currency_id" invisible="1" />
                            <button
                                name="view_account_values"
                                string="Values"
                                type="object"
                                icon="fa-eye"
                                attrs="{'invisible': [('has_moves', '=', False),  ('has_invoices', '=', False)]}"
                            />
                            <button
                                name="view_process_values"
                                string="Process"
                                type="object"
                                icon="fa-cogs"
                                attrs="{'invisible': ['|', '|', ('has_moves', '=', True),  ('has_invoices', '=', True), ('loan_state', '!=', 'posted')]}"
                            />
                        </tree>
                    </field> 
                </page>

            </xpath>
        </field>
    </record>
</odoo>

