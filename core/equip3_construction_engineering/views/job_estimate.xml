<?xml version="1.0" encoding="utf-8"?>
<!--
Copyright (C) 2015 DevIntelle Consulting Service Pvt.Ltd (<http://www.devintellecs.com>).

For Module Support : devintelle@gmail.com  or Skype : devintelle
 -->
<odoo>
    <record id="variable_estimation_inherit_engineering" model="ir.ui.view">
        <field name="name">variable.estimate.fields.inherit.engineering</field>
        <field name="model">job.estimate</field>
        <field name="inherit_id" ref="equip3_construction_sales_operation.variable_estimation_inherit"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook/page[@name='variable']/field[@name='variable_ids']/tree/field[@name='variable_name']" position="before">
                <field name="is_engineering" invisible="1"/>
            </xpath>

            <!-- <xpath expr="//notebook/page[@name='variable']/field[@name='variable_ids']/tree/field[@name='variable_name']" position="attributes">
                <attribute name="domain">[]</attribute>
            </xpath>  -->

        </field>
    </record>

    <record id="section_estimation_inherit_inherit" model="ir.ui.view">
        <field name="name">job.estimate.engineering.inherited.To Manufacture</field>
        <field name="model">job.estimate</field>
        <field name="inherit_id" ref="bi_job_cost_estimate_customer.job_estimate_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//group[2]//group[1]/div[1]" position="after">
                 <label for='is_engineering' invisible="1"/>
                <div class="card-group">
                    <field name="is_engineering" invisible="1" force_save="1"/>
                </div>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="before">
                <field name="construction_type" string="Type"/>
            </xpath>
            <xpath expr="//notebook/page[@name='variable']" position="after">
                <page string="To Manufacture" name="manufacture" attrs="{'invisible':[('is_engineering','=',False)]}">
                    <field name="project_scope_computed" widget="many2many_tags" invisible="1"/>
                    <field name='hide_cascade' invisible="1"/>
                    <field name='hide_undo' invisible="1"/>
                    <button name="cascade_bom_button" type="object" string="Cascade to child BOM " class="btn btn-primary"/>
                    <button name="undo_cascade_bom" type="object" invisible="1" string="Undo Cascade" class="btn btn-secondary"/>
                    <field name='manufacture_line' widget="one2many_list" attrs="{'readonly': [('state', 'in', ['confirmed','done','sale','cancel'])]}">
                        <tree editable="bottom">
                            <control>
                                <create name="add_product_control" string="Add a finish good"/>
                            </control>
                            <field name="sequence" widget="handle"/>
                            <field name='is_lock' invisible="1"/>
                            <field name='is_new' invisible="1"/>
                            <field name='number'/>
                            <field name="project_scope_id" domain="[('id','in',parent.project_scope_computed)]"
                                   options="{'no_create': True, 'no_quick_create':True,'no_create_edit':True}"
                                   attrs="{'readonly': [('is_lock', '=', True), ('is_new', '=', False)]}"/>
                            <field name="project_section_computed" widget="many2many_tags" invisible="1"/>
                            <field name="section_id"
                                   domain="[('id','in',project_section_computed)]"
                                   options="{'no_create': True, 'no_quick_create':True,'no_create_edit':True}" 
                                   attrs="{'readonly': ['|',('project_scope_id', '=', False),'&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}"/>
                            <field name="variable_ref" attrs="{'readonly': ['|', ('section_id', '=', False), '&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}"
                                    options="{'no_quick_create':True}"
                                    context="{'default_variable_subcon':False}"
                                    optional="hide"/>
                            <field name="final_finish_good_id" readonly="1" attrs="{'column_invisible': [('parent.hide_cascade', '=', False)]}"/>
                            <field name="parent_finish_good_id" readonly="1" attrs="{'column_invisible': [('parent.hide_cascade', '=', False)]}" optional="hide"/>
                            <field name='finish_good_id' required="1" domain="[('finish_goods_bom_count','>',0)]" attrs="{'readonly': ['|', ('section_id', '=', False), '&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}"/>
                            <field name='bom_id' required="1" attrs="{'readonly': ['|', ('finish_good_id', '=', False), '&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}"/>
                            <field name="current_quantity" string="Available Budget Quantity" attrs="{'column_invisible': [('parent.contract_category', '!=', 'var')]}"/>
                            <field name="initial_quantity" readonly="1" invisible="1"/>
                            <field name='quantity' attrs="{'readonly': ['|', ('bom_id', '=', False), '&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}"/>
                            <field name='uom' attrs="{'readonly': ['|', ('bom_id', '=', False), '&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}"/>
                            <field name='manuf_no' attrs="{'readonly': ['|', ('bom_id', '=', False), '&amp;',('is_lock', '=', True),  ('is_new', '=', False)]}" invisible="1"/>
                            <field name='subtotal' readonly="1" force_save="1" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="company_id" invisible="1"/>
                            <field name="cost_sheet_ref" invisible="1"/>
                            <field name="contract_category" invisible="1"/>
                            <field name="onchange_pass" invisible="1"/>
                            <field name="is_changed" invisible="1"/>
                            <field name="is_engineering" invisible="1"/>
                            <field name="cascaded" force_save="1" invisible="1"/>
                            <field name="is_child" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.hide_cascade', '=', False)]}" invisible="1"/>
                            <field name="parent_manuf_line" invisible="1"/>
                        </tree>
                    </field>
                    <group>
                        <group class="oe_subtotal_footer oe_right" colspan="2" name="total_material_estimate">
                            <field name="total_material_estimate" widget="monetary" options="{'currency_field': 'currency_id'}" force_save='1'/>
                            <field name="total_labour_estimate" widget="monetary" options="{'currency_field': 'currency_id'}" force_save='1'/>
                            <field name="total_overhead_estimate" widget="monetary" options="{'currency_field': 'currency_id'}" force_save='1'/>
                            <field name="total_assets_estimate" widget="monetary" options="{'currency_field': 'currency_id'}" force_save='1'/>
                            <field name="total_subcon_estimate" widget="monetary" options="{'currency_field': 'currency_id'}" force_save='1'/>
                            <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                <label for="total_job_estimate"/>
                            </div>
                            <field name="total_job_estimate" nolabel="1" class="oe_subtotal_footer_separator"
                                widget='monetary' options="{'currency_field': 'currency_id'}" force_save='1'/>
                        </group>
                        <group name="description" string="Description of BOQ">
                            <field name="description" nolabel="1"/>
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//notebook/page[@name='material_page']/field[@name='material_estimation_ids']/tree/field[@name='variable_ref']" position="after">
                <field name="manufacture_finish_good" invisible="1"/>
                <field name="finish_good_id_template" invisible="1"/>
                <field name='final_finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name="parent_finish_good_id" invisible="1"/>
                <field name='finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name='bom_id' optional="hide" domain="[('product_tmpl_id','=', finish_good_id_template)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('finish_good_id', '=', False)], 'required': [('finish_good_id', '!=', False)]}"/>
                <field name="operation_two_id" readonly='1' force_save='1' optional='hide'/>
            </xpath>
             <xpath expr="//notebook/page[@name='labour_page']/field[@name='labour_estimation_ids']/tree/field[@name='variable_ref']" position="after">
                <field name="manufacture_finish_good" invisible="1"/>
                <field name="finish_good_id_template" invisible="1"/>
                <field name='final_finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name="parent_finish_good_id" invisible="1"/>
                <field name='finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name='bom_id' optional="hide" domain="[('product_tmpl_id','=', finish_good_id_template)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('finish_good_id', '=', False)], 'required': [('finish_good_id', '!=', False)]}"/>
                <field name="operation_two_id" readonly='1' force_save='1' optional='hide'/>
            </xpath>
            <xpath expr="//notebook/page[@name='overhead_page']/field[@name='overhead_estimation_ids']/tree/field[@name='variable_ref']" position="after">
                <field name="manufacture_finish_good" invisible="1"/>
                <field name="finish_good_id_template" invisible="1"/>
                <field name='final_finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name="parent_finish_good_id" invisible="1"/>
                <field name='finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name='bom_id' optional="hide" domain="[('product_tmpl_id','=', finish_good_id_template)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('finish_good_id', '=', False)], 'required': [('finish_good_id', '!=', False)]}"/>
                <field name="operation_two_id" readonly='1' force_save='1' optional='hide'/>
            </xpath>
            <xpath expr="//notebook/page[@name='asset_astimation_page']//page[@name='internal_asset']/field[@name='internal_asset_ids']/tree/field[@name='variable_ref']" position="after">
                <field name="manufacture_finish_good" invisible="1"/>
                <field name="finish_good_id_template" invisible="1"/>
                <field name='final_finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name="parent_finish_good_id" invisible="1"/>
                <field name='finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name='bom_id' optional="hide" domain="[('product_tmpl_id','=', finish_good_id_template)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('finish_good_id', '=', False)], 'required': [('finish_good_id', '!=', False)]}"/>
                <field name="operation_two_id" readonly='1' force_save='1' optional='hide'/>
            </xpath>
            <xpath expr="//notebook/page[@name='asset_astimation_page']//page[@name='equipment_page']/field[@name='equipment_estimation_ids']/tree/field[@name='variable_ref']" position="after">
                <field name="manufacture_finish_good" invisible="1"/>
                <field name="finish_good_id_template" invisible="1"/>
                <field name='final_finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name="parent_finish_good_id" invisible="1"/>
                <field name='finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name='bom_id' optional="hide" domain="[('product_tmpl_id','=', finish_good_id_template)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('finish_good_id', '=', False)], 'required': [('finish_good_id', '!=', False)]}"/>
                <field name="operation_two_id" readonly='1' force_save='1' optional='hide'/>
            </xpath>
            <xpath expr="//notebook/page[@name='subcon_page']/field[@name='subcon_estimation_ids']/tree/field[@name='variable_ref']" position="after">
                <field name="manufacture_finish_good" invisible="1"/>
                <field name="finish_good_id_template" invisible="1"/>
                <field name='final_finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name="parent_finish_good_id" invisible="1"/>
                <field name='finish_good_id' optional="show" domain="[('finish_goods_bom_count','>',0), ('id', 'in', manufacture_finish_good)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('section_name', '=', False)]}"/>
                <field name='bom_id' optional="hide" domain="[('product_tmpl_id','=', finish_good_id_template)]" attrs="{'column_invisible':[('parent.is_engineering','=',False)], 'readonly': [('finish_good_id', '=', False)], 'required': [('finish_good_id', '!=', False)]}"/>
                <field name="operation_two_id" readonly='1' force_save='1' optional='hide'/>
            </xpath>
        </field>
    </record>
    <record id="edit_job_estimate_tree_view_engineering" model="ir.ui.view">
        <field name="name">edit.job.estimate.tree.view.engineering</field>
        <field name="model">job.estimate</field>
        <field name="inherit_id" ref="equip3_construction_sales_operation.edit_job_estimate_tree_view"/>
        <field name="arch" type="xml">
            <xpath expr="//tree/field[@name='contract_category']" position="after">
                    <field name="construction_type" string="Type"/>
            </xpath>
        </field>
    </record>
</odoo>