<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Form View -->
    <record id="progress_history_form_view_wiz" model="ir.ui.view">
        <field name="name">progress.history.form.view.wiz</field>
        <field name="model">progress.history.wiz</field>
        <field name="arch" type="xml">
            <form string="Progress History">
                <header attrs="{'invisible': [('is_progress_history_approval_matrix', '=', False)]}">
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting,approved"/>  
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="number" />
                        </h1>
                    </div>
                    <group name="main">
                        <group>
                            <field name="project_id" attrs="{'invisible':[('is_create_from_list_view', '=', True)]}" options="{'no_create': True, 'no_quick_create':True,'no_create_edit':True}"/>
                            <field name="sale_order" attrs="{'invisible':['|','|', ('department_type', '=', 'department'), ('is_subcon', '=', True), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="job_estimate" attrs="{'invisible':['|','|', ('department_type', '=', 'project'), ('is_subcon','=', True), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="list_project_id" attrs="{'invisible':[('is_create_from_list_view', '=', False)], 'required':[('is_create_from_list_view','=', True)]}"
                                   options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}"/>
                            <field name="list_sale_order"
                                   domain="[('project_id','=',list_project_id),('vo_payment_type','=','split'), ('state','=','sale')]"
                                   attrs="{'invisible':['|','|', ('department_type', '=', 'department'), ('is_subcon', '=', True), ('is_create_from_list_view', '=', False)], 'required':['&amp;', ('is_create_from_list_view','=', True), ('department_type','=', 'project')]}"
                                   options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}"/>
                            <field name="list_job_estimate" domain="[('project_id','=',list_project_id), ('state_new','=','approved')]" 
                                   attrs="{'invisible':['|','|', ('department_type', '=', 'project'), ('is_subcon','=', True), ('is_create_from_list_view', '=', False)], 'required':['&amp;', ('is_create_from_list_view','=', True), ('department_type','=', 'department')]}"
                                   options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}"/>
                            <field name="purchase_subcon" attrs="{'invisible':[('is_subcon','=', False)]}"/>
                            <field name="completion_ref" invisible="1"/>
                            <field name="list_completion_ref" invisible="1"/>
                            <field name="stage_computed_new" widget="many2many_tags" invisible="1"/>
                            <field name="stage_new" attrs="{'invisible':[('is_create_from_list_view', '=', True)]}"/>
                            <field name="list_stage_computed_new" widget="many2many_tags" invisible="1"/>
                            <field name="list_stage_new" domain="[('id','in',list_stage_computed_new)]" attrs="{'invisible':[('is_create_from_list_view', '=', False)], 'required':[('is_create_from_list_view','=', True)]}"
                                   options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}"/>
                            <field name="work_order" readonly="1" force_save="1"  string="Job Order" attrs="{'invisible':['|', ('subtask_exist','=', True), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="work_order" readonly="1" force_save="1"  string="Job Order" attrs="{'invisible':['|', '|', ('subtask_exist','=', False), ('subtask','!=', False), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="work_order" readonly="1" force_save="1"  string="Parent Task" attrs="{'invisible':['|', '|', ('subtask_exist','=', False), ('subtask','=', False), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="name" invisible="1" readonly="1" string="Job Order" attrs="{'invisible':['|',('subtask_exist','=', True), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="name" invisible="1" readonly="1" string="Parent Task" attrs="{'invisible':['|',('subtask_exist','=', False), ('is_create_from_list_view', '=', True)]}"/>
                            <field name="list_work_order" string="Job Order" 
                                   domain="[('project_id','=',list_project_id), ('stage_new','=',list_stage_new), ('is_subtask','=',False), '|', ('sale_order','=',list_sale_order), ('job_estimate','=',list_job_estimate)]" 
                                   attrs="{'invisible':[('is_create_from_list_view', '=', False)], 'required':[('is_create_from_list_view','=', True)]}"
                                   options="{'no_create': True, 'no_quick_create': True, 'no_create_edit': True}"/>
                            <field name="hide_subtask_parents" invisible="1"/>
                            <field name="subtask_parents" readonly="1" attrs="{'invisible':[('hide_subtask_parents','=', True)]}"/>
                            <field name="child_subtasks" readonly="1" invisible="1"/>
                            <field name="subtask" attrs="{'invisible':[('subtask_exist','=', False)]}"/>
                            <field name="progress_start_date_new" required="1" force_save="1"/>
                            <field name="progress_end_date_new" required="1" force_save="1"/>
                            <field name="parent_task" invisible="1" />
                            <field name="custom_project_progress" invisible="1" />
                            <field name="is_subcon" invisible="1"/>
                            <field name="is_subtask" invisible="1"/>
                            <field name="subtask_exist" invisible="1"/>
                            <field name="department_type" invisible="1"/>
                            <field name="is_progress_history_approval_matrix" invisible="1"/>
                            <field name="is_approval_matrix_filled" invisible="1" />   
                            <field name="is_create_from_list_view" invisible="1" />
                            <field name="custom_project_progress" invisible="1" />
                            <field name="is_using_labour_attendance" invisible="1"/>
                        </group>
                        <group>
                            <label for="latest_completion" string="Latest Completion" attrs="{'invisible':[('subtask_exist','=', True)]}"/>
                                <div attrs="{'invisible':[('subtask_exist','=', True)]}">
                                    <field name="latest_completion" force_save="1" readonly="1" class="oe_inline"/>
                                    <label for="latest_completion" string="%%"/>
                                </div>
                            <label for="latest_completion" string="Latest Completion" attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','!=', False)]}"/> 
                                <div attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','!=', False)]}">
                                    <field name="latest_completion" force_save="1" readonly="1" class="oe_inline"/>
                                    <label for="latest_completion" string="%%"/>
                                </div>
                            <label for="latest_completion" string="Latest Completion Parent Task" attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','=', False)]}"/>
                                <div attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','=', False)]}">
                                    <field name="latest_completion" force_save="1" readonly="1" class="oe_inline"/>
                                    <label for="latest_completion" string="%%"/>
                                </div>
                            <label for="latest_completion_subtask" string="Latest Completion Subtask" attrs="{'invisible':['|',('subtask_exist','=', False),('subtask','=', False)]}"/>
                                <div attrs="{'invisible':['|',('subtask_exist','=', False),('subtask','=', False)]}">
                                    <field name="latest_completion_subtask" force_save="1" readonly="1" class="oe_inline" />
                                    <label for="latest_completion_subtask" string="%%"/>
                                </div>
                            <label for="progress_subtask" string="Additional Progress Subtask" attrs="{'invisible':['|',('subtask_exist','=', False),('subtask','=', False)]}"/>
                                <div attrs="{'invisible':['|',('subtask_exist','=', False),('subtask','=', False)]}">
                                    <field name="progress_subtask" force_save="1" class="oe_inline" attrs="{'required':[('subtask_exist','=', True)]}"/>
                                    <label for="progress_subtask" string="%%"/>
                                </div>
                            <label for="progress" string="Additional Progress" attrs="{'invisible':[('subtask_exist','=', True)]}"/>
                                <div attrs="{'invisible':[('subtask_exist','=', True)]}">
                                    <field name="progress" required="1" force_save="1" class="oe_inline" attrs="{'readonly':[('custom_project_progress','!=', 'manual_estimation')]}"/>
                                    <label for="progress" string="%%"/>
                                </div>
                            <label for="progress" string="Additional Progress" attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','!=', False)]}"/>
                                <div attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','!=', False)]}">
                                    <field name="progress" required="1" force_save="1" class="oe_inline"  attrs="{'readonly':[('custom_project_progress','!=', 'manual_estimation')]}"/>
                                    <label for="progress" string="%%"/>
                                </div>
                            <label for="progress" string="Parent Task Progress" attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','=', False)]}"/>
                                <div attrs="{'invisible':['|', ('subtask_exist','=', False), ('subtask','=', False)]}">
                                    <field name="progress" required="1" force_save="1" class="oe_inline" attrs="{'readonly':['|', ('subtask_exist','=', True), ('custom_project_progress','!=', 'manual_estimation')]}"/>
                                    <label for="progress" string="%%"/>
                                </div>                        
                            <field name="progress_summary" required="1" force_save="1"/>
                            <field name="company_id" />
                            <field name="branch_id" readonly="1" force_save="1"/>    
                            <field name="create_by" readonly="1"/>
                            <field name="date_create" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <!-- Labour Usage -->
                        <page name="labour_usage" string="Labour Usage" attrs="{'invisible':[('is_using_labour_attendance','=', True)]}">
                            <field name="labour_usage_ids" attrs="{'readonly':[('state','!=', 'draft')]}">
                                <tree editable="bottom" create="1">
                                    <field name="labour_usage_line_id" invisible="0" force_save="1"/>
                                    <field name="cs_labour_id" invisible="1" force_save="1"/>
                                    <field name="bd_labour_id" invisible="1" force_save="1"/>
                                    <field name="no" readonly="1" force_save="1"/>
                                    <field name="project_scope_id" readonly="1" force_save="1"/>
                                    <field name="section_id" readonly="1" force_save="1"/>
                                    <field name="group_of_product_id" readonly="1" force_save="1"/>
                                    <field name="product_id" readonly="1" force_save="1"/>
                                    <field name="contractors" readonly="1" force_save="1"/>
                                    <field name="time_usage" readonly="0" force_save="1"  attrs="{'column_invisible':[('parent.custom_project_progress', '!=', 'manual_estimation')]}"/>
                                    <field name="time" force_save="1" readonly="1"/>
                                    <field name="time_left" readonly="1" invisible="1" force_save="1"/>
                                    <field name="uom_id" readonly="1" force_save="1"/>
                                    <field name="unit_price" force_save="1"/>
                                    <field name="domain_worker" readonly="1" invisible="1"/>
                                    <field name="custom_project_progress" readonly="1" invisible="1"/>
                                    <field name="workers_ids" widget="many2many_tags" domain="domain_worker" force_save="1" attrs="{'column_invisible':[('parent.custom_project_progress','=', 'manual_estimation')]}"/>
                                    <field name="analytic_group_ids" widget="many2many_tags" force_save="1"/>
                                    <field name="project_task_id" invisible="1" force_save="1"/>
                                    <field name="is_add_progress" invisible="1" force_save="1"/>
                                    <field name="temp_time_left" invisible="1" force_save="1"/>
                                </tree>
                                <form>
                                    <sheet>
                                        <group>
                                            <group class="o_setting_left_pane">
                                                <field name="project_task_id" invisible="1"/>
                                                <field name="project_scope_id" required="1" force_save="1"/>
                                                <field name="section_id" required="1" force_save="1"/>
                                                <field name="product_id" required="1" force_save="1"/>
                                                <field name="workers_ids" force_save="1" widget="many2many_tags"/>
                                            </group>
                                            <group class="o_setting_right_pane">
                                                <field name="contractors" required="1" force_save="1"/>
                                                <field name="time" required="1" force_save="1"/>
                                                <field name="time_left" force_save="1"/>
                                                <field name="uom_id" required="1" force_save="1"/>
                                                <field name="analytic_group_ids" required="1" force_save="1" widget="many2many_tags"/>
                                            </group>
                                        </group>
                                    </sheet>
                                </form>
                            </field>
                        </page>
                        <page name="attachment_ids" string="Attachments" >
                            <field name="attachment_ids" class="o_attachment_line"  widget="one2many_list">
                                <tree editable="bottom">
                                    <control>
                                        <create name="add_product_control" string="Add a attachment"/>
                                    </control>
                                    <field name="sequence" invisible="1"/>
                                    <field name="sr_no" />
                                    <field name="date_now" invisible='1' force_save="1"/>
                                    <field name="attachment" required="1" filename="name"/>
                                    <field name="name" />
                                    <field name="size" invisible="1"/>
                                    <field name="description"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Approval Matrix Line" attrs="{'invisible': [('is_progress_history_approval_matrix', '=', False)]}">
                            <group name="approval">
                                <group >
                                    <field name="approving_matrix_sale_id" attrs="{'invisible': [('is_progress_history_approval_matrix', '=', False)]}"/>
                                </group>
                            </group>
                            <field name="approval_matrix_ids" context="{'approval_matrix_ids': approval_matrix_ids}" class="o_sale_approval_matrix_line">
                                <tree editable="bottom">
                                    <field name="sequence" />
                                    <field name="approvers" widget="many2many_tags"/>
                                    <field name="minimum_approver" />
                                    <field name="approval_status" />
                                    <field name="approved_time" />
                                    <field name="feedback" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="add_progress" string="Add Progress" type="object" class="oe_highlight" attrs="{'invisible':[('is_progress_history_approval_matrix','=', True)]}"/>
                    <button name="add_progress" string="Request For Approval" type="object" class="oe_highlight" attrs="{'invisible':[('is_progress_history_approval_matrix','=', False)]}"/>
                    <button string="Cancel" special="cancel" class="btn-secondary"/>
                </footer>   
            </form>
        </field>
    </record>

</odoo>