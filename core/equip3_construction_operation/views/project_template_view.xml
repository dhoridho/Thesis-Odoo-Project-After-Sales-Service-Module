<?xml version='1.0' encoding='utf-8'?>
<odoo>

    <!-- templates.project tree view -->
    <record id="template_project_view_tree" model="ir.ui.view">
        <field name="name">Project Template</field>
        <field name="model">templates.project</field>
        <field name="arch" type="xml">
            <tree multi_edit="1" sample="1">
                <field name="name"/>
            </tree>
        </field>
    </record>

    <!-- templates.project form view -->
    <record id="template_project_view_form" model="ir.ui.view">
        <field name="name">Project Template</field>
        <field name="model">templates.project</field>
        <field name="arch" type="xml">
            <form string="">
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="allowed_job_order_templates" widget="many2many_tags"/>
                        </group>
                        <group>
                            <field name="create_uid" string='Created By'/>
                            <field name="create_date" string='Creation Date'/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Project Template">
                            <field name="project_template_line">
                                <tree create="true" delete="true" editable="bottom">
                                    <control>
                                        <create string="Add a line"/>
                                    </control> 
                                    <field name="sequence" widget="handle"/>
                                    <field name="sr_no"/>
                                    <field name="name"/>
                                    <field name="stage_weightage"/>
                                    <field 
                                        name="job_order_template_id"
                                        widget="many2many_tags"
                                        domain="[('id', 'in', parent.allowed_job_order_templates)]"
                                        />
                                </tree>
                            </field>
                        </page>
                        <page string="Predecessor and Successor">
                            <field name="predecessor_template_line">
                                <tree create="true" delete="true" editable="bottom">
                                    <control>
                                        <create string="Add a line"/>
                                    </control>
                                    <field name="project_template_id" invisible="1"/> 
                                    <field name="sequence" widget="handle"  invisible="1"/>
                                    <field name="sr_no"/>
                                    <field
                                        name="predecessor_task_id"
                                        domain="[('id', 'in', parent.allowed_job_order_templates), ('id', '!=', successor_task_id)]"
                                        />
                                    <field
                                        name="successor_task_id"
                                        domain="[('id', 'in', parent.allowed_job_order_templates), ('id', '!=', predecessor_task_id)]"
                                        />
                                    <field name="type"/>
                                    <field name="lag"/>
                                    <field name="lag_type"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Successor" invisible="1">
                            <field name="successor_template_line">
                                <tree create="false">
                                    <field name="project_template_id" invisible="1"/>
                                    <field name="predecessor_task_id"/>
                                    <field name="successor_task_id"/>
                                    <field name="type"/>
                                    <field name="lag"/>
                                    <field name="lag_type"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- template.project action window -->

    <record id="template_project_action" model="ir.actions.act_window">
        <field name="name">Project Template</field>
        <field name="res_model">templates.project</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="template_project_view_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No Project Template found. Let's create one!
            </p>
        </field>
    </record>

    <!-- This Menu Item Must have a parent -->
    <menuitem id="templates_menu_categ" name="Templates" parent="abs_construction_management.construction_management" sequence="7"/>

    <!-- This Menu Item must have a parent and an action -->
    <menuitem id="templates_project_menu_act" name="Project Template" parent="templates_menu_categ" action="template_project_action" sequence="10"/>

    <record model='ir.ui.menu' id='templates_project_menu_act'>
        <field name="groups_id" eval="[(6, 0, [ref('equip3_construction_accessright_setting.group_construction_engineer')])]"/>
    </record>

    <record id="templates_menu_categ" model="ir.ui.menu">
        <field name="equip_icon_class">o-hm-sidebar-parent-construction-templates</field>
    </record>



</odoo>