<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_form_purchase_requisition" model="ir.ui.view">
        <field name="name">purchase.requisition.inherit</field>
        <field name="model">purchase.requisition</field>
        <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_form"/>
        <field name="arch" type="xml">
            <xpath expr="//group" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//div[hasclass('float-left')]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//group" position="before">
                <div class="oe_title">
                    <label for="name" class="oe_edit_only oe_inline"/>
                    <h1>
                        <field name="name"/>
                    </h1>
                </div>
                <div>
                    <div class="row">
                        <div class="col" name="col_1">
                            <group>
                                <field name="is_quantity_copy" invisible="1"/>
                                <field name="user_id" attrs="{'readonly': [('state','not in',('draft','in_progress','open'))]}" domain="[('share', '=', False)]"/>
                                <field name="type_id" attrs="{'readonly': [('state','!=','draft')]}"/>
                                <field name="vendor_id" context="{'res_partner_search_mode': 'supplier'}" attrs="{'required': [('is_quantity_copy', '=', 'none')], 'readonly': [('state', 'in', ['ongoing','done'])]}"/>
                                <field name="currency_id" groups="base.group_multi_currency"/>
                            </group>
                        </div>
                        <div class="col" name="col_2">
                            <group>
                                <field name="show_analytic_tags" invisible="1"/>
                                <field name="account_tag_ids" widget="many2many_tags" attrs="{'invisible': ['|', ('analytic_accounting', '=', False),('show_analytic_tags', '=', False)], 'readonly': [('state1', 'in', ('to_approve', 'approved', 'blanket_order'))]}"/>
                                <field name="date_end" attrs="{'readonly': [('state','not in',('draft','in_progress','open','ongoing'))]}"/>
                                <field name="ordering_date" attrs="{'readonly': [('state','not in',('draft','in_progress','open','ongoing'))]}"/>
                                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" attrs="{'readonly': [('state','not in',('draft'))]}"/>
                            </group>
                        </div>
                        <div class="col" name="col_3">
                            <group>
                                <field name="schedule_date" attrs="{'readonly': [('state','not in',('draft','in_progress','open','ongoing'))]}"/>
                                <field name="origin" placeholder="e.g. PO0025" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            </group>
                        </div>
                    </div>
                </div>
            </xpath>
            <xpath expr="//field[@name='type_id']" position="attributes">
                <attribute name="invisible">1</attribute>               
            </xpath>
            <xpath expr="//field[@name='vendor_id']" position="after">
              <field name="is_goods_orders" invisible="1"/>
              <field name="bo_state2" invisible="1"/>
            </xpath>
            <xpath expr="//button[@name='%(purchase_requisition.action_purchase_requisition_to_so)d']" position="replace">
                <button name="%(blanket_quotation_wizard)d" type="action"
                        string="New Quotation" class="btn-primary"
                        attrs="{'invisible': [('bo_state', 'not in', ('pending_order', 'ongoing'))]}"/>
<!--              <button name="action_new_blanket_order_quotation" type="object"-->
<!--                    string="New Quotation" class="btn-primary"-->
<!--                    attrs="{'invisible': [('bo_state', 'not in', ('pending_order', 'ongoing'))]}"/>-->
                <button name="action_bo_close" type="object" string="Close" class="btn btn-primary" attrs="{'invisible': ['|', ('state', '!=', 'blanket_order'), ('bo_state', 'not in', ('pending_order', 'ongoing'))]}"/>
                <button name="action_bo_cancel" type="object" string="Cancel" class="btn btn-secondary" attrs="{'invisible': ['|', ('state', '!=', 'blanket_order'), ('bo_state', 'not in', ('pending_order', 'ongoing'))]}"/>
            </xpath>
            <xpath expr="//button[@name='%(purchase_requisition.action_purchase_requisition_to_so)d']" position="attributes">
              <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="replace">
                <field name="user_id" required="1" domain="[('share', '=', False)]"/>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='currency_id']" position="after">
                <field name="analytic_accounting" nolabel="1" invisible="1"/>
                <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}" readonly="True"/>
                <field name="branch_id" readonly="0"/>
            </xpath>
            <xpath expr="//field[@name='currency_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state1', 'in', ('to_approve', 'approved', 'blanket_order'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state1', 'in', ('to_approve', 'approved', 'blanket_order'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='vendor_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state1', 'in', ('to_approve', 'approved', 'blanket_order'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='date_end']" position="after">
                <field name="create_uid" string="Create By" attrs="{'invisible': [('create_uid', '=', False)]}"/>
                <field name="create_date" string="Create Date" attrs="{'invisible': [('create_date', '=', False)]}"/>                
            </xpath>
            <xpath expr="//field[@name='date_end']" position="attributes">
                <attribute name="required">1</attribute>
                <attribute name="attrs">{'readonly': [('state1', 'not in', ('draft', 'to_approve', 'approved', 'blanket_order'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='vendor_id']" position="attributes">
                <attribute name="required">1</attribute>
            </xpath>
            <xpath expr="//field[@name='ordering_date']" position="attributes">
                <attribute name="readonly">True</attribute>
            </xpath>
            <xpath expr="//field[@name='schedule_date']" position="after">
                <label for="set_single_delivery_date" invisible='1'/>
                <div class="o_row" name="delivery_date">
                    <field name="set_single_delivery_date" nolabel="1" attrs="{'readonly': [('state', '!=', 'draft')]}" style="margin-right: 20px;"/>
                    <span>Single Schedule Date</span>
                </div>
                <field name="filter_destination_warehouse" invisible="1"/>
                <field name="destination_warehouse" attrs="{'invisible': [('set_single_delivery_destination', '!=', True)], 'readonly': [('state1', 'in', ('to_approve', 'approved', 'blanket_order'))], 'required':[('set_single_delivery_destination', '=', True)]}"
                domain="filter_destination_warehouse"/>
                <label for="set_single_delivery_destination" invisible='1'/>
                <div class="o_row" name="delivery_dest">
                    <field name="set_single_delivery_destination" nolabel="1" attrs="{'readonly': [('state', '!=', 'draft')]}" style="margin-right: 20px;"/>
                    <span>Single Destination</span>
                </div>
            </xpath>
            <xpath expr="//field[@name='schedule_date']" position="attributes">
                <attribute name="attrs">{'invisible': [('set_single_delivery_date', '!=', True)], 'readonly': [('state1', 'in', ('to_approve', 'approved', 'blanket_order'))], 'required':[('set_single_delivery_date', '=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='schedule_date']" position="attributes">
                <attribute name="attrs">{'readonly': [('set_single_delivery_date', '=', True)], 'column_invisible': [('parent.set_single_delivery_date', '=', True)], 'required': [('set_single_delivery_date', '!=', True)]}</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='schedule_date']" position="after">
                <field name="set_single_delivery_date" invisible="1"/>
                <field name="set_single_delivery_destination" invisible="1"/>
                <field name="company_id" invisible="1"/>
                <field name="analytic_accounting" invisible="1"/>
                <field name="branch_id" invisible="1"/>
                <field name="filter_destination_warehouse_line" invisible="1"/>
                <field name="destination_warehouse" attrs="{'required' :[('set_single_delivery_destination', '=', False)], 'column_invisible': [('parent.set_single_delivery_destination', '=', True)]}" domain="filter_destination_warehouse_line"/>
                <field name="account_tag_ids" widget="many2many_tags" attrs="{'column_invisible': ['|', ('parent.analytic_accounting', '==', False), ('parent.show_analytic_tags', '==', False)],'required' : [('parent.show_analytic_tags','=',True)]}" readonly="False"/>
<!--                <field name="branch_id" invisible="1"/>-->
            </xpath>         
            <xpath expr="//field[@name='line_ids']/tree/field[@name='product_id']" position="before">
                <field name="sequence" widget="handle"/>
                <field name="sequence2" force_save="1" readonly="1"/>
            </xpath>   
            <xpath expr="//field[@name='line_ids']/tree/field[@name='account_analytic_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']" position="attributes">
                <attribute name="context">{'line_ids': line_ids}</attribute>
                <attribute name="attrs">{'readonly':['|', ('state', 'in', ['done']), ('state1', 'in', ('to_approve', 'approved', 'blanket_order'))]}</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='analytic_tag_ids']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/form/group" position="inside">
                <field name="qty_received"/>
                <field name="qty_invoiced"/>
                <field name="qty_remaining"/>
                <field name="branch_id" invisible="1"/>
                <field name="destination_warehouse"/>
<!--                <field name="branch_id" invisible="1"/>-->
            </xpath>
            <xpath expr="//field[@name='origin']" position="attributes">
                <attribute name="attrs">{'readonly': [('state1', 'in', ['to_approve', 'approved', 'blanket_order'])]}</attribute>
            </xpath>
            <xpath expr="//field[@name='origin']" position="after">
                <field name="is_blanket_order_approval_matrix" invisible="1"/>
                <field name="approval_matrix_line_id" invisible="1"/>
                <field name="is_approve_button" invisible="1"/>
            </xpath>
            <xpath expr="//notebook//page[@name='products']" position="after">
                <page name="approved_matrix_ids" string="Approval Matrix Line" attrs="{'invisible': ['|', ('is_blanket_order_approval_matrix','=', False), ('approval_matrix_id', '=', False)]}">
                    <label for="approval_matrix_id" style="margin-bottom: 13px;"/>
                    <field name="approval_matrix_id" attrs="{'invisible': ['|', ('is_blanket_order_approval_matrix','=', False), ('approval_matrix_id', '=', False)]}" string="Approval Matrix"/>
                    <field name="approved_matrix_ids" context="{'approved_matrix_ids': approved_matrix_ids}">
                        <tree editable="bottom">
                            <field name="sequence" />
                            <field name="user_ids" widget="many2many_tags"/>
                            <field name="minimum_approver" />
                            <field name="state_char" />
                            <field name="time_stamp" invisible="1"/>
                            <field name="feedback" />
                        </tree>
                    </field>
                </page>
            </xpath>
            <xpath expr="//header" position="after">
                <header>
                    <field name="bo_state" widget="statusbar" statusbar_visible="pending_order,ongoing,close" align="right" readonly="1" attrs="{'invisible': ['|', ('state', '!=', 'blanket_order'), ('bo_state', '=', 'cancel')]}"/>
                    <field name="bo_state1" widget="statusbar" statusbar_visible="pending_order,ongoing,cancel" align="right" readonly="1" attrs="{'invisible': ['|', ('state', '!=', 'blanket_order'), ('bo_state', '!=', 'cancel')]}"/>
                </header>
            </xpath>
            <xpath expr="//header" position="inside">
                <field name="state1" widget="statusbar" statusbar_visible="draft,to_approve,approved,blanket_order" align="right" readonly="1" attrs="{'invisible': ['|', '|', ('is_blanket_order_approval_matrix','=', False), ('state', '=', 'rejected'), ('approval_matrix_id', '=', False)]}"/>
                <field name="state2" widget="statusbar" statusbar_visible="draft,to_approve,rejected,blanket_order" align="right" readonly="1" attrs="{'invisible': ['|', ('is_blanket_order_approval_matrix','=', False), ('state', '!=', 'rejected')]}"/>
                <field name="is_bo_confirm" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='state_blanket_order']" position="attributes">
                <attribute name="attrs">{'invisible': [('is_blanket_order_approval_matrix', '=', True), ('approval_matrix_id', '!=', False)]}</attribute>
                <attribute name="statusbar_visible">draft,blanket_order</attribute>
            </xpath>
            <xpath expr="//button[@name='action_in_progress']" position="attributes">
                <attribute name="attrs">{'invisible': [
                    '|', '|',
                    '&amp;', '&amp;',
                    ('is_blanket_order_approval_matrix', '=', True),
                    ('approval_matrix_id', '!=', False),
                    ('state', '!=', 'approved'),
                    '&amp;',
                    ('is_blanket_order_approval_matrix', '=', False),
                    ('state', '!=', 'draft'),
                    ('is_bo_confirm', '=', False)
                ]}</attribute>
                <attribute name="states"></attribute>
            </xpath>

            <xpath expr="//button[@name='action_in_progress']" position="before">
                <button name="bo_request_for_approval" type="object"
                    string="Request for Approval" class="btn-primary"
                    attrs="{'invisible': ['|', '|', ('is_blanket_order_approval_matrix', '=', False), ('approval_matrix_id', '=', False), ('state', '!=', 'draft')]}"/>

                <button name="bo_approving" string="Approve" attrs="{'invisible': ['|', '|', ('is_blanket_order_approval_matrix','=', False), ('is_approve_button', '=', False), ('state', '!=', 'to_approve')]}" type="object" class="btn btn-primary"/>

                <button name="bo_reject" string="Reject" attrs="{'invisible': ['|', '|', ('is_blanket_order_approval_matrix','=', False), ('is_approve_button', '=', False), ('state', '!=', 'to_approve')]}" type="object" class="decoration-secondary"/>
            </xpath>
        </field>
    </record>

    <record id="view_purchase_requisition_tree" model="ir.ui.view">
        <field name="name">purchase.requisition.inherit.list</field>
        <field name="model">purchase.requisition</field>
        <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_tree"/>
        <field name="arch" type="xml">
            <field name="state" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="state" position="after">
                <field name="bo_state2" 
                    decoration-primary="bo_state2 == 'draft'"
                    decoration-warning="bo_state2 == 'to_approve'"
                    decoration-success="bo_state2 == 'approved'"
                    decoration-warning2="bo_state2 == 'pending_order'"
                    decoration-primary2="bo_state2 == 'blanket_order'"
                    decoration-primary3="bo_state2 == 'ongoing'"
                    decoration-success2="bo_state2 == 'close' or bo_state2 == 'done'"
                    decoration-secondary="bo_state2 == 'cancel'"
                    decoration-danger="bo_state2 == 'rejected'"
                    decoration-info="bo_state2 == 'open'"
                    widget="badge" />
            </field>
            <tree position="inside">
                <field name="branch_id" optional="show"/>
                <field name="company_id" position="move"/>
            </tree>
        </field>
    </record>

<!--    <record id="view_purchase_requisition_filter" model="ir.ui.view">-->
<!--        <field name="name">purchase.requisition.list.select</field>-->
<!--        <field name="model">purchase.requisition</field>-->
<!--        <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_filter"/>-->
<!--        <field name="arch" type="xml">-->
<!--            <filter name="confirmed" position="attributes">-->
<!--                <attribute name="invisible">1</attribute>-->
<!--            </filter>-->
<!--            <filter name="done" position="attributes">-->
<!--                <attribute name="invisible">1</attribute>-->
<!--            </filter>-->
<!--            <filter name="draft" position="attributes">-->
<!--                <attribute name="invisible">1</attribute>-->
<!--            </filter>-->
<!--            <filter name="draft" position="after">-->
<!--                <filter string="Draft" name="draft" domain="[('bo_state2', '=', 'draft')]" help="New Agreements"/>-->
<!--                <filter string="Waiting for Approval" name="to_approve" domain="[('bo_state2', '=', 'to_approve')]" help="New Agreements"/>-->
<!--                <filter string="Approved" name="approved" domain="[('bo_state2', '=', 'approved')]" help="New Agreements"/>-->
<!--                <filter string="Pending Order" name="pending_order" domain="[('bo_state2', '=', 'pending_order')]" help="New Agreements"/>-->
<!--                <filter string="Ongoing" name="ongoing" domain="[('bo_state2', '=', 'ongoing')]" help="New Agreements"/>-->
<!--                <filter string="Closed" name="done" domain="[('bo_state2', '=', 'close')]" help="New Agreements"/>-->
<!--                <filter string="Cancelled" name="cancel" domain="[('bo_state2', '=', 'cancel')]" help="New Agreements"/>-->
<!--            </filter>-->
<!--        </field>-->
<!--    </record>-->
                          
    <record id="purchase_agreement_view_form" model="ir.ui.view">
      <field name="name">purchase.agreement.form</field>
      <field name="model">purchase.agreement</field>
      <field name="inherit_id" ref="sh_po_tender_management.sh_purchase_agreement_form_view"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='sh_purchase_user_id']" position="after">
          <field name="is_goods_orders" invisible="1"/>
        </xpath>
      </field>
    </record>

    <record id="purchase_requisition_view_form" model="ir.ui.view">
      <field name="name">purchase.requisition.view.form</field>
      <field name="model">purchase.requisition</field>
      <field name="inherit_id" ref="purchase_requisition.view_purchase_requisition_form"/>
      <field name="arch" type="xml">
        <xpath expr="//field[@name='product_id']" position="attributes">
          <attribute name="domain"></attribute>
        </xpath>
        <xpath expr="//field[@name='line_ids']/tree/field[@name='product_uom_id']" position="before">
            <field name="qty_received" />
            <field name="qty_invoiced"/>
            <field name="qty_remaining"/>
        </xpath>
          <xpath expr="//notebook" position="after">
                <group class="oe_subtotal_footer oe_right" colspan="2" name="amount_total">
                    <div class="oe_inline o_td_label" >
                      <label for="amount_total" style="padding-bottom: 25px"/>
                    </div>
                    <field name="amount_total" nolabel="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                  </group>
            </xpath>
      </field>
    </record>

    <record model="ir.ui.menu" id="purchase_requisition.menu_purchase_requisition_pro_mgt">
        <field name='name'>Purchase Blanket Order</field>
        <field name="sequence">12</field>
    </record>

    <record model="ir.actions.act_window" id="purchase_requisition.action_purchase_requisition">
        <field name='name'>Purchase Blanket Order</field>
    </record>

    <record model="ir.ui.menu" id="purchase_requisition.menu_purchase_requisition_type">
        <field name="active" eval="False"/>
    </record>
    

</odoo>
