<?xml version="1.0" encoding="utf-8"?>
<odoo>

      <record id="view_form_purchase_request" model="ir.ui.view">
        <field name="name">purchase.request.inherit</field>
        <field name="model">purchase.request</field>
        <field name="inherit_id" ref="purchase_request.view_purchase_request_form"/>
        <field name="arch" type="xml">
          <xpath expr="//field[@name='branch_id']" position="after">
            <field name="is_pr_to_pt" invisible="1"/>
          </xpath>
          <xpath expr="//field[@name ='line_ids']//tree/field[@name='purchased_qty']" position="after">
            <field name="tender_qty" attrs="{'column_invisible':[('parent.is_pr_to_pt', '=', False)]}"/>
            <field name="qty_received"/>
            <field name="tender_line_ids" invisible="1"/>
          </xpath>
          <xpath expr="//field[@name ='line_ids']//form//group[@name='quantities']" position="inside">
              <group>
                <field name="tender_qty" string="Qty in Tender"/>
                <field name="qty_received"/>
              </group>
          </xpath>
            <xpath expr="//button[@name='%(purchase_request.action_purchase_request_line_make_purchase_order)d']" position="after">
                <button string="Create Purchase Tender" name="create_purchase_tender" type="object" class="oe_highlight" attrs="{'invisible':['|', '|', ('state','!=','purchase_request'), ('is_purchase_tender','=', False), ('purchase_req_state','not in', ('pending','in_progress'))]}"/>
            </xpath>

            <xpath expr="//field[@name='requested_by']" position="after">
                <field name="is_purchase_tender" invisible="1"/>
            </xpath>

            <xpath expr="//div[hasclass('oe_button_box')]" position="inside">

                <button type="object" name="action_view_blanket_order" class="oe_stat_button" attrs="{'invisible':[('blanket_order_count', '=', 0)]}" icon="o-hm-smart-all-purchase-blanket">
                    <field name="blanket_order_count" widget="statinfo" string="Blanket Order Count"/>
                </button>

                <button type="object" name="action_view_purchase_tender" class="oe_stat_button" attrs="{'invisible':['|', ('purchase_tender_count', '=', 0), ('is_purchase_tender','=', False)]}" icon="o-hm-smart-all-purchase-tender">
                    <field name="purchase_tender_count" widget="statinfo" string="Purchase Tender Count"/>
                </button>

            </xpath>
            
            <xpath expr="//notebook" position="after">
                <group class="oe_subtotal_footer oe_right" colspan="2" name="amount_total">
                    <div class="oe_inline o_td_label" >
                      <label for="amount_total" style="padding-bottom: 25px"/>
                    </div>
                    <field name="amount_total" nolabel="1" />
                  </group>
            </xpath>
        </field>
    </record>

    <record id="view_form_purchase_request_line_inherit" model="ir.ui.view">
      <field name="name">purchase.request.line.inherit</field>
      <field name="model">purchase.request.line</field>
      <field name="inherit_id" ref="purchase_request.purchase_request_line_tree"/>
      <field name="arch" type="xml">
        <field name="request_state" position="attributes">
            <attribute name="invisible">1</attribute>
        </field>
        <field name="request_state" position="after">
            <field name="request_state" widget="badge" optional="show" 
            decoration-primary="request_state == 'draft'" 
            decoration-primary2="request_state == 'purchase_request'" 
            decoration-warning="request_state == 'to_approve'" 
            decoration-success="request_state == 'approved'" 
            decoration-danger="request_state == 'rejected'" 
            decoration-success2="request_state == 'done'"/>
        </field>
        <field name="purchase_state" position="attributes">
          <attribute name="invisible">1</attribute>
        </field>
        <field name="purchase_state" position="after">
            <field name="purchase_state" widget="badge" optional="show" 
            decoration-warning2="purchase_state == 'request_for_amendment'" 
            decoration-primary="purchase_state in ('draft', 'purchase')"
            decoration-primary2="purchase_state == 'sent'" 
            decoration-warning="purchase_state in ('to approve', 'waiting_for_approve')"
            decoration-success="purchase_state == 'rfq_approved'" 
            decoration-danger="purchase_state == 'rejected'" 
            decoration-success2="purchase_state == 'done'"
            decoration-warning3="purchase_state == 'on_hold'"
            decoration-muted="purchase_state == 'retreat'"
            decoration-secondary="purchase_state == 'cancel'"
            decoration-primary3="purchase_state == 'blanket_ordered'"/>
        </field>
        <xpath expr="//field[@name='purchased_qty']" position="after">
          <field name="tender_qty" />
        </xpath>
        <xpath expr="//field[@name='purchase_order']" position="after">
            <field name="agreement_state" groups="equip3_purchase_other_operation.is_purchase_tender" required="1" widget="badge" decoration-success="agreement_state in ('bid_selection', 'bid_submission')" decoration-muted="agreement_state == 'draft'" decoration-info="agreement_state in ( 'pending', 'confirm')" decoration-warning="agreement_state == 'waiting_approval'" decoration-danger="agreement_state in ('cancel', 'closed')"/>
            <field name="agreement_id" groups="equip3_purchase_other_operation.is_purchase_tender" required="1"/>
        </xpath>
        <xpath expr="//field[@name='request_id']" position="attributes">
              <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='requested_by']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='assigned_to']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='assigned_to']" position="after">
            <field name="analytic_account_group_ids" widget="many2many_tags" optional="hide"/>
        </xpath>
        <xpath expr="//field[@name='date_required']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='estimated_cost']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='purchased_qty']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='tender_qty']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='purchase_state']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='purchase_order']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='agreement_state']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='agreement_id']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='product_id']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='name']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='product_qty']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='qty_in_progress']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='qty_done']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='qty_cancelled']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='product_uom_id']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='product_uom_id']" position="after">
            <field name="incoming_stock" optional="hide"/>
            <field name="current_qty" optional="hide"/>
            <field name="remaning_qty" optional="hide"/>
            <field name="qty_received"/>
        </xpath>
        <xpath expr="//field[@name='analytic_account_id']" position="attributes">
            <attribute name="invisible">1</attribute>
        </xpath>
        <xpath expr="//field[@name='supplier_id']" position="attributes">
            <attribute name="optional">show</attribute>
        </xpath>
        <xpath expr="//field[@name='company_id']" position="attributes">
            <attribute name="optional">hide</attribute>
        </xpath>
      </field>
    </record>

    <record id="purchase_request_line_form" model="ir.ui.view">
      <field name="model">purchase.request.line</field>
      <field name="inherit_id" ref="purchase_request.purchase_request_line_form"/>
      <field name="arch" type="xml">
        <xpath expr="//group[@name='quantities']" position="inside">
          <group>
            <field name="tender_qty" string="Qty in Tender"/>
          </group>
        </xpath>
      </field>
    </record>

    <record id="sh_po_tender_management.sh_purchase_agreement_action" model="ir.actions.act_window">
      <field name="name">Purchase Tender</field>
      <field name="context">{'goods_order': 1, 'default_is_goods_orders' : True, 'default_set_single_delivery_date' : True, 'default_set_single_delivery_destination' : True, 'group_by': 'state2'}</field>
      <field name="domain">[('is_goods_orders', '=', True)]</field>
    </record>

    <record id="sh_po_tender_management.action_po_bidline_action" model="ir.actions.act_window">
      <field name="context">{'search_default_hide_cancelled_lines':1,'search_default_tender':1,'search_default_groupby_product':1, 'goods_order': 1, 'default_is_goods_orders' : True}</field>
      <field name="domain">[('state','not in',['cancel']),('order_id.state','in',['draft']), ('is_goods_orders', '=', True), ('agreement_id', '!=', False)]</field>
    </record>
    
    <record id="purchase_requisition.action_purchase_requisition" model="ir.actions.act_window">
      <field name="context">{'goods_order': 1, 'default_is_goods_orders' : True, 'default_set_single_delivery_date' : True, 'default_set_single_delivery_destination' : True}</field>
      <field name="domain">[('is_goods_orders', '=', True)]</field>
    </record>

    <record id="view_purchase_agreement_kanban" model="ir.ui.view">
        <field name="name">purchase.agreement.kanban</field>
        <field name="model">purchase.agreement</field>
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" sample="1">
                <field name="name"/>
                <field name="state"/>
                <field name="sh_purchase_user_id"/>
                <templates>
                    <t t-name="kanban-box">
                        <div t-attf-class="oe_kanban_card oe_kanban_global_click">
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings mt4">
                                    <strong class="o_kanban_record_title"><span><field name="name"/></span></strong>
                                </div>
                                <!-- <field name="state" widget="label_selection" options="{'classes': {'draft': 'default', 'in_progress': 'default', 'open': 'success', 'done': 'success', 'close': 'danger'}}" readonly="1"/> -->
                            </div>
                            <div class="o_kanban_record_body">
                              <div class="o_kanban_record_body_top">
                                <span class="text-muted"><field name="tender_name"/></span>
                              </div>
                              <div class="o_kanban_record_body_bottom">
                                <span class="text-muted"><field name="sh_agreement_type"/></span>
                              </div>
                            </div>
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <field name="partner_ids"/>
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="sh_purchase_user_id" widget="many2one_avatar_user"/>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

  <record model="ir.actions.act_window" id="product_purchase_blanket_order_services">
    <field name="name">Purchase Blanket Order</field>
    <field name="type">ir.actions.act_window</field>
    <field name="res_model">purchase.requisition</field>
    <field name="view_mode">tree,kanban,form</field>
    <field name="context">{'services_good': 1, 'default_is_services_orders' : True, 'default_set_single_delivery_date': True, 'default_set_single_delivery_destination': True}</field>
    <field name="domain">[('is_services_orders', '=', True)]</field>
    <field name="search_view_id" ref="purchase_requisition.view_purchase_requisition_filter"/>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Start a new purchase agreement
      </p><p>
        Example of purchase agreements include call for tenders and blanket orders.
      </p><p>
        In a call for tenders, you can record the products you need to buy
        and generate the creation of RfQs to vendors. Once the tenders have
        been registered, you can review and compare them and you can
        validate some and cancel others.
      </p><p>
        For a blanket order, you can record an agreement for a specifc period
        (e.g. a year) and you order products within this agreement, benefiting
        from the negotiated prices.
      </p>
    </field>
  </record>

  <menuitem id="menu_purchase_blanket_order" name="Purchase Blanket Order" action="product_purchase_blanket_order_services"
    parent="equip3_purchase_other_operation.main_menu_balnket_orders_services" sequence="9" />


  <record id="sh_purchase_agreement_tree_view_inherit" model="ir.ui.view">
    <field name="name">sh.purchase.agreement.tree.view.inherit</field>
    <field name="model">purchase.agreement</field>
    <field name="inherit_id" ref="sh_po_tender_management.sh_purchase_agreement_tree_view"/>
    <field name="arch" type="xml">
      <xpath expr="//field[@name='name']" position="attributes">
        <attribute name="optional">show</attribute>
        <attribute name="decoration-bf">1</attribute>
      </xpath>
      <xpath expr="//field[@name='sh_purchase_user_id']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='tender_name']" position="attributes">
        <attribute name="optional">show</attribute>
        <attribute name="style">max-width:400px !important</attribute>
      </xpath>
      <xpath expr="//field[@name='sh_agreement_type']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='tender_scope']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='partner_ids']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='sh_agreement_deadline']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='sh_order_date']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='sh_delivery_date']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='sh_source']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
      <xpath expr="//field[@name='pt_state']" position="attributes">
        <attribute name="optional">show</attribute>
      </xpath>
    </field>
  </record>

	<record id="sh_purchase_agreement_action_orders" model="ir.actions.act_window">
    <field name="name">Purchase Tender</field>
    <field name="type">ir.actions.act_window</field>
    <field name="res_model">purchase.agreement</field>
    <field name="view_mode">kanban,tree,form</field>
    <field name="context">{'default_set_single_delivery_date': True, 'default_set_single_delivery_destination': True}</field>
    <field name="search_view_id" ref="view_purchase_agreement_kanban"/>
    <field name="help" type="html">
        <p class="oe_view_nocontent_create">
            Click to Create New Purchase Tender.
        </p>
    </field>
</record>

<record id="action_po_bidline_action_orders" model="ir.actions.act_window">
<field name="name">Analyze Multiple Tender</field>
<field name="res_model">purchase.order.line</field>
<field name="type">ir.actions.act_window</field>
<field name="view_mode">tree,pivot,form</field>
<field name="domain">[('state','not in',['cancel']),('order_id.state','in',['draft'])]</field>
<field name="context"></field>
<field name="view_id" ref="sh_po_tender_management.sh_bidline_tree_view" />
<field name="search_view_id" ref="sh_po_tender_management.sh_po_bidline_search_view" />
</record>

<record model="ir.actions.act_window" id="product_purchase_blanket_order_services_orders">
<field name="name">Purchase Blanket Order</field>
<field name="type">ir.actions.act_window</field>
<field name="res_model">purchase.requisition</field>
<field name="view_mode">tree,kanban,form</field>
<field name="context">{'default_set_single_delivery_date': True, 'default_set_single_delivery_destination': True}</field>
<field name="domain">[]</field>
<field name="search_view_id" ref="purchase_requisition.view_purchase_requisition_filter"/>
<field name="help" type="html">
  <p class="o_view_nocontent_smiling_face">
  Start a new purchase agreement
  </p><p>
  Example of purchase agreements include call for tenders and blanket orders.
  </p><p>
  In a call for tenders, you can record the products you need to buy
  and generate the creation of RfQs to vendors. Once the tenders have
  been registered, you can review and compare them and you can
  validate some and cancel others.
  </p><p>
  For a blanket order, you can record an agreement for a specifc period
  (e.g. a year) and you order products within this agreement, benefiting
  from the negotiated prices.
  </p>
</field>
</record>

<record model="ir.ui.menu" id="equip3_purchase_operation.good_menu_purchase_request_line_assigned">
  <field name="name">Assigned Request Line</field>
</record>
<record model="ir.ui.menu" id="equip3_purchase_operation.good_menu_purchase_request_line_not_assigned">
  <field name="name">Unassigned Request Line</field>
</record>
<record id="equip3_purchase_operation.good_purchase_request_line_form_action_assigned" model="ir.actions.act_window">
  <field name="name">Assigned Request Line</field>
</record>
<record id="equip3_purchase_operation.good_purchase_request_line_form_action_not_assigned" model="ir.actions.act_window">
  <field name="name">Unassigned Request Line</field>
</record>

<record model="ir.ui.menu" id="equip3_purchase_operation.menu_purchase_request_lines_assigned">
  <field name="name">Assigned Request Line</field>
</record>
<record model="ir.ui.menu" id="equip3_purchase_operation.menu_purchase_request_lines_not_assigned">
  <field name="name">Unassigned Request Line</field>
</record>
<record id="equip3_purchase_operation.product_purchase_request_line_services_assigned" model="ir.actions.act_window">
  <field name="name">Assigned Request Line</field>
</record>
<record id="equip3_purchase_operation.product_purchase_request_line_services_not_assigned" model="ir.actions.act_window">
  <field name="name">Unassigned Request Line</field>
</record>

<record model="ir.ui.menu" id="equip3_purchase_operation.menu_purchase_request_line_orders_assigned">
  <field name="name">Assigned Request Line</field>
</record>
<record model="ir.ui.menu" id="equip3_purchase_operation.menu_purchase_request_line_orders_not_assigned">
  <field name="name">Unassigned Request Line</field>
</record>
<record id="equip3_purchase_operation.product_purchase_request_line_orders_assigned" model="ir.actions.act_window">
  <field name="name">Assigned Request Line</field>
</record>
<record id="equip3_purchase_operation.product_purchase_request_line_orders_not_assigned" model="ir.actions.act_window">
  <field name="name">Unassigned Request Line</field>
</record>

    <!-- Menu Orders -->
    <menuitem id="menu_purchase_tenders_orders_main"
        name="Purchase Tenders"
        parent="equip3_purchase_operation.menu_orders" />

    <menuitem action="sh_purchase_agreement_action_orders" id="menu_purchase_agreement_action_orders"
              parent="menu_purchase_tenders_orders_main" sequence="1"/>

    <menuitem id="rfq_tender_submission_all_orders_menu_act" name="RFQ Tender Submission"
              parent="menu_purchase_tenders_orders_main" action="rfq_tender_submission_all_orders_action" sequence="2"/>
    <menuitem id="rfq_open_tender_submission_all_orders_menu_act" name="RFQ Open Tender Submission"
              parent="menu_purchase_tenders_orders_main" action="rfq_open_tender_submission_all_orders_action" sequence="3"/>

    <menuitem action="action_po_bidline_action_orders" id="menu_po_bidline_action_orders"
              parent="menu_purchase_tenders_orders_main" sequence="4"/>

    <menuitem id="main_menu_purchase_blanket_orders" name="Purchase Blanket Orders"
              parent="equip3_purchase_operation.menu_orders" sequence="8"/>

    <menuitem action="product_purchase_blanket_order_services_orders" id="menu_purchase_requisition_to_so_orders"
              parent="main_menu_purchase_blanket_orders" sequence="8"/>

    <menuitem action="product_purchase_blanket_order_lines" id="menu_purchase_blanket_order_lines"
              parent="main_menu_purchase_blanket_orders" sequence="10"/>

</odoo>
