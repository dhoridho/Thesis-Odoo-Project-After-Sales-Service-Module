<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_daily_attendance_inherit" model="ir.ui.view">
        <field name="model">daily.attendance</field>
        <field name="inherit_id" ref="school_attendance.view_daily_attendance_form_1"/>
        <field name="arch" type="xml">
            <button name="open_student_attendance_sheet" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
            <xpath expr="//sheet/group" position="replace">
                <group>
                    <group>
                        <field name="date" required="1" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="name" required="1" string="Name" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="school_id" required="1" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="program_id" required="1" domain="[('school_id', '=', school_id)]" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="standard_id" required="1" string="Intake" domain="[('standard_id', '=', program_id)]" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="group_class" required="1" widget="many2many_tags" domain="[('id', 'in', related_group_class_ids), ('state', '=', 'validated')]" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="related_teacher_ids" widget="many2many_tags" invisible="1"/>
                    </group>
                    <group>
                        <field name="year_id" required="1" string="Academic Years" attrs="{'readonly':[('state','not in','draft')]}" options="{'no_create': True, 'no_create_edit':True}"/>
                        <field name="term_id" required="1" options="{'no_create': True, 'no_create_edit':True}" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="subject_id" required="1" options="{'no_create': True, 'no_create_edit':True}" domain="[('id', 'in', related_subject_ids)]" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="teacher_id" required="1"  placeholder="Select" string="Teacher" options="{&quot;no_create&quot;: True}" attrs="{'invisible': [('is_teacher', '=', True)],'readonly':[('state','not in','draft')]}"/>
                        <field name="replacement_teacher_id" placeholder="Select" string="Replacement Teacher" options="{&quot;no_create&quot;: True}" attrs="{'invisible': [('is_teacher', '=', True)],'readonly':[('state','not in','draft')]}"/>
                        <field name="start_time" widget="float_time" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="end_time" widget="float_time" attrs="{'readonly':[('state','not in','draft')]}"/>
                        <field name="related_subject_ids" widget="many2many_tags" invisible="1"/>
                        <field name="related_group_class_ids" widget="many2many_tags" invisible="1"/>
                        <field name="is_teacher" invisible="1"/>
                        <field name="related_subject_ids" widget="many2many_tags" invisible="1"/>
                        <field name="branch_id" invisible="1"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//form/sheet/notebook/page" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <sheet>
                <notebook>
                    <page string="Student Attendance" readonly="1">
                        <field name="daily_attendance_line" force_save="1">
                            <tree create="false" editable="bottom">
                                <field name="student_id"/>
                                <field name="is_present" attrs="{'readonly': [('is_absent', '=', True)]}"/>
                                <field name="is_late"/>
                                <field name="is_absent" attrs="{'readonly': [('is_present', '=', True)]}"/>
                                <field name="remark"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
            </sheet>
            <xpath expr="//button[@name='attendance_validate']" position="attributes">
                <attribute name="class">oe_highlight</attribute>
            </xpath>
        </field>
    </record>

    <record id="view_school_attendance_sheet_line_matrix" model="ir.ui.view">
        <field name="name">attendance.sheet.line.matrix.tree</field>
        <field name="model">attendance.sheet.line.matrix</field>
        <field name="arch" type="xml">
            <tree string="Attendance Line">
                <field name="student_id" />
            </tree>
        </field>
    </record>

    <record model="ir.ui.menu" id="school_attendance.menu_daily_attendances">
        <field name="name">Daily Attendance</field>
    </record>

    <record id="view_daily_attendance_tree_inherit" model="ir.ui.view">
        <field name="name">daily.attendance.tree.inherit</field>
        <field name="model">daily.attendance</field>
        <field name="inherit_id" ref="school_attendance.view_daily_attendance_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='user_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='standard_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='date']" position="after">
                <field name="name"/>
                <field name="school_id" invisible="1"/>
                <field name="program_id"/>
                <field name="standard_id"/>
                <field name="year_id"/>
                <field name="term_id"/>
                <field name="subject_id"/>
                <field name="teacher_id"/>
            </xpath>
            <xpath expr="//field[@name='state']" position="attributes">
                <attribute name="string">Status</attribute>
                <attribute name="widget">badge</attribute>
                <attribute name="decoration-info">state in ('draft')</attribute>
                <attribute name="decoration-success">state in ('validate')</attribute>
                <attribute name="decoration-danger">state in ('cancelled')</attribute>
            </xpath>
        </field>
    </record>
    
    <!--Pivot View of Daily Attendance-->
    <record id="view_daily_attendance_pivot" model="ir.ui.view">
        <field name="name">daily.attendance.pivot</field>
        <field name="model">daily.attendance</field>
        <field name="arch" type="xml">
            <pivot string="Daily Attendance Information">
                <field name="date" type="col"/>
                <field name="standard_id" type="row"/>
            </pivot>
        </field>
    </record>

    <record id="school_attendance.action_daily_attendance_form" model="ir.actions.act_window">
        <field name="view_mode">tree,form,pivot</field>
    </record>

    <record id="daily_attendance_line_view_form" model="ir.ui.view">
        <field name="name">daily.attendance.line.view.form</field>
        <field name="model">daily.attendance.line</field>
        <field name="arch" type="xml">
            <form string="Attendance Line">
                <sheet>
                    <group>
                        <group>
                            <field name="student_id"/>
                            <field name="student_pid"/>
                            <field name="school_id"/>
                            <field name="program_id"/>
                            <field name="group_class_id" widget="many2many_tags"/>
                            <field name="intake_id"/>
                            <field name="year_id"/>
                            <field name="term_id"/>
                        </group>
                        <group>
                            <field name="subject_id"/>
                            <field name="teacher_id"/>
                            <field name="is_present" attrs="{'readonly': [('is_absent', '=', True)]}"/>
                            <field name="is_absent" attrs="{'readonly': [('is_present', '=', True)]}"/>
                            <field name="remark"/>
                            <field name="date"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="attendance_line_tree" model="ir.ui.view">
        <field name="name">daily.attendance.line.tree</field>
        <field name="model">daily.attendance.line</field>
        <field name="arch" type="xml">
            <tree string="Attendance Line" create="false">
                <field name="date"/>
                <field name="student_id"/>
                <field name="program_id"/>
                <field name="intake_id"/>
                <field name="group_class_id" widget="many2many_tags"/>
                <field name="subject_id"/>
                <field name="is_present"/>
                <field name="is_absent"/>
                <field name="teacher_id"/>
            </tree>
        </field>
    </record>

    <record id="attendance_line_search" model="ir.ui.view">
        <field name="name">daily.attendance.line.search</field>
        <field name="model">daily.attendance.line</field>
        <field name="arch" type="xml">
            <search string="Attendance Line">
                <filter name="groupby_student" string="Student" context="{'group_by': 'student_id'}"/>
                <filter name="groupby_year" string="Year" context="{'group_by': 'year_id'}"/>
                <filter name="groupby_term" string="Term" context="{'group_by': 'term_id'}"/>
                <filter name="groupby_subject" string="Subject" context="{'group_by': 'subject_id'}"/>
            </search>
        </field>
    </record>
    
    <record id="action_attendance_line" model="ir.actions.act_window">
        <field name="name">Attendance Line</field>
        <field name="res_model">daily.attendance.line</field>
        <field name="view_mode">tree</field>
        <field name="context">{'search_default_groupby_student': 1, 'search_default_groupby_year': 1, 'search_default_groupby_term':1, 'search_default_groupby_subject': 1}</field>
    </record>

    <menuitem id="menu_attendance_line" name="Attendance Line" parent="school_attendance.menu_attendance"
              action="action_attendance_line" groups="school.group_school_administration,school.group_school_teacher" sequence="51"/>

</odoo>
