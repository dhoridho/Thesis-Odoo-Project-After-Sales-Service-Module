<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_move_line_subcon_tree" model="ir.ui.view">
        <field name="name">stock.move.line.subcon.tree</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <tree string="Move Lines" create="0" default_order="date">
                <field name="date" invisible="1"/>
                <field name="reference" string="Reference"
                       invisible="1"/>
                <field name="product_id"/>
                <field name="picking_id" invisible="1"/>
                <field name="location_id" invisible="1"/>
                <field name="location_dest_id" string="Location"/>
                <field name="production_id" invisible="1"/>
                <field name="subcon_partner_id" string="Vendor"/>
                <field name="lot_id" groups="stock.group_production_lot"/>
                <field name="package_id" string="Package"/>
                <field name="owner_id" string="Owner"/>
                <field name="subcon_qty_available" string="On Hand Quantity" sum="Total On Hand Quantity"/>
                <field name="subcon_qty_available" string="Available Qualtity" sum="Total Available Quantity"/>
                <field name="qty_done" string="Quantity Done" invisible="1"/>
                <field name="product_uom_id" options="{'no_open': True, 'no_create': True}" string="Unit of Measure" groups="uom.group_uom"/>
                <field name="subcon_svl_value" string="Value" sum="Total Value"/>
                <field name="company_id" groups="base.group_multi_company" force_save="1"/>
                <field name="state" widget='badge' decoration-success="state == 'done'" decoration-info="state not in ('done', 'cancel')" optional="hide"/>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="view_move_line_subcon_pivot">
        <field name="name">stock.move.line.subcon.pivot</field>
        <field name="model">stock.move.line</field>
        <field eval="1000" name="priority"/>
        <field name="arch" type="xml">
            <pivot string="Inventory" sample="1">
                <field name="product_id" type="row"/>
                <field name="location_id" type="col"/>
                <field name="qty_done" type="measure"/>
            </pivot>
        </field>
    </record>

    <record id="view_move_line_subcon_graph" model="ir.ui.view">
        <field name="name">stock.move.line.subcon.pivot</field>
        <field name="model">stock.move.line</field>
        <field eval="1000" name="priority"/>
        <field name="arch" type="xml">
            <graph string="Stock Quant" sample="1">
                <field name="location_id"/>
                <field name="subcon_partner_id"/>
                <field name="qty_done" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="stock_move_line_subcon_view_search" model="ir.ui.view">
        <field name="name">stock.move.line.subcon.search</field>
        <field name="model">stock.move.line</field>
        <field name="arch" type="xml">
            <search string="Stock Moves">
                <field name="product_id"/>
                <field name="lot_id" groups="stock.group_production_lot"/>
                <field name="location_dest_id" string="Location" groups="stock.group_stock_multi_locations"/>
                <field name="subcon_partner_id"/>

                <group expand='0' string='Filters'>
                    <filter name='internal_loc' string="Internal Locations" domain="[('location_dest_id.usage','=', 'internal')]"/>
                    <filter name='transit_loc' string="Transit Locations" domain="[('location_dest_id.usage' ,'=', 'transit')]"/>
                    <!-- <filter name="on_hand" string="On Hand" domain="[('on_hand', '=', True)]"/> -->
                    <separator/>
                    <filter name="negative" string="Negative Stock" domain="[('subcon_qty_available', '&lt;', 0.0)]"/>
                    <filter name="positive" string="Positive Stock" domain="[('subcon_qty_available', '&gt;', 0.0)]"/>
                    <!-- <filter name="reserved" string="Reservations" domain="[('reserved_quantity', '&gt;', 0.0)]"/>
                    <separator/>
                    <filter name="filter_in_date" date="in_date"/> -->
                    <separator/>
                    <filter name="has_partner_id" string="Vendor" domain="[('subcon_partner_id', '!=', False)]"/>
                </group>

                <group expand="0" string="Group By">
                    <filter string="Product" name="groupby_product_id" domain="[]" context="{'group_by': 'product_id'}"/>
                    <filter string="Location" name="groupby_location_dest_id" domain="[]" context="{'group_by': 'location_dest_id'}"/>
                    <filter string="Lot/Serial Number" name="groupby_lot_id" domain="[]" context="{'group_by': 'lot_id'}"/>
                    <filter string="Vendor" name="groupby_subcon_partner_id" domain="[]" context="{'group_by': 'subcon_partner_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_stock_move_line_subcon_report" model="ir.actions.act_window">
        <field name="name">Stock On Hand</field>
        <field name="res_model">stock.move.line</field>
        <field name="view_mode">tree,pivot,graph</field>
        <field name="view_ids"
               eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('view_move_line_subcon_tree')}),
                          (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_move_line_subcon_pivot')}),
                          (0, 0, {'view_mode': 'graph', 'view_id': ref('view_move_line_subcon_graph')})]"/>
        <field name="search_view_id" ref="stock_move_line_subcon_view_search"/>
        <field name="context">{
            "search_default_groupby_location_dest_id" : 1,
            "search_default_groupby_product_id" : 1
            }
        </field>
        <field name="domain">[('subcon_partner_id', '!=', False), ('product_id.type', '=', 'product')]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Subcontracting Report.
            </p>
        </field>
    </record>

    <menuitem id="menu_subcon_report"
              name="Subcontracting Report"
              parent="mrp.menu_mrp_reporting"
              action="action_stock_move_line_subcon_report"
              sequence="99"/>

</odoo>