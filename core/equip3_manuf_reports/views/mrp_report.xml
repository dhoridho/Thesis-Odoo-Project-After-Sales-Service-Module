<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- recompute svl_cost before displaying menu view -->
        <record id="mrp_production_cost_analysis_compute" model="ir.actions.server">
            <field name="name">Production Order</field>
            <field name="model_id" ref="mrp.model_mrp_production"/>
            <field name="state">code</field>
            <field name="code">action = model.recompute_and_go()</field>
        </record>

        <record id="view_production_pivot" model="ir.ui.view">
            <field name="inherit_id" ref="equip3_manuf_operations.view_production_pivot"/>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <field name="date_planned_start" position='after'>
                    <field name="warehouse_id" type="row" string="Warehouse"/>
                    <field name="name" type="row"/>
                    <field name="product_id" type="measure" string="Product"/>
                    <field name="qty_produced" type="measure" string="Quantity"/>
                    <field name="total_material" type="measure" string="Material"/>
                    <field name="total_overhead" type="measure" string="Overhead"/>
                    <field name="total_labor" type="measure" string="Labor" />
                    <field name="total_subcontracting" type="measure" string="Subcontracting" />
                    <field name="total_byproduct" type="measure" string="By Product" />
                    <field name="svl_cost" type="measure" string="Total Cost"/>
                    <field name="svl_unit_cost" type="measure" string="Unit Cost" />
                    <field name="bom_forecast_cost" type="measure" string="Forecast Cost"/>
                </field>
            </field>
        </record>

        <record id="reuse_mrp_production_tree_view" model="ir.ui.view">
            <field name="name">reuse.mrp.production.tree</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <tree string="Production Orders" create="false"
                      default_order="priority desc, date_planned_start desc" multi_edit="1" sample="1">
                    <header>
                        <button name="print_pdf_preview1" type="object" string="Print Preview"/>
                        <button name="print_xlsx" type="object" string="Export (XLSX)"/>
                    </header>
                    <field name="priority" optional="show" widget="priority" nolabel="1"/>
                    <field name="message_needaction" invisible="1"/>
                    <field name="name" string="Production Order" sum="ids"/>
                    <field name="date_planned_start" string="Production Date"/>
                    <field name="date_deadline" widget="remaining_days" invisible="1"/>
                    <field name="product_id" readonly="1" optional="show"/>
                    <field name="lot_producing_id" invisible="1" optional="hide"/>
                    <field name="origin" invisible="1"/>
                    <field name="user_id" invisible="1"/>
                    <field name="reservation_state" invisible="1"/>
                    <field name="product_qty" string="Quantity" invisible="1"/>
                    <field name="qty_produced" string="Quantity"/>
                    <field name="product_uom_id" string="Unit of Measure" options="{'no_open':True,'no_create':True}"
                           optional="show"/>
                    <field name="company_id" invisible="1" groups="base.group_multi_company" optional="show"/>
                    <field name="state" invisible="1"/>
                    <field name="activity_exception_decoration" invisible="1" widget="activity_exception"/>
                    <field name="delay_alert_date" invisible="1"/>
                    <field name="total_material" sum="Total Material" string="Material"/>
                    <field name="total_overhead" sum="Total Overhead" string="Overhead"/>
                    <field name="total_labor" sum="Total Labor" string="Labor"/>
                    <field name="total_subcontracting" sum="Total Subcontracting" string="Subcontracting"/>
                    <field name="total_byproduct" sum="Total By-Product" string="By-Product"/>
                    <field name="svl_cost" sum="Total Cost" string="Total Cost"/>
                    <field name="svl_unit_cost" sum="Total Unit Cost" string="Unit Cost"/>
                    <field name="bom_forecast_cost" sum="Total Forecast Cost" string="Forecast Cost"/>
                    <field string=" " name="json_popover" widget="stock_rescheduling_popover"
                           attrs="{'invisible': [('delay_alert_date', '=', False)]}"/>
                </tree>
            </field>
        </record>

        <record id="view_mrp_cost_analysis_filter" model="ir.ui.view">
            <field name="name">mrp.cost.analysis.select</field>
            <field name="model">mrp.production</field>
            <field name="arch" type="xml">
                <search string="Search Production Cost Analysis">
                    <field name="name"/>
                    <field name="warehouse_id"/>
                    <field name="product_id"/>
                    <field name="name"/>
                    <filter name="filter_date_planned_start" string="Production Date" date="date_planned_start"/>
                    <filter string="Last 30 days" name="last_30_days"
                            domain="[('date_planned_start','&lt;=',context_today().strftime('%Y-%m-%d')), ('date_planned_start','&gt;',(context_today()-relativedelta(days=30)).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Month" name="current_month"
                            domain="[('date_planned_start','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), ('date_planned_start','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                    <filter string="This Year" name="current_year"
                            domain="[('date_planned_start','&lt;',(context_today()+relativedelta(years=1)).strftime('%%Y-01-01')), ('date_planned_start','&gt;=',time.strftime('%%Y-01-01'))]"/>
                    <filter string="Last Month" name="last_month"
                            domain="[('date_planned_start','&lt;',time.strftime('%%Y-%%m-01')), ('date_planned_start','&gt;=',(context_today()-relativedelta(months=1)).strftime('%%Y-%%m-01'))]"/>
                    <filter string="Last Year" name="last_year"
                            domain="[('date_planned_start','&lt;',time.strftime('%%Y-01-01')), ('date_planned_start','&gt;=',(context_today()-relativedelta(years=1)).strftime('%%Y-01-01'))]"/>
                    <group expand="0" string="Group By...">
                        <filter string="Production Date" name="date_planned_start" domain="[]"
                                context="{'group_by': 'date_planned_start'}" help=""/>
                        <filter string="Warehouse" name="warehouse" domain="[]" context="{'group_by': 'warehouse_id'}"/>
                        <filter string="Product" name="product" domain="[]" context="{'group_by': 'product_id'}"/>
                        <filter string="Name" name="production_name" domain="[]" context="{'group_by': 'name'}"/>
                        <filter string="Production Order" name="manuf_order" domain="[]"
                                context="{'group_by': 'name'}"/>
                        <filter string="Production Plan" name="mrp_plan_id" domain="[]"
                                context="{'group_by': 'mrp_plan_id'}"/>
                        <filter string="Production Work Order" name="workorder_ids" domain="[]"
                                context="{'group_by': 'mrp_plan_id'}"/>
                        <filter string="Status" name="state" domain="[]"
                                context="{'group_by': 'state'}"/>
                        <filter string="Sales Order" name="sale_order_id" domain="[]" context="{'group_by': 'sale_order_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_mrp_production_cost_analysis_computes" model="ir.actions.act_window">
            <field name="name">Production Cost Analysis Report</field>
            <field name="res_model">mrp.production</field>
            <field name="view_mode">pivot,tree,form</field>
            <field name="context">{'search_default_date_planned_start': True, 'search_default_warehouse': True, 'search_default_product': True, 'search_default_production_name': True, 'search_default_current_month': True, 'tree_view_ref': 'equip3_manuf_reports.reuse_mrp_production_tree_view'}</field>
            <field name="domain">['|',('state','=','done'),('state','=','progress')]</field>
            <field name="views">[['reuse_mrp_production_tree_view', 'tree']]]</field>
            <field name="search_view_id" ref="view_mrp_cost_analysis_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No data yet!
                </p>
                <p>
                    Create Production Cost Analysis Report
                </p>
            </field>
        </record>

        <record id="reuse_mrp_production_action22" model="ir.actions.act_window">
            <field name="name">Production Cost Analysis Report</field>
            <field name="res_model">mrp.production</field>
            <field name="view_mode">tree,pivot,form</field>
            <field name="context">{'search_default_product': True,'search_default_current_month': True}</field>
            <field name="domain">['|',('state','=','done'),('state','=','progress')]</field>
            <field name="views">[['reuse_mrp_production_tree_view', 'tree']]]</field>
            <field name="search_view_id" ref="view_mrp_cost_analysis_filter"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No data yet!
                </p>
                <p>
                    Create Production Cost Analysis Report
                </p>
            </field>
        </record>

        <record id="reuse_mrp_production_tree2" model="ir.actions.act_window.view">
            <field eval="1" name="sequence"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="reuse_mrp_production_tree_view"/>
            <field name="act_window_id" ref="reuse_mrp_production_action22"/>
        </record>

        <record id="search_view_mrp_production_work_order" model="ir.ui.view">
            <field name="name">mrp.production.work.order.search</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.view_mrp_production_work_order_search"/>
            <field name="arch" type="xml">
                <xpath expr="//search" position="inside">
                    <group expand="0" string="Group By...">
                        <filter string="Product" name="product_id" domain="[]" context="{'group_by': 'product_id'}"/>
                        <filter string="Production Plan" name="mrp_plan_id" domain="[]"
                                context="{'group_by': 'mrp_plan_id'}"/>
                        <filter string="Production Order" name="production_id" domain="[]"
                                context="{'group_by': 'production_id'}"/>
                        <filter string="Production Work Order" name="name" domain="[]"
                                context="{'group_by': 'workorder_id'}"/>
                        <filter string="Work Center" name="workcenter_id" domain="[]"
                                context="{'group_by': 'workcenter_id'}"/>
                        <filter string="Warehouse" name="groupby_warehouse_id" domain="[]" context="{'group_by': 'warehouse_id'}"/>
                    </group>
                </xpath>
                <xpath expr="//filter[@name='date_start_filter']" position="replace">
                    <filter string="Last 30 days" name="last_30_days"
                            domain="[('date_finished','&lt;=',context_today().strftime('%Y-%m-%d')), ('date_finished','&gt;',(context_today()-relativedelta(days=30)).strftime('%Y-%m-%d'))]"/>
                    <filter string="This Month" name="current_month"
                            domain="[('date_finished','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')), ('date_finished','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                    <filter string="This Year" name="current_year"
                            domain="[('date_finished','&lt;',(context_today()+relativedelta(years=1)).strftime('%%Y-01-01')), ('date_finished','&gt;=',time.strftime('%%Y-01-01'))]"/>
                    <filter string="Last Month" name="last_month"
                            domain="[('date_finished','&lt;',time.strftime('%%Y-%%m-01')), ('date_finished','&gt;=',(context_today()-relativedelta(months=1)).strftime('%%Y-%%m-01'))]"/>
                    <filter string="Last Year" name="last_year"
                            domain="[('date_finished','&lt;',time.strftime('%%Y-01-01')), ('date_finished','&gt;=',(context_today()-relativedelta(years=1)).strftime('%%Y-01-01'))]"/>
                </xpath>
            </field>
        </record>

        <!-- <record id="mrp_finished_good_report" model="ir.actions.act_window">
            <field name="name">Finished Goods Report</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.production</field>
            <field name="view_mode">pivot,graph,form,ks_gantt</field>
            <field name="domain">[('state', '=', 'done')]</field>
            <field name="context">{'search_default_current_month': 1}</field>
            <field name="target">current</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No data yet!
                </p>
                <p>
                    Create a new manufacturing order
                </p>
            </field>
        </record> -->

        <record model="ir.actions.act_window" id="action_mrp_work_center_report_eqi">
            <field name="name">Work Center Report</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mrp.workorder</field>
            <field name="domain">[]</field>
            <field name="context">{'search_default_current_month': 1}</field>
            <field name="view_mode">pivot,graph,tree,form,ks_gantt</field>
            <field name="search_view_id" ref="mrp.view_mrp_production_work_order_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new work orders performance
                </p>
            </field>
        </record>

        <record model="ir.ui.view" id="view_mrp_production_workorder_form_inherit_name">
            <field name="name">mrp.production.work.order.select.inherit.name</field>
            <field name="model">mrp.workorder</field>
            <field name="inherit_id" ref="mrp.view_mrp_production_workorder_form_view_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="attributes">
                    <attribute name="filter_domain">[('workorder_id', 'ilike', self)]</attribute>
                </xpath>
            </field>
        </record>

    </data>
</odoo>