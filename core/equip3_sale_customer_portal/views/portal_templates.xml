<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="inherit_portal_my_invoices" inherit_id="account.portal_my_invoices">
        <xpath expr="//t[contains(@t-call, 'portal.portal_table')]" position="replace">
            <t t-if="grouped_invoices" t-call="portal.portal_table">
                <t t-foreach="grouped_invoices" t-as="g_invoices">
                    <thead>
                        <tr class="thead-light" t-if="groupby and groupby!='none'">
                            <th colspan="8">
                                <t t-if="groupby == 'payment_state'">
                                    <em class="font-weight-normal text-muted"></em>
                                    <span t-field="g_invoices[0].payment_state"/>
                                </t>
                                <t t-if="groupby == 'period_by_day'">
                                    <em class="font-weight-normal text-muted"></em>
                                    <span t-field="g_invoices[0].invoice_date" t-options='{"widget": "date","format": "d MMMM Y"}'/>
                                </t>
                                <t t-if="groupby == 'period_by_month'">
                                    <em class="font-weight-normal text-muted"></em>
                                    <span t-field="g_invoices[0].invoice_date" t-options='{"widget": "date","format": "MMMM Y"}'/>
                                </t>
                                <t t-if="groupby == 'period_by_year'">
                                    <em class="font-weight-normal text-muted"></em>
                                    <span t-field="g_invoices[0].invoice_date" t-options='{"widget": "date","format": "Y"}'/>
                                </t>
                            </th>
                        </tr>
                        <tr class="active">
                            <th>Invoice #</th>
                            <th>Invoice Date</th>
                            <th class="d-none d-md-table-cell">Due Date</th>
                            <th/>
                            <th class="text-right">Amount Due</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="g_invoices" t-as="invoice">
                            <tr>
                                <td>
                                    <a t-att-href="invoice.get_portal_url()" t-att-title="invoice.name">
                                        <t t-esc="invoice.name" t-if="invoice.name != '/'"/>
                                        <em t-else="">Draft Invoice</em>
                                    </a>
                                </td>
                                <td><span t-field="invoice.invoice_date"/></td>
                                <td class="d-none d-md-table-cell"><span t-field="invoice.invoice_date_due"/></td>
                                <td class="tx_status">
                                    <t t-if="invoice.state == 'posted' and invoice.payment_state not in ('in_payment', 'paid', 'reversed')">
                                        <span class="badge badge-pill badge-info"><i class="fa fa-fw fa-clock-o" aria-label="Opened" title="Opened" role="img"/><span class="d-none d-md-inline"> Waiting for Payment</span></span>
                                    </t>
                                    <t t-if="invoice.state == 'posted' and invoice.payment_state in ('paid', 'in_payment')">
                                        <span class="badge badge-pill badge-success"><i class="fa fa-fw fa-check" aria-label="Paid" title="Paid" role="img"/><span class="d-none d-md-inline"> Paid</span></span>
                                    </t>
                                    <t t-if="invoice.state == 'posted' and invoice.payment_state == 'reversed'">
                                        <span class="badge badge-pill badge-success"><i class="fa fa-fw fa-check" aria-label="Reversed" title="Reversed" role="img"/><span class="d-none d-md-inline"> Reversed</span></span>
                                    </t>
                                    <t t-if="invoice.state == 'cancel'">
                                        <span class="badge badge-pill badge-warning"><i class="fa fa-fw fa-remove" aria-label="Cancelled" title="Cancelled" role="img"/><span class="d-none d-md-inline"> Cancelled</span></span>
                                    </t>
                                </td>
                                <td class="text-right"><span t-esc="-invoice.amount_residual if invoice.move_type == 'out_refund' else invoice.amount_residual" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: invoice.currency_id}"/></td>
                            </tr>
                        </t>
                    </tbody>
                </t>
            </t>
        </xpath>

    </template>


    <template id="portal_my_home_menu_do" name="Portal layout : Delivery Orders" inherit_id="portal.portal_breadcrumbs">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'delivery_order' or picking" t-attf-class="breadcrumb-item #{'active ' if not picking else ''}">
                <a t-if="picking" t-attf-href="/my/delivery_orders?{{ keep_query() }}">Delivery Order</a>
                <t t-else="">Delivery Order</t>
            </li>
            <li t-if="picking" class="breadcrumb-item active">
                <span>Delivery Order</span>
                <t t-esc="picking.name"/>
            </li>
        </xpath>
    </template>

    <template id="portal_my_orders" inherit_id="sale.portal_my_orders">
        <xpath expr="//thead/tr/th[3]" position="replace">
            <th class="text-center d-none">Status</th>
        </xpath>
        <xpath expr="//thead/tr/th[3]" position="after">
            <th class="text-center">Delivery Status</th>
            <th class="text-center">Invoice Status</th>
        </xpath>
        <xpath expr="//tr/td[3]" position="replace">
            <td class="text-center d-none">
            </td>
            <xpath expr="//tr/td[3]" position="after">
                <td class="text-center">
                    <span t-if="order.delivered_state == 'pending'" style="background-color: #D95551 !important;color: #FFFFFF !important;" class="badge"> Pending Delivery</span>
                    <span t-if="order.delivered_state == 'partially'" style="background-color: #FFC107 !important;color: #464646 !important;" class="badge"> Partially Delivered</span>
                    <span t-if="order.delivered_state == 'fully'" style="background-color: #44BF49 !important;color: #FFFFFF !important;" class="badge"> Fully Delivered</span>
                </td>
                <td class="text-center">
                    <span t-if="order.invoice_status == 'upselling'" style="background-color: #D95551 !important;color: #FFFFFF !important;" class="badge"> Upselling Opportunity</span>
                    <span t-if="order.invoice_status == 'invoiced'" style="background-color: #44BF49 !important;color: #FFFFFF !important;" class="badge"> Fully Invoiced</span>
                    <span t-if="order.invoice_status == 'to invoice'" style="background-color: #0BC3CF !important;color: #132A40 !important;" class="badge"> To Invoice</span>
                    <span t-if="order.invoice_status == 'no'" class="badge badge-info"> Nothing to Invoice</span>
                </td>
            </xpath>
        </xpath>
    </template>

    <template id="portal_my_quotations" inherit_id="sale.portal_my_quotations">
        <xpath expr="//thead/tr/th[4]" position="replace">
            <th class="text-center">Status</th>
        </xpath>
        <xpath expr="//tr/td[4]" position="replace">
            <td class="text-center">
                <span t-if="quotation.state == 'draft_quote'" style="background-color: #A4A4A4 !important;color: #FFFFFF !important;" class="badge"> Revised Quotation</span>
                <span t-if="quotation.state == 'draft'" style="background-color: #0BC3CF !important;color: #132A40 !important;" class="badge"> Quotation</span>
                <span t-if="quotation.state == 'waiting_for_over_limit_approval'" style="background-color: #FFC107 !important;color: #464646 !important;" class="badge"> Waiting For Over Limit Approval</span>
                <span t-if="quotation.state == 'over_limit_approved'" style="background-color: #44BF49 !important;color: #FFFFFF !important;" class="badge"> Over Limit Approved</span>
                <span t-if="quotation.state == 'waiting_for_approval'" style="background-color: #FFC107 !important;color: #464646 !important;" class="badge"> Waiting For Sale Order Approval</span>
                <span t-if="quotation.state == 'quotation_approved'" style="background-color: #50CD89 !important;color: #10482A !important;" class="badge"> Quotation Approved</span>
                <span t-if="quotation.state == 'reject'" style="background-color: #D95551 !important;color: #FFFFFF !important;" class="badge"> Quotation Rejected</span>
                <span t-if="quotation.state == 'revised'" style="background-color: #A4A4A4 !important;color: #FFFFFF !important;" class="badge"> Order Revised</span>
                <span t-if="quotation.state == 'over_limit_reject'" style="background-color: #D95551 !important;color: #FFFFFF !important;" class="badge"> Over Limit Rejected</span>
                <span t-if="quotation.state == 'sent'" style="background-color: #44BF49 !important;color: #FFFFFF !important;" class="badge"> Quotation Sent</span>
                <span t-if="quotation.state == 'sale'" style="background-color: #006641 !important;color: #FFFFFF !important;" class="badge"> Sale Order</span>
                <span t-if="quotation.state == 'progress'" class="badge badge-info"> In Progress</span>
                <span t-if="quotation.state == 'ready'" class="badge badge-info"> Ready</span>
                <span t-if="quotation.state == 'picked'" class="badge badge-info"> Picked</span>
                <span t-if="quotation.state == 'delivered'" class="badge badge-info"> Delivered</span>
                <span t-if="quotation.state == 'done'" class="badge badge-info"> Done</span>
                <span t-if="quotation.state == 'cancel'" class="badge badge-info"> Cancelled</span>
                <span t-if="quotation.state == 'on_hold'" class="badge badge-info"> On Hold</span>
            </td>
        </xpath>
    </template>

     <!-- <template id="portal_my_home_delivery_order" name="Delivery Orders" customize_show="True" inherit_id="sale.portal_my_home_sale">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <t if="is_customer">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="title">Delivery Order - <t t-esc="str(is_customer)"/></t>
                    <t t-set="url" t-value="'/my/delivery_orders'"/>
                    <t t-set="placeholder_count" t-value="'picking_count'"/>
                </t>
            </t>
        </xpath>
    </template> -->

    <template id="portal_my_delivery_order" name="Delivery Order">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True"/>

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Delivery Order</t>
            </t>
            
            <t t-if="orders" t-call="portal.portal_table">
                <thead>
                    <tr class="active">
                        <th>Delivery Order #</th>
                        <th>Schedule Date</th>
                        <th>Source Location</th>
                    </tr>
                </thead>
                <t t-foreach="orders" t-as="d_o">
                    <tr>
                        <td><a t-att-href="d_o.get_portal_url()"><t t-esc="d_o.name"/></a></td>
                        <td><span t-field="d_o.scheduled_date"/></td>
                        <td><span t-field="d_o.location_id"/></td>
                    </tr>
                </t>
            </t>
        </t>
    </template>

    <template id="delivery_order_portal_template" name="Delivery Order Portal Template" inherit_id="portal.portal_sidebar" primary="True">
        <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
            <t t-set="o_portal_fullwidth_alert">
                <t t-call="portal.portal_back_in_edit_mode">
                    <t t-set="backend_url" t-value="'/web#model=%s&amp;id=%s&amp;view_type=form' % (picking.name, picking.id)"/>
                </t>
            </t>

            <div class="row mt16 o_portal_sale_sidebar">
                <!-- Sidebar -->
                <t t-call="portal.portal_record_sidebar">
                    <t t-set="classes" t-value="'col-lg-auto d-print-none'"/>

                    <t t-set="entries">
                        <ul class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                            <li class="list-group-item flex-grow-1">
                                <div class="mb-1"><strong class="text-left">Salesperson</strong></div>
                                <div class="row flex-nowrap">
                                    <div class="col flex-grow-0 pr-2">
                                        <img class="rounded-circle mr4 float-left o_portal_contact_img" t-if="picking.group_id.sale_id.user_id.image_1024" t-att-src="image_data_uri(picking.group_id.sale_id.user_id.image_1024)" alt="Contact"/>
                                        <img class="rounded-circle mr4 float-left o_portal_contact_img" t-if="not picking.group_id.sale_id.user_id.image_1024" src="/web/static/src/img/placeholder.png" alt="Contact"/>
                                    </div>
                                    <div class="col pl-0" style="min-width: 150px">
                                        <span t-field="picking.group_id.sale_id.user_id" t-options='{"widget": "contact", "fields": ["name", "phone"], "no_marker": True}'/>
                                        <a href="#discussion" class="small"><i class="fa fa-comment"></i> Send message</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </t>
                </t>

                <!-- Page content -->
                <div id="delivery_order_content" class="col-12 col-lg justify-content-end">

                    <!-- modal relative to the actions sign and pay -->
                    <!-- main content -->
                    <div t-attf-class="card #{'pb-5' if report_type == 'html' else ''}" id="portal_delivery_content">
                        <div t-call="equip3_sale_customer_portal.picking_portal_content"/>
                    </div>

                    <!-- chatter -->
                    <div id="picking_communication" t-if="not is_portal_user" class="mt-4">
                        <h2>History</h2>
                        <t t-call="portal.message_thread">
                            <t t-set="object" t-value="picking"/>
                        </t>
                    </div>
                </div>


                    
                </div><!-- // #quote_content -->
        </xpath>
    </template>

    <template id="picking_portal_content" name="Delivery Order Portal Content">
        <!-- Intro -->
        <div id="introduction" t-attf-class="d-flex pb-2 pt-3 #{'card-header bg-white' if report_type == 'html' else ''}">
            <div>
                <h2 class="my-0">
                    <span>Delivery Order</span>
                    <em t-esc="picking.name"/>
                </h2>
            </div>
            <div class="ml-auto mt-2">
                <span class="small badge badge-warning" t-if="picking.state in ('draft', 'waiting', 'confirmed')"><b><t t-esc="state"/></b></span>
                <span class="small badge badge-success" t-if="picking.state in ('assigned', 'done')"><b><t t-esc="state"/></b></span>
                <span class="small badge badge-danger" t-if="picking.state in ('cancel')"><b><t t-esc="state"/></b></span>
            </div>
        </div>
        <div t-attf-class="#{'card-body' if report_type == 'html' else ''}">
            <!-- Informations -->
            <div id="informations">
                <div class="row">
                    <div class="col-lg-6">
                        <strong class="d-block mb-1">From:</strong>
                        <address t-field="picking.company_id.partner_id" t-options='{"widget": "contact", "fields": ["address", "name"], "no_marker": True}'/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <strong class="mb-1">Source Location:</strong>
                        <span t-esc="picking.location_id.display_name"/>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-lg-6">
                        <strong class="mb-1">Schedule Date:</strong>
                        <span t-esc="picking.scheduled_date"/>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-6">
                        <strong class="mb-1">Deadline:</strong>
                        <span t-esc="picking.date_deadline"/>
                    </div>
                </div>
            </div>
        </div>
        <section id="details" style="page-break-inside: auto;" class="mt32">
                <h3 id="details" class="pl-3">Pricing</h3>

                <table t-att-data-order-id="picking.id" t-att-data-token="picking.access_token" class="table table-sm" id="picking_order_table" style="width:775px!important; margin-left:18px;">
                    <thead class="bg-100">
                        <tr>
                            <th class="text-left">Product</th>
                            <th class="text-left">From</th>
                            <th t-attf-class="text-right">To Do</th>
                            <th t-attf-class="text-right">Done</th>
                        </tr>
                    </thead>
                    <tbody class="sale_tbody">
                        <t t-foreach="picking.move_ids_without_package" t-as="line">
                            <tr>
                                <td calss="text-left"><span t-esc="line.product_id.display_name"/></td>
                                <td class="text-left"><span t-esc="line.location_id.display_name"/></td>
                                <td class="text-right"><span t-esc="line.product_uom_qty"/></td>
                                <td class="text-right"><span t-esc="line.quantity_done"/></td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </section>
    </template>
    <!-- sale_order.note to html view -->
    <template id="sale_order_customer_portal_content_inherit" name="Orders Terms" inherit_id="sale.sale_order_portal_content">
        <xpath expr="//section[@id='terms']/em" position="replace">
            <em t-raw="sale_order.note"/>
            <style>p {margin-bottom: 0;}</style>
        </xpath>
    </template>

    <template id="frontend_layout" name="Main Frontend Layout" inherit_id="web.frontend_layout">
        <xpath expr="//div[@id='wrapwrap']" position="attributes">
            <attribute name="t-attf-class" add="#{'customer_quotes_view' if request.httprequest.path.startswith('/my/quotes') else ''}" separator=" "/>
            <attribute name="t-attf-class" add="#{'customer_my_orders_view' if request.httprequest.path.startswith('/my/orders') else ''}" separator=" "/>
            <attribute name="t-attf-class" add="#{'customer_delivery_order_view' if request.httprequest.path.startswith('/my/delivery_orders') else ''}" separator=" "/>
        </xpath>
    </template>

</odoo>
