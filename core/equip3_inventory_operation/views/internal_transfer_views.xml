<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_form_internal_transfer" model="ir.ui.view">
        <field name="name">Internal Transfer</field>
        <field name="model">internal.transfer</field>
        <field name="arch" type="xml">
            <form js_class="internal_transfer_barcode_scanner">
                <header>
                    <button name="action_confirm" string="Confirm" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('state', 'not in', ('draft')), ('is_itr_approval_matrix','!=', False)]}"/>
                    <button name="action_confirm" string="Confirm" type="object" attrs="{'invisible': ['|', ('state', '!=', 'approved'),('is_itr_approval_matrix','=', False)]}" class="oe_highlight"/>
                    <button name="action_done" string="Done" type="object" class="oe_highlight" attrs="{'invisible': [('state', 'not in',  ('confirm'))]}"/>
                    <button name="itr_request_for_approving" string="Request For Approval" attrs="{'invisible': ['|', '|', ('is_itr_approval_matrix','=', False), ('state', '!=', 'draft'), ('is_product_lines', '=', False)]}" type="object" class="btn btn-primary"/>
                    <button name="itr_approving" string="Approve" attrs="{'invisible': ['|', '|', ('is_itr_approval_matrix','=', False), ('is_approve_button', '=', False), ('state', '!=', 'to_approve')]}" type="object" class="btn btn-primary"/>
                    <button name="itr_reject" string="Reject" attrs="{'invisible': ['|', '|', ('is_itr_approval_matrix','=', False), ('is_approve_button', '=', False), ('state', '!=', 'to_approve')]}" type="object" class="btn btn-primary"/>
                    <button name="itr_reset_to_draft" string="Reset To Draft" attrs="{'invisible': [('is_reset_to_draft', '=', False)]}" type="object" class="btn btn-secondary"/>
                    <button name="print_report" string="Print" type="object" attrs="{'invisible': [('state', 'not in', ('confirm'))]}"/>
                    <button name="action_cancel" string="Cancel" type="object" attrs="{'invisible': [('state', '!=', 'confirm')]}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,done" attrs="{'invisible': [('is_itr_approval_matrix', '!=', False)]}"/>
                    <field name="state1" widget="statusbar" statusbar_visible="draft,to_approve,approved,confirm,done" attrs="{'invisible': ['|', ('is_itr_approval_matrix','=', False), ('state', '!=', 'approved')]}"/>
                    <field name="state2" widget="statusbar" statusbar_visible="draft,to_approve,rejected" attrs="{'invisible': ['|', ('is_itr_approval_matrix','=', False), ('state', '!=', 'rejected')]}"/>
                    <field name="state3" widget="statusbar" statusbar_visible="draft,to_approve,confirm,done" attrs="{'invisible': ['|', ('is_itr_approval_matrix','=', False), ('state', 'in', ('approved', 'rejected'))]}"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="button_notes" type="object" class="oe_stat_button" icon="o-hm-smart-all-operations" attrs="{'invisible': [('operation_count', '=', 0)]}">
                            <field name="operation_count" widget="statinfo" string="Operations"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <script type="text/javascript" src="/sh_all_in_one_mbs/static/src/js/ZXing.js"></script>
                    <script type="text/javascript" src="/equip3_inventory_operation/static/src/js/sh_it_barcode_mobile_new.js"></script>
                    <group col="3">
                        <group name="group_1">
                            <field name="name" invisible="1"/>
                            <field name="is_itr_approval_matrix" invisible="1"/>
                            <field name="is_product_lines" invisible="1"/>
                            <field name="is_approve_button" invisible="1"/>
                            <field name="is_reset_to_draft" invisible="1"/>
                            <field name="approval_matrix_line_id" invisible="1"/>
                            <field name="is_source_loc" invisible="1"/>
                            <field name="is_destination_loc" invisible="1"/>
                            <field name="domain_warehouse_source_id" invisible="1"/>
                            <field name="domain_warehouse_destination_id" invisible="1"/>
                            <field name="company_id"/>
                            <field name="branch_id" required="1"/>
                            <field name="requested_by" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="scheduled_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <div name="src_info" style="color: red !important;" invisible="1">
                                Source Location has been changed. Click to update source location on product line
                                <button name="upd_source" string="Update Source Location" type="object" attrs="{'invisible': [('is_source_loc','!=',True)]}"/>
                            </div >
                            <!-- <div>
                                <button name="upd_source" style="color: red !important;" string="Source Location has been changed. Click to update source location on product line" type="object" class="source_location oe_link" attrs="{'invisible': [('is_source_loc','!=',True)]}"/>
                            </div> -->

                            <div name="dest_info" style="color: red !important;" invisible="1">
                                Destination Location has been changed. Click to update source location on product line
                                <button name="upd_dest" string="Update Destination Location" type="object" attrs="{'invisible': [('is_destination_loc','!=',True)]}"/>
                            </div >
                            <!-- <div>
                                <button name="upd_dest" style="color: red !important;" string=" Destination Location has been changed. Click to update source location on product line" type="object" class="destination_location oe_link" attrs="{'invisible': [('is_destination_loc','!=',True)]}"/>
                            </div> -->

                            <field name="is_transit" invisible="1" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <section class="oe_edit_only" attrs="{'invisible': [('is_mbs_on_transfer_operations', '=', False)]}">
                                <group attrs="{'invisible': [('state', '!=', 'draft')]}">
                                    <field name="sh_it_barcode_mobile"/>
                                    <div>
                                        <a role="button" style="color: #fff; border-radius: 0px; margin-bottom: 5px; margin-right: 5px;" class="btn btn-primary" id="js_id_sh_it_barcode_mobile_start_btn">
                                            <i class="fa fa-barcode"></i>
                                            Start
                                        </a>
                                        <a role="button" style="display: none; color: #fff; border-radius: 0px; margin-bottom: 5px; margin-right: 5px;" class="btn btn-danger" id="js_id_sh_it_barcode_mobile_reset_btn">
                                            <i class="fa fa-barcode"></i>
                                            Stop
                                        </a>
                                    </div>
            
                                    <div id="js_id_sh_it_barcode_mobile_vid_div" style="display: none;">
                                        <group style="margin-bottom: 10px;">
                                            <div class="form-group row" style="margin-bottom: 0px;">
                                                <strong style="align-self: center;" class="col-3">Camera</strong>
                                                <select class="col-8 form-control" id="js_id_sh_it_barcode_mobile_cam_select"> </select>
                                            </div>
                                        </group>
            
                                        <video id="video" class="cls_sh_all_in_one_mbs_video_tag" width="600" height="400" style="border: 1px solid gray;"></video>
                                        <span style="display: block;">Result:</span>
                                        <code id="js_id_sh_it_barcode_mobile_result"></code>
                                    </div>
                                </group>
                            </section>
                        </group>
                        <group name="group_2">
                            <field name="filter_source_warehouse_id" invisible="1" />
                            <field name="source_warehouse_id" attrs="{'readonly': [('state', '!=', 'draft')]}" required="1" domain="domain_warehouse_source_id"/>
                            <field name="filter_destination_warehouse_id" invisible="1"/>
                            <field name="destination_warehouse_id" attrs="{'readonly': [('state', '!=', 'draft')]}" required="1" domain="domain_warehouse_destination_id"/>
                            <label for="is_single_source_location" invisible="1"/>
                            <div class="o_row" name="is_single_source_location" style="margin-top: 10px;">
                                <field name="is_single_source_location" nolabel="1" class="o_inline"/>
                                <label for="is_single_source_location" class="o_inline">Single Source Location</label>
                            </div>
                            <field name="source_location_id" attrs="{'readonly': [('state', '!=', 'draft')], 'invisible': [('is_single_source_location', '=', False)], 'required': [('is_single_source_location', '=', True)]}" domain="[('id', 'in', filter_source_warehouse_id)]"/>
                            <section class="oe_edit_only" attrs="{'invisible': [('is_mbs_on_itr_location', '=', False)]}">
                                <div attrs="{'invisible': [('state', '!=', 'draft')]}">
                                    <field name="source_location_barcode"/>
                                    <a role="button" style="color: #fff; border-radius: 0px; margin-bottom: 5px; margin-right: 5px;" class="btn btn-primary" id="js_id_sh_it_barcode_mobile_start_btn_source_location">
                                        <i class="fa fa-barcode"></i>
                                        Start
                                    </a>
                                    <a role="button" style="display: none; color: #fff; border-radius: 0px; margin-bottom: 5px; margin-right: 5px;" class="btn btn-danger" id="js_id_sh_it_barcode_mobile_reset_btn_source_location">
                                        <i class="fa fa-barcode"></i>
                                        Stop
                                    </a>
                                </div>
        
                                <div id="js_id_sh_it_barcode_mobile_vid_div_source_location" style="display: none;">
                                    <group style="margin-bottom: 10px;">
                                        <div class="form-group row" style="margin-bottom: 0px;">
                                            <strong style="align-self: center;" class="col-3">Camera</strong>
                                            <select class="col-8 form-control" id="js_id_sh_it_barcode_mobile_cam_select_source_location"> </select>
                                        </div>
                                    </group>
        
                                    <video id="video_source_location" class="cls_sh_all_in_one_mbs_video_tag" width="600" height="400" style="border: 1px solid gray;"></video>
                                    <span style="display: block;">Result:</span>
                                    <code id="js_id_sh_it_barcode_mobile_result_source_location"></code>
                                </div>
                            </section>
                            <div class="o_row" name="is_single_destination_location" style="margin-top: 10px;">
                                <field name="is_single_destination_location" nolabel="1" class="o_inline"/>
                                <label for="is_single_destination_location" class="o_inline">Single Destination Location</label>
                            </div>
                            <field name="destination_location_id" attrs="{'readonly': [('state', '!=', 'draft')],  'invisible': [('is_single_destination_location', '=', False)], 'required': [('is_single_destination_location', '=', True)], }" domain="[('id', 'in', filter_destination_warehouse_id)]"/>
                            <section class="oe_edit_only" attrs="{'invisible': [('is_mbs_on_itr_location', '=', False)]}">
                                <field name="destination_location_barcode"/>
                                <div attrs="{'invisible': [('state', '!=', 'draft')]}">
                                    <a role="button" style="color: #fff; border-radius: 0px; margin-bottom: 5px; margin-right: 5px;" class="btn btn-primary" id="js_id_sh_it_barcode_mobile_start_btn_dest_location">
                                        <i class="fa fa-barcode"></i>
                                        Start
                                    </a>
                                    <a role="button" style="display: none; color: #fff; border-radius: 0px; margin-bottom: 5px; margin-right: 5px;" class="btn btn-danger" id="js_id_sh_it_barcode_mobile_reset_btn_dest_location">
                                        <i class="fa fa-barcode"></i>
                                        Stop
                                    </a>
                                </div>
        
                                <div id="js_id_sh_it_barcode_mobile_vid_div_dest_location" style="display: none;">
                                    <group style="margin-bottom: 10px;">
                                        <div class="form-group row" style="margin-bottom: 0px;">
                                            <strong style="align-self: center;" class="col-3">Camera</strong>
                                            <select class="col-8 form-control" id="js_id_sh_it_barcode_mobile_cam_select_dest_location"> </select>
                                        </div>
                                    </group>
        
                                    <video id="video_destination_location" class="cls_sh_all_in_one_mbs_video_tag" width="600" height="400" style="border: 1px solid gray;"></video>
                                    <span style="display: block;">Result:</span>
                                    <code id="js_id_sh_it_barcode_mobile_result_dest_location"></code>
                                </div>
                            </section>
                            <field name="domain_analytic_account_group_ids" invisible="1"/>
                            <field name="analytic_account_group_ids" domain="domain_analytic_account_group_ids" attrs="{'readonly': [('state', '!=', 'draft')]}" widget="many2many_tags" groups="analytic.group_analytic_tags"/>
                            <field name="internal_transfer_line_total" invisible="1"/>
                            <field name="get_warehouse" invisible="1"/>
                            <field name="is_itr_approval_matrix" invisible="1"/>
                            <field name="itr_approval_matrix_id" attrs="{'invisible': [('is_itr_approval_matrix', '=', False)]}"/>
                            <field name="is_mbs_on_transfer_operations" invisible="1"/>
                            <field name="is_mbs_on_itr_location" invisible="1"/>
                        </group>
                        <group name="group_3">
                            <field name="create_date" />
                            <field name="create_uid"/>
                            <field name="expiry_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="source_document" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                            <field name="description" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Product">
                            <field name="product_line_ids" attrs="{'readonly': [('state', '!=', 'draft')]}" context="{'default_source_location_id': source_location_id,
                                'default_destination_location_id': destination_location_id,'default_scheduled_date':scheduled_date,
                                'product_line_ids': product_line_ids, 'default_analytic_account_group_ids' : analytic_account_group_ids}">
                                <tree editable="bottom">
                                    <field name="sequence" force_save="1" readonly="1"/>
                                    <field name="product_id" domain="[('type', '=', 'product')]"/>
                                    <field name="description"/>
                                    <field name="analytic_account_group_ids" widget="many2many_tags" groups="analytic.group_analytic_tags"/>
                                    <field name="qty" string="Demand"/>
                                    <field name="filter_available_product_ids" widget="many2many_tags" invisible="1"/>
                                    <field name="uom" domain="[('category_id', '=', product_uom_category_id)]"/>
                                    <field name="product_uom_category_id" invisible="1"/>
                                    <field name="current_qty"/>
                                    <field name="source_location_id" attrs="{'readonly':[('is_single_source_location', '=', True)]}" force_save="1" domain="filter_source_loc"/>
                                    <field name="filter_source_loc" invisible="1"/>
                                    <field name="destination_location_id" attrs="{'readonly':[('is_single_destination_location', '=', True)]}" force_save="1" domain="filter_dest_loc"/>
                                    <field name="filter_dest_loc" invisible="1"/>
                                    <field name="is_single_source_location" invisible="1"/>
                                    <field name="is_single_destination_location" invisible="1"/>

                                    <field name="scheduled_date" required="1"/>
                                    <field name="itr_remaining_qty"/>
                                    <field name="itr_in_progress_qty" string="Progress Quantity"/>
                                    <field name="transfer_qty" invisible="0"/>
                                    <field name="return_qty" invisible="0" force_save="1"/>
                                    <field name="total_trf" invisible="1"/>
                                    <field name="qty_cancel" invisible="1"/>
                                    <field name="mr_line_id" invisible="1"/>
                                </tree>
                                <form>
                                    <div class="oe_title">
                                        <h1>
                                            <field name="product_line" readonly="1"/>
                                        </h1>
                                    </div>
                                    <group>
                                        <group>
                                            <field name="source_document"/>
                                            <field name="requested_by"/>
                                            <field name="create_date"/>
                                            <field name="company_id"/>
                                        </group>
                                        <group>
                                            <field name="product_id"/>
                                            <field name="description"/>
                                            <field name="scheduled_date"/>
                                            <field name="source_location_id"/>
                                            <field name="destination_location_id"/>
                                        </group>
                                    </group>
                                    <group>
                                        <group string="Tracking">
                                            <field name="qty" string="Requested Quantity"/>
                                            <field name="itr_in_progress_qty"/>
                                            <field name="itr_remaining_qty"/>
                                            <field name="transfer_qty"/>
                                            <field name="return_qty" force_save="1" string="Returned Quantity"/>
                                        </group>
                                    </group>
                                    <group string="Traceability">
                                        <notebook>
                                            <page string="Stock Picking">
                                                <field name='picking_id'>
                                                    <tree create="false">
                                                        <field name="name"/>
                                                        <field name="location_id"/>
                                                        <field name="location_dest_id"/>
                                                        <field name="partner_id"/>
                                                        <field name="state"/>
                                                    </tree>
                                                </field>
                                            </page>
                                        </notebook>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Additional Info" invisible="1">
                            <form>
                                <group>
                                    <group>
                                        <field name="operation_type_in_id" force_save="1"/>
                                    </group>
                                    <group>
                                        <field name="operation_type_out_id" force_save="1"/>
                                    </group>
                                </group>
                            </form>
                        </page>
                        <page name="approved_matrix_ids" string="Approval Matrix Line" attrs="{'invisible': ['|',('itr_approval_matrix_id', '=', False), ('is_itr_approval_matrix', '=', False)]}">
                            <field name="approved_matrix_ids" context="{'approved_matrix_ids': approved_matrix_ids}">
                                <tree editable="bottom">
                                    <field name="sequence" />
                                    <field name="user_ids" widget="many2many_tags"/>
                                    <field name="minimum_approver" />
                                    <field name="state_char" />
                                    <field name="time_stamp" invisible="1"/>
                                    <field name="feedback" />
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="view_tree_internal_transfer" model="ir.ui.view">
        <field name="name">internal.transfer.tree</field>
        <field name="model">internal.transfer</field>
        <field name="arch" type="xml">
            <tree string="Interwarehouse Transfer" default_order="id desc">
                <field name ="name"/>
                <field name="source_warehouse_id"/>
                <field name="destination_warehouse_id"/>
                <field name="scheduled_date"/>
                <field name="state" widget="badge" decoration-success2="state == 'done'" decoration-secondary="state == 'draft'" decoration-warning3="state =='to_approve'" decoration-danger3="state == 'cancel'" decoration-danger="state == 'rejected'" decoration-success3="state in ('confirm', 'approved')"/>
                <field name="get_warehouse" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="action_internal_transfer_request" model="ir.actions.act_window">
        <field name="name">Interwarehouse Transfer Request</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">internal.transfer</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="oe_views_nocontent_create">
           Click to add a new test object.
            </p>
        </field>
    </record>

    <menuitem name="Interwarehouse Transfer Request" id="menu_operation_internal_transfer_request" parent="equip3_inventory_operation.menu_operations_internal_transfer" action="action_internal_transfer_request" sequence="1"/>

</odoo>
