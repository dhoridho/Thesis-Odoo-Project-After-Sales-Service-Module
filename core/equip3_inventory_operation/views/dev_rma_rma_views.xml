<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_form_dev_rma_rma" model="ir.ui.view">
        <field name="name">dev.rma.rma.form</field>
        <field name="model">dev.rma.rma</field>
        <field name="inherit_id" ref="dev_rma.view_dev_rma_rma_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='picking_id']" position="after">
                <field name="purchase_id" attrs="{'invisible': [('is_po', '=', False)]}"/>
                <field name='sale_id' position="move"/>
            </xpath>
            <field name="sale_id" position="attributes">
                <attribute name="attrs">{'invisible': [('is_po', '=', True)], 'readonly':[('state','!=','draft')]}</attribute>
                <attribute name="domain">[('is_process_rma','!=',True),('company_id','=',company_id)]</attribute>
            </field>
            <xpath expr="//field[@name='subject']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="after">
                <field name="partner_id" position="move" />
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="required">1</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="after">
                <field name="picking_type_code" invisible="1"/>
            </xpath>
            <xpath expr="//button[@name='action_view_shipment']" position="after">
                <button name="action_view_shipment" type="object" string="Delivery" class="oe_stat_button" icon="o-hm-smart-crm-delivery" attrs="{'invisible': ['|', ('picking_type_code', '!=', 'incoming'), ('incoming_id', '=', False)]}">
                </button>
                <button name="action_view_receipt" type="object" class="oe_stat_button" icon="o-hm-smart-all-receipt" attrs="{'invisible': [('receipt_id', '=', False)]}">
                    Receipt
                </button>
            </xpath>
            <xpath expr="//button[@name='action_view_shipment']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('incoming_id', '=', False), ('picking_type_code', '=', 'incoming')]}</attribute>
            </xpath>

            <xpath expr="//button[@name='action_view_invoice']" position="after">
                <button name="action_view_invoice" type="object" string="Vendor Credit Note" class="oe_stat_button" icon="fa-pencil-square-o" attrs="{'invisible': ['|', ('picking_type_code', '!=', 'incoming'), ('invoice_id', '=', False)]}">
                </button>
            </xpath>

            <xpath expr="//button[@name='action_view_invoice']" position="before">
                <button name="action_view_purchase_order" type="object" string="Purchase Order" class="oe_stat_button" icon="fa-usd" attrs="{'invisible': ['|', ('picking_type_code', '!=', 'incoming'), ('new_purchase_id', '=', False)]}">
                </button>
            </xpath>
            <button name="action_confirm" position="attributes">
                <attribute name="string">Confirm Request</attribute>
            </button>
            <button name="action_process" position="attributes">
                <attribute name="string">Process Request</attribute>
            </button>
            <button name="%(dev_rma.action_reject_rma_reason)d" position="attributes">
                <attribute name="string">Reject Request</attribute>
            </button>
			
            <xpath expr="//button[@name='action_view_invoice']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('invoice_id', '=', False), ('picking_type_code', '=', 'incoming')]}</attribute>
            </xpath>
            <button name="action_close" position="attributes">
                <attribute name="string">Set as Done</attribute>
            </button>
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="warehouse_id" />
                <field name="new_purchase_id" invisible="1"/>
                <field name="location_id" domain="[('id', 'in', filter_location_ids)]" />
                <field name="receipt_id" invisible="1"/>
                <field name="operation_type_id" readonly="1" force_save="1"/>
                <field name="filter_location_ids" invisible="1"/>
                <field name="is_po" invisible="1"/>
                <field name="is_return_order"/>
            </xpath>
            <xpath expr="//field[@name='operation_type_id']" position="after">
                <field name="picking_id" string="Transfer Reference" />
            </xpath>
            <xpath expr="//field[@name='deadline_date']" position="attributes">
                <attribute name="string">Scheduled Date</attribute>
            </xpath>
            <xpath expr="//notebook/page[@name='rma_lines']" position="attributes">
                <attribute name="string">Product Lines</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="attributes">
                <attribute name="domain">[]</attribute>
            </xpath>
            <xpath expr="//field[@name='date']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='user_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='team_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='tags']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='priority']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='email']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='phone']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='deadline_date']" position="after">
                <field name="create_date" />
                <field name="create_uid" /> 
            </xpath>
            <xpath expr="//field[@name='name']/.." position="replace">
                <h1>
                    <field name="name" readonly="1"/>
                </h1>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="branch_id" />
            </xpath>
            <xpath expr="//sheet/group[2]" position="before">
                <field name="return_possible_date" invisible="1"/>
                <div attrs="{'invisible': [('return_possible_date', '=', False)]}">
                    <p class="text-danger"><b>Return Request exceed the Product(s) Return Limit date: <field name="return_possible_date"/></b></p>
                </div>
            </xpath>
            <xpath expr="//field[@name='rma_lines']//field[@name='replace_product_id']" position="after">
                <field name="available_qty" force_save="1" readonly="1"/>
            </xpath>
            <xpath expr="//field[@name='rma_lines']//field[last()]" position="after">
                <field name="return_reason"/>
                <field name="product_description" invisible="1" force_save="1"/>
            </xpath>
        </field>
    </record>

    <record id="view_tree_dev_rma_rma" model="ir.ui.view">
        <field name="name">dev.rma.rma.tree</field>
        <field name="model">dev.rma.rma</field>
        <field name="inherit_id" ref="dev_rma.view_dev_rma_rma_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="string">Reference</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="attributes">
                <attribute name="string">Transfer Reference</attribute>
            </xpath>
            <xpath expr="//field[@name='picking_id']" position="after">
                <field name="location_id" />
            </xpath>
            <xpath expr="//field[@name='location_id']" position="after">
                <field name="operation_type_id" />
            </xpath>
            <xpath expr="//tree/field[@name='state']" position="replace">
                <field name="state" optional="show" string="status" widget="badge" 
                            decoration-warning="state == 'process'"
                            decoration-success3="state == 'confirm'"
                            decoration-secondary="state == 'draft'"
                            decoration-success2="state == 'close'"
                            decoration-danger="state == 'reject'"/>

            </xpath>
            <!-- <xpath expr="//field[@name='operation_type_id']" position="after" invisible="1">
                <field name="state" string="Status"/>
            </xpath> -->
            <xpath expr="//field[@name='date']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='sale_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='deadline_date']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='email']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='phone']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.actions.act_window" id="dev_rma.action_reject_rma_reason">
        <field name='name'>Reject Reason</field>
    </record>

    <menuitem name="Return Request of Sale Order" 
              id="menu_dev_rma_rma_main_so" 
              parent="equip3_inventory_operation.menu_operations_return_request" 
              action="equip3_inventory_operation.action_dev_rma_rma_so" 
              sequence="16"/>
    
</odoo>