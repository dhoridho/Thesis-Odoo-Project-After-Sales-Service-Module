<?xml version='1.0' encoding='utf-8'?>
<odoo>
	<!-- inter.asset.transfer tree view -->
	<record id="maintenance_repair_order_tree_view" model="ir.ui.view">
		<field name="name">maintenance.repair.order.tree.view</field>
		<field name="model">maintenance.repair.order</field>
		<field name="arch" type="xml">
			<tree string="Maintenance Repair Order">
				<field name="name"/>
				<field name="facilities_area" />
				<field name="maintenance_team"/>
				<field name="maintenance_assignation_type"/>
				<field name="ref" />
				<field name="state_id"/>
				<field name="date_start"/>
				<field name="date_stop"/>
			</tree>
		</field>
	</record>

	<record id="maintenance_repair_order_form_view" model="ir.ui.view">
		<field name="name">maintenance.repair.order.form.view</field>
		<field name="model">maintenance.repair.order</field>
		<field eval="12" name="priority"/>
		<field name="arch" type="xml">
			<form string="Maintenance Repair Order">
				<header>

					<button string="Start" name="state_confirm" type="object" class="oe_highlight" attrs="{'invisible':[('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>

					<button string="Create Material Request" name="create_material_request" type="object" class="oe_highlight" attrs="{'invisible':['|',('state_id', 'in', ['in_progress','pending','done','cancel']),('is_material_not_available', '=', False)]}"/>

					<button string="Done" name="state_done" type="object" class="oe_highlight" attrs="{'invisible':[('state_id', 'in', ['draft','done','cancel'])]}" context="{'replace_part': 1}"/>

					<button string="Pause" name="state_pending" type="object" attrs="{'invisible':[('state_id', 'in', ['draft','pending','done','cancel'])]}"/>

					<button string="Start Again" name="action_start_again" type="object" class="oe_highlight" attrs="{'invisible':[('state_id', '!=', 'pending')]}"/>

					<button string="Cancel" name="state_cancel" type="object" attrs="{'invisible':[('state_id', 'in', ['draft','pending','done','cancel'])]}"/>

					<button class="oe_highlight" type="object" name="create_ro_invoice" string="Create Invoice" icon="fa-pencil-square-o" attrs="{'invisible':['|',('state_id', 'in', ['draft','cancel']), ('invoice_id', '!=', False)]}"/>

					<field name="is_expired_draft" invisible="1"/>
                    <field name="is_expired_progress" invisible="1"/>
					<field name="invoice_id" invisible="1"/>
					<field name="invoice_state" invisible="1"/>
					<button name="button_cancel" string="Cancel Invoice" type="object" attrs="{'invisible':[('invoice_count', '=', 0), ('invoice_state', 'not in', ['cancel'])]}"/>

					<field name="state_id" widget="statusbar" statusbar_visible="draft,in_progress,pending,done" readonly="1"/>
				</header>
				<sheet>
					<div class="oe_button_box" name="button_box">
						<button class="oe_stat_button" name="action_view_receiving_notes" type="object" icon="fa-pencil-square-o" attrs="{'invisible':[ ('receiving_notes_count', '=', 0)]}">
							<div class="o_field_widget o_stat_info">
								<span class="o_stat_value">
									<field name="receiving_notes_count" widget="statinfo" nolabel="1" class="mr4"/>
								</span>
								<span class="o_stat_text">Receiving Notes</span>
							</div>
						</button>
						<button class="oe_stat_button" name="action_view_invoice" type="object" icon="fa-pencil-square-o" attrs="{'invisible':[ ('invoice_count', '=', 0)]}">
							<div class="o_field_widget o_stat_info">
								<span class="o_stat_value">
									<field name="invoice_count" widget="statinfo" nolabel="1" class="mr4"/>
								</span>
								<span class="o_stat_text">Invoices</span>
							</div>
						</button>
						<button class="oe_stat_button" name="action_view_material_request" type="object" icon="fa-list" attrs="{'invisible':[('material_request_count', '=', 0)]}">
							<div class="o_field_widget o_stat_info">
								<span class="o_stat_value">
									<field name="material_request_count" widget="statinfo" nolabel="1" class="mr4"/>
								</span>
								<span class="o_stat_text">Material Request</span>
							</div>
						</button>
						<button class="oe_stat_button" name="action_delivery_order" type="object" icon="fa-truck" attrs="{'invisible':[('delivery_order_count', '=', 0)]}">
							<div class="o_field_widget o_stat_info">
								<span class="o_stat_value">
									<field name="delivery_order_count" widget="statinfo" nolabel="1" class="mr4"/>
								</span>
								<span class="o_stat_text">Delivery Order</span>
							</div>
						</button>
					</div>
					<div class="oe_title">
						<h1>
							<field name="name" readonly="1"/>
						</h1>
					</div>
					<group>
						<group>
							<field name="approvers_id" widget="many2many_tags" invisible="1"/>
							<field name="partner_id" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="facilities_area" required="0" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="maintenance_team" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="maintenance_assignation_type" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="maintenance_types" widget="many2many_tags" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="ref" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="date_start" required="1" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}" decoration-danger="is_expired_draft"/>
							<field name="date_stop" required="1" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}" decoration-danger="is_expired_progress"/>
						</group>
						<group>
							<field name="created_date"/>
							<field name="user_id"/>
							<field name="company_id"/>
							<field name="branch_id" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="is_approval_matrix" invisible="1"/>
							<field name="is_material_not_available" invisible="1"/>
							<field name="approvalmatrix" attrs="{'required': [('is_approval_matrix', '=', True)], 'invisible': [('is_approval_matrix', '!=', True)]}"/>
							<field name="analytic_group_id" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}" widget="many2many_tags"/>
							<field name="remarks" attrs="{'readonly': [('state_id', 'in', ['in_progress','pending','done','cancel'])]}"/>
							<field name="time_in_progress" readonly="1" widget="time_in_progress"/>
							<field name="time_post" widget="time_post" readonly="1"/>
						</group>
					</group>
					<notebook>
						<page string="Description" invisible='1'>
							<field name="instruction" attrs="{'readonly': [('state_id', '=', 'in_progress')]}"/>
						</page>
						<page string="Asset Checklist">
                            <field name="task_check_list_ids"
                                attrs="{'readonly': [('state_id', '=', 'done')]}">
                                <tree editable="bottom">
                                    <field name="equipment_id" string="Asset" required="1"/>
                                    <field name="asset_description" string="Description"/>
                                    <field name="vehicle_parts_ids" string="Parts"
                                        widget="many2many_tags"/>
                                    <field name="task" required='0' string="Details"/>
                                    <field name="already_compute" required='0'
                                        string="Already Compute" invisible="1" />
                                    <field name="is_checklist" string="Checklist" attrs="{'readonly':[('parent.state_id', '=', 'done')]}"/>
                                </tree>
                            </field>
                        </page>
						<page string="Materials" name="materials_page">
							<field name="maintenance_materials_list_ids" context="{'default_analytic_group_ids': analytic_group_id, 'is_repair':True}" attrs="{'readonly': [('state_id', 'not in', ['draft'])]}">
								<tree editable="bottom">
									<field name="types" required="1"/>
									<field name="product_id" string="Product" required='1' domain="[('type', 'in', ('consu', 'product', 'service'))]"/>
									<field name="parent_equipment_id_domain" invisible="1"/>
									<field name="parent_equipment_id" domain="parent_equipment_id_domain"/>
									<field name="part_equipment_id_domain" invisible="1"/>
									<field name="part_equipment_id" required="0" domain="part_equipment_id_domain"/>
									<field name="product_uom_qty" string="Qty" />
									<field name="uom_id" string="UOM"/>
									<field name="loc_is_required" invisible="1"/>
									<field name="location_id" domain="[('id', 'in', filter_location_ids)]" attrs="{'required': [('loc_is_required', '=', True)]}"/>
									<field name="filter_location_ids" widget="many2many_tags" invisible="1"/>
									<field name="location_dest_id" attrs="{'required': [('loc_is_required', '=', True)]}"/>
									<field name="analytic_group_ids" widget="many2many_tags" />
									<field name="notes" string="Notes" />
									<field name="price_unit" />
									<field name="invoiced_price" />
									<field name="taxes_id" widget="many2many_tags" options="{'no_create': True}" optional="show"/>
									<field name="price_subtotal" widget="monetary"/>
									<field name="attachment" filename="file_name" widget="binary"/>
									<field name="file_name" invisible="1"/>
								</tree>
							</field>
							<group class="oe_subtotal_footer oe_right">
								<field name="amount_untaxed" widget="monetary" options="{'currency_field': 'currency_id'}"/>
								<field name="amount_tax" widget="monetary" options="{'currency_field': 'currency_id'}"/>
								<div class="oe_subtotal_footer_separator oe_inline">
									<label for="amount_total"/>
								</div>
								<field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							</group>
						</page>
						<page string="Tools" name="tools_page">
							<field name="tools_materials_list_ids" attrs="{'readonly': [('state_id', 'not in', ['draft'])]}">
								<tree editable="bottom">
									<field name="product_id" string="Product" required='1'/>
									<field name="product_uom_qty" string="Qty"/>
									<field name="uom_id" string="UOM"/>
									<field name="notes" string="Notes"/>
								</tree>
							</field>
						</page>
						<page string="Replacement Parts" name="part_replacements">
							<field name="replacement_parts_line" attrs="{'readonly': [('state_id', 'not in', ['draft'])]}">
								<tree editable="bottom" create="0">
									<field name="asset_vehicle_id" invisible="1"/>
									<field name="current_part_id"/>
									<field name="current_serial_number" force_save="1" readonly="1"/>
									<field name="replacement_part_id" force_save="1" readonly="1"/>
									<field name="new_part_serial" force_save="1" readonly="1"/>
									<button name="action_replace" type="object" string="Replace" class="oe_highlight" attrs="{'invisible':[('state', 'in', ['done', 'cancel'])]}"/>
									<field name="state" invisible="1"/>
								</tree>
							</field>
						</page>
					</notebook>
				</sheet>
			</form>
		</field>
	</record>

	<record id="maintenance_repair_order_kanban_view" model="ir.ui.view">
		<field name="name">maintenance.repair.order.kanban</field>
		<field name="model">maintenance.repair.order</field>
		<field name="arch" type="xml">
			<kanban default_group_by="state_id" sample="1" records_draggable="0">
				<field name="state_id"/>
				<field name="name"/>
				<field name="color"/>
				<field name="priority"/>
				<field name="equipment_ids"/>
				<field name="user_id"/>
				<field name="partner_id"/>
				<field name="activity_ids"/>
				<field name="facilities_area"/>
				<field name="maintenance_team"/>
				<!-- <progressbar field="kanban_state" colors='{"done": "success", "blocked": "danger"}'/> -->
				<templates>
					<t t-name="kanban-tooltip">
						<ul class="oe_kanban_tooltip">
							<li t-if="record.partner_id.raw_value">
								<b>Request to:</b>
								<t t-esc="record.partner_id.value"/>
							</li>
						</ul>
					</t>
					<t t-name="kanban-box">
						<div t-attf-class="{{!selection_mode ? 'oe_kanban_color_' + kanban_getcolor(record.color.raw_value) : ''}} oe_kanban_card oe_kanban_global_click oe_semantic_html_override">
							<div class="o_dropdown_kanban dropdown">

								<a role="button" class="dropdown-toggle o-no-caret btn" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
									<span class="fa fa-ellipsis-v"/>
								</a>
								<div class="dropdown-menu" role="menu">
									<t t-if="widget.editable">
										<a role="menuitem" type="edit" class="dropdown-item">Edit...</a>
									</t>
									<t t-if="widget.deletable">
										<a role="menuitem" type="delete" class="dropdown-item">Delete</a>
									</t>
									<ul class="oe_kanban_colorpicker" data-field="color"/>
								</div>
							</div>
							<div class="oe_kanban_content" tooltip="kanban-tooltip">
								<div class="o_kanban_record_top">
									<b class="o_kanban_record_title">
										<field name="name"/>
									</b>
								</div>
								<div class="o_kanban_record_body">
									<span name="user_id" t-if="record.user_id.raw_value">Created by : <field name="user_id"/>
									<br/>
								</span>
								<span class="oe_grey" t-if="record.maintenance_team.raw_value">
									<field name="maintenance_team"/>
									<br/>
								</span>
								<span t-if="record.facilities_area.raw_value">
									<field name="facilities_area"/>
								</span>
							</div>
							<div class="o_kanban_record_bottom">
								<div class="oe_kanban_bottom_left">
									<field name="priority" widget="priority"/>
									<div class="o_kanban_inline_block ml4 mr4">
										<field name="activity_ids" widget="kanban_activity" />
									</div>
								</div>
								<div class="oe_kanban_bottom_right">
									<!-- <field name="kanban_state" widget="state_selection"/> -->
									<field name="user_id" widget="many2one_avatar_user"/>
								</div>
							</div>
						</div>
						<div class="oe_clear"></div>
					</div>
				</t>
			</templates>
		</kanban>
	</field>
</record>

<!-- maintenance.repair.order calendar view -->
<record id="mro_view_calendar" model="ir.ui.view">
	<field name="name">maintenance.repair.order.view.calendar</field>
	<field name="model">maintenance.repair.order</field>
	<field name="arch" type="xml">
		<calendar date_start="date_start">
			<field name="name" />
		</calendar>
	</field>
</record>

<record id="maintenance_repair_order_action" model="ir.actions.act_window">
	<field name="name">Maintenance Repair Order</field>
	<field name="type">ir.actions.act_window</field>
	<field name="res_model">maintenance.repair.order</field>
	<field name="view_mode">kanban,tree,form,calendar</field>
	<field name="help" type="html">
		<p class="oe_view_nocontent_create">
					Create Repair Order
		</p>
	</field>
</record>
<menuitem id="menu_m_repair_order" name="Maintenance Repair Order" parent="maintenance.menu_m_request" action="maintenance_repair_order_action" sequence="5"/>
</odoo>
