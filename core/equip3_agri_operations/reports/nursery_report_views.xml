<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_agriculture_nursery_report_pivot" model="ir.ui.view">
         <field name="name">agriculture.nursery.report.pivot</field>
         <field name="model">agriculture.nursery.report</field>
         <field name="arch" type="xml">
             <pivot string="Nursery Report" sample="1">
             </pivot>
         </field>
    </record>

    <record id="view_agriculture_nursery_report_search" model="ir.ui.view">
            <field name="name">agriculture.nursery.report.search</field>
            <field name="model">agriculture.nursery.report</field>
            <field name="arch" type="xml">
                <search string="Nursery Report">
                    <field name="activity_record_id"/>
                    <field name="estate_id"/>
                    <field name="division_id"/>
                    <field name="block_id"/>
                    <field name="date"/>
                    <field name="product_id"/>

                    <filter name="filter_date" date="date"/>

                    <group expand="0" string="Group By...">
                        <filter name="groupby_estate_id" string="Estate" domain="[]" context="{'group_by': 'estate_id'}"/>
                        <filter name="groupby_division_id" string="Division" domain="[]" context="{'group_by': 'division_id'}"/>
                        <filter name="groupby_block_id" string="Block" domain="[]" context="{'group_by': 'block_id'}"/>
                    </group>

                    <searchpanel>
                        <field name="estate_id"/>
                        <field name="division_id"/>
                        <field name="block_id"/>
                        <field name="product_id"/>
                    </searchpanel>
                </search>
            </field>
    </record>

    <record id="view_agriculture_nursery_report_graph" model="ir.ui.view">
        <field name="name">agriculture.nursery.report.graph</field>
        <field name="model">agriculture.nursery.report</field>
        <field name="arch" type="xml">
            <graph string="Nursery Report" sample="1">
                <field name="product_id"/>
                <field name="qty" type="measure"/>
            </graph>
        </field>
    </record>

    <record id="view_agriculture_nursery_report_tree" model="ir.ui.view">
        <field name="name">agriculture.nursery.report.tree</field>
        <field name="model">agriculture.nursery.report</field>
        <field name="arch" type="xml">
            <tree string="Nursery Report" js_class="list_view_report">
                <field name="estate_id" invisible="1"/>
                <field name="division_id" invisible="1"/>
                <field name="block_id" invisible="1"/>
                <field name="date"/>
                <field name="activity_record_id"/>
                <field name="product_id"/>
                <field name="qty"/>
                <field name="uom_id" string="UoM"/>
                <field name="planted_year" widget="date_year"/>
                <field name="planted_area"/>
                <field name="area_uom_id" string="UoM"/>
            </tree>
        </field>
    </record>

    <record id="action_agriculture_nursery_report" model="ir.actions.act_window">
        <field name="name">Nursery Report</field>
        <field name="res_model">agriculture.nursery.report</field>
        <field name="view_mode">tree,pivot,graph</field>
        <field name="search_view_id" ref="view_agriculture_nursery_report_search"/>
        <field name="context">{'search_default_groupby_block_id': 1, 'search_default_groupby_division_id': 1, 'search_default_groupby_estate_id': 1}</field>
        <field name="domain">[]</field>
        <field name="help">This report performs analysis on your Nursery.</field>
    </record>

    <template id="equip3_agri_operations.agriculture_nursery_report">

        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <div class="page">

                    <div class="oe_structure"/>

                    <h3><span t-esc="company.name"/>: Nursery Report</h3>

                    <br></br>

                    <table class="table table-sm table-reports table-nursery-report">
                        <thead>
                            <tr>
                                <th class="font-weight-bold">Date</th>
                                <th class="font-weight-bold">Reference</th>
                                <th class="font-weight-bold">Crop</th>
                                <th class="font-weight-bold text-right">Quantity</th>
                                <th class="font-weight-bold">UoM</th>
                                <th class="font-weight-bold">Planted Year</th>
                                <th class="font-weight-bold text-right">Planted Area</th>
                                <th class="font-weight-bold">UoM</th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="lines" t-as="line">
                                
                                <t t-set="td_style" t-value="''"/>
                                <t t-if="line['type'] in ('list', 'total')">
                                    <t t-set="td_style" t-value="td_style + 'font-weight: bold;'"/>
                                    <t t-if="line['type'] == 'list'">
                                        <t t-set="td_style" t-value="td_style + 'background-color: #dee2e6;'"/>
                                    </t>
                                </t>

                                <t t-set="padding" t-value="'padding-left: %spx;' % (5 + (line['level'] * 20))"/>
                                
                                <tr>
                                    <td t-att-style="padding + td_style"><t t-esc="line['date']"/></td>
                                    <td t-att-style="td_style"><t t-esc="line['activity_record_id']"/></td>
                                    <td t-att-style="td_style"><t t-esc="line['product_id']"/></td>
                                    <td t-att-style="td_style" class="text-right"><t t-esc="'{0:,.2f}'.format(line['qty']) if line['qty'] else ''"/></td>
                                    <td t-att-style="td_style"><t t-esc="line['uom_id']"/></td>
                                    <td t-att-style="td_style" class="text-center"><t t-esc="line['planted_year']"/></td>
                                    <td t-att-style="td_style" class="text-right"><t t-esc="'{0:,.2f}'.format(line['planted_area']) if line['planted_area'] else ''"/></td>
                                    <td t-att-style="td_style"><t t-esc="line['area_uom_id']"/></td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                    <div class="oe_structure"/>
                </div>
            </t>
        </t>
    </template>

    <record id="paperformat_agriculture_nursery_report" model="report.paperformat">
        <field name="name">Nursery Report Paper</field>
        <field name="format">A4</field>
        <field name="orientation">Landscape</field>
        <field name="margin_top">20</field>
        <field name="margin_bottom">10</field>
        <field name="margin_left">10</field>
        <field name="margin_right">10</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">10</field>
        <field name="dpi">96</field>
    </record>

    <record id="action_print_agriculture_nursery_report" model="ir.actions.report">
        <field name="name">Nursery Report</field>
        <field name="model">agriculture.nursery.report</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">equip3_agri_operations.agriculture_nursery_report</field>
        <field name="report_file">equip3_agri_operations.agriculture_nursery_report</field>
        <field name="print_report_name">'Nursery Report'</field>
        <field name="binding_model_id" ref="model_agriculture_nursery_report"/>
        <field name="binding_type">report</field>
        <field name="paperformat_id" ref="equip3_agri_operations.paperformat_agriculture_nursery_report"/>
    </record>
</odoo>
