<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>
        <!-- tree view -->
        <record id="progressive_claim_view_tree" model="ir.ui.view">
            <field name="name">progressive.claim.view.tree</field>
            <field name="model">progressive.claim</field>
            <field name="arch" type="xml">
                <tree string="Progressive Porject Claim" multi_edit="1" sample="1">
                    <field name="active" invisible="1"/>
                    <field name="name" class="font-weight-bold"/>
                    <field name="project_id" />
                    <field name="partner_id" />
                    <field name="actual_progress" />
                    <field name="approved_progress" />
                    <field name="invoiced_progress" />
                    <field name="currency_id" invisible="1"/>
                    <field name="contract_amount" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                    <field name="total_invoice" optional="hide" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                    <field name="remaining_amount_invoiced" optional="hide" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                    <field name="total_claim" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                    <field name="remaining_amount" optional="hide" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                    <field name="company_id" groups="base.group_multi_company" optional="hide"/>
                    <field name="state" widget="badge"
                           decoration-success="state == 'done'"
                           decoration-primary2="state == 'in_progress'"
                           decoration-secondary="state == 'draft'"
                           decoration-danger2="state == 'cancel'"
                           />
                </tree>
            </field>
        </record>

        <!-- form view -->
        <record id="progressive_claim_view_form" model="ir.ui.view">
            <field name="name">progressive.claim.view.form</field>
            <field name="model">progressive.claim</field>
            <field name="arch" type="xml">
                <form string="Progressive Project Claim">
                    <header>
                        <field name="complete_progress" invisible="1" />
                        <button name="claim_confirm" string="Confirm" type="object" class="btn-primary" attrs="{'invisible': [('state', 'in', ['in_progress','done','cancel'])]}"/>
                        <button name="create_request" string="Create Claim Request" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', '|', ('state', 'in', ['draft','done','cancel']), ('show_button_request', '=', False), ('complete_progress', '=', True), '&amp;', ('claim_type', '=', 'monthly'), ('is_create_automatically', '=', True)]}"/>
                        <button name="create_invoice_dp" string="Create Down Payment Invoice" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', 'in', ['draft','done','cancel']), ('dp_able', '=', False), ('progressive_bill', '=', True)]}"/>
                        <button name="create_bill_dp" string="Create Down Payment Bill" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', 'in', ['draft','done','cancel']), ('dp_able', '=', False), ('progressive_bill', '=', False)]}"/>
                        <button name="create_invoice_progress" string="Create Progress Invoice" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', '|', ('state', 'in', ['draft','done','cancel']), ('invoiceable_progress', '=', False), ('progressive_bill', '=', True), '&amp;', ('claim_type', '=', 'monthly'), ('is_create_automatically', '=', True)]}"/>
                        <button name="create_bill_progress" string="Create Progress Bill" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', '|', ('state', 'in', ['draft','done','cancel']), ('invoiceable_progress', '=', False), ('progressive_bill', '=', False), '&amp;', ('claim_type', '=', 'monthly'), ('is_create_automatically', '=', True)]}"/>
                        <button name="create_invoice_retention1" string="Create Retention 1 Invoice" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', 'in', ['draft','done','cancel']), ('invoiceable_rent1', '=', False), ('progressive_bill', '=', True)]}"/>
                        <button name="create_bill_retention1" string="Create Retention 1 Bill" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', 'in', ['draft','done','cancel']), ('invoiceable_rent1', '=', False), ('progressive_bill', '=', False)]}"/>
                        <button name="create_invoice_retention2" string="Create Retention 2 Invoice" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', 'in', ['draft','done','cancel']), ('invoiceable_rent2', '=', False), ('progressive_bill', '=', True)]}"/>
                        <button name="create_bill_retention2" string="Create Retention 2 Bill" type="object" class="btn-primary" attrs="{'invisible': ['|', '|', ('state', 'in', ['draft','done','cancel']), ('invoiceable_rent2', '=', False), ('progressive_bill', '=', False)]}"/>
                        <!-- <button name="reset_draft" type="object" string="Set To In Progress" attrs="{'invisible': [('state', '!=', 'cancel')]}" class="btn-primary"/> -->
                        <button name="action_done" id="done_1" type="object" string="Done" attrs="{'invisible': [('state', 'in', ['draft','done','cancel'])]}" class="btn-primary"
                                confirm="Are you sure to complete this progressive claim?"/>
                        <button name="action_complete_progress" string="Complete Progress" type="object" attrs="{'invisible': ['|', '|', '|', '|', ('state', 'in', ['draft','done','cancel']), ('dp_able', '=', True), ('progress_full_invoiced', '=', True), ('complete_progress', '=', True), '&amp;', ('claim_type', '=', 'monthly'), ('is_create_automatically', '=', True)]}"/>
                        <button string="Print" name="action_print_progressive_claim" type="object"/>
                        <button name="action_cancel" type="object" string="Cancel" invisible="1" attrs="{'invisible': ['|', ('state', 'in', ['draft','done','cancel']), '&amp;', ('claim_type', '=', 'monthly'), ('is_create_automatically', '=', True)]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,in_progress,done"/>
                    </header>
                    <sheet>
                        <div name="button_box" class="oe_button_box">
                            <button name="action_view_invoice" attrs="{'invisible':['|', ('progressive_bill','=',True), ('count_invoice', '=', 0)]}" 
                                    type="object" class="oe_stat_button" icon="o-hm-smart-construction-invoices">
                                <field name="count_invoice"
                                    string="Invoices"
                                    widget="statinfo"/>
                            </button>
                            <button name="action_view_invoice" attrs="{'invisible':['|', ('progressive_bill','=', False), ('count_bill', '=', 0)]}" 
                                    type="object" class="oe_stat_button" icon="o-hm-smart-construction-bills">
                                <field name="count_bill" 
                                    string="Bills"
                                    widget="statinfo"/>
                            </button>
                            <button name="action_work_order" attrs="{'invisible':['|', ('progressive_bill','=',True), ('total_work_order', '=', 0)]}"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="o-hm-smart-construction-job-order">
                                <field name="total_work_order" string="Job Order" widget="statinfo"/>
                            </button>
                            <button name="action_work_order_sub" attrs="{'invisible':['|', ('progressive_bill','=',False), ('total_work_order', '=', 0)]}"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="o-hm-smart-construction-job-order">
                                <field name="total_work_order" string="Job Order" widget="statinfo"/>
                            </button>   
                        </div>
                        <div class="oe_title oe_left">
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group name="main_form">
                            <group name="left_section_main">
                                <field name="active" invisible="1"/>
                                <field name="progressive_bill" invisible="1"/>
                                <field name="project_id" required="1"
                                       attrs="{'readonly': [('state', 'in', ['in_progress','done','cancel'])]}"/>
                                <field name="partner_id" 
                                       attrs="{'invisible':[('progressive_bill','=',True)], 'readonly': [('state', 'in', ['in_progress','done','cancel'])], 'required':[('progressive_bill','=',False)]}" />
                                <field name="vendor" 
                                       attrs="{'invisible':[('progressive_bill','=',False)], 'required':[('progressive_bill','=',True)], 'readonly': [('state', 'in', ['in_progress','done','cancel'])]}" /> 
                                <field name="partner_invoice_id" attrs="{'invisible':[('progressive_bill','=',True)]}"
                                       options="{'no_create': True, 'no_quick_create':True,'no_create_edit':True}"/>
                                <field name="partner_bill_id"  attrs="{'invisible':[('progressive_bill','=',False)]}"
                                       options="{'no_create': True, 'no_quick_create':True,'no_create_edit':True}"/>
                                <field name="company_currency_id" />
                                <field name="currency_id" string="Currency" invisible="1"/>
                                <field name="analytic_idz" widget="many2many_tags" attrs="{'readonly': [('state', 'in', ['in_progress','done','cancel'])]}"/>
                                <field name="project_director" invisible="1" string='Project Manager'/>
                                <field name="start_date" attrs="{'invisible':[('progressive_bill','=',True)]}" invisible="1"/>
                                <field name="end_date" attrs="{'invisible':[('progressive_bill','=',True)]}" invisible="1"/>
                                <field name="is_create_automatically" invisible="1" force_save="1"/>
                                <field name="claim_type" invisible="1" force_save="1"/>                                  
                                <label for="actual_progress" />
                                <div>
                                    <field name="actual_progress" />
                                    <label for="actual_progress" string="%%"  class="oe_inline"/>
                                </div>
                                <label for="approved_progress" />
                                <div>
                                    <field name="approved_progress" />
                                    <label for="approved_progress" string="%%"  class="oe_inline"/>
                                </div>
                                <label for="invoiced_progress" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',True)]}">
                                    <field name="invoiced_progress"  />
                                    <label for="invoiced_progress" string="%%"  class="oe_inline"/>
                                </div>
                                <label for="invoiced_progress" string="Billed Progress" attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',False)]}">
                                    <field name="invoiced_progress"  />
                                    <label for="invoiced_progress" string="%%"  class="oe_inline"/>
                                </div>
                            </group>
                            <group name="right_section_main">
                                <field name="contract_parent" 
                                       domain="[('project_id', '=', project_id), ('vo_payment_type', '=', 'split'), ('state', '=', 'sale')]"
                                       attrs="{'invisible':[('progressive_bill','=',True)], 'required':[('progressive_bill','=',False)], 'readonly': [('state', 'in', ['in_progress','done','cancel'])]}"/> 
                                <field name="contract_parent_po" 
                                       attrs="{'invisible':[('progressive_bill','=',False)], 'required':[('progressive_bill','=',True)], 'readonly': [('state', 'in', ['in_progress','done','cancel'])]}"
                                       domain="[('project', '=', project_id), ('addendum_payment_method', '=', 'split_payment'), ('state', '=', 'purchase'), ('is_subcontracting', '=', 'True')]" />
                                <field name="po_subcon_line_id" attrs="{'invisible':[('progressive_bill','=',False)]}" readonly="1" invisible="1" force_save='1'/>
                                <field name="contract_amount" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                <label for="down_payment" string="Down Payment"/> 
                                <div class="d-flex" readonly='1'>
                                    <field name="dp_method" force_save="1" required="1" readonly='1'
                                           placeholder="Method"/>
                                    <span class="oe_inline o_form_label mx-3 oe_read_only"> Amount </span>
                                    <span class="oe_inline o_form_label mx-3 oe_edit_only"> Amount </span>
                                    <field name="down_payment" required="1" readonly='1' force_save="1"
                                           placeholder="Amount"/>
                                    <label for="down_payment" string="%%"  class="oe_inline"
                                           attrs="{'invisible': [('dp_method', '!=', 'per')]}"/>
                                </div>
                                <field name="dp_amount" readonly="1" invisible="1" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                <label for="retention1" string="Retention 1"/>
                                <div>
                                    <field name="retention1"  readonly='1' force_save="1"/>
                                    <label for="retention1" string="%%"  class="oe_inline"/>
                                    <span attrs="{'invisible': ['|', ('invoiceable_rent1', '=', False), ('state','in',('draft', 'cancel'))]}" class="oe_inline o_form_label mx-3"> Expected Date </span>
                                    <field name="expected_retention1" force_save="1" attrs="{'invisible': [('invoiceable_rent1', '=', False)]}"/>
                                </div>
                                <!-- add expected retention date -->
                                <field name="expected_retention1" readonly='1' invisible='1'/>
                                <field name="retention1_amount" readonly='1' force_save="1" invisible="1"/>
                                <label for="retention2" string="Retention 2"/>
                                <div>
                                    <field name="retention2"  readonly='1' force_save="1"/>
                                    <label for="retention2" string="%%"  class="oe_inline"/>
                                    <span attrs="{'invisible': ['|', ('invoiceable_rent1', '=', False), ('state','in',('draft', 'cancel'))]}" class="oe_inline o_form_label mx-3"> Expected Date </span>
                                    <field name="expected_retention2" force_save="1" attrs="{'invisible': [('invoiceable_rent1', '=', False)]}"/>
                                </div>
                                <!-- add expected retention date -->
                                <field name="expected_retention2" readonly='1' invisible='1'/>
                                <field name="retention2_amount" readonly='1' force_save="1" invisible="1"/>
                                <field name="tax_id" widget="many2many_tags" readonly="1"/>
                                <field name="vat_tax" widget="many2many_tags" invisible="1" readonly='1' force_save="1"/>
                                <field name="income_tax" widget="many2many_tags" invisible="1" readonly='1' force_save="1"/>
                                <field name="payment_term" options="{'no_create': True, 'no_quick_create': True, 'no_create_edit':True}" readonly='1' force_save="1" invisible="1"/>
                                <!-- <field name="company_id" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <field name="branch_id" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <field name="company_currency_id" attrs="{'invisible':[('progressive_bill','=',True)]}"/> -->
                                <field name="company_id" readonly="1"/>
                                <field name="branch_id" required="1" readonly="1" force_save="1"/>
                                <field name="create_uid" string="Created By"/>
                                <field name="create_date" string="Creation Date"/>
                                <field name="reason_complete_progress" readonly='1' force_save="1" attrs="{'invisible':[('reason_complete_progress','=', False)]}"/>  
                            </group>
                            <group invisible="1">
                                <field name="dp_able" />
                                <field name="request" />
                                <field name="request_2" />
                                <field name="claim_request" />
                                <field name="show_claim_request" />
                                <field name="show_journal_account" />
                                <field name="claim_request_filled" />
                                <field name="invoiceable" />
                                <field name="invoiceable_progress" />
                                <field name="requested_progress" />
                                <field name="progress_full_approved" />
                                <field name="retention1_able" />
                                <field name="retention2_able" />
                                <field name="show_button_request" />
                                <field name="clear_status" />
                            </group>
                            <group invisible="1">
                                <field name="progress_full_invoiced" />
                                <field name="invoiceable_rent1" />
                                <field name="rent1_avail" />
                                <field name="rent2_avail" />
                                <field name="invoiceable_rent2" />
                                <field name="rent2_invoice" />
                                <field name="retention1_paid"/>
                                <field name="retention2_paid"/>
                                <field name="progress_done_complete"/>
                                <field name="count_contract_so" />
                                <field name="count_contract_po" />
                                <field name="count_claim_so" />
                                <field name="count_claim_po" />
                                <field name="department_type"/>
                                <field name="project_contract"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="claim_request" string="Claim Request" attrs="{'invisible': [('show_claim_request', '=', False)]}">
                                <field name="claim_request_ids" widget="one2many_list" class="o_claim_request" readonly="1">
                                    <tree editable='bottom'>
                                        <field name="active" invisible="1"/>
                                        <field name="sr_no"/>
                                        <field name="progressive_bill" invisible="1"/>
                                        <field name="request_for" invisible="1"/>
                                        <field name="name" force_save="1"/>
                                        <field name="partner_id" 
                                               attrs="{'column_invisible': [('parent.progressive_bill', '=', True)]}"/>
                                        <field name="vendor" 
                                               attrs="{'column_invisible': [('parent.progressive_bill', '=', False)]}"/>
                                        <field name="create_uid" string="Created By"/>
                                        <field name="create_date" string="Creation Date"/>
                                        <field name="requested_progress" />
                                        <field name="requested_progress_2" invisible="1" />
                                        <field name="approved_progress" invisible="1" />
                                        <field name="state" readonly="1" 
                                               widget="badge"
                                               decoration-success="state == 'approved'"
                                               decoration-info="state == 'to_approve'"
                                               decoration-danger="state == 'rejected'"
                                               />
                                        <button name="line_delete" type="object" class="btn fa fa-trash-o oe_edit_only"
                                                confirm="This claim request have journal entry, are you sure you want to delete this claim request? (Created journal entry will be deleted)"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="new_journal_ids" string="Journal Entries" attrs="{'invisible': [('show_journal_account', '=', False)]}">
                                <field name="project_account_claim_ids" widget="one2many_list" readonly="1" force_save="1">
                                    <tree>
                                        <control>
                                            <create name="add_product_control" string="Add an entry"/>
                                        </control>
                                        <field name="sequence" invisible="1"/>
                                        <field name="sr_no"/>
                                        <field name="journal_claim_id" invisible="1"/>
                                        <field name="journal_entry"/>
                                        <field name="request_id" string="Request ID" />
                                        <field name="ref" invisible="1"/>
                                        <field name="journal_id" invisible="1"/>
                                    </tree>
                                    <form string="Journal Entries">
                                        <header>
                                            <button name="action_post" string="Confirm" type="object" class="btn-primary" attrs="{'invisible': [('state', '=', 'posted')]}"/>
                                            <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
                                        </header>
                                        <sheet>
                                            <div class="oe_title oe_left">
                                                <h1>
                                                    <field name="journal_entry"/>
                                                </h1>
                                            </div>
                                            <group name="main">
                                                <group>
                                                    <field name="project_id"/>
                                                    <field name="progressive_bill" invisible="1"/>
                                                    <field name="contract_parent" attrs="{'invisible': [('progressive_bill', '=', True)]}"/>
                                                    <field name="contract_parent_po" attrs="{'invisible': [('progressive_bill', '=', False)]}"/>
                                                    <field name="request_id" />
                                                    <field name="attn" />
                                                    <field name="analytic_group_ids" widget="many2many_tags"/>
                                                    <field name="journal_entries_template"/>
                                                    <field name="ref"/>
                                                    <field name="department_type" invisible="1"/>
                                                </group>
                                                <group>
                                                    <field name="period_id" />
                                                    <field name="fiscal_year" />
                                                    <field name="date" />
                                                    <label for="journal_id"/>
                                                    <div name="journal_div" class="d-flex">
                                                        <field name="journal_id"/>
                                                        <span class="oe_inline o_form_label mx-3 oe_read_only"> in </span>
                                                        <span class="oe_inline o_form_label mr-3 ml-5 oe_edit_only"> in </span>
                                                        <field name="currency_id"/>
                                                    </div>
                                                    <field name="company_id" />
                                                    <field name="branch_id" />
                                                    <field name="name" invisible="1"/>
                                                </group>
                                            </group>
                                            <group>
                                                <notebook>
                                                    <page name="journal_items" string="Journal Items">
                                                        <field name="line_ids">
                                                            <tree create="false" delete="false" edit="false" editable="bottom">
                                                                <field name="account_id"/>
                                                                <field name="project_scope" optional="hide"/>
                                                                <field name="section" optional="hide"/>
                                                                <field name="group_of_product" optional="hide"/>
                                                                <field name="name" optional="hide"/>
                                                                <field name="analytic_tag_ids" optional="hide"/>
                                                                <field name="amount_currency" optional="hide"/>
                                                                <field name="tax_ids" optional="hide"/>
                                                                <field name="tax_tag_ids" optional="hide"/>
                                                                <field name="currency_id"/>
                                                                <field name="debit" sum='total_debit'/>
                                                                <field name="credit" sum='total_credit'/>
                                                                <field name="company_id" invisible="1"/>
                                                            </tree>
                                                        </field>
                                                    </page>
                                                </notebook>
                                            </group>
                                        </sheet>
                                    </form>
                                </field>
                            </page> 
                            <page name="claim" string="Claim History">
                                <field name="claim_ids" widget="one2many_list" class="o_claim_history_line" readonly="1">
                                    <tree editable='bottom'>
                                        <field name="active" invisible="1"/>
                                        <field name="sr_no"/>
                                        <field name="progressive_bill" invisible="1"/>
                                        <field name="date"/>
                                        <field name="claim_name"/>
                                        <field name="claim_for" optional='hide'/>
                                        <field name="progressline"/>
                                        <field name="progress" invisible="1"/>
                                        <field name="gross_amount"/>
                                        <field name="dp_deduction"/>
                                        <field name="retention_deduction" />
                                        <field name="amount_deduction" />
                                        <field name="paid_invoice" attrs="{'column_invisible':[('parent.progressive_bill','=',True)]}"/>
                                        <field name="paid_bill" attrs="{'column_invisible':[('parent.progressive_bill','=',False)]}"/>
                                        <field name="amount_untaxed" widget='monetary' options="{'currency_field': 'currency_id'}" />
                                        <field name="tax_id" optional='hide' widget="many2many_tags"/>
                                        <field name="tax_amount" />
                                        <field name="amount_invoice"  attrs="{'column_invisible':[('parent.progressive_bill','=',True)]}"/>
                                        <field name="amount_bill" attrs="{'column_invisible':[('parent.progressive_bill','=',False)]}"/>
                                        <field name="amount_claim" widget='monetary'/>
                                        <field name="remaining_amount" widget='monetary'/>
                                        <field name="invoice_status"  attrs="{'column_invisible':[('parent.progressive_bill','=',True)]}"/>
                                        <field name="bill_status" attrs="{'column_invisible':[('parent.progressive_bill','=',False)]}"/>
                                        <field name="payment_status" />
                                        <field name="company_id" invisible="1" />
                                        <field name="currency_id" invisible="1"/>
                                        <field name="billed_amount" invisible="1" force_save='1' widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                        <field name="purchased_amount" invisible="1" force_save='1' widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    </tree>
                                </field>
                                <group name="bottom_fields">
                                    <group class="oe_subtotal_footer oe_right" colspan="2" name="total_variable_estimate" attrs="{'invisible': [('progressive_bill', '=', True)]}">
                                        <field name="total_invoice" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                        <field name="total_claim" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                        <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                            <label for="remaining_amount" />
                                        </div>
                                        <field name="remaining_amount" nolabel="1" class="oe_subtotal_footer_separator" 
                                            widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    </group>
                                    <group class="oe_subtotal_footer oe_right" colspan="2" name="total_variable_estimate_sub" attrs="{'invisible': [('progressive_bill', '=', False)]}">
                                        <field name="total_invoice" string="Total Amount Billed" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                        <field name="total_claim" string="Total Amount Paid" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                        <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                            <label for="remaining_amount" />
                                        </div>
                                        <field name="remaining_amount" nolabel="1" class="oe_subtotal_footer_separator" 
                                            widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    </group>
                                    <group >
                                    <!-- attrs="{'invisible': ['|', ('count_claim_so', '&lt;', 1), ('count_claim_po', '&lt;', 1)]}" -->
                                        <field name="taxes_ids" widget="one2many_list" nolabel="1" class='o_taxes_line' readonly="1">
                                            <tree editable="bottom">
                                                <field name="sr_no" readonly="1" />
                                                <field name="tax_id" force_save="1"/>
                                                <field name="currency_id" string="Currency" invisible="1"/>
                                                <field name="amount_tax" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                            </tree>
                                        </field>
                                    </group>
                                </group>    
                            </page>
                            <page string="Related Contracts" name="related_contract_so_ids" attrs="{'invisible': ['|', ('progressive_bill','=',True), ('count_contract_so', '&lt;', 2)]}">
                                <group> 
                                    <field name="related_contract_so_ids" widget="many2many_list" nolabel="1" readonly="1" force_save="1"/>
                                </group>
                            </page>
                            <page string="Related Contracts" name="related_contract_po_ids" attrs="{'invisible': ['|', '|', ('progressive_bill','=',False), ('department_type','=','department'), ('count_contract_po', '&lt;', 2)]}">
                                <group> 
                                    <field name="related_contract_po_ids" widget="many2many_list" nolabel="1" readonly="1" force_save="1"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter" name="chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
    
        <record id="claim_request_view" model="ir.ui.view">
            <field name="name">claim.request.view</field>
            <field name="model">claim.request.line</field>
            <field name="arch" type="xml">
                <form string="Claim Request" create="false" edit="false">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible="to_approve,approved" attrs="{'invisible' : [('state', 'in', 'rejected')]}"/>   
                        <field name="state2" widget="statusbar" statusbar_visible="to_approve,rejected" attrs="{'invisible' : [('state', '!=', 'rejected')]}"/>
                    </header>
                    <header>
                        <field name="show_approval_buttons" invisible="1"/>
                        <button name="confirm_request" string="Approve" invisible="1" type="object" class="btn-primary" attrs="{'invisible': ['|', ('state', 'in', ['draft','approved','rejected']), ('show_approval_buttons', '=', False)]}"/>
                        <button name="action_reject" string="Reject" invisible="1" type="object" attrs="{'invisible': ['|', ('state', 'in', ['draft','approved','rejected']), ('show_approval_buttons', '=', False)]}"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" force_save="1"/>
                                <field name="request_id" invisible="1" 
                                       options="{'no_open': True}"/>
                            </h1>
                        </div>
                        <group invisible="1">
                            <group>
                                <field name="request_for"/>
                            </group>
                        </group>
                        <group name="main_form">
                            <group name="left_section_main">
                                <field name="active" invisible="1"/>
                                <field name="claim_id" string='Progressive Claim'/>
                                <field name="project_id" />
                                <field name="contract_parent" 
                                       attrs="{'invisible':[('progressive_bill','=',True)]}"/> 
                                <field name="contract_parent_po" attrs="{'invisible': [('progressive_bill', '=', False)]}"/>
                                <field name="partner_id"  attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <field name="vendor"  attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <field name="journal_entry"/>
                                <field name="progressive_bill" invisible="1"/>
                                <field name="department_type" invisible="1"/>
                            </group>
                            <group name="right_section_main">
                                <field name="project_director" string='Project Manager'/>
                                <field name="company_id" />
                                <field name="branch_id" />
                                <field name="create_uid" string="Created By"/>
                                <field name="create_date" string="Creation Date"/>
                                <field name="claim_id" invisible="1"/>
                                <field name="currency_id" string="Currency" invisible="1"/>
                            </group>
                            <group attrs="{'invisible': [('request_for', '!=', 'down_payment')]}">
                                <group>
                                    <field name="contract_amount" force_save="1" readonly="1" invisible="1"/>
                                    <label for="requested_progress" string="Requested Down Payment"/>
                                        <div>
                                            <field name="requested_progress" class="oe_inline" force_save="1" readonly="1"/>
                                            <label for="requested_progress" string="%%"  class="oe_inline"/>
                                        </div>          
                                </group>
                            </group>
                            <group attrs="{'invisible': [('request_for', '!=', 'progress')]}">
                                <group>
                                    <field name="contract_amount" force_save="1" readonly="1" invisible="1"/>
                                    <label for="requested_progress" />
                                        <div>
                                            <field name="requested_progress" class="oe_inline" readonly="1" force_save="1"/>
                                            <label for="requested_progress" string="%%"  class="oe_inline"/>
                                        </div>
                                </group>
                            </group>
                            <group attrs="{'invisible': [('request_for', '!=', 'retention1')]}">
                                <group>
                                    <field name="contract_amount" force_save="1" readonly="1" invisible="1"/>
                                    <label for="requested_progress" string="Requested Retention 1"/>
                                        <div>
                                            <field name="requested_progress" class="oe_inline" force_save="1" readonly="1"/>
                                            <label for="requested_progress" string="%%"  class="oe_inline"/>
                                        </div>
                                </group>
                            </group>
                            <group attrs="{'invisible': [('request_for', '!=', 'retention2')]}">
                                <group>
                                    <field name="contract_amount" force_save="1" readonly="1" invisible="1"/>
                                    <label for="requested_progress" string="Requested Retention 2"/>
                                        <div>
                                            <field name="requested_progress" class="oe_inline" force_save="1" readonly="1"/>
                                            <label for="requested_progress" string="%%"  class="oe_inline"/>
                                        </div>
                                </group>
                            </group>
                            <group>
                                <group>
                                    <field name="amount_approved" invisible="1"/>
                                    <field name="max_claim" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                </group>         
                            </group>
                            <group invisible="1"> 
                                <field name="last_progress" force_save="1"/>
                                <field name="account_1" force_save="1"/>
                                <field name="account_2" force_save="1"/>
                                <field name="account_3" force_save="1"/>
                                <field name="account_4" force_save="1"/>
                            </group>
                            <group invisible="1">  
                                <field name="contract_amount"/>
                                <field name="down_payment"/>
                                <field name="retention1"/>
                                <field name="retention1_amount" />
                                <field name="retention2"/>
                                <field name="retention2_amount" />
                            </group>
                        </group>
                        <group>
                            <group>
                            </group>
                            <group invisible="1">
                                <field name="approved_date" attrs="{'invisible': [('state', '!=', 'approved')]}"/>
                                <field name="rejected_date" attrs="{'invisible': [('state', '!=', 'rejected')]}"/>
                                <field name="rejected_reason" attrs="{'invisible': [('state', '!=', 'rejected')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="request_ids" string="Request Lines" attrs="{'invisible': [('request_for', '!=', 'progress')]}">
                                <field name="request_ids" widget="one2many_list" class="o_request_line_wiz" readonly="1">
                                    <tree editable='bottom'>
                                        <field name="sequence" invisible="1"/>
                                        <field name="sr_no"/>
                                        <field name="progressive_bill" invisible="1"/>
                                        <field name="work_order" string="Job Order" attrs="{'column_invisible':[('parent.progressive_bill','=',True)]}"/>
                                        <field name="work_order_sub" string="Job Order" attrs="{'column_invisible':[('parent.progressive_bill','=',False)]}"/>
                                        <field name="wo_prog_temp" invisible="1"/>
                                        <field name="stage" invisible="1"/>
                                        <field name="stage_new" attrs="{'column_invisible':[('parent.progressive_bill','=',True)]}"/>
                                        <field name="worker_assigned_to"/>
                                        <field name="assigned_to" invisible="1"/>
                                        <field name="completion_date" optional="hide"/>
                                        <field name="stage_weightage" optional="hide"
                                               attrs="{'column_invisible':[('parent.progressive_bill','=',True)]}"/>
                                        <field name="work_subcon_weightage" optional="hide"
                                               attrs="{'column_invisible':[('parent.progressive_bill','=',False)]}" />
                                        <field name="work_weightage" optional="hide"/>
                                        <field name="last_progress" optional="hide" />
                                        <field name="work_progress" optional="hide" />
                                        <field name="progress"/>
                                        <field name="state" invisible="1"/>
                                        <field name="claim_id" invisible="1"/>
                                        <field name="contract_parent" invisible="1"/>
                                        <field name="contract_parent_po" invisible="1"/>
                                        <field name="task_contract_po" invisible="1"/>
                                        <field name="department_type" invisible="1"/>
                                        <field name="project_id" invisible="1"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter" name="chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="claim_request_line_view" model="ir.ui.view">
            <field name="name">claim.request.line.view</field>
            <field name="model">request.from.line</field>
            <field name="arch" type="xml">
                <form string="Request Lines">
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="work_order" string="Job Order" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <field name="work_order_sub"  string="Job Order" attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                            </h1>
                        </div>
                        <group name="main_form">
                            <group name="left_section_main">
                                <field name="progressive_bill" invisible="1"/>
                                <field name="stage" invisible="1"/>
                                <field name="stage_new"/>
                                <field name="stage_weightage"
                                       attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <field name="work_subcon_weightage"
                                       attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <field name="work_weightage" />
                                <field name="last_progress" />
                                <field name="work_progress"/>
                            </group>
                            <group name="right_section_main">
                                <field name="completion_date"/>
                                <field name="assigned_to"/>
                                <field name="progress" />
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="progressive_bill_view_tree" model="ir.ui.view">
            <field name="name">progressive.bill.view.tree</field>
            <field name="model">progressive.claim</field>
            <field name="arch" type="xml">
                <tree string="Progressive Porject Claim" multi_edit="1" sample="1">
                    <field name="active" invisible="1"/>
                    <field name="name" class="font-weight-bold"/>
                    <field name="project_id" />
                    <field name="vendor" />
                    <field name="actual_progress" />
                    <field name="approved_progress" />
                    <field name="invoiced_progress" />
                    <field name="contract_amount" />
                    <field name="total_invoice" string="Total Amount Billed" optional="hide"/>
                    <field name="remaining_amount_invoiced" optional="hide" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                    <field name="total_claim" string="Total Amount Paid"/>
                    <field name="remaining_amount" string="Remaining Amount to Claim" optional="hide"/>
                    <field name="company_id" groups="base.group_multi_company"/>
                    <field name="state" widget="badge"
                           decoration-success="state == 'done'"
                           decoration-info="state == 'in_progress'"
                           />
                </tree>
            </field>
        </record>

        <record id="claim_request_view_tree" model="ir.ui.view">
            <field name="name">claim.request.view.tree</field>
            <field name="model">claim.request.line</field>
            <field name="arch" type="xml">
                <tree multi_edit="1" sample="1" create="false" edit="false">
                    <field name="active" invisible="1"/>
                    <field name="name"/>
                    <field name="claim_id" string='Progressive Claim' readonly='1'/>
                    <field name="project_id"/>
                    <field name="partner_id" />
                    <field name="create_uid" string="Created By"/>
                    <field name="create_date" string="Creation Date"/>
                    <field name="requested_progress" readonly='1'/>
                    <field name="state" 
                            widget="badge"
                            decoration-success="state == 'approved'"
                            decoration-info="state == 'to_approve'"
                            decoration-danger="state == 'rejected'"
                            />
                    <field name="requested_progress_2" invisible="1" />
                    <field name="approved_progress" invisible="1" />
                    <field name="progressive_bill" invisible="1"/>
                    <field name="request_for" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="claim_request_bill_view_tree" model="ir.ui.view">
            <field name="name">claim.request.bill.view.tree</field>
            <field name="model">claim.request.line</field>
            <field name="arch" type="xml">
                <tree multi_edit="1" sample="1" create="false" edit="false">
                    <field name="active" invisible="1"/>
                    <field name="name"/>
                    <field name="claim_id" string='Progressive Claim' readonly='1'/>
                    <field name="project_id"/>
                    <field name="vendor" />
                    <field name="create_uid" string="Created By"/>
                    <field name="create_date" string="Creation Date"/>
                    <field name="requested_progress" readonly='1'/>
                    <field name="state" 
                            widget="badge"
                            decoration-success="state == 'approved'"
                            decoration-info="state == 'to_approve'"
                            decoration-danger="state == 'rejected'"
                            />
                    <field name="requested_progress_2" invisible="1" />
                    <field name="approved_progress" invisible="1" />
                    <field name="progressive_bill" invisible="1"/>
                    <field name="request_for" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- action -->
        <record id="progressive_claim_action" model="ir.actions.act_window">
            <field name="name">Progressive Claim</field>
            <field name="res_model">progressive.claim</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('department_type', '=', 'project'), ('progressive_bill', '=', False)]</field>
            <field name="context">{'default_department_type': 'project', 'default_progressive_bill':False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No Progressive Claim found. Let's create one!
                </p>
            </field>
        </record>

        <record id="progressive_bill_view_action" model="ir.actions.act_window">
            <field name="name">Progressive Claim</field>
            <field name="res_model">progressive.claim</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('progressive_bill', '=', True)]</field>
            <field name="context">{'default_department_type': False, 'default_progressive_bill': True}</field> 
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No Progressive Claim found. Let's create one!
                </p>
            </field>
        </record>

        <record id="claim_request_action" model="ir.actions.act_window">
            <field name="name">Claim Request</field>
            <field name="res_model">claim.request.line</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('department_type', '=', 'project'), ('progressive_bill', '=', False)]</field>
            <field name="context">{'default_department_type': 'project', 'default_progressive_bill':False}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No Claim Request found. Let's create one!
                </p>
            </field>
        </record>

        <record id="claim_request_bill_action" model="ir.actions.act_window">
            <field name="name">Claim Request</field>
            <field name="res_model">claim.request.line</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('progressive_bill', '=', True)]</field>
            <field name="context">{'default_department_type': False, 'default_progressive_bill': True}</field> 
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No Claim Request found. Let's create one!
                </p>
            </field>
        </record>

        <record id="progressive_claim_view_action_window" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="equip3_construction_accounting_operation.progressive_claim_view_tree"/>
            <field name="act_window_id" ref="progressive_claim_action"/>
        </record>

        <record id="progressive_bill_view_action_window" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="equip3_construction_accounting_operation.progressive_bill_view_tree"/>
            <field name="act_window_id" ref="progressive_bill_view_action"/>
        </record>

        <record id="claim_request_view_action_window" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="equip3_construction_accounting_operation.claim_request_view_tree"/>
            <field name="act_window_id" ref="claim_request_action"/>
        </record>

        <record id="claim_request_bill_view_action_window" model="ir.actions.act_window.view">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="equip3_construction_accounting_operation.claim_request_bill_view_tree"/>
            <field name="act_window_id" ref="claim_request_bill_action"/>
        </record>

        <record id="progressive_claim_action_form" model="ir.actions.act_window">
            <field name="name">Progressive Claim Form</field>
            <field name="res_model">progressive.claim</field>
            <field name="view_mode">form</field>
            <field name="context">{'res_id': active_id}</field>
        </record>

        <record id="action_Progressive_claim" model="ir.actions.act_window">
            <field name="name">Progressive Claim</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">progressive.claim</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record id="action_claim_request" model="ir.actions.act_window">
            <field name="name">Claim Request</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">claim.request.line</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!-- menu -->
        <menuitem
            id="claim_ar_menu"
            name="Progressive Claim"
            parent="account.menu_finance_receivables"
            sequence="-1"/>

        <menuitem
            id="progressive_claim_menu"
            name="Progressive Claim"
            action="progressive_claim_action"
            parent="claim_ar_menu"
            sequence="1"/>
        
        <menuitem
            id="claim_request_menu"
            name="Claim Request"
            action="claim_request_action"
            parent="claim_ar_menu"
            sequence="2"/>
        
        <menuitem
            id="progressive_bill_menu"
            name="Progressive Claim"
            parent="account.menu_finance_payables"
            sequence="-1"/> 
        
        <menuitem
            id="progressive_claim_bill_menu"
            name="Progressive Claim"
            action="progressive_bill_view_action"
            parent="progressive_bill_menu"
            sequence="1"/> 
        
        <menuitem
            id="claim_request_bill_menu"
            name="Claim Request"
            action="claim_request_bill_action"
            parent="progressive_bill_menu"
            sequence="2"/> 

    </data>

</odoo>
