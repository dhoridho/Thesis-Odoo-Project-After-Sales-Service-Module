<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="create_progressive_invoice_form" model="ir.ui.view">
        <field name="name">create.progressive.invoice.form</field>
        <field name="model">progressive.invoice.wiz</field>
        <field name="arch" type="xml">
            <form string="Create Progressive Invoice">
                <sheet>
                    <field name="claim_type" invisible="1" />
                    <group attrs="{'invisible':['&amp;', ('claim_type', '!=', 'milestone'), ('invoice_for', '!=', 'progress')]}">
                        <h1><field name="milestone_id" readonly="1" force_save="1" /></h1>
                    </group>
                    <group string="General Information">
                        <group>
                            <field name="progressive_claim_id" invisible="1" force_save="1"/>
                            <field name="invoice_for" string="Invoice Type" readonly="1" attrs="{'invisible': [('progressive_bill', '=', True)]}"/>
                            <field name="invoice_for" string="Bill Type" readonly="1" attrs="{'invisible': [('progressive_bill', '=', False)]}"/>
                            <field name="po_subcon_line_id" attrs="{'invisible':[('progressive_bill','=',False)]}" readonly="1" invisible="1" force_save='1'/>
                            <field name="progressive_bill" invisible="1"/>
                            <field name="currency_id" invisible="1"/>
                        </group>
                    </group>
                    <group attrs="{'invisible': [('invoice_for', '!=', 'progress')]}">
                        <group>
                            <field name="contract_amount" force_save="1" readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <label for="last_progress" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',True)]}">
                                    <field name="last_progress"  readonly="1" force_save="1"/>
                                    <label for="last_progress" string="%%"  class="oe_inline"/>
                                    (<field name="last_amount" class="oe_inline" force_save="1"  readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>)
                                </div>
                            <label for="last_progress" string="Last Bill Progress" attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',False)]}">
                                    <field name="last_progress"  readonly="1" force_save="1"/>
                                    <label for="last_progress" string="%%"  class="oe_inline"/>
                                    (<field name="last_amount" class="oe_inline" force_save="1" readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>)
                                </div>
                            <label for="approved_progress" />
                                <div>
                                    <field name="approved_progress"  readonly="1" force_save="1"/>
                                    <label for="approved_progress" string="%%"  class="oe_inline"/>
                                    (<field name="approved_amount" class="oe_inline" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>)
                                </div>
                        </group>
                        <group>
                            <field name="method" attrs="{'required': [('invoice_for', 'in', 'progress')], 'readonly':[('claim_type', '=', 'milestone'), ('milestone_id', '!=', False)]}" force_save="1" invisible="1"/>
                            <label for="invoice_progress" string="Invoice progress" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',True)]}">
                                    <field name="invoice_progress" required="1" class="oe_inline" attrs="{'readonly':[('claim_type', '=', 'milestone'), ('milestone_id', '!=', False)]}" force_save="1" />
                                    <label for="invoice_progress" string="%%" attrs="{'invisible': [('method', '!=', 'per')]}"/>
                                </div>
                            <label for="invoice_progress" string="Bill progress" attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',False)]}">
                                    <field name="invoice_progress" required="1" class="oe_inline" attrs="{'readonly':[('claim_type', '=', 'milestone'), ('milestone_id', '!=', False)]}" force_save="1"/>
                                    <label for="invoice_progress" string="%%" attrs="{'invisible': [('method', '!=', 'per')]}"/>
                                </div>
                        </group>
                    </group>
                    <group attrs="{'invisible': [('invoice_for', '=', 'progress')]}">
                        <group>
                            <field name="contract_amount" force_save="1" readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <label for="down_payment" attrs="{'invisible': [('invoice_for', '!=', 'down_payment')]}"/>
                                <div attrs="{'invisible': [('invoice_for', '!=', 'down_payment')]}">
                                    <field name="down_payment" readonly="1" />
                                    <label for="down_payment" string="%%"  class="oe_inline"/>
                                </div>
                            <field name="dp_amount" readonly="1" attrs="{'invisible': [('invoice_for', '!=', 'down_payment')]}" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <label for="retention1" attrs="{'invisible': [('invoice_for', '!=', 'retention1')]}"/>
                                <div attrs="{'invisible': [('invoice_for', '!=', 'retention1')]}">
                                    <field name="retention1" readonly="1" />
                                    <label for="retention1" string="%%"  class="oe_inline"/>
                                </div>
                            <field name="retention1_amount" readonly="1" attrs="{'invisible': [('invoice_for', '!=', 'retention1')]}" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <label for="retention2" attrs="{'invisible': [('invoice_for', '!=', 'retention2')]}"/>
                                <div attrs="{'invisible': [('invoice_for', '!=', 'retention2')]}">
                                    <field name="retention2" readonly="1" />
                                    <label for="retention2" string="%%"  class="oe_inline"/>
                                </div>
                            <field name="retention2_amount" readonly="1" attrs="{'invisible': [('invoice_for', '!=', 'retention2')]}" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>
                        <group attrs="{'invisible': [('invoice_for', 'in', (False, 'retention1', 'retention2'))]}">
                            <label for="last_progress" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',True)]}">
                                    <field name="last_progress"  readonly="1" force_save="1"/>
                                    <label for="last_progress" string="%%"  class="oe_inline"/>
                                    (<field name="last_amount" class="oe_inline" force_save="1" readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>)
                                </div>
                            <label for="last_progress" string="Last Bill Progress" attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',False)]}">
                                    <field name="last_progress"  readonly="1" force_save="1"/>
                                    <label for="last_progress" string="%%"  class="oe_inline"/>
                                    (<field name="last_amount" class="oe_inline" force_save="1" readonly="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>)
                                </div>
                            <field name="method" attrs="{'required': [('invoice_for', 'in', ('down_payment','retention1','retention2'))], 'readonly':[('claim_type', '=', 'milestone'), ('milestone_id', '!=', False)]}" force_save="1" invisible="1"/>
                            <label for="invoice_progress" string="Invoice progress" attrs="{'invisible':[('progressive_bill','=',True)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',True)]}">
                                    <field name="invoice_progress" required="1" class="oe_inline" attrs="{'readonly':[('claim_type', '=', 'milestone'), ('milestone_id', '!=', False)]}" force_save="1"/>
                                    <label for="invoice_progress" string="%%" attrs="{'invisible': [('method', '!=', 'per')]}"/>
                                </div>
                            <label for="invoice_progress" string="Bill progress" attrs="{'invisible':[('progressive_bill','=',False)]}"/>
                                <div attrs="{'invisible':[('progressive_bill','=',False)]}">
                                    <field name="invoice_progress" required="1" class="oe_inline" attrs="{'readonly':[('claim_type', '=', 'milestone'), ('milestone_id', '!=', False)]}" force_save="1"/>
                                    <label for="invoice_progress" string="%%" attrs="{'invisible': [('method', '!=', 'per')]}"/>
                                </div>
                        </group>
                        <group invisible="1"> 
                            <field name="contract_amount" readonly="1" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="dp_amount" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="retention1"/>
                            <field name="retention2"/>
                            <field name="tax_id" widget="many2many_tags"/>
                            <field name="vat_tax" widget="many2many_tags"/>
                            <field name="income_tax" widget="many2many_tags"/>
                        </group>
                    </group>
                    <group >
                        <group string="Amount Progress">
                            <field name="progress" force_save="1"/>
                            <field name="gross_amount" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="dp_deduction" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="retention_deduction" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="amount_deduction" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>
                        <group string="Amount to Invoice" attrs="{'invisible': [('progressive_bill', '=', True)]}">
                            <field name="dp_deduction_temp" force_save="1" invisible="1"/>
                            <field name="retention_deduction_temp" force_save="1" invisible="1"/>
                            <field name="paid_invoice" force_save="1" invisible="1"/>
                            <field name="amount_untaxed" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="tax_amount" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="amount_invoice" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>
                        <group string="Amount to Bill" attrs="{'invisible': [('progressive_bill', '=', False)]}">
                            <field name="dp_deduction_temp" force_save="1" invisible="1"/>
                            <field name="retention_deduction_temp" force_save="1" invisible="1"/>
                            <field name="amount_untaxed" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="tax_amount" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="amount_invoice" string="Total Amount to Bill" force_save="1" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>
                    </group>
                </sheet> 
                <footer>
                    <button name="create_invoice" string="Create Invoice" type="object" class="oe_highlight" attrs="{'invisible': [('progressive_bill', '=', True)]}"/>
                    <button name="create_invoice" string="Create Bill" type="object" class="oe_highlight" attrs="{'invisible': [('progressive_bill', '=', False)]}"/>
                    <button string="Cancel" special="cancel" class="btn-secondary"/>
                </footer>
            </form>
        </field>
    </record>
    
</odoo>