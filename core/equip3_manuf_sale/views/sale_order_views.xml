<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
    	<record id="view_sale_order_form" model="ir.ui.view">
    		<field name="name">view.sale.order.form</field>
    		<field name="model">sale.order</field>
    		<field name="inherit_id" ref="sale_mrp.sale_order_form_mrp"/>
    		<field name="arch" type="xml">

    			<xpath expr="//div[@name='button_box']" position="inside">
                    <button name="action_view_manufacturing"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-industry"
                            attrs="{'invisible': [('mrp_plan_count', '=', 0)]}"
                            context="{'model': 'mrp.plan'}">
						<div class="o_field_widget o_stat_info">
							<span class="o_stat_value"><field name="mrp_plan_count" widget="statinfo" nolabel="1"/></span>
							<span class="o_stat_text">Production<br/>Plan</span>
						</div>
                    </button>

                    <button name="action_view_manufacturing"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-industry"
                            attrs="{'invisible': [('mrp_order_count', '=', 0)]}"
                            context="{'model': 'mrp.production'}">
						<div class="o_field_widget o_stat_info">
							<span class="o_stat_value"><field name="mrp_order_count" widget="statinfo" nolabel="1"/></span>
							<span class="o_stat_text">Production<br/>Order</span>
						</div>
                    </button>
    			</xpath>

				<xpath expr="//form" position="inside">
					<field name="sales_to_manufacturing" invisible="1"/>
				</xpath>

				<xpath expr="//field[@name='order_line']//tree//field[@name='product_template_id']" position="after">
					<field name="branch_id" invisible="1"/>
					<field name="manuf_auto_create" invisible="1"/>
					<field name="bom_id" invisible="1"/>
					<widget name="order_line_bom" width="0.1" attrs="{'invisible': [('manuf_auto_create', 'not in', ('auto_mp', 'auto_mo'))], 'column_invisible': [('parent.sales_to_manufacturing', '=', False)]}"/>
				</xpath>

				<xpath expr="//field[@name='order_line']//form//field[@name='analytic_tag_ids']" position="after">
					<field name="branch_id" invisible="1"/>
					<field name="manuf_auto_create" invisible="1"/>
					<field name="bom_id" options="{'no_create': True, 'no_create_edit':True}" attrs="{'required': [('manuf_auto_create','!=', 'none')],'invisible': ['|', ('parent.sales_to_manufacturing', '=', False), ('manuf_auto_create', 'not in', ('auto_mp', 'auto_mo'))]}"/>
				</xpath>

    		</field>
    	</record>
    </data>
</odoo>