<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_payment_transaction_form" model="ir.ui.view">
        <field name="name">view_payment_transaction_form</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet/field[@name='id']" position="before">
                <field name="payment_transaction_credit" invisible="1"/>
                <field name="payment_transaction_debit" invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='ref']" position="after">
                <field name="signature_to_confirm" invisible="1"/>
                <field name="is_receipt_approval_matrix" invisible="1"/>
                <field name="is_approve_button" invisible="1"/>
                <field name="approval_matrix_line_id" invisible="1"/>
                <field name="payment_receipt_approval_matrix_id" attrs="{'invisible': [('is_receipt_approval_matrix', '=', False)], 'required': [('is_receipt_approval_matrix', '=', True)]}"/>
                <field name="reconcile_invisible" invisible="1"/>
            </xpath>

            <xpath expr="//button[@name='action_draft']" position="attributes">
                <attribute name="attrs">{'invisible': [('state', '!=', 'cancel')]}</attribute>
            </xpath>

            <xpath expr="//button[@name='action_cancel']" position="attributes">
                <attribute name="attrs">{'invisible': [('state', '!=', 'posted')]}</attribute>
            </xpath>

            <xpath expr="//button[@name='action_post']" position="after">
                <button name="request_for_approval" string="Request For Approval" type="object" class="oe_highlight" attrs="{'invisible': ['|', ('is_receipt_approval_matrix', '=', False), ('state', 'not in', 'draft')]}"/>

                <button name="action_approved_rp" string="Approve" type="object" class="oe_highlight" attrs="{'invisible': ['|', '|', ('is_receipt_approval_matrix', '=', False), ('is_approve_button', '=', False), ('state', '!=', 'to_approve')]}"/>
                
                <button name="rp_reject" string="Reject" type="object" class="oe_highlight" attrs="{'invisible': ['|', '|', ('is_receipt_approval_matrix', '=', False), ('is_approve_button', '=', False), ('state', '!=', 'to_approve')]}"/>

                <button name="action_reconcile_payment" string="Reconcile" type="object" class="oe_highlight" attrs="{'invisible': [('reconcile_invisible', '=', True)]}"/>

            </xpath>
            <field name="state" position="attributes">
                <attribute name="attrs">{'invisible': [('is_receipt_approval_matrix', '=', True)]}</attribute>
            </field>
            <field name="state" position="after">
                <field name="state1" widget="statusbar" statusbar_visible="draft,to_approve,posted" attrs="{'invisible': ['|', ('is_receipt_approval_matrix', '=', False), ('state', '=', 'rejected')]}"/>
                <field name="state2" widget="statusbar" statusbar_visible="draft,to_approve,rejected" attrs="{'invisible': ['|', ('is_receipt_approval_matrix', '=', False), ('state', '!=', 'rejected')]}"/>
            </field>
            <xpath expr="//button[@name='action_post']" position="attributes">
                <attribute name="attrs">{'invisible': ['|', ('is_receipt_approval_matrix', '=', True), ('state', '!=', 'draft')]}</attribute>
            </xpath>
            <xpath expr="//sheet" position="inside">
                <notebook attrs="{'invisible': ['|', ('payment_receipt_approval_matrix_id', '=', False), ('is_receipt_approval_matrix', '=', False)]}">
                    <page string="Approval Matrix Line" name="approved_matrix_ids">
                        <field name="approved_matrix_ids" context="{'approved_matrix_ids': approved_matrix_ids}" force_save="1">
                            <tree create="0" edit="0" delete="0">
                                <field name="sequence" />
                                <field name="user_ids" widget="many2many_tags"/>
                                <field name="minimum_approver" />
                                <field name="state_char" />
                                <field name="time_stamp" invisible="1"/>
                                <!-- <field name="signature_ids" widget="many2many_binary" attrs="{'column_invisible':[('parent.signature_to_confirm','=',False)]}"/> -->
                                <field name="feedback" />
                            </tree>
                        </field>
                    </page>
                      <page string="Signature History" name="siganture_history_ids" attrs="{'invisible': [('signature_to_confirm','=',False)]}">
                        <field name="siganture_history_ids"  force_save="1">
                            <tree create="0" edit="0" delete="0">
                                <field name="approver_id" />
                                <field name="timestamp" />
                                <field name="signature" widget="image"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
            </xpath>
            <xpath expr="//sheet/div[@name='button_box']" position="inside">
                <button name="button_payment_credit" type="object" class="oe_stat_button" icon="o-hm-smart-all-3-payments" attrs="{'invisible': [('payment_transaction_credit_count','=', 0)]}">
                    <field name="payment_transaction_credit_count"/>
                    <span>Payment</span>
                </button>

                <button name="button_payment_debit" type="object" class="oe_stat_button" icon="o-hm-smart-all-3-payments" attrs="{'invisible': [('payment_transaction_debit_count','=', 0)]}">
                    <field name="payment_transaction_debit_count"/>
                    <span>Payment</span>
                </button>
            </xpath>
            <xpath expr="//sheet/div[@name='button_box']/button[@name='button_open_bills']" position="replace">
                <button name="button_open_bills" type="object" class="oe_stat_button" icon="o-hm-smart-all-bills" attrs="{'invisible': [('reconciled_bills_count','=', 0)]}">
                    <field name="reconciled_bills_count"/>
                    <span attrs="{'invisible': [('reconciled_bills_count','&gt;', 1)]}">Bill</span>
                    <span attrs="{'invisible': [('reconciled_bills_count','&lt;=', 1)]}">Bills</span>
                </button>
            </xpath>
            <xpath expr="//sheet/div[@name='button_box']/button[@name='button_open_invoices']" position="replace">
                <button name="button_open_invoices" type="object" class="oe_stat_button" icon="o-hm-smart-all-invoices" attrs="{'invisible': [('reconciled_invoices_count','=', 0)]}">
                    <field name="reconciled_invoices_count"/>
                    <span attrs="{'invisible': [('reconciled_invoices_count','&gt;', 1)]}">Invoice</span>
                    <span attrs="{'invisible': [('reconciled_invoices_count','&lt;=', 1)]}">Invoices</span>
                </button>
            </xpath>

            <xpath expr="//field[@name='branch_id']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
                <attribute name="options">{'no_create': True, 'no_create_edit': True}</attribute>
                <attribute name="required">1</attribute>
            </xpath>

            <xpath expr="//field[@name='ref']" position="attributes">
                <attribute name="attrs">{'readonly': [('state', '!=', 'draft')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='payment_type']" position="attributes">
                <attribute name="attrs">{'readonly': 1}</attribute>
            </xpath>
            
            <xpath expr="//field[@name='partner_bank_id']" position="after">
                <field name="administration" attrs="{'invisible' : [('payment_type','!=','outbound')]}"/>
                <field name="analytic_group_ids" widget="many2many_tags" attrs="{'invisible' : ['|',('administration','=',False),('payment_type','!=','outbound')], 'required' : [('administration','=',True)]}"/>
                <field name="administration_account" attrs="{'invisible' : ['|',('administration','=',False),('payment_type','!=','outbound')], 'required' : [('administration','=',True)]}"/>
                <field name="administration_fee" attrs="{'invisible' : ['|',('administration','=',False),('payment_type','!=','outbound')], 'required' : [('administration','=',True)]}"/>
            </xpath>

            <xpath expr="//field[@name='partner_id']" position="attributes">
                <attribute name="attrs">{'required': [('is_internal_transfer','=',False)], 
                                         'readonly': ['|',('state','!=','draft'),('is_internal_transfer','=',True)]
                                         }</attribute>
            </xpath>
        </field>
    </record>

    <record id="inherit_view_account_payment_tree" model="ir.ui.view">
        <field name="name">view.account.payment.tree</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree/field[@name='currency_id']" position="after">
                <field name="invoice_origin_ids" widget="many2many_tags" string="Invoices No."/>
            </xpath>
        </field>
    </record>

    <record id="inherit_view_account_supplier_payment_tree" model="ir.ui.view">
        <field name="name">view.account.supplier.payment.tree</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_supplier_payment_tree"/>
        <field name="arch" type="xml">
            <field name="invoice_origin_ids" position="attributes">
                <attribute name="string">Bills No.</attribute>
            </field>
        </field>
    </record>
</odoo>

