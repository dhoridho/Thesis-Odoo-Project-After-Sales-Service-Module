<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_out_invoice_tree_inherit2" model="ir.ui.view">
        <field name="name">account.out.invoice.tree.inherit2</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_out_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree/field[@name='state']" position="replace">
                <field name="state" optional="show" widget="badge" decoration-danger="state == 'rejected'" 
                decoration-warning2="state == 'approved'" decoration-success="state == 'posted'" decoration-warning3="state == 'to_approve'"
                decoration-muted="state == 'draft'" decoration-danger3="state == 'cancelled'" decoration-danger2="state == 'failed'"/>
            </xpath>
        </field>
    </record>

    <record id="view_in_invoice_tree_inherit2" model="ir.ui.view">
        <field name="name">account.in.invoice.tree.inherit2</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_in_invoice_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree/field[@name='state']" position="replace">
                <field name="state" optional="show" widget="badge" decoration-danger="state == 'rejected'" 
                decoration-warning2="state == 'approved'" decoration-success="state == 'posted'" decoration-warning3="state == 'to_approve'"
                decoration-muted="state == 'draft'" decoration-danger3="state == 'cancelled'" decoration-danger2="state == 'failed'"/>
            </xpath>
        </field>
    </record>

    <record id="view_move_form_inherit_budget" model="ir.ui.view">
        <field name="name">Invoice Form Inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">
            <div name="button_box" position="inside">
                <button name="open_payments"
                    class="oe_stat_button"
                    icon="fa-usd"
                    type="object"
                    string="Requested Payment" attrs="{'invisible': [('to_approve_state_payment_count','=',0)]}">
                    <field name="to_approve_state_payment_count" invisible="1"/>
                </button>
            </div>
            <xpath expr="//field[@name='ref']" position="after">
                <field name="journal_entries_template" widget="selection"  domain="[('company_id', '=', company_id)]" attrs="{'invisible':[('move_type', '!=', 'entry')]}" />
            </xpath>
            <xpath expr="//field[@name='branch_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit': True}</attribute>
                <attribute name="required">1</attribute>
            </xpath>
            <xpath expr="//div[@name='button_box']/button[1]" position="before">
                <field name="is_merge" invisible="1"/>
                <!-- <field name="move_type" invisible="1"/> -->
                <button class="oe_stat_button" name="action_view_merged_invoice" type="object" icon="fa-file-text-o" attrs="{'invisible': ['|',('move_type', 'not in', ('out_invoice', 'out_refund', 'out_receipt')), ('is_merge', '=', False)]}">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="count_merged_invoice" widget="statinfo" nolabel="1" class="mr4"/>
                        </span>
                        <span class="o_stat_text">Invoice Merged</span>
                    </div>
                </button>
                <button class="oe_stat_button" name="action_view_merged_invoice" type="object" icon="fa-file-text-o" attrs="{'invisible': ['|',('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt')), ('is_merge', '=', False)]}">
                    <div class="o_field_widget o_stat_info">
                        <span class="o_stat_value">
                            <field name="count_merged_invoice" widget="statinfo" nolabel="1" class="mr4"/>
                        </span>
                        <span class="o_stat_text">Bill Merged</span>
                    </div>
                </button>
            </xpath>
            <xpath expr="//div[hasclass('d-flex')]" position="after">
                <field name="expiry_date" attrs="{'readonly': [('state', '=', 'posted')], 'invisible' :[('credit_note_expiry_date', '=', False)]}" />
                <field name="credit_note_expiry_date" invisible='1'/>
            </xpath>

            <xpath expr=".//notebook/page[@id='invoice_tab']/field[@name='invoice_line_ids']/tree/field[@name='price_subtotal']" position="replace">
                <field name="price_subtotal" string="Untaxed Amount"/>
            </xpath>


            <xpath expr=".//notebook/page[@id='invoice_tab']/field[@name='invoice_line_ids']/tree/field[@name='price_total']" position="replace">
                <field name="price_total" string="Total Amount" />
            </xpath>

            <xpath expr=".//notebook/page[@id='invoice_tab']/field[@name='invoice_line_ids']/tree/field[@name='price_unit']" position="after">
                <field name="unit_price_fnct" invisible="1" />
            </xpath>
            
            <xpath expr="//field[@name='narration']" position="replace">
                <div style="width:60%;">
                    <field name="narration" widget="html" attrs="{'style': 'width: 60%;'}" />   
                </div>
            </xpath>

            <xpath expr="//field[@name='to_check']" position="after">
                <field name="is_intercompany_transaction" attrs="{'invisible': [('move_type', 'not in', ['out_invoice', 'in_invoice', 'out_refund', 'in_refund', 'entry'])]}"/>
            </xpath>

            <xpath expr=".//notebook/page[@id='other_tab_entry']/group/group/field[@name='to_check']" position="after">
                <field name="is_intercompany_transaction" attrs="{'invisible': [('move_type', 'not in', ['out_invoice', 'in_invoice', 'out_refund', 'in_refund', 'entry'])]}"/>
            </xpath>

            <xpath expr=".//notebook/page[@id='invoice_tab']/field[@name='invoice_line_ids']/tree/field[@name='tax_ids']" position="attributes">
                <attribute name="invisible">0</attribute>
            </xpath>

            <xpath expr="//button[@name='action_reverse']" position="attributes">
                <attribute name="attrs">
                    {'invisible': ['|', ('move_type', 'not in', ('out_invoice', 'out_refund')), ('state', '!=', 'posted')]}
                </attribute>
            </xpath>

        </field>
    </record>

    <!-- <record id="view_move_form_debit_inherit" model="ir.ui.view">
        <field name="name">account.move.form.debit.inherit</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account_debit_note.view_move_form_debit" />
        <field name="arch" type="xml">
            <xpath expr="//button[@name='%(account_debit_note.action_view_account_move_debit)d']" position="attributes">
                <attribute name="attrs">
                    {'invisible': ['|', '|', ('debit_origin_id', '!=', False),('move_type', 'not in', ('in_invoice','in_refund')), ('state', '!=', 'posted')]}
                </attribute>
            </xpath>
        </field>
    </record> -->

    <record id="view_account_invoice_dev_purchase_down_payment_form" model="ir.ui.view">
        <field name="name">Invoice Form Inherit (Down Payment Form)</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="dev_purchase_down_payment.view_move_form"/>
        <field name="arch" type="xml">

            
            <xpath expr="//field[@name='amount_untaxed']" position="before">
                <field name="subtotal_amount" string="Subtotal" attrs="{'invisible': [('tax_applies_on', '=', 'Before Discont')]}"/>
            </xpath>

            <xpath expr="//field[@name='amount_untaxed']" position="after">
                <field name="amount_tax2" string="Total Taxes" attrs="{'invisible': ['|','|', ('amount_tax', '=', 0), ('is_down_payment', '=', True),('tax_applies_on', '!=', 'Before Discount')]}"/>
            </xpath>

            <xpath expr="//field[@name='amount_untaxed']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <xpath expr="//field[@name='amount_tax']" position="replace">
                <field name="amount_tax" string="Total Taxes" attrs="{'invisible': ['|','|', ('amount_tax', '=', 0), ('is_down_payment', '=', True),('tax_applies_on', '=', 'Before Discount')]}"/>
            </xpath>
        </field>
    </record>


    <record id="view_account_invoice_discount_form" model="ir.ui.view">
        <field name="name">account.invoice.discount.form.view</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="equip3_discount_with_tax.view_account_invoice_discount_form"/>
        <field name="arch" type="xml">

            <xpath expr="//field[@name='discount_amt_line']" position="after">
                <!-- <attribute name="invisible">1</attribute> -->
                <field name="amount_untaxed" attrs="{'invisible': ['|','|', ('amount_tax', '=', 0), ('is_down_payment', '=', True),('tax_applies_on', '=', 'Before Discount')]}" string="Total Untaxed Amount" />
            </xpath>

            <xpath expr="//label[@for='discount_amount']" position="before">
                
                <label for="multi_discount"  attrs="{'invisible': ['|',('discount_type','=','line'),('discount_method','=','fix')],'readonly': [('state', '=', 'posted')]}"/>
                <div name="multi_disount">
                    <field name="multi_discount" class="oe_inline" attrs="{'invisible': ['|',('discount_type','=','line'),('discount_method','=','fix')],'readonly': [('state', '=', 'posted')]}"/>
                    <label for="discount_amount" string="%" attrs="{'invisible': ['|',('discount_method', '!=', 'per'),('discount_type','!=','global')]}" class="oe_inline"/>
                </div>
                
            </xpath>
            
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='discount_amount']" position="attributes">
                <attribute name="attrs">{'readonly': ['|',('parent.discount_type', '=', 'global'),('discount_method', '=', 'per')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='price_unit']" position="after">
                <xpath expr="//field[@name='discount_method']" position="move"/>
                <field name="multi_discount" attrs="{'readonly': ['|',('parent.discount_type', '=', 'global'),('discount_method', '=', 'fix')]}" />
                <xpath expr="//field[@name='discount_amount']" position="move"/>
            </xpath>

        </field>
    </record>



    <record id="account_move_inherited_form" model="ir.ui.view">
        <field name="name">Invoice Form Inherit (update)</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="interest_on_overdue_invoice.invoice_form_inherited"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='interest']" position="replace">
            </xpath>
            <xpath expr="//button[@name='button_add_interest']/parent::div" position="replace">
                <div style="width:420px; position:relative; text-align:right; float:right; margin-right:-92px;">
                    <field name="show_intrest" invisible="1"/>

                    <span style="width:20%; margin-right:10px; color:#333; font-weight:bold; font-size:14px;" attrs="{'visible':[('show_intrest','=', True)],'invisible':[('show_intrest','=', False)]}">Interest</span>

                    <button style="width:25%;margin-right:30px;" name="button_add_interest" string="(Update)" type="object" help="button_add_interest" attrs="{'visible':['|', ('show_intrest','=', True), ('state','=','draft')],'invisible':['|',('show_intrest','=', False),('state','!=','draft')], 'invisible': [('is_button_update_invisible', '=', True)]}"/>

                    <button style="width:25%;margin-right:30px;" name="action_interest_update_cancel" string="(Update)" type="object" help="button_update_interest" attrs="{'visible':['|', ('show_intrest','=', True), ('state','=','posted')],'invisible':['|','|',('show_intrest','=', False),('state','!=','posted'),('payment_state','=','paid')]}"/>

                    <button style="width:25%"  name="button_reset_interest" string="(Reset)" groups="sales_team.group_sale_manager" type="object" help="button_reset_taxes" attrs="{'visible':['|',('show_intrest','=', True), ('state','=','draft')],'invisible':['|',('show_intrest','=', False),('state','!=','draft')]}"/>

                    <field style="width:30%; margin-left:17px"  name="interest" readonly="1" nolabel="1" widget="monetary" options="{'currency_field': 'currency_id'}" attrs="{'visible':[('show_intrest','=', True)],'invisible':[('show_intrest','=', False)]}"/>

                    <field name="is_button_update_invisible" invisible="1"/>

                </div>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree" position="inside">  
              <field name="is_discount_line" optional="hide"/>
              <field name="is_interest_line" optional="hide"/>
            </xpath>
            <!-- <xpath expr="//group[@class='oe_subtotal_footer oe_right']/field[@name='amount_untaxed']" position="after"> -->
            <xpath expr="//group[hasclass('oe_subtotal_footer','oe_right')]/field[@name='amount_untaxed']" position="after">
                        <button name="refresh_discount" string="(Apply Discount Line)" type="object" class="oe_edit_only oe_link" attrs="{'invisible':['|',('state','not in',('draft','sent')),('discount_type','!=','line')]}"/>
                </xpath>
        </field>
    </record>

    <record id="view_invoice_line_calendar" model="ir.ui.view">
        <field name="name">account.move.calendar</field>
        <field name="model">account.move</field>
        <field name="arch" type="xml">
            <calendar string="Invoices" color="partner_id" date_start="invoice_date_due" date_stop="invoice_date_due" event_open_popup="true" mode="month" quick_add="False">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="amount_total"/>
                <field name="payment_state"/>
                <field name="amount_residual"/>
            </calendar>
        </field>
    </record>
    
    <record id="account.action_move_out_invoice_type" model="ir.actions.act_window">
        <field name="name">Invoices</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,calendar,form</field>
        <field name="view_id" ref="view_out_invoice_tree_inherit2"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('move_type', '=', 'out_invoice')]</field>
        <field name="context">{'default_move_type': 'out_invoice', 'is_ppn_invisible': False, 'def_invisible': False}</field>
        <!-- <field name="context">{'default_move_type': 'out_invoice'}</field> -->
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a customer invoice
          </p><p>
            Create invoices, register payments and keep track of the discussions with your customers.
          </p>
        </field>
    </record>

    <record id="action_move_out_invoice_type_ref2" model="ir.actions.act_window">
            <field name="name">Invoices</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_id" ref="account.view_out_invoice_tree"/>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="domain">[('move_type', '=', 'out_invoice'),('state', '=', 'posted'),('payment_state', 'in', ['not_paid','in_payment','partial'])]</field>
            <field name="context">{'default_move_type': 'out_invoice', 'is_ppn_invisible': False, 'def_invisible': False}</field>
            <!-- <field name="context">{'default_move_type': 'out_invoice'}</field> -->
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Create a customer invoice
              </p><p>
                Create invoices, register payments and keep track of the discussions with your customers.
              </p>
            </field>
        </record>


    <record id="action_move_in_invoice_type_ref2" model="ir.actions.act_window">
            <field name="name">Bills</field>
            <field name="res_model">account.move</field>
            <field name="view_mode">tree,kanban,form</field>
            <field name="view_id" ref="account.view_out_invoice_tree"/>
            <field name="search_view_id" ref="account.view_account_invoice_filter"/>
            <field name="domain">[('move_type', '=', 'in_invoice'),('state', '=', 'posted'),('payment_state', 'in', ['not_paid','in_payment','partial'])]</field>
            <field name="context">{'default_move_type': 'in_invoice', 'is_ppn_invisible': False, 'def_invisible': False}</field>
            <!-- <field name="context">{'default_move_type': 'in_invoice'}</field> -->
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Create a vendor bill
              </p><p>
                Create invoices, register payments and keep track of the discussions with your vendors.
              </p>
            </field>
        </record>



    <record id="account.action_move_out_refund_type" model="ir.actions.act_window">
        <field name="name">Credit Notes</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,calendar,form</field>
        <field name="view_id" ref="account.view_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('move_type', '=', 'out_refund')]</field>
        <field name="context">{'default_move_type': 'out_refund', 'is_ppn_invisible': True, 'def_invisible': False}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a credit note
          </p><p>
            Note that the easiest way to create a credit note is to do it directly
            from the customer invoice.
          </p>
        </field>
    </record>

    <record id="account.action_move_in_invoice_type" model="ir.actions.act_window">
        <field name="name">Bills</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,calendar,form</field>
        <field name="view_id" ref="view_in_invoice_tree_inherit2"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('move_type', '=', 'in_invoice')]</field>
        <field name="context">{'default_move_type': 'in_invoice', 'is_ppn_invisible': False, 'def_invisible': False}</field>
        <!-- <field name="context">{'default_move_type': 'in_invoice'}</field> -->
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a vendor bill
          </p><p>
            Create invoices, register payments and keep track of the discussions with your vendors.
          </p>
        </field>
    </record>

    <record id="account.action_move_in_refund_type" model="ir.actions.act_window">
        <field name="name">Debit Note</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,calendar,form</field>
        <field name="view_id" ref="account.view_in_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('move_type', '=', 'in_refund')]</field>
        <field name="context">{'default_move_type': 'in_refund', 'is_ppn_invisible': True, 'def_invisible': False}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a vendor credit note
          </p><p>
            Note that the easiest way to create a vendor credit note it to do it directly from the vendor bill.
          </p>
        </field>
    </record>

    <record id="account.action_move_out_receipt_type" model="ir.actions.act_window">
        <field name="name">Receipts</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,calendar,form</field>
        <field name="view_id" ref="account.view_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('move_type', '=', 'out_receipt')]</field>
        <field name="context">{'default_move_type': 'out_receipt', 'is_ppn_invisible': True, 'def_invisible': False}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Create a new sales receipt
          </p><p>
            When the sale receipt is confirmed, you can record the customer
            payment related to this sales receipt.
          </p>
        </field>
    </record>

    <record id="account.action_move_in_receipt_type" model="ir.actions.act_window">
        <field name="name">Receipts</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,kanban,calendar,form</field>
        <field name="view_id" ref="account.view_in_invoice_tree"/>
        <field name="search_view_id" ref="account.view_account_invoice_filter"/>
        <field name="domain">[('move_type', '=', 'in_receipt')]</field>
        <field name="context">{'default_move_type': 'in_receipt', 'is_ppn_invisible': True, 'def_invisible': False}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Register a new purchase receipt
          </p><p>
            When the purchase receipt is confirmed, you can record the
            vendor payment related to this purchase receipt.
          </p>
        </field>
    </record>

    <!-- <record id="base_view_partner_form_inherited_new" model="ir.ui.view">
            <field name="name">Customer Addition Account Receivable</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="inside">
                    <field name="partner_id" string="Customer" style="font-weight:bold;" attrs="{'invisible': [('move_type', 'not in', ('out_invoice', 'out_refund', 'out_receipt'))]}"/>
                    <field name="partner_id" string="Vendor" style="font-weight:bold;" attrs="{'invisible': [('move_type', 'not in', ('in_invoice', 'in_refund', 'in_receipt'))]}"/>
                </xpath>
            </field>
        </record> -->


</odoo>
