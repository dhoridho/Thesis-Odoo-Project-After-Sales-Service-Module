<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="pos_sale_report_template_inherit" inherit_id="equip3_pos_general.pos_sale_report_template">
        <xpath expr="//tr[hasclass('tr-sales-summary_receivable')]" position="after">

            <t t-if="report_data and 'redeem_point_by_session_id' in report_data">
                <tr class="tr-sales-summary_receivable">
                    <td class="text-left">
                        Redeem Point
                    </td>
                    <td class="text-right">
                        <span t-esc="report_data['redeem_point_by_session_id'].get(o.id, 0.0)" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                    </td>
                </tr>
            </t>

            <t t-if="report_data and 'deposit_used_by_session_id' in report_data">
                <tr class="tr-sales-summary_deposit_used">
                    <td class="text-left">
                        Deposit Used
                    </td>
                    <td class="text-right">
                        <span t-esc="report_data['deposit_used_by_session_id'].get(o.id, 0.0)" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                    </td>
                </tr>
            </t>
            
        </xpath>

        <xpath expr="//table[hasclass('table-receivable_payment')]" position="after">
            <t t-if="report_data and 'member_deposit_by_session_id' in report_data">
                <t t-set="member_deposits" t-value="report_data['member_deposit_by_session_id'].get(o.id, [])"/>
                <t t-if="member_deposits">
                    <t t-set="member_deposit_total" t-value="0.0" />
                    <table width="100%" class="table-member_deposit">
                        <tr>
                            <td colspan="2" style="padding-top:1px;border:1px solid black;color:#ffffff; background-color: #333333;" class='text-center'>
                                <span><h3>Deposit</h3></span>
                            </td>
                        </tr>
                      
                        <tr t-foreach="member_deposits" t-as="l">
                            <td class="text-left">
                                <span t-esc="l.get('payment_name') or ' - '"/>
                            </td>
                            <td class="text-right">
                                <span>
                                    <t t-esc="l.get('total_amount')" 
                                        t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                </span>
                            </td>
                            <t t-set="member_deposit_total" t-value="member_deposit_total + l.get('total_amount')"/>
                        </tr>

                        <tr>
                            <td class="text-left">
                                <b><span>Total</span></b>
                            </td>
                            <td class="text-right">
                                <b>
                                    <t t-esc="member_deposit_total" 
                                        t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                </b>
                            </td>
                        </tr>
                    </table>
                    <br/>
                </t>
            </t>
        </xpath>

    </template>

</odoo>
