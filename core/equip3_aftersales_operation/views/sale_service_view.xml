<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="sale_service_line_view_tree" model="ir.ui.view">
        <field name="name">sale.service.tree</field>
        <field name="model">sale.service.line</field>
        <field name="priority">2</field>
        <field name="arch" type="xml">
            <tree string="Sale Service Line" >
                <field name="product_id"/>
                <field name="product_qty"/>
                <field name="product_uom"/>
                <field name="price_unit"/>
                <field name="amount_total"/>
            </tree>
        </field>
    </record>

    <record id="sale_service_line_view_form" model="ir.ui.view">
        <field name="name">sale.service.form</field>
        <field name="model">sale.service.line</field>
        <field name="priority">2</field>
        <field name="arch" type="xml">
            <form string="Sale Service Line" >
                <group>
                    <group>
                        <field name="product_id"/>
                        <field name="product_qty"/>
                        <field name="product_uom"/>
                    </group>
                    <group>
                        <field name="price_unit"/>
                        <field name="amount_total"/>
                    </group>
                </group>
            </form>
        </field>
    </record>

    <record id="sale_service_view_search" model="ir.ui.view">
        <field name="name">sale.service.search.sale</field>
        <field name="model">sale.service</field>
        <field name="arch" type="xml">
            <search string="Search Sale Service">
                <field name="name" string="Sale Service" filter_domain="[('name', 'ilike', self)]"/>
            </search>
        </field>
    </record>

    <record id="sale_service_view_tree" model="ir.ui.view">
        <field name="name">sale.service.tree</field>
        <field name="model">sale.service</field>
        <field name="priority">2</field>
        <field name="arch" type="xml">
            <tree string="Sale Service" multi_edit="1" sample="1">
                <field name="name" string="Number" readonly="1" decoration-bf="1"/>
                <field name="partner_id" readonly="1"/>
                <field name="amount_untaxed" sum="Total Tax Excluded" widget="monetary" optional="hide"/>
                <field name="amount_tax" sum="Tax Total" widget="monetary" optional="hide"/>
                <field name="amount_total" sum="Total Tax Included" widget="monetary" decoration-bf="1" optional="show"/>
                <field name="state"/>

            </tree>
        </field>
    </record>

        <record id="view_sale_service_form" model="ir.ui.view">
        <field name="name">sale.service.form</field>
        <field name="model">sale.service</field>
        <field name="arch" type="xml">
            <form string="Sale Service">
                <header>
                    <field name="state" widget="statusbar" statusbar_visible="draft,waiting,sale" attrs="{'invisible': [('is_sale_service_approval_matrix', '=', True)]}"/>
                    <!-- <field name="state" widget="statusbar" statusbar_visible="draft,waiting,pending,sale" attrs="{'invisible': [('is_sale_service_approval_matrix', '=', True), ('state', '!=', 'pending')]}"/> -->
                    <field name="state" widget="statusbar" statusbar_visible="draft,sale" attrs="{'invisible': [('is_sale_service_approval_matrix', '=', False)]}"/>
                    <field name="is_sale_service_approval_matrix" invisible="1"/>
                    <field name="is_previous_approved" invisible="1"/>
                    <button name="request_aproval" type="object" string="Request Approval" attrs="{'invisible': ['|', ('is_sale_service_approval_matrix', '=', False), ('state', '!=', 'draft')]}"/>
                    <button name="action_confirm" type="object" string="Confirm" attrs="{'invisible': ['|', ('is_sale_service_approval_matrix', '!=', False), ('state', 'not in', ['draft', 'waiting'])]}"/>
                    <button name="create_purchase" type="object" string="Create Purchase"/>
                    <button name="button_create_invoice" type="object" string="Create Invoice" attrs="{'invisible': [('display_create_invoice', '=', False)]}"/>
                    <button name="action_approve" type="object" string="Approve" attrs="{ 'invisible': ['|',('is_previous_approved', '=', False), ('state', '=', 'draft')]}"/>
                    <button name="action_reject" type="object" string="Reject" attrs="{ 'invisible': ['|',('is_previous_approved', '=', False), ('state', '=', 'draft')]}"/>
                    <field name="invoice_paid" invisible="1"/>
                    <field name="display_create_invoice" invisible="1"/>
                </header>
                <header name="maintenance_header">
                    <field name="maintenance_state" widget="statusbar" statusbar_visible="pending"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="show_invoices"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-dddglobe icon">
                            <div class="o_field_widget o_stat_info">
                                <field name="invoice_count"/>
                                <span class="o_stat_text">Invoices</span>
                            </div>
                        </button>
                        <button name="show_purchases"
                            type="object"
                            class="oe_stat_button"
                            icon="fa-globe icon">
                            <div class="o_field_widget o_stat_info">
                                <field name="purchase_count"/>
                                <span class="o_stat_text">Purchases</span>
                            </div>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>
                    <group name="sale_service_header">
                        <group>
                            <field name="partner_id"
                                    widget="res_partner_many2one"
                                    context="{'res_partner_search_mode': 'customer', 'show_address': 1, 'show_vat': True}"
                                    options='{"always_reload": True}'
                                    domain="[('is_customer', '=', True)]"/>
                            <field name="delivery_type"/>
                            <field name="facility_area"/>
                            <field name="maintenance_team_id"/>
                            <field name="warranty"/>
                            <field name="maintenance_type" required="1"/>
                            <field name="reference"/>
                            <field name="scheduled_date"/>
                            <field name="end_date"/>
                        </group>
                        <group>
                            <field name="create_date" readonly="1"/>
                            <field name="create_uid" readonly="1"/>
                            <field name="company_id" readonly="1"/>
                            <field name="branch_id" required="1"/>
                            <field name="remarks"/>
                            <field name="pricelist_id" required="1"/>
                            <field name="currency_id" invisible="1"/>
                            <field name="location_id" domain="[('usage', '=', 'internal'), ('branch_id', '=', branch_id)]" required="1"/>
                            <field name="condition_beforehanded"/>
                            <field name="task_performance"/>
                            <field name="followup"/>
                            <field name="approval_matrix_id" attrs="{'invisible': [('is_sale_service_approval_matrix', '=', False)]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Product" name="order_lines">
                            <field name="line_ids" widget="section_and_note_one2many" context="{'pricelist_id': pricelist_id}">
                                <form>
                                    <group>
                                        <group>
                                            <field name="product_id"/>
                                            <field name="name" />
                                            <field name="analytic_tag_ids" widget="many2many_tags"/>
                                            <field name="disc_method" />
                                            <field name="disc_percentage"/>
                                            <field name="disc_amount" />
                                        </group>
                                        <group>
                                            <field name="product_qty"/>
                                            <field name="product_uom"/>
                                            <field name="price_unit"/>
                                            <field name="tax_ids" widget="many2many_tags"/>
                                            <field name="amount_untaxed"/>
                                            <field name="amount_total"/>
                                            <field name="chargable"/>
                                        </group>
                                    </group>

                                </form>
                                <tree string="Sales Order Lines" editable="bottom">
                                    <field name="related_product_categ" invisible="1"/>
                                    <field name="product_id"/>
                                    <field name="name" />
                                    <field name="analytic_tag_ids" widget="many2many_tags"/>
                                    <field name="disc_method" />
                                    <field name="disc_percentage" attrs="{'readonly': [('disc_method', '!=', 'per')]}" force_save="1"/>
                                    <field name="disc_amount" attrs="{'readonly': [('disc_method', '!=', 'fixed')]}" force_save="1"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom" domain="[('category_id', '=',related_product_categ)]"/>
                                    <field name="chargable"/>
                                    <field name="price_unit"/>
                                    <field name="tax_ids" widget="many2many_tags"/>
                                    <field name="amount_untaxed"/>
                                    <field name="amount_total"/>
                                </tree>

                            </field>
                            <group name="note_group" col="6" class="mt-2 mt-md-0">
                                <field name="terms_condition_id"/>
                                <group colspan="4">
                                    <field name="note" widget="html" nolabel="1" placeholder="Terms and conditions..."/>
                                </group>
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_service_total">
                                    <field name="amount_untaxed" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <field name="amount_tax" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                        <label for="amount_total" />
                                    </div>
                                    <field name="amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                </group>
                                <div class="oe_clear"/>
                            </group>
                        </page>
                        <page string="Material" name="material_line" context="{'pricelist_id': pricelist_id}">
                            <field name="line_material_ids" widget="section_and_note_one2many">
                                <form>
                                    <group>
                                        <group>
                                            <field name="product_id"/>
                                            <field name="name" />
                                            <field name="analytic_tag_ids" widget="many2many_tags"/>
                                            <field name="disc_method" />
                                            <field name="disc_percentage"/>
                                            <field name="disc_amount" />
                                        </group>
                                        <group>
                                            <field name="product_qty"/>
                                            <field name="product_uom"/>
                                            <field name="price_unit"/>
                                            <field name="tax_ids" widget="many2many_tags"/>
                                            <field name="amount_untaxed"/>
                                            <field name="amount_total"/>
                                        </group>
                                    </group>

                                </form>
                                <tree string="Materials" editable="bottom">
                                    <field name="related_product_categ" invisible="1"/>
                                    <field name="product_id"/>
                                    <field name="name" />
                                    <field name="analytic_tag_ids" widget="many2many_tags"/>
                                    <field name="disc_method" />
                                    <field name="disc_percentage" attrs="{'readonly': [('disc_method', '!=', 'per')]}" force_save="1"/>
                                    <field name="disc_amount" attrs="{'readonly': [('disc_method', '!=', 'fixed')]}" force_save="1"/>
                                    <field name="product_qty"/>
                                    <field name="product_uom" domain="[('category_id', '=', related_product_categ)]"/>
                                    <field name="chargable"/>
                                    <field name="price_unit"/>
                                    <field name="tax_ids" widget="many2many_tags"/>
                                    <field name="amount_untaxed"/>
                                    <field name="amount_total"/>
                                </tree>

                            </field>
                            <group name="toal_material_group" col="6" class="mt-2 mt-md-0">
                                <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_service_total">
                                    <field name="amount_untaxed_material" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <field name="amount_tax_material" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                    <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                        <label for="amount_total_material" />
                                    </div>
                                    <field name="amount_total_material" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                                </group>
                                <div class="oe_clear"/>
                            </group>
                        </page>
                        <page string="Approval Matrix" name="approval_matrix" attrs="{'invisible': [('is_sale_service_approval_matrix', '=', False)]}">
                            <field name="approved_matrix_ids" >
                                <tree create="false">
                                    <field name="sequence" invisible="1"/>
                                    <field name="sequence2" modifiers='{"readonly": true}'/>
                                    <field name="user_ids" widget="many2many_tags" modifiers='{"readonly": true}'/>
                                    <field name="minimum_approver" modifiers='{"readonly": true}'/>
                                    <field name="state_char" modifiers='{"readonly": true}'/>
                                    <field name="feedback" modifiers='{"readonly": true}'/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                    <group name="grand_total" col="6" class="mt-2 mt-md-0">
                        <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_service_total">
                            <field name="grand_amount_untaxed" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="grand_amount_taxed" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <field name="down_payment_amount" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                                <label for="grand_amount_total" />
                            </div>
                            <field name="grand_amount_total" nolabel="1" class="oe_subtotal_footer_separator" widget='monetary' options="{'currency_field': 'currency_id'}"/>
                        </group>
                        <div class="oe_clear"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    <record id="action_service_orders" model="ir.actions.act_window">
        <field name="name">Sale Service</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">sale.service</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="sale_service_view_search"/>
        <field name="context">{}</field>
        <field name="domain">[]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create Sale Service
            </p>
        </field>
    </record>

</odoo>
