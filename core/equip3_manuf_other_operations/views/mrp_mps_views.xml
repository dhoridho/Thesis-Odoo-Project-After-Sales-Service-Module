<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <record id="view_mrp_mps_tree" model="ir.ui.view">
        <field name="name">view.mrp.mps.tree</field>
        <field name="model">mrp.mps</field>
        <field name="arch" type="xml">
            <tree string="Master Production Schedule">
                <field name="name"/>
                <field name="description"/>
                <field name="date_from" string="From"/>
                <field name="date_to" string="To"/>
                <field name="warehouse_id"/>
                <field name="branch_id"/>
                <field name="state" widget="badge" decoration-success="state == 'close'" decoration-info="state == 'progress'"/>
            </tree>
        </field>
    </record>

    <record id="view_mrp_mps_form" model="ir.ui.view">
        <field name="name">view.mrp.mps.form</field>
        <field name="model">mrp.mps</field>
        <field name="arch" type="xml">
            <form string="Master Production Schedule">
                <header>
                    <button name="action_confirm" string="Confirm" type="object" class="oe_highlight" attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                    <button name="action_produce" string="Produce" type="object" class="oe_highlight" attrs="{'invisible': [('state', '!=', 'progress')]}"/>
                    <button name="action_close" string="Close" type="object" attrs="{'invisible': [('state', '!=', 'progress')]}"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" force_save="1"/>
                        </h1>
                    </div>

                    <div name="button_box" class="oe_button_box">
                        <button name="action_view_production_plan" type="object" class="oe_stat_button" icon="fa-industry" attrs="{'invisible': [('plan_count', '=', 0)]}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="plan_count" widget="statinfo" nolabel="1"/></span>
                                <span class="o_stat_text">Production<br/>Plan</span>
                            </div>
                        </button>

                        <button name="action_view_production_order" type="object" class="oe_stat_button" icon="fa-industry" attrs="{'invisible': [('order_count', '=', 0)]}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="order_count" widget="statinfo" nolabel="1"/></span>
                                <span class="o_stat_text">Production<br/>Order</span>
                            </div>
                        </button>

                        <button name="action_view_material_request" type="object" class="oe_stat_button" icon="o-hm-smart-construction-material-request" attrs="{'invisible': [('request_count', '=', 0)]}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value"><field name="request_count" widget="statinfo" nolabel="1"/></span>
                                <span class="o_stat_text">Material<br/>Request</span>
                            </div>
                        </button>
                    </div>

                    <group>
                        <group>
                            <field name="description"/>
                            <label for="date_from" string="Period"/>
                            <div class="o_row">
                                <field name="date_from" class="oe_inline mr-3"/>
                                <span class="mr-3">To</span>
                                <field name="date_to" class="oe_inline"/>
                            </div>
                            <field name="warehouse_id"/>
                            <field name="product_ids" widget="many2many_tags" required="1"/>
                            <field name="period_type" invisible="1"/>
                        </group>
                        <group>
                            <field name="company_id" force_save="1"/>
                            <field name="branch_id"/>
                            <field name="create_date" string="Created On"/>
                            <field name="create_uid" string="Created By"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Schedule">
                            <field name="datas" widget="mps"/>
                        </page>
                        <page name="miscellaneous" string="Miscellaneous" invisible="0">
                            <group>
                                <group>
                                    <field name="bom_edit_history"/>
                                    <field name="plan_ids" widget="many2many_tags"/>
                                    <field name="order_ids" widget="many2many_tags"/>
                                    <field name="request_ids" widget="many2many_tags"/>
                                </group>
                                <group>
                                    <field name="forecast_edit_history"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_mrp_mps_form_reproduce" model="ir.ui.view">
        <field name="name">view.mrp.mps.form.reproduce</field>
        <field name="model">mrp.mps</field>
        <field name="priority" eval="100"/>
        <field name="arch" type="xml">
            <form string="Reproduce">
                <header>
                    <button name="action_create_production_draft" string="Create Production Draft" type="object" class="oe_highlight"/>
                    <button name="action_submit_material_request" string="Submit Material Request" type="object" class="oe_highlight"/>
                </header>
                <sheet>
                    <field name="reproduce_action" widget="radio" required="1" style="display: flex; flex-direction: row; background-color: transparent !important;"/>

                    <group invisible="1">
                        <group>
                            <field name="description"/>
                            <label for="date_from" string="Period"/>
                            <div class="o_row">
                                From 
                                <field name="date_from" class="oe_inline mr-3"/>
                                To 
                                <field name="date_to" class="oe_inline"/>
                            </div>
                            <field name="warehouse_id"/>
                            <field name="product_ids" widget="many2many_tags" required="1"/>
                            <field name="period_type" invisible="1"/>
                        </group>
                        <group>
                            <field name="company_id" force_save="1"/>
                            <field name="branch_id"/>
                            <field name="create_date" string="Created On"/>
                            <field name="create_uid" string="Created By"/>
                        </group>
                    </group>

                    <field name="datas" widget="mps" options="{'is_reproduce': 1}"/>

                    <notebook>
                        <page name="miscellaneous" string="Miscellaneous" invisible="1">
                            <group>
                                <group>
                                    <field name="bom_edit_history"/>
                                </group>
                                <group>
                                    <field name="forecast_edit_history"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_mrp_mps_search" model="ir.ui.view">
        <field name="name">view.mrp.mps.search</field>
        <field name="model">mrp.mps</field>
        <field name="arch" type="xml">
            <search string="Master Production Schedule">
                <field name="name"/>
                <field name="description"/>
                <field name="warehouse_id"/>

                <filter name="state_draft" string="Draft" domain="[('state', '=', 'draft')]"/>
                <filter name="state_progress" string="In Progress" domain="[('state', '=', 'progress')]"/>
                <filter name="state_close" string="Close" domain="[('state', '=', 'close')]"/>
                <group>
                    <filter name="groupby_date_from" string="Date" context="{'group_by': 'date_from'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="action_view_mrp_mps" model="ir.actions.act_window">
        <field name="name">Master Production Schedule</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">mrp.mps</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_mrp_mps_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No product yet. Try changing warehouses, remove the filters, or add new one.
            </p>
            <p>
                The master schedule translates your sales and demand forecasts into a production and purchase planning for each component.
                It ensures everything gets scheduled on time, based on constraints such as: safety stock, production capacity, lead times.
                It's the perfect tool to support your S&amp;OP meetings.
              </p>
        </field>
    </record>

</odoo>