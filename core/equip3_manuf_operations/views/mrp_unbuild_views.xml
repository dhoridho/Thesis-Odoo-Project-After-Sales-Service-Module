<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record model="ir.ui.view" id="equip3_mrp_unbuild_form_view">
        <field name="name">equip3.mrp.unbuild.form</field>
        <field name="model">mrp.unbuild</field>
        <field name="inherit_id" ref="mrp.mrp_unbuild_form_view"/>
        <field name="arch" type="xml">
            <!-- FORM INHERIT -->
            <xpath expr="//field[@name='product_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit':True}</attribute>
            </xpath>
            <xpath expr="//field[@name='bom_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit':True}</attribute>
            </xpath>
            <xpath expr="//field[@name='mo_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit':True}</attribute>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="attributes">
                <attribute name="options">{'no_create': True, 'no_create_edit':True}</attribute>
            </xpath>
            <xpath expr="//field[@name='bom_id']" position="after">
                <xpath expr="//field[@name='mo_id']" position="move"/>
                <xpath expr="//field[@name='location_id']" position="move"/>
                <xpath expr="//field[@name='location_dest_id']" position="move"/>
            </xpath>
            <xpath expr="//field[@name='lot_id']" position="attributes">
                <attribute name="invisible">1</attribute>
                <attribute name="attrs">{}</attribute>
            </xpath>
            <xpath expr="//label[@for='product_qty']" position="attributes">
                <attribute name="invisible">1</attribute>
                <atttribute name="attrs">{}</atttribute>
            </xpath>
            <xpath expr="//field[@name='product_qty']/parent::div" position="attributes">
                <attribute name="invisible">1</attribute>
                <atttribute name="attrs">{}</atttribute>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="attributes">
                <attribute name="attrs">{
                    'invisible': [('mo_id', '!=', False)],
                    'required': [('mo_id', '=', False)]
                }</attribute>
            </xpath>
            
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="is_branch_required" invisible="1"/>
                <field name="branch_id" attrs="{'required': [('is_branch_required', '=', True)]}" options="{'no_create': True, 'no_create_edit': True}"/>
                <field name="create_date" readonly="1"/>
                <field name="create_uid" readonly="1"/>
            </xpath>

            <xpath expr="//field[@name='bom_id']" position="attributes">
                <attribute name="attrs">{
                    'required': [('mo_id', '=', False)], 
                    'readonly': ['|', ('mo_id','!=',False), ('state', '=', 'done')], 
                    'invisible': [('mo_id', '!=', False), ('mo_bom_id', '=', False)]
                    }</attribute>
            </xpath>

            <xpath expr="//form/sheet" position="inside">
                <notebook>
                    <page string="Finished" name="finished">
                        <field name="line_finished_ids">
                            <tree string="Finished" delete="false" create="false" editable="bottom">
                                <field name="move_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="location_id" string="From" readonly="1" force_save="1"/>
                                <field name="location_dest_id" string="To" readonly="1" force_save="1"/>
                                <field name="product_id" string="Finished Goods" readonly="1" force_save="1"/>
                                <field name="lot_id" attrs="{'readonly': ['|', '|', ('parent.mo_id', '!=', False), ('has_tracking', '=', 'none'), ('parent.state', '=', 'done')], 'required': [('has_tracking', '!=', 'none')]}" domain="lot_domain" force_save="1"/>
                                <field name="product_uom_qty" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.mo_id', '=', False)]}"/>
                                <field name="unbuild_qty" optional="hide"/>
                                <field name="to_unbuild_qty" attrs="{'readonly': [('parent.state', '=', 'done')]}"/>
                                <field name="available_qty" optional="hide"/>
                                <field name="product_uom" string="UoM" readonly="1" force_save="1"/>
                                <field name="finished_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="lot_domain" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Materials" name="components">
                        <field name="line_raw_ids">
                            <tree string="Materials" delete="false" create="false" editable="bottom">
                                <field name="move_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="location_id" string="From" readonly="1" force_save="1"/>
                                <field name="location_dest_id" string="To" readonly="1" force_save="1"/>
                                <field name="product_id" string="Material" readonly="1" force_save="1"/>
                                <field name="lot_id" attrs="{'readonly': ['|', ('parent.mo_id', '!=', False), ('has_tracking', '=', 'none')], 'required': [('has_tracking', '!=', 'none')]}" domain="lot_domain" force_save="1"/>
                                <field name="product_uom_qty" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.mo_id', '=', False)]}"/>
                                <field name="unbuild_qty" optional="hide"/>
                                <field name="to_unbuild_qty" readonly="1" force_save="1"/>
                                <field name="available_qty" optional="hide"/>
                                <field name="product_uom" string="UoM" readonly="1" force_save="1"/>
                                <field name="bom_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="lot_domain" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="By-Products" name="byproducts" attrs="{'invisible': [('line_byproduct_ids', '=', [])]}">
                        <field name="line_byproduct_ids">
                            <tree string="By-Products" delete="false" create="false" editable="bottom">
                                <field name="move_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="location_id" string="From" readonly="1" force_save="1"/>
                                <field name="location_dest_id" string="To" readonly="1" force_save="1"/>
                                <field name="product_id" string="By-Product" readonly="1" force_save="1"/>
                                <field name="lot_id" attrs="{'readonly': ['|', ('parent.mo_id', '!=', False), ('has_tracking', '=', 'none')], 'required': [('has_tracking', '!=', 'none')]}" domain="lot_domain" force_save="1"/>
                                <field name="product_uom_qty" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.mo_id', '=', False)]}"/>
                                <field name="unbuild_qty" optional="hide"/>
                                <field name="to_unbuild_qty" readonly="1" force_save="1"/>
                                <field name="available_qty" optional="hide"/>
                                <field name="product_uom" string="UoM" readonly="1" force_save="1"/>
                                <field name="byproduct_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="lot_domain" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
            </xpath>

            <xpath expr="//button[@name='action_validate']" position="replace">
                <button name="action_validate" string="Unbuild" type="object" states="draft" class="oe_highlight"/>
            </xpath>
        </field>
    </record>

    <record id="mrp_unbuild_form_view_simplified" model="ir.ui.view">
        <field name="name">mrp.unbuild.form.simplified</field>
        <field name="model">mrp.unbuild</field>
        <field name="inherit_id" ref="mrp.mrp_unbuild_form_view_simplified"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='bom_id']" position="after">
                <xpath expr="//field[@name='mo_id']" position="move"/>
                <xpath expr="//field[@name='location_id']" position="move"/>
                <xpath expr="//field[@name='location_dest_id']" position="move"/>
            </xpath>
            <xpath expr="//field[@name='lot_id']" position="attributes">
                <attribute name="invisible">1</attribute>
                <attribute name="attrs">{}</attribute>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="after">
                <field name="branch_id" readonly="1" force_save="1"/>
            </xpath>
            <xpath expr="//field[@name='location_dest_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//label[@for='product_qty']" position="attributes">
                <attribute name="invisible">1</attribute>
                <atttribute name="attrs">{}</atttribute>
            </xpath>
            <xpath expr="//field[@name='product_qty']/parent::div" position="attributes">
                <attribute name="invisible">1</attribute>
                <atttribute name="attrs">{}</atttribute>
            </xpath>
            <xpath expr="//form/sheet" position="inside">
                <notebook>
                    <page string="Finished" name="finished">
                        <field name="line_finished_ids">
                            <tree string="Finished" delete="false" create="false" editable="bottom">
                                <field name="move_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="product_id" string="Finished Goods" readonly="1" force_save="1"/>
                                <field name="location_id" string="From" readonly="1" force_save="1"/>
                                <field name="location_dest_id" string="To" readonly="1" force_save="1"/>
                                <field name="lot_id" attrs="{'readonly': ['|', ('parent.mo_id', '!=', False), ('has_tracking', '=', 'none')], 'required': [('has_tracking', '!=', 'none')]}" domain="lot_domain" force_save="1"/>
                                <field name="product_uom_qty" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.mo_id', '=', False)]}"/>
                                <field name="unbuild_qty" optional="hide"/>
                                <field name="to_unbuild_qty"/>
                                <field name="available_qty" optional="hide"/>
                                <field name="product_uom" string="UoM" readonly="1" force_save="1"/>
                                <field name="finished_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="lot_domain" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="Materials" name="components">
                        <field name="line_raw_ids">
                            <tree string="Materials" delete="false" create="false" editable="bottom">
                                <field name="move_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="location_id" string="From" readonly="1" force_save="1"/>
                                <field name="location_dest_id" string="To" readonly="1" force_save="1"/>
                                <field name="product_id" string="Material" readonly="1" force_save="1"/>
                                <field name="lot_id" attrs="{'readonly': ['|', ('parent.mo_id', '!=', False), ('has_tracking', '=', 'none')], 'required': [('has_tracking', '!=', 'none')]}" domain="lot_domain" force_save="1"/>
                                <field name="product_uom_qty" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.mo_id', '=', False)]}"/>
                                <field name="unbuild_qty" optional="hide"/>
                                <field name="to_unbuild_qty" readonly="1" force_save="1"/>
                                <field name="available_qty" optional="hide"/>
                                <field name="product_uom" string="UoM" readonly="1" force_save="1"/>
                                <field name="bom_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="lot_domain" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    <page string="By-Products" name="byproducts" attrs="{'invisible': [('line_byproduct_ids', '=', [])]}">
                        <field name="line_byproduct_ids">
                            <tree string="By-Products" delete="false" create="false" editable="bottom">
                                <field name="move_line_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="location_id" string="From" readonly="1" force_save="1"/>
                                <field name="location_dest_id" string="To" readonly="1" force_save="1"/>
                                <field name="product_id" string="By-Product" readonly="1" force_save="1"/>
                                <field name="lot_id" attrs="{'readonly': ['|', ('parent.mo_id', '!=', False), ('has_tracking', '=', 'none')], 'required': [('has_tracking', '!=', 'none')]}" domain="lot_domain" force_save="1"/>
                                <field name="product_uom_qty" readonly="1" force_save="1" attrs="{'column_invisible': [('parent.mo_id', '=', False)]}"/>
                                <field name="unbuild_qty" optional="hide"/>
                                <field name="to_unbuild_qty" readonly="1" force_save="1"/>
                                <field name="available_qty" optional="hide"/>
                                <field name="product_uom" string="UoM" readonly="1" force_save="1"/>
                                <field name="byproduct_id" optional="hide" readonly="1" force_save="1"/>
                                <field name="has_tracking" invisible="1"/>
                                <field name="lot_domain" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

    <record id="mrp_unbuild_tree_view_inherit" model="ir.ui.view">
        <field name="name">mrp.unbuild.tree.view.inherit</field>
        <field name="model">mrp.unbuild</field>
        <field name="inherit_id" ref="mrp.mrp_unbuild_tree_view"/>
        <field name="arch" type="xml">
            <field name="name" position="attributes">
                <attribute name="string">Unbuild Order</attribute>
            </field>
            <field name="company_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
        </field>
    </record>

    <record id="mrp_unbuild_tree_view_inherit" model="ir.ui.view">
        <field name="name">mrp.unbuild.tree.view.inherit</field>
        <field name="model">mrp.unbuild</field>
        <field name="inherit_id" ref="mrp.mrp_unbuild_tree_view"/>
        <field name="arch" type="xml">
            <field name="name" position="attributes">
                <attribute name="string">Unbuild Order</attribute>
            </field>
            <field name="company_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
        </field>
    </record>

    <record id="view_mrp_unbuild_search" model="ir.ui.view">
        <field name="name">mrp.unbuild.list.select</field>
        <field name="model">mrp.unbuild</field>
        <field name="arch" type="xml">
            <search string="Search Material Unbuild">
                <searchpanel view_types="tree,kanban,pivot,graph">
                    <field name="product_id"/>
                    <field name="bom_id"/>
                    <field name="location_id"/>
                    <field name="state"/>
                </searchpanel>
            </search>
        </field>
    </record>

</odoo>
