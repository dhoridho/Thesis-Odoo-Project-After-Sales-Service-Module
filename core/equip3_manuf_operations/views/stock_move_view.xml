<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="view_move_form_inherited" model="ir.ui.view">
            <field name="name">stock.move.form.inherited</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='date_deadline']" position="after">
                    <field name="operation_id" string="Consumed in Operation" readonly="1"/>
                    <field name="allowed_operation_ids" invisible="1"/>
                </xpath>
            </field>
        </record>

        <record id="view_stock_move_operations_mrp_reserve_material" model="ir.ui.view">
            <field name="name">stock.move.operations.form.mrp.reserve.material</field>
            <field name="model">stock.move</field>
            <field name="inherit_id" ref="stock.view_stock_move_operations"/>
            <field name="mode">primary</field>
            <field name="priority">1001</field>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='product_id']" position="after">
                    <field name="mrp_reserve_next_sequence" readonly="1" force_save="1" invisible="1"/>
                </xpath>
                <xpath expr="//button[@special='save']" position="replace">
                    <button name="action_mrp_reserve_material_wizard" type="object" string="Confirm" class="oe_highlight"/>
                </xpath>
                <xpath expr="//button[@special='cancel']" position="replace">
                    <button name="action_mrp_reserve_material_wizard" type="object" string="Discard" context="{'is_discard': True}"/>
                </xpath>
                <xpath expr="//field[@name='move_line_ids']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//field[@name='move_line_ids']" position="after">
                    <field name="mrp_reserve_line_ids" 
                           attrs="{'readonly': ['|', ('state', '=', 'cancel'), '&amp;', ('state', '=', 'done'), ('is_locked', '=', True)]}" 
                           context="{
                                'default_product_uom_id': product_uom, 
                                'default_product_id': product_id,
                                'default_company_id': company_id,
                                'default_sequence': mrp_reserve_next_sequence
                        }">
                        <tree editable="bottom">
                            <field name="company_id" invisible="1" force_save="1"/>
                            <field name="product_uom_category_id" invisible="1"/>
                            <field name="product_id" invisible="1"/>
                            <field name="sequence"/>
                            <field name="lot_id" groups="stock.group_production_lot" width="1"
                                attrs="{'required': [('tracking', 'in', ('lot', 'serial'))]}"
                                domain="[('product_id', '=', parent.product_id), ('company_id', '=', company_id)]"
                                context="{
                                    'default_company_id': parent.company_id,
                                    'default_product_id': parent.product_id,
                                }"
                            />
                            <field name="tracking" invisible="1"/>
                            <field name="product_uom_qty" width="1" string="To Reserve" attrs="{'readonly': [('tracking', '=', 'serial')]}" force_save="1"/>
                            <field name="product_uom_id" width="1" options="{'no_open': True, 'no_create': True}" readonly="1" force_save="1" string="Unit of Measure" groups="uom.group_uom"/>
                        </tree>
                    </field>
                </xpath>
            </field>
        </record>
    </data>
</odoo>
