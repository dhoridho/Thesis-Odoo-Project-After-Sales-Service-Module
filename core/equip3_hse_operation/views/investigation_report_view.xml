<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="investigation_reports_employee_view_tree" model="ir.ui.view">
            <field name="name">Investigation.report.employee.view.tree</field>
            <field name="model">investigation.report.employee</field>
            <field name="arch" type="xml">
                <tree multi_edit="1" sample="1">
                    <field name="name"/>
                    <field name="employee_id"/>
                    <field name="employee_incident_id"/>
                    <field name="responsible_person"/>
                    <field name="state" widget="badge"/>
                </tree>
            </field>
        </record>

        <!-- form view -->
        <record id="investigation_reports_employee_view_form" model="ir.ui.view">
            <field name="name">Investigation.report.employee.view.form</field>
            <field name="model">investigation.report.employee</field>
            <field name="arch" type="xml">
                <form string="Investigation Report">
                    <header>
                        <button string="Process" states="draft" class="btn-primary"
                                name="action_process" type="object"/>
                        <button string="Complete" states="process" class="btn-primary"
                                name="action_complete" type="object"/>
                        <button string="Cancel" states="process"
                                name="action_cancel" type="object"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,process,done"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" />
                            </h1>
                        </div>
                        <group name="incident_group">
                            <group name="incident_left">
                                <field name="employee_incident_id" domain="[('state','=','investigation')]" attrs="{'readonly': [('state', 'in', ['done','cancel'])]}"/>
                                <field name="employee_id" readonly="1" force_save="1"/>
                                <field name="incident_category_id" readonly="1" force_save="1"/>
                                <field name="description" readonly="1" force_save="1"/>
                            </group>
                            <group name="incident_right">
                                <field name="responsible_person" attrs="{'readonly': [('state', 'in', ['done','cancel'])]}"/>
                                <field name="company_id"/>
                                <field name="branch_id" attrs="{'readonly': [('state', 'in', ['done','cancel'])]}"/>
                                <field name="create_uid"/>
                                <field name="create_date" string="Creation Date"/>
                            </group>
                        </group>
                        <notebook>
                            <page name="investigation_ids" string="Investigation Record">
                                <field name="investigation_ids" widget="one2many_list" force_save="1" attrs="{'readonly': [('state', 'in', ['draft','done','cancel'])]}">
                                    <tree editable='bottom'>
                                        <field name="inv_datetime" attrs="{'readonly': [('state', 'in', ['complete'])]}"/>
                                        <field name="Investigation_process" attrs="{'readonly': [('state', 'in', ['complete'])]}"/>
                                        <field name="Investigation_findigs" attrs="{'readonly': [('state', 'in', ['complete'])]}"/>
                                        <field name="state" widget="badge"/>
                                        <field name="complete_datetime" readonly='1' force_save='1'/>
                                        <button name="complete" attrs="{'invisible': [('state', '!=', 'investigation')]}" string="Complete" type="object" class="btn-primary oe_read_only"/>
                                    </tree>
                                </field>
                            </page>
                            <page name="action_ids" string="Action Checklist">
                                <field name="action_checklist_ids" widget="one2many_list" force_save="1" attrs="{'readonly': [('state', 'in', ['draft','done','done','cancel'])]}">
                                    <tree editable='bottom'>
                                        <field name="name"/>
                                        <field name="employee_incident_id" invisible="1"/>
                                        <field name="action_propose" force_save='1'/>
                                        <field name="state" widget="badge"/>
                                        <field name="is_hse_action_approval_matrix" invisible='1'/>
                                        <field name="approving_matrix_action_checklist_id" invisible="1"/>
                                        <field name="approvers_ids" invisible='1'/>
                                        <field name="approved_user_ids" invisible='1'/>
                                        <field name="is_approver" invisible='1'/>
                                        <field name="approved_user_text" invisible='1'/>
                                        <field name="approved_user" invisible='1'/>
                                        <field name="feedback_parent" invisible='1'/>
                                        <field name="employee_id" invisible='1'/>
                                        <field name="last_approved" invisible='1'/>
                                        <field name="action_checklist_user_ids" readonly="1" force_save="1" invisible="1"/>
                                        <button string="Propose Action" name="request_approval" type="object"
                                                class="btn-primary" attrs="{'invisible': ['|', ('is_hse_action_approval_matrix', '=', False), ('state', 'not in', ('draft'))]}"/>
                                        <button id='approve1' string="Take Action" name="btn_approve" type="object"
                                                class="btn-primary" attrs="{'invisible': ['|', ('is_hse_action_approval_matrix', '=', True), ('state', 'not in', ('draft'))]}"/>
                                        <!-- <button id='reject1' string="Reject Action" name="button_reject" type="object"
                                                class="btn-primary" attrs="{'invisible': ['|', ('is_hse_action_approval_matrix', '=', True), ('state', 'not in', ('draft'))]}"/> -->
                                        <button id='approve2' string="Take Action" name="btn_approve" type="object"
                                                class="btn-primary" attrs="{'invisible': ['|', ('is_hse_action_approval_matrix', '=', False), ('state', 'not in', ('to_approve'))]}"/>
                                        <button id='reject1' string="Reject Action" name="button_reject" type="object"
                                                class="btn-primary" attrs="{'invisible': ['|', ('is_hse_action_approval_matrix', '=', False), ('state', 'not in', ('to_approve'))]}"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter" name="chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
    

        <record id="action_view_investigation_reports_menu_tree" model="ir.actions.act_window">
            <field name="name">Employee Investigation Reports</field>
            <field name="res_model">investigation.report.employee</field>
            <field name="view_mode">tree,form</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No Employee Investigation Reports found. Let's create one!
                </p>
            </field>
        </record>

        <!-- Menu Configuration -->
        <menuitem id="hse_operations_menu"
            name = "Operations"
            parent="equip3_hse_masterdata.human_safety_environment_main"
            sequence="1"
        />

        <menuitem id="investigation_report_menu"
                  name="Investigation Reports"
                  parent="equip3_hse_operation.hse_operations_menu"
                  action="action_view_investigation_reports_menu_tree"
                  sequence="2"/>
    </data>
</odoo>