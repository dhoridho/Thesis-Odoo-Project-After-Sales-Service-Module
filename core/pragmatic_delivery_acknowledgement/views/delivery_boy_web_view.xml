<odoo>
    <data>
        <template id="pragmatic_odoo_delivery_boy.order-view-driver" name="Sale Order">
            <div id="spinner"/>
            <t t-call="website.layout">
                <div class="oe_structure">
                    <div class="container">
                        <div class="viewjoblist_mainsection">
                            <h5 class="background">
                                <span t-field="order.name"/>
                            </h5>
                            <!--                            <t t-if="order.delivery_state == 'assigned' and picking_order.state == 'accept'">-->
                            <!--                                <div class="row">-->
                            <!--                                    <div class="col-md-8"></div>-->
                            <!--                                    <div class="col-md-4">-->
                            <!--                                        <input type="button" style="background-color:#000;color:#fff;width:150px;-->
                            <!--    height:40px; font-weight: bold;" class="joblist_buttons joblist_pay_now" id="pay_now_button" value="PAY NOW"/>-->
                            <!--                                    </div>-->
                            <!--                                </div>-->
                            <!--                            </t>-->
                            <div class="row">
                                <div class="col-md-7">

                                    <div class="joblist_tablecoloumn">
                                        <div class="form-group field-name sizealign">
                                            <div>
                                                <input class="form-control" id="order_number" type="hidden" name="order_number" t-att-value="order.name" t-att-data-order_id="order.id"/>

                                                <input class="form-control" id="picking_order_number" type="hidden" name="picking_order_number" t-att-value="picking_order.id" t-att-data-order_id="picking_order.id"/>
                                            </div>

                                            <div class="joblist_left">
                                                <label class="control-label">Customer Name</label>
                                                <input class="form-control" type="text" name="customer_name" t-att-value="order.partner_id.name" readonly="readonly"/>
                                            </div>

                                            <div class="joblist_right">
                                                <label class="control-label">Order Source</label>
                                                <input class="form-control" type="text" name="order_source" value="Web" readonly="readonly"/>
                                            </div>
                                        </div>


                                        <div class="form-group field-name sizealign">
                                            <div class="joblist_left">
                                                <label class="control-label">Customer Phone</label>
                                                <div class="input-group mb-3">
                                                    <input class="form-control" type="text" name="customer_phone" id="customer_phone" t-att-value="order.partner_id.phone"/>
                                                    <div class="input-group-append">
                                                        <button class="btn btn-dark joblist_call_customer" type="button">Call</button>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="joblist_right">
                                                <label class="control-label">Payment Status</label>
                                                <input class="form-control" type="text" name="payment_status" t-att-value="picking_order_payment_status" readonly="readonly" />
                                            </div>
                                        </div>

                                        <div class="form-group field-name sizealign">
                                            <div class="joblist_right">
                                                <label class="control-label">Customer Address</label>
                                                <div class="address_col" t-field="order.partner_id" t-options='{"widget": "contact", "fields": ["address"], "no_marker": True, "phone_icons": True}'/>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="col-md-5">
                                    <div class="form-group field-name sizealign joblist_tablecoloumn">
                                        <div>
                                            <label class="control-label">Order Details</label>
                                            <div class="address_col">
                                                <table class="table table-condensed">

                                                    <thead>
                                                        <tr>
                                                            <th width="50%">Product Name</th>
                                                            <th width="10%" class="text-right">Qty</th>
                                                            <th width="20%" class="text-right">Demand</th>
                                                            <th width="20%" class="text-right">Done</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody class="sale_tbody" style="border-bottom:0px;">
                                                        <t t-if="not picking_order.back_order">
                                                            <t t-if="picking_order.state in ['picked','paid','delivered','payment_collect']">
                                                                <t t-foreach="picking_order.picking_id.move_ids_without_package" 
                                                                    t-as="lines">
                                                                    <tr>
                                                                        <td>
                                                                            <span t-field="lines.name"/>
                                                                        </td>
                                                                        <td class="text-right">
                                                                            <span t-field="lines.initial_demand"/>
                                                                        </td>
                                                                        <td class="text-right">
                                                                            <span t-field="lines.initial_demand"/>
                                                                        </td>
                                                                        <td class="text-right">
                                                                            <span t-field="lines.quantity_done"/>
                                                                        </td>
                                                                    </tr>
                                                                </t>
                                                            </t>
                                                            <t t-else="">
                                                                <t t-foreach="order.order_line" t-as="lines">
                                                                    <tr>
                                                                        <td>
                                                                            <span t-field="lines.name"/>
                                                                        </td>
                                                                        <td class="text-right">
                                                                            <span t-field="lines.product_uom_qty"/>
                                                                        </td>
                                                                        <td class="text-right">
                                                                            <span t-field="lines.product_uom_qty"/>
                                                                        </td>
                                                                    </tr>
                                                                </t>
                                                            </t>
                                                        </t>
                                                        <t t-else="">
                                                            <t t-foreach="picking_order.picking.move_ids_without_package" 
                                                                    t-as="lines">
                                                                <tr>
                                                                    <td>
                                                                        <span t-field="lines.name"/>
                                                                    </td>
                                                                    <td class="text-right">
                                                                        <span t-field="lines.initial_demand"/>
                                                                    </td>
                                                                    <td class="text-right">
                                                                        <span t-field="lines.product_uom_qty"/>
                                                                    </td>
                                                                    <td class="text-right">
                                                                        <span t-field="lines.quantity_done"/>
                                                                    </td>
                                                                </tr>
                                                            </t>
                                                        </t>
                                                    </tbody>
                                                    <footer>
                                                        <tr style="border-bottom:0px;">
                                                            <td style="border-bottom:0px;">
                                                            </td>
                                                        </tr>
                                                        <tr style="border-top:0px;">
                                                            <td style="border-top:0px;font-weight: bold;" class="text-center" colspan="3">
                                                                <span>Total Price</span>
                                                            </td>
                                                            <t t-if="picking_order.state in ['picked','paid','delivered','payment_collect']">
                                                                <t t-set="total" t-value="0"/>
                                                                <t t-foreach="picking_order.picking_id.move_ids_without_package" t-as="o">
                                                                    <t t-foreach="order.order_line" t-as="so">
                                                                        <t t-if="o.product_id.id == so.product_id.id and so.tax_id">
                                                                            <t t-set="total" 
                                                                            t-value="total + ((o.quantity_done * so.price_unit) + 
                                                                            (o.quantity_done * so.price_unit * so.tax_id.amount / 100))"/>
                                                                        </t>
                                                                        <t t-if="o.product_id.id == so.product_id.id and not so.tax_id">
                                                                            <t t-set="total" 
                                                                            t-value="total + ((o.quantity_done * so.price_unit))"/>
                                                                        </t>
                                                                    </t>
                                                                </t>
                                                                <td style="border-top:0px;" class="text-right">
                                                                    <span t-esc="total" t-options='{"widget": "float", "precision": 2}'/>
                                                                </td>
                                                            </t>
                                                            <t t-else="">
                                                                <td style="border-top:0px;" class="text-right">
                                                                    <span t-field="order.amount_total"/>
                                                                </td>
                                                            </t>
                                                        </tr>
                                                    </footer>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="viewjoblist_button">
                                        <t t-if="picking_order.state == 'assigned'">
                                            <div class="col-sm-2">
                                                <button class="joblist_buttons joblist_accept_order">Accept Order
                                                </button>
                                            </div>
                                            <div class="col-sm-2">
                                                <a style="float:left;" href="#select_driver" data-toggle="modal" 
                                                    data-target="#driver_deny_order" data-oe-model="ir.ui.view" 
                                                    data-oe-id="1164" data-oe-field="arch" 
                                                    data-oe-xpath="/t[1]/t[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[2]/div[5]/div[2]/a[1]" 
                                                    class="joblist_buttons back_and_issue" 
                                                    data-order-steps="delivered">
                                                    Deny Order
                                                </a>
                                            </div>
                                        </t>
                                        <t t-if="picking_order.state == 'paid'">
                                            <t t-if="picking_order_payment_status == 'Paid' or picking_order.acquirer_type == 'bank'">

                                                <!--                                            <t t-if="picking_order_payment_status == 'Paid' and picking_order.acquirer_type != 'cash'">-->
                                                <div t-if="picking_order.state in ['picked','paid']">
                                                    <t t-if="picking_order.customer_code == False">
                                                        <input class="joblist_buttons joblist_delivered_order" 
                                                               t-att-data-order_id="order.id" id="delivered_button" 
                                                               type="button" value="Deliver Order">
                                                        </input>
                                                    </t>
                                                    <p t-if="picking_order.customer_code" style="text-align:center;">
                                                        <a style="float:left;" href="#select_driver" data-toggle="modal" 
                                                           data-target="#driver_delivery_code" data-oe-model="ir.ui.view" 
                                                           data-oe-id="1164" data-oe-field="arch" 
                                                           data-oe-xpath="/t[1]/t[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[2]/div[5]/div[2]/a[1]" 
                                                           class="joblist_buttons back_and_issue" 
                                                           data-order-steps="delivered">
                                                           Order Delivered
                                                        </a>
                                                    </p>
                                                </div>
                                            </t>
                                        </t>
                                            <!--                                            <div>-->
                                            <!--                                                <button class="joblist_buttons joblist_cancel_order_driver"-->
                                            <!-- t-att-data-order_id="order.id">Cancel Order-->
                                            <!--                                                </button>-->
                                            <!--                                            </div>-->

                                            <t t-if="picking_order.state in ['picked'] and picking_order.acquirer_type == 'cash'">
                                                <a type="button" style="background-color:#000;color:#fff;width:150px;
                                                        height:42; font-weight: bold; font-size:14px;" class="text-center joblist_buttons joblist_pay_now" id="pay_now_button">Receive Payment</a>
                                            </t>

                                            <div t-if="picking_order.state == 'accept'">
                                                <p style="text-align:center;">
                                                    <a style="float:left;" href="#select_driver" data-toggle="modal" 
                                                        data-target="#picked_picking_in_website_div" data-oe-model="ir.ui.view" 
                                                        data-oe-id="1164" data-oe-field="arch" 
                                                        class="joblist_buttons back_and_issue">
                                                            Picked
                                                    </a>
                                                </p>
                                                <!-- <button class="joblist_buttons joblist_picked_order_to_wizard">Picked
                                                </button> -->
                                            </div>
                                            <t t-if="picking_order.state in ['accept','picked'] or picking_order.state == 'paid'">
                                                <div>
                                                    <p style="text-align:center;">
                                                        <a style="float:left;" href="/page/job/list/driver" 
                                                        class="joblist_buttons back_and_issue">
                                                                Back
                                                        </a>
                                                    </p>
                                                </div>

                                                <div>
                                                    <p style="text-align:center;">
                                                        <a style="float:left;" href="#select_driver" data-toggle="modal" 
                                                        data-target="#driver_issue" data-oe-model="ir.ui.view" 
                                                        data-oe-id="1164" data-oe-field="arch" 
                                                        data-oe-xpath="/t[1]/t[1]/div[1]/div[1]/div[1]/div[2]/div[1]/div[2]/div[5]/div[2]/a[1]" 
                                                        class="joblist_buttons back_and_issue" 
                                                        data-order-steps="delivered">
                                                            Issue
                                                        </a>
                                                    </p>
                                                </div>
                                            </t>

                                            <t t-if="picking_order.state in ['paid']">
                                                <t t-if="picking_order.back_order_boolean != True">
                                                    <t t-foreach="picking_order.picking_id.move_ids_without_package" t-as="lines">
                                                        <t t-if="lines.initial_demand &gt; lines.quantity_done">
                                                            <a type="button" style="background-color:#000;color:#fff;width:180px;
                                                                height:42; font-weight: bold; font-size:14px;" class="text-center joblist_buttons create_backorder" id="create_back_order">Create Backorder</a>
                                                        </t>
                                                    </t>
                                                </t>
                                            </t>


                                            <!--                                            <div>-->
                                            <!--                                                <button class="joblist_buttons joblist_call_customer"-->
                                            <!-- style="width: 120px;">-->
                                            <!--                                                    Call Customer-->
                                            <!--                                                </button>-->

                                            <!--                                            </div>-->
                                        <!-- </t> -->


                                        <div class="choose_driversection">
                                            <div id="driver_issue" class="modal fade" tabindex="-1" 
                                                role="dialog" aria-labelledby="label" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div id="loading-indicator" style="display:none"/>
                                                        <div class="choose_driverpopup">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal" 
                                                                        aria-hidden="true"></button>
                                                                <img 
                                                                        src="/pragmatic_delivery_control_app/static/src/img/driver_pop.png" 
                                                                        alt=""/>
                                                                <h3 class="modal-title" id="label">Please enter
                                                                    message demo
                                                                </h3>
                                                            </div>
                                                            <div class="modal-body driver-list">
                                                                <textarea name="message_driver" id="message_driver" 
                                                                          style="height: 104px; width: 604px; padding-left: 2px;">Customer Not Available</textarea>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn cancelbtn" 
                                                                        data-dismiss="modal">Cancel
                                                                </button>
                                                                <button type="button" 
                                                                        class="btn cancelbtn confirm_driver" data-dismiss="modal">Ok
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div id="picked_picking_in_website_div" class="modal fade" tabindex="-1" 
                                                role="dialog" aria-labelledby="label" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered" role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="picked_picking_website">Picking</h5>
                                                        </div>
                                                        <div class="modal-body">
                                                                <div class="row">
                                                                    <div class="column" style="width: 20%">
                                                                            No
                                                                    </div>
                                                                    <div class="column" style="width: 20%">
                                                                            Product
                                                                    </div>
                                                                    <div class="column" style="width: 20%">
                                                                            Location
                                                                    </div>
                                                                    <div class="column" style="width: 20%">
                                                                            Demand
                                                                    </div>
                                                                    <div class="column" style="width: 20%">
                                                                            Done
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <t t-set="no" t-value="1"/>
                                                                    <t t-foreach="picking_order.picking.move_ids_without_package" t-as="lines">
                                                                        <!-- <div class="column" style="width: 20%">
                                                                            <span t-esc="order"/>
                                                                        </div> -->
                                                                        <!-- <div class="column" style="width: 20%">
                                                                            <span t-esc="picking_order"/>
                                                                        </div> -->
                                                                        <!-- <div class="column" style="width: 20%">
                                                                            <span t-esc="stock_pickings"/>
                                                                        </div> -->
                                                                        <div class="column" style="width: 20%">
                                                                            <span t-esc="no"/>
                                                                        </div>
                                                                        <div class="column" style="width: 20%">
                                                                            <span t-att-data-id="lines.product_id.id" id="product_id" t-field="lines.product_id"/>
                                                                        </div>
                                                                        <div class="column" style="width: 20%">
                                                                            <span t-att-data-id="lines.location_id.id" id="stocklocation_id" t-field="lines.location_id.complete_name"/>
                                                                        </div>
                                                                        <div class="column" style="width: 20%">
                                                                            <span id="quantity_demand" t-field="lines.product_uom_qty"/>
                                                                        </div>
                                                                        <div class="column" style="width: 20%">
                                                                            <input class="form-control" type="text" name="quantity_done" id="quantity_done" t-att-value="lines.quantity_done"/>
                                                                        </div>
                                                                        <t t-set="no" t-value="no+1"/>
                                                                    </t>
                                                                </div>
                                                        </div>
                                                        <div class="modal-content">
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn cancelbtn" data-dismiss="modal">Cancel
                                                                </button>
                                                                <div class="col-xs-12">
                                                                    <button class="btn btn-primary btn-lg joblist_picked_order_after_wizard">Ok</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <form action="/get_acknowledgement_code" method="post" class="checkout_autoformat">
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                                <p class="alert alert-danger" t-if="error" role="alert">
                                                    <t t-esc="error"/>
                                                </p>
                                                <div id="driver_delivery_code" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="label" aria-hidden="true">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div id="loading-indicator" style="display:none"/>
                                                            <div class="choose_driverpopup">
                                                                <div class="modal-header">
                                                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                                                                    <img 
                                                                            src="/pragmatic_delivery_control_app/static/src/img/driver_pop.png" 
                                                                            alt=""/>
                                                                    <h3 class="modal-title" id="label">Please enter Delivery Acknowledgement Code
                                                                    </h3>
                                                                </div>
                                                                <div class="modal-body driver-list">
                                                                    <input type="text" class="form-control" name="customer_code" required='1'/>
                                                                    <input class="form-control" id="picking_order_number" type="hidden" 
                                                            name="picking_order_number" 
                                                            t-att-value="order.name" t-att-data-order_id="order.name"/>
                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn cancelbtn" 
                                                                            data-dismiss="modal">Cancel
                                                                    </button>
                                                                    <div class="col-xs-12">
                                                                        <button class="btn btn-primary btn-lg">Ok</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>

                                            <div id="driver_deny_order" class="modal fade" tabindex="-1" 
                                                 role="dialog" aria-labelledby="label" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div id="loading-indicator" style="display:none"/>
                                                        <div class="choose_driverpopup">
                                                            <div class="modal-header">
                                                                <button type="button" class="close" data-dismiss="modal" 
                                                                        aria-hidden="true"></button>
                                                                <img src="/pragmatic_delivery_control_app/static/src/img/driver_pop.png" alt=""/>
                                                                <h3 class="modal-title" id="label">
                                                                    Please Enter Reject Reason
                                                                </h3>
                                                            </div>
                                                            <div class="modal-body driver-list">
                                                                <textarea name="reject_reason" id="reject_reason" style="height: 104px; width: 604px; padding-left: 2px;" required='1'/>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn cancelbtn" 
                                                                        data-dismiss="modal">Cancel
                                                                </button>
                                                                <button type="button" 
                                                                        class="btn cancelbtn joblist_deny_order" data-dismiss="modal">Ok
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>

        <template id="error_popup" name="Error Popup">
            <t t-call="website.layout">
                <div class="container">
                    <div>
                        <form action="/page/job/list/driver" method="post" class="checkout_autoformat" >
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                            <p class="alert alert-danger" t-if="error" role="alert">
                                <t t-esc="error"/>
                            </p>
                            <div class="col-xs-12">
                                <button class="btn btn-primary btn-lg">Re-Enter</button>
                            </div>
                        </form>
                    </div>
                </div>
            </t>
        </template>
    </data>
</odoo>
