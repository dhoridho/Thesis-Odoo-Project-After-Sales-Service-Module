<templates>
    <t t-name="BudgetAnalysisReportTemplate">
        <div class="o_view_agri_report">
            <div class="o_agri_report_header"></div>
            <div class="o_agri_report_content">
            </div>
        </div>
    </t>
    
    <t t-name="BudgetAnalysisReportHeader">
        <div class="o_agri_report_title">
            <h1>Budget Analysis Report</h1>
        </div>

        <div class="o_agri_control_panel">
            <div class="o_panel_left">
                <div class="o_report_buttons">
                    <button type="button" class="o_print_pdf btn btn-primary mr-2">Print (PDF)</button>
                    <button type="button" class="o_print_xlsx btn btn-primary" id="xlsx">Export (XLSX)</button>
                </div>
            </div>
            <div class="o_panel_right">
                <div class="o_report_filter">
                    <div class="o_filter mr-2">
                        <div class="dropleft o_filter_date">
                            <t t-set="filter_date" t-value="filters['filter_date']"/>
                            <a class="btn btn-secondary dropdown-toggle o_filter_date_btn" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" t-att-data-filter-date="filter_date['active'][0]">
                                <t t-esc="filter_date['active'][1]"/>
                            </a>
                            <ul class="dropdown-menu o_filter_date_dropdown" aria-labelledby=".o_filter_date_btn">
                                <t t-foreach="filter_date['selection']" t-as="selection">
                                    <t t-if="selection[0] != 'custom'">
                                        <t t-if="selection[0] == 'last_month'">
                                            <li class="dropdown-divider"></li>
                                        </t>
                                        <li><a class="dropdown-item o_filter_date_item" href="#" t-att-data-filter-date="selection[0]">
                                            <t t-esc="selection[1]"/>
                                        </a></li>
                                    </t>
                                </t>
                                <li class="dropdown-divider"></li>
                                <li class="o_filter_date_custom">
                                    <a class="dropdown-item o_filter_date_custom_btn" data-toggle="collapse" href="#" role="button" aria-expanded="false">
                                        Custom
                                    </a>
                                    <div class="collapse o_filter_date_custom_collapse">
                                        <div class="o_filter_date_custom_container">
                                            <div class="o_custom_date_from"></div>
                                            <div class="o_custom_date_to mt-2"></div>
                                            <button class="btn btn-sm btn-secondary w-100 mt-2 o_apply_custom_date">Apply</button>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="o_apply">
                        <button type="button" class="o_apply_filter btn btn-primary">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <t t-name="BudgetAnalysisReportTable">

        <table class="table o_table_agri_report">
            <thead>
                <tr>
                    <th rowspan="2" class="o_title o_freeze">Division</th>
                    <th rowspan="2" class="o_title o_freeze">Area</th>
                    <t t-foreach="header" t-as="head">
                        <th colspan="2" class="o_month"><t t-esc="head"/></th>
                    </t>
                    <th colspan="2" class="o_month">Total</th>
                </tr>
                <tr>
                    <t t-foreach="header">
                        <th class="o_value">Planned</th>
                        <th class="o_value">Actual</th>
                    </t>
                    <th class="o_value">Planned</th>
                    <th class="o_value">Actual</th>
                </tr>
            </thead>

            <t t-foreach="data['children']" t-as="division">
                <tbody class="o_row" data-toggle="collapse" t-attf-data-target=".row_{{division['id']}}" aria-expanded="false">
                    <tr>
                        <td class="o_freeze">
                            <span class="fa fa-caret-right" role="img" aria-label="Unfolded" title="Unfolded"></span>
                            <t t-esc="division['name']"/>
                        </td>
                        <td class="o_freeze"><t t-esc="division['area']"/></td>

                        <t t-set="total_division_planned" t-value="0.0"/>
                        <t t-set="total_division_actual" t-value="0.0"/>
                        <t t-foreach="division['months']" t-as="division_month">
                            <td class="o_value"><t t-esc="formatFloat(division_month_value['planned'])"/></td>
                            <td class="o_value"><t t-esc="formatFloat(division_month_value['actual'])"/></td>
                            <t t-set="total_division_planned" t-value="total_division_planned + division_month_value['planned']"/>
                            <t t-set="total_division_actual" t-value="total_division_actual + division_month_value['actual']"/>
                        </t>

                        <td class="o_value o_total"><t t-esc="formatFloat(total_division_planned)"/></td>
                        <td class="o_value o_total"><t t-esc="formatFloat(total_division_actual)"/></td>
                    </tr>
                </tbody>
                <tbody t-attf-class="collapse row_{{division['id']}}">
                    <t t-foreach="division['children']" t-as="activity">
                        <tr>
                            <td class="o_activity o_freeze">
                                <div class="dropdown o_record">
                                    <a class="o_record_dropdown dropdown-toggle">
                                        <span t-esc="activity['name']"/>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <a class="dropdown-item o_view_record" href="#" 
                                            t-att-data-name="activity['name']" 
                                            t-att-data-model="activity['model']" 
                                            t-att-data-res_id="activity['id']">
                                                View Activity
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item o_view_activity_record" href="#" 
                                            t-att-data-division-id="division['id']" 
                                            t-att-data-activity-id="activity['id']">
                                                View Plantation Record
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item o_view_budget_plan" href="#" 
                                            t-att-data-division-id="division['id']"
                                            t-att-data-activity-id="activity['id']">
                                                View Budget Planning
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </td>
                            <td class="o_freeze"></td>
                            <t t-set="total_activity_planned" t-value="0.0"/>
                            <t t-set="total_activity_actual" t-value="0.0"/>
                            <t t-foreach="activity['months']" t-as="activity_month">
                                <td class="o_value"><t t-esc="formatFloat(activity_month_value['planned'])"/></td>
                                <td class="o_value"><t t-esc="formatFloat(activity_month_value['actual'])"/></td>
                                <t t-set="total_activity_planned" t-value="total_activity_planned + activity_month_value['planned']"/>
                                <t t-set="total_activity_actual" t-value="total_activity_actual + activity_month_value['actual']"/>
                            </t>
                            <td class="o_value o_total"><t t-esc="formatFloat(total_activity_planned)"/></td>
                            <td class="o_value o_total"><t t-esc="formatFloat(total_activity_actual)"/></td>
                        </tr>
                    </t>
                </tbody>
            </t>
        </table>
    </t>

</templates>