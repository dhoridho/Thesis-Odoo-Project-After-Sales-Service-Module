<?xml version="1.0" encoding="utf-8"?>
<odoo>


    <record id="pos_payment_method_view_tree" model="ir.ui.view">
        <field name="name">pos.payment.method.form</field>
        <field name="model">pos.payment.method</field>
        <field name="inherit_id" ref="point_of_sale.pos_payment_method_view_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='is_cash_count']" position="after">
                <field name="is_bank"/>
                <field name="is_receivables"/>
                <field name="fullfill_amount"/>
                <field name="shortcut_keyboard"/>
                <field name="cheque_bank_information"/>
                <field name="discount"/>
            </xpath>
        </field>
    </record>

    <record id="pos_view_pos_payment_method_form" model="ir.ui.view">
        <field name="name">pos.payment.method.form.view.inherit</field>
        <field name="model">pos.payment.method</field>
        <field name="inherit_id" ref="point_of_sale.pos_payment_method_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet/group[@name='Payment methods']" position="attributes">
                <attribute name="col">3</attribute>
            </xpath>
            <xpath expr="//field[@name='receivable_account_id']" position="attributes">
                <attribute name="domain">[('user_type_id.type', '=', 'receivable')]</attribute>
            </xpath>
            <xpath expr="//field[@name='use_payment_terminal']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='is_cash_count']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='cash_journal_id']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <xpath expr="//field[@name='receivable_account_id']" position="after">
                <field name="account_journal_id" 
                    widget="selection"
                    domain="[('company_id','=',company_id), ('type','in',('bank','cash'))]" required="1"/>
            </xpath>
            <xpath expr="//field[@name='use_payment_terminal']" position="before">
                <field name="is_cash_count"/>
                <field name="is_bank"/>
                <field name="is_receivables"/>
                <field name="able_use_card"/>
            </xpath>
            <xpath expr="//field[@name='company_id']" position="before">
                <field name="shortcut_keyboard"/>
                <field name="hide_use_payment_terminal" invisible="1"/>
                <field name="use_payment_terminal" attrs="{'invisible': [('hide_use_payment_terminal', '=', True)]}"/>
                <field name="is_mdr"/>
            </xpath>
            <xpath expr="//sheet/group[@name='Payment methods']/group[last()]" position="after">
                <group>
                    <field name="cash_journal_id" attrs="{'invisible': [('is_cash_count', '=', False)], 'required': [('is_cash_count', '=', True)]}"/>
                    <field name="fullfill_amount"/>
                    <field name="cheque_bank_information"/>
                    <field name="discount"/>
                    <field name="discount_type"
                           attrs="{'required': [('discount', '=', True)], 'invisible': [('discount', '=', False)]}"/>
                    <field name="discount_amount"
                           attrs="{'required': [('discount', '=', True)], 'invisible': [('discount', '=', False)]}"/>
                    <field name="discount_product_id"
                           attrs="{'required': [('discount', '=', True)], 'invisible': [('discount', '=', False)]}"/>
                </group>
            </xpath>
            <xpath expr="//sheet/group[@name='Payment methods']" position="after">
                <notebook>
                    <page name="custom_point_of_sale" string="Point of Sale">
                        <group>
                            <group>
                                <field name="jr_use_for"/>
                                <field name="generate_invoice"/>
                                <field name="invoice_partner_id" 
                                    domain="[('is_pos_partner', '=', True)]"
                                    context="{'default_is_pos_partner':True}"
                                    attrs="{'invisible': [('generate_invoice', '=', False)],'required': [('generate_invoice', '=', True)]}"/>
                                <!-- <field name="accrued_receivable_id" attrs="{'invisible': [('generate_invoice', '=', False)],'required': [('generate_invoice', '=', True)]}"/> -->
                            </group>
                        </group>
                    </page>
                    <page name="card_payment_and_mdr" string="Card Payment &#38; MDR" attrs="{'invisible': [('is_mdr', '=', False)]}">
                        <group>
                            <field name="is_mdr_discount"/>
                            <field name="mdr_paid_by" attrs="{'invisible': ['|',('is_mdr', '=', False),('is_mdr_discount', '=', False)],'required': [('is_mdr', '=', True),('is_mdr_discount', '=', True)]}"/>
                            <field name="mdr_intermediary_account_id" attrs="{'invisible': ['|',('is_mdr', '=', False),('is_mdr_discount', '=', False)],'required': [('is_mdr', '=', True),('is_mdr_discount', '=', True)]}"/>
                        </group>
                        <field name="mdr_ids">
                            <tree editable="bottom">
                                <field name="mdr_type" required="1"/>
                                <field name="name" required="1"/>
                                <field name="card_group_ids" attrs="{'required': [('mdr_type', '!=', 'QRIS')]}"  widget="many2many_tags"/>
                                <field name="card_payment_ids" attrs="{'required': [('mdr_type', '!=', 'QRIS')]}" widget="many2many_tags" domain="[('card_group','in',card_group_ids),('card_type','=',card_type)]"/>
                                <field name="percentage" required="1" attrs="{'column_invisible': [('parent.is_mdr_discount', '=', False)],'required': [('mdr_type', '!=', 'QRIS')]}" />
                                <field name="surcharge" required="0" attrs="{'column_invisible': [('parent.is_mdr_discount', '=', False)]}" />
                                <field name="card_type" invisible="1"/>
                            </tree>
                        </field>
                    </page>
                    <page name="payment_charges" string="Payment Charges">
                        <group>
                            <group>
                                <field name="apply_charges"/>
                                <field name="fees_amount"
                                       attrs="{'invisible':[('apply_charges' ,'!=',True)],'required':[('apply_charges' ,'=',True)]}"/>
                            </group>
                            <group>
                                <field name="fees_type"
                                       attrs="{'invisible':[('apply_charges' ,'!=',True)],'required':[('apply_charges' ,'=',True)]}"/>
                                <field name="fees_product_id"
                                       attrs="{'invisible':[('apply_charges' ,'!=',True)],'required':[('apply_charges' ,'=',True)]}"/>
                            </group>
                        </group>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

</odoo>
