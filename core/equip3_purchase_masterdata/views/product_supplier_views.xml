<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
		<record id="product_supplierinfo_form_view_inherit" model="ir.ui.view">
			<field name="name">product.supplierinfo.form.view.inherit</field>
			<field name="model">product.supplierinfo</field>
			<field name="inherit_id" ref="product.product_supplierinfo_form_view"/>
			<field name="arch" type="xml">
				<xpath expr="//sheet" position="before">
					<header>
						<button name="req_amendment_process" class="oe_highlight oe_read_only" type="object" string="Request for Amendment" attrs="{'invisible':['|', '|',('state', '!=', 'approved'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False)]}"/>
						<button name="set_confirm_change" type="object" string="Confirm" attrs="{'invisible':['|', '|',('state', '!=', 'req_amendment'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False)]}"/>
						<button name="action_request_for_approval" string="Request For Approval" type="object" class="oe_highlight oe_read_only" attrs="{'invisible':['|', '|',('state', '!=', 'draft'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False)]}"/>
						<button name="action_approved" string="Approve" type="object" class="oe_highlight oe_read_only" attrs="{'invisible':['|', '|', '|', ('state', '!=', 'waiting_approval'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False), ('is_approve_button', '=', False)]}"/>
						<button name="action_reject_supplier" string="Reject" type="object" class="decoration-secondary" attrs="{'invisible':['|', '|', '|', ('state', '!=', 'waiting_approval'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False), ('is_approve_button', '=', False)]}"/>
						<button name="action_draft" type="object" string="Set to Draft" attrs="{'invisible':[('state', '!=', 'rejected')]}"/>
						<field name="state" invisible="1"/>
						<field name="state1" widget="statusbar" align="right"  statusbar_visible="draft,waiting_approval,approved" attrs="{'invisible':['|', '|',('state', '=', 'rejected'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False)]}"/>
						<field name="state2" widget="statusbar" align="right"  statusbar_visible="draft,waiting_approval,rejected" attrs="{'invisible':['|', '|',('state', '!=', 'rejected'),('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False)]}"/>
					</header>
				</xpath>
				<xpath expr="//sheet/group/group/field[@name='name']" position="attributes">
					<attribute name="context">{'res_partner_search_mode': 'supplier', 'show_vat': True, 
						'tree_view_ref': 'equip3_purchase_operation.view_res_partner_line_tree', 
						'default_is_vendor': 1,
						'search_default_supplier': 1}</attribute>
					<attribute name="options">{'no_create':True,
						'no_create_edit':True}</attribute>
				</xpath>
				<xpath expr="//group[@name='vendor']" position="inside">
					<field name="branch_id" options="{'no_create':True,'no_create_edit':True}"/>
					<field name="create_date"/>
					<field name="is_approve_button" invisible="1"/>
					<field name="changes_id" invisible="1"/>
				</xpath>
				<field name="company_id" position="attributes">
					<attribute name="readonly">1</attribute>
					<attribute name="force_save">1</attribute>
				</field>
				<field name="company_id" position="after">
					<field name="current_user" invisible="1"/>
					<field name="user_approval_ids" invisible="1"/>
					<field name="is_vendor_pricelist_approval_matrix" invisible="1"/>
					<field name="vendor_pricelist_approval_matrix" attrs="{'invisible' : [('vendor_pricelist_approval_matrix', '=', False)]}"/>
				</field>
				<field name="product_code" position="after">
					<field name="vendor_uom" groups="uom.group_uom"/>
				</field>
				<field name="product_uom" position="after">
					<field name="product_uom_category_id" invisible="1"/>
					<field name="product_uom_new" groups="uom.group_uom" required="1"/>
				</field>
				<field name="product_uom" position="attributes">
					<attribute name="readonly">0</attribute>
					<attribute name="invisible">1</attribute>
				</field>
				<field name="min_qty" position="attributes">
					<attribute name="class">thousand-separator-input</attribute>
				</field>
				<field name="price" position="attributes">
					<attribute name="class">thousand-separator-input</attribute>
				</field>
				<field name="delay" position="attributes">
					<attribute name="class">thousand-separator-input oe_inline</attribute>
				</field>
				<xpath expr="//sheet" position="inside">
					<notebook attrs="{'invisible':['|',('is_vendor_pricelist_approval_matrix', '=', False),('vendor_pricelist_approval_matrix', '=', False)]}">
						<page string="Approval Matrix Line">
							<field name="approval_ids" nolabel="True">
								<tree create="false" edit="false" delete="false">
									<field name="sequence" invisible="1"/>
									<field name="sequence2" force_save="1" readonly="1" class="approver_matrix_sequence"/>
									<field name="user_ids" widget="many2many_tags"/>
									<field name="minimum_approver"/>
									<field name="last_approved"/>
									<field name="time_stamp"/>

									<field name="status"/>
									<field name="time"/>
									<field name="feedback"/>
									<field name="approved" invisible="1"/>
									<field name="approval" invisible="1"/>
								</tree>
							</field>
						</page>
						<page string="History" attrs="{'invisible': [('changes_id', '=', 0)]}">
							<group readonly="1">
								<group string="Vendor">
									<field name="name_old" readonly="True"/>
									<field name="product_name_old" readonly="True"/>
									<field name="product_code_old" readonly="True"/>
									<field name="delay_old" readonly="True"/>
									<field name="branch_id_old" readonly="True"/>
									<field name="date_old" readonly="True"/>
									<field name="write_date" string="Last Changed On" readonly="True"/>
								</group>
								<group string="Pricelist">
									<field name="product_tmpl_id_old" string="Product" readonly="True"/>
									<field name="product_id_old" readonly="True"/>
									<label for="min_qty_old"/>
									<div class="o_row">
										<field name="min_qty_old" readonly="True"/>
										<field name="product_uom_old" groups="uom.group_uom" readonly="True"/>
									</div>
									<label for="price_old" string="Unit Price"/>
									<div class="o_row">
										<field name="price_old" readonly="True"/><field name="currency_id_old" readonly="True" groups="base.group_multi_currency"/>
									</div>
									<label for="date_start_old" string="Validity"/>
									<div class="o_row"><field name="date_start_old" readonly="True"/> to <field name="date_end_old" readonly="True"/></div>
									<field name="company_id_old" readonly="True"/>
									<field name="vendor_pricelist_approval_matrix_old" readonly="True" attrs="{'invisible' : [('vendor_pricelist_approval_matrix_old', '=', False)]}"/>
								</group>
							</group>
						</page>
					</notebook>
				</xpath>
				<xpath expr="//sheet" position="after">
					<div class="oe_chatter">
						<field name="message_follower_ids"/>
						<field name="activity_ids"/>
						<field name="message_ids"/>
					</div>
				</xpath>
				<xpath expr="//field[@name='company_id']" position="after">
					<field name="edit_button_state" force_save="1" nolabel="1"/>
				</xpath>
			</field>
		</record>

		<!-- product.supplierinfo inherit tree view -->
		<record id="product_supplierinfo_tree_view" model="ir.ui.view">
			<field name="name">product.supplierinfo.inherit.view.tree</field>
			<field name="model">product.supplierinfo</field>
			<field name="inherit_id" ref="product.product_supplierinfo_tree_view"/>
			<field name="arch" type="xml">
				<xpath expr="//field[@name='company_id']" position="attributes">
					<attribute name="invisible">1</attribute>
				</xpath>
				<field name="delay" position="after">
					<field name="branch_id"/>
					<field name="company_id"/>
				</field>
			</field>
		</record>

		<record model="ir.ui.view" id="cancel_supplier_memory_form">
			<field name="name">cancel.supplier.memory.form</field>
			<field name="model">cancel.supplier.memory</field>
			<field name="arch" type="xml">
				<form>
					<label for="reason" string="Reason For Refusal:"/><p/>
					<field name="reason" style="font-size: 12px"/>
					<footer>
						<button string="Proceed" type="object" name="action_cancel_supplier" class="oe_highlight"/>
						<button string="Cancel" class="oe_link" special="cancel"/>
					</footer>
				</form>
			</field>
		</record>

		<record id="product.product_supplierinfo_type_action" model="ir.actions.act_window">
			<!-- <field name="domain">[('state1', '=', 'approved')]</field> -->
			<field name="domain">[('state1', '=', 'approved'), '|', ('branch_id', 'in', context.get('allowed_branch_ids')), ('branch_id', '=', False)]</field>
		</record>

		<record id="product_supplierinfo_type_action_draft" model="ir.actions.act_window">
			<field name="name">Vendor Pricelists To Approve</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">product.supplierinfo</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="context">{'visible_product_tmpl_id':False, 'group_by': ['state']}</field>
			<!-- <field name="domain">[('state1', '!=', 'approved'), ('changes', '=', False)]</field> -->
			<field name="domain">[('state1', 'not in', ('approved', 'req_amendment')), '|', ('branch_id', 'in', context.get('allowed_branch_ids')), ('branch_id', '=', False)]</field>
			<field name="help" type="html">
				<p class="o_view_nocontent_smiling_face">
					No vendor pricelist found
				</p><p>
				Register the prices requested by your vendors for each product, based on the quantity and the period.
			</p>
			</field>
		</record>

		<record id="vendor_pricelist_changes_to_approve" model="ir.actions.act_window">
			<field name="name">Vendor Pricelist Changes To Approve</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">product.supplierinfo</field>
			<field name="view_mode">tree,form,kanban</field>
			<field name="context">{'visible_product_tmpl_id':False, 'create': False}</field>
			<!-- <field name="domain">[('state', '=', 'req_amendment'), ('changes', '=', True)]</field> -->
			<field name="domain">[('state', '=', 'req_amendment'), ('changes', '=', True), '|', ('branch_id', 'in', context.get('allowed_branch_ids')), ('branch_id','=', False)]</field>
			<field name="help" type="html">
				<p class="o_view_nocontent_smiling_face">
					No vendor pricelist changes to approve found
				</p>
			</field>
		</record>

		<menuitem
				id="vendor_pricelist_sub_menu"
				name="Vendor Pricelists"
				parent="purchase.menu_purchase_config"
				sequence="0"/>

		<menuitem id="purchase.menu_product_pricelist_action2_purchase" name="Vendor Pricelists" parent="equip3_purchase_masterdata.menu_procurement_vendor" sequence="4"/>

		<!--Vendor Pricelists dropdown menu-->
		<menuitem id="menu_product_purchase_vendor_pricelists_main" name="Vendor Pricelists"
				  parent="equip3_purchase_masterdata.menu_procurement_vendor" sequence="4"/>

		<!--Vendor Pricelists under dropdown menu-->
		<menuitem id="menu_product_purchase_vendor_pricelists_sub" name="Vendor Pricelists"
				  parent="menu_product_purchase_vendor_pricelists_main"
				  action="product.product_supplierinfo_type_action" sequence="4"/>

		<menuitem
				action="product_supplierinfo_type_action_draft" id="menu_vendor_pricelist_to_approve"
				parent="menu_product_purchase_vendor_pricelists_main" sequence="5"/>

		<menuitem
				action="vendor_pricelist_changes_to_approve" id="menu_vendor_pricelist_changes_to_approve"
				parent="menu_product_purchase_vendor_pricelists_main" sequence="6"/>

		<function model="product.supplierinfo" name="action_vendors_pricelists_menu"/>

	</data>
</odoo>